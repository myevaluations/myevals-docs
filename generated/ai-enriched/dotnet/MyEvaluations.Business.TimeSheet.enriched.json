{
  "module": "MyEvaluations.Business.TimeSheet",
  "generatedAt": "2026-02-20T16:00:00.000Z",
  "isPriority": false,
  "overview": "The TimeSheet module is a large, feature-rich business layer component (52 classes) responsible for managing resident and trainee duty-hour time tracking within MyEvaluations. It integrates with multiple external scheduling systems -- Amion, QGenda, and Tangier -- to import rotation schedules, on-call assignments, clinic shifts, and cross-cover duties. The module provides time sheet initialization, search, save, and violation-tracking workflows, along with CSV import capabilities and HTTP utilities for API communication.",
  "architecture": "## Overview\n\nThe TimeSheet module is a large, feature-rich business layer component (52 classes) responsible for managing resident and trainee duty-hour time tracking within MyEvaluations. It integrates with multiple external scheduling systems -- Amion, QGenda, and Tangier -- to import rotation schedules, on-call assignments, clinic shifts, and cross-cover duties. The module provides time sheet initialization, search, save, and violation-tracking workflows, along with CSV import capabilities and HTTP utilities for API communication. An audit logging system tracks external API interactions via SQL stored procedures.\n\n## Key Classes\n\n- **AmionManager** (extends Manager): The primary manager class orchestrating Amion scheduling integration. Serves as the central coordinator for importing and synchronizing schedule data from the Amion external scheduling platform.\n- **AmionBase / AmionBaseAssignment**: Base classes forming an inheritance hierarchy for all Amion-related schedule entities and their assignments.\n- **AmionAPIService** (static): Handles HTTP communication with the Amion external API, including tracked HTTP clients, New Relic logging, payload utilities, and SQL-based API audit logging.\n- **SqlApiAuditLogger** (static): Persists API response audit records to the database via the `usp_InsertApiResponseAudit` stored procedure.\n- **QGendaAPI**: Integration client for the QGenda physician scheduling platform.\n- **TangierServiceModel** and related classes: XML/SOAP service model classes for the Tangier scheduling system integration via Web References.\n- **BaseRequest / InitializeRequest / SearchRequest / SaveRequest / ExplanationRequest**: Request hierarchy for time sheet operations.\n- **TimeSheetViolation**: Represents duty-hour violations detected during time sheet review, critical for ACGME compliance tracking.\n- **ActivityInfo / ActivitySettingInfo / ActivityTypeInfo / SubActivityInfo**: Info classes describing time sheet activities, their settings, types, and sub-activities.\n- **RotationInfo**: Data transfer object for rotation schedule information.\n- **CSVReader**: Utility class for parsing CSV-formatted schedule import files.\n\n## Patterns\n\n- **Manager/Info pattern detected**: AmionManager extends the base Manager class, coordinating business logic. Multiple Info classes serve as lightweight data transfer objects.\n- **Inheritance hierarchy**: AmionBase serves as a base class for six Amion entity types; AmionBaseAssignment serves as a base for their corresponding assignment classes.\n- **External API integration**: Three separate scheduling platform integrations (Amion via REST API, QGenda via API, Tangier via SOAP Web References).\n- **Static utility classes**: AmionAPIService, HttpTrackedClient, NewRelicApiLogger, PayloadUtils, and SqlApiAuditLogger are static helper classes.\n- **Audit logging**: API interactions are logged to SQL Server via stored procedures.\n\n## Notes\n\n- This is one of the largest modules in the business layer with 52 classes.\n- The module depends on three external scheduling platforms (Amion, QGenda, Tangier).\n- The SOAP-based Tangier integration is a legacy pattern that would benefit from modernization.\n- Duty-hour violation tracking is critical for ACGME/GME compliance.",
  "managerPattern": "Manager/Info pattern detected",
  "storedProcedures": "usp_InsertApiResponseAudit",
  "keyClasses": [
    {
      "name": "AmionManager",
      "purpose": "Primary manager class orchestrating Amion scheduling integration, extends base Manager class",
      "keyMethods": []
    },
    {
      "name": "AmionAPIService",
      "purpose": "Static service handling HTTP communication with the Amion external API, including audit logging",
      "keyMethods": []
    },
    {
      "name": "SqlApiAuditLogger",
      "purpose": "Static logger persisting API response audit records via usp_InsertApiResponseAudit stored procedure",
      "keyMethods": []
    },
    {
      "name": "QGendaAPI",
      "purpose": "Integration client for the QGenda physician scheduling platform",
      "keyMethods": []
    },
    {
      "name": "TimeSheetViolation",
      "purpose": "Represents duty-hour violations detected during time sheet review for ACGME compliance",
      "keyMethods": []
    },
    {
      "name": "SearchRequest",
      "purpose": "Time sheet search request implementing ICloneable for complex search state management",
      "keyMethods": []
    },
    {
      "name": "AmionBase",
      "purpose": "Base class for all Amion-related schedule entities, extended by 6 Amion entity types",
      "keyMethods": []
    },
    {
      "name": "CSVReader",
      "purpose": "Utility class for parsing CSV-formatted schedule import files",
      "keyMethods": []
    }
  ],
  "businessRules": [],
  "migrationNotes": [],
  "mermaidDiagram": null,
  "mdxContent": "---\ntitle: \"MyEvaluations.Business.TimeSheet\"\ndescription: \"Auto-generated documentation for the MyEvaluations.Business.TimeSheet module\"\nsidebar_label: \"TimeSheet\"\ntags: [dotnet, business-layer]\n---\n\n{/* Auto-generated by ai-enrich-dotnet.ts on 2026-02-20T16:00:00.000Z */}\n\n## Overview\n\nThe TimeSheet module is a large, feature-rich business layer component (52 classes) responsible for managing resident and trainee duty-hour time tracking within MyEvaluations. It integrates with multiple external scheduling systems -- Amion, QGenda, and Tangier -- to import rotation schedules, on-call assignments, clinic shifts, and cross-cover duties. The module provides time sheet initialization, search, save, and violation-tracking workflows, along with CSV import capabilities and HTTP utilities for API communication. An audit logging system tracks external API interactions via SQL stored procedures.\n\n## Key Classes\n\n- **AmionManager** (extends Manager): The primary manager class orchestrating Amion scheduling integration. Serves as the central coordinator for importing and synchronizing schedule data from the Amion external scheduling platform.\n- **AmionBase / AmionBaseAssignment**: Base classes forming an inheritance hierarchy for all Amion-related schedule entities and their assignments. AmionBase is extended by AmionClinic, AmionCrossCover, AmionOnCallSchedule, AmionShiftSchedule, AmionRotation, AmionUser, AmionClinicService, AmionOnCallService, and AmionRotationService.\n- **AmionAPIService** (static): Handles HTTP communication with the Amion external API, including tracked HTTP clients, New Relic logging, payload utilities, and SQL-based API audit logging.\n- **SqlApiAuditLogger** (static): Persists API response audit records to the database via the `usp_InsertApiResponseAudit` stored procedure.\n- **QGendaAPI**: Integration client for the QGenda physician scheduling platform, providing an alternative scheduling data source.\n- **TangierServiceModel** and related classes (tangier, tangierSchedule, tangierScheduleDatesDate, tangierScheduleDatesDateShiftsShift, tangierLocationsLocation, NewDataSet): XML/SOAP service model classes for the Tangier scheduling system integration via Web References.\n- **BaseRequest / InitializeRequest / SearchRequest / SaveRequest / ExplanationRequest**: Request hierarchy for time sheet operations including initialization, searching (implements ICloneable), saving entries, and providing duty-hour explanations.\n- **TimeSheetViolation**: Represents duty-hour violations detected during time sheet review, critical for ACGME compliance tracking.\n- **ActivityInfo / ActivitySettingInfo / ActivityTypeInfo / SubActivityInfo**: Info classes describing time sheet activities, their settings, types, and sub-activities.\n- **RotationInfo**: Data transfer object for rotation schedule information.\n- **CSVReader**: Utility class for parsing CSV-formatted schedule import files.\n- **HttpUtil**: HTTP utility class for web request handling.\n- **Constants**: Module-wide constant definitions.\n- **AmionScheduleTempTable / AmionScheduleLastUpdateDate**: Temporary table models and tracking for schedule synchronization timestamps.\n- **ScheduleRequest** (TangierSchedule namespace, extends SoapHttpClientProtocol): SOAP web service proxy for Tangier schedule data retrieval.\n\n## Patterns\n\n- **Manager/Info pattern detected**: AmionManager extends the base Manager class, coordinating business logic. Multiple Info classes (ActivityInfo, ActivitySettingInfo, ActivityTypeInfo, RotationInfo, SubActivityInfo) serve as lightweight data transfer objects.\n- **Inheritance hierarchy**: AmionBase serves as a base class for six Amion entity types; AmionBaseAssignment serves as a base for their corresponding assignment classes. BaseRequest forms a request hierarchy with four specialized request types.\n- **External API integration**: Three separate scheduling platform integrations (Amion via REST API, QGenda via API, Tangier via SOAP Web References) following an adapter-like pattern.\n- **Static utility classes**: AmionAPIService, HttpTrackedClient, NewRelicApiLogger, PayloadUtils, and SqlApiAuditLogger are static helper classes for cross-cutting concerns.\n- **Audit logging**: API interactions are logged to SQL Server via stored procedures for compliance and debugging.\n\n## Notes\n\n- This is one of the largest modules in the business layer with 52 classes, indicating significant complexity in duty-hour tracking and schedule integration.\n- The module depends on three external scheduling platforms (Amion, QGenda, Tangier), making it a key integration point. Migration to NestJS would require replicating these external API integrations.\n- The SOAP-based Tangier integration (Web References) is a legacy pattern that would benefit from modernization during migration.\n- The `usp_InsertApiResponseAudit` stored procedure is the only detected sproc; the AmionManager likely delegates further database operations to other modules or uses inline queries.\n- Duty-hour violation tracking (TimeSheetViolation) is critical for ACGME/GME compliance and must be preserved during any migration effort.\n- The ICloneable implementation on SearchRequest suggests complex search state management that may need careful translation.\n\n---\n*This documentation was auto-generated from source code analysis. Last updated: 2026-02-20T16:00:00.000Z*"
}
