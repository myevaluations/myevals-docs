{
  "module": "MyEvaluations.Business.Security",
  "generatedAt": "2026-02-20T00:00:00.000Z",
  "isPriority": true,
  "overview": "The MyEvaluations.Business.Security module is the foundational security and identity layer of the MyEvaluations platform -- a healthcare education management system serving 10,000+ users across 900+ institutions for GME, CME, Nursing, and PA programs. With 119 classes (including 23 Manager classes), this module is the single largest business-layer assembly and touches virtually every aspect of the platform. It implements a classic Manager/Info pattern with all database access mediated through SQL Server stored procedures.",
  "architecture": "## Architecture Overview\n\nThe `MyEvaluations.Business.Security` module is the foundational security and identity layer of the MyEvaluations platform -- a healthcare education management system serving 10,000+ users across 900+ institutions for GME (Graduate Medical Education), CME, Nursing, and PA programs. With **119 classes** (including **23 Manager classes**), this module is the single largest business-layer assembly and touches virtually every aspect of the platform.\n\nThe module implements a classic **Manager/Info pattern**: Manager classes encapsulate business logic and orchestrate SQL Server stored procedure calls, while Info classes serve as Data Transfer Objects (DTOs) that carry data between layers. All database access is mediated through stored procedures -- there is no raw SQL or ORM usage.\n\n### Functional Domains\n\n1. **Authentication and Multi-Factor Authentication (MFA)** -- Login verification, password encryption, multi-factor auth via email and SMS, auth code generation/verification, and user impersonation.\n2. **Authorization and Role-Based Access Control (RBAC)** -- Role definitions, privilege assignments, sub-module permissions, feature flags per user and department, and menu visibility control.\n3. **User Management** -- User profiles, user search, user merging, demographics reporting, extended user info, login history, and email management.\n4. **Institutional Hierarchy** -- Institutions, departments, department groups, institution-level department groups, training types, time zones, sub-specialities, and GME/IGA administrative structures.\n5. **Onboarding (OBC)** -- Custom fields, custom forms, requirement groups, document types, onboarding group participants, lookup items, and managed fields with institution-level configurability.\n6. **Certificates and Credentials** -- Certificate templates, user certificate assignments, certificate signatures, preceptor management, speciality templates, exam tracking, and training agreements.\n7. **Operational Support** -- Audit trails, access history, service messages, build schedules, curriculum management, UIC management, New Relic logging, encryption utilities, and application settings.",
  "managerPattern": "Manager/Info pattern detected",
  "storedProcedures": "GetAOCAndMOC,InsertAOCAndMOS,GetAOCAndMOSByID,GetTrainingFrequency,GetTrainingSkillLevel,DeleteAOCAndMOS,GetAccessHistoryByID,GetAccessHistoryByFilter,GetAccessHistoryEntityListByEventID,GetAcademicDateRange,GetAccessHistoryEventTypeList,GetCurrentAcademicYear,GetAuditTrailList,GetAuditTrailListByCriteria,GetUserSpecialityByID,GetUserSpecialityByName,InsertUpdateSpeciality,GetScheduleNames,DeleteSchedules,PublishSchedules,InsertBuildSchedule,UpdateBuildSchedule,GetScheduleNamesById,GetCertificateTemplateByID,GetAllCertificateTemplates,GetCertificateTemplates,GetUserCertifications,InsertCertificateTemplate,DeleteCertificateTemplate,DeleteUserCertificateAssignment,UpdateUserCertificateFields,GetCertificateUsers,GetCertificateSignatureRoles,AssignCertificateTemplate,GetUserCertificationDetailsByID,GetCertificateCustomData,GetCurriculumDetails,DoesOBCFieldNameExist,AddOBCField,UpdateOBCField,GetOBCCustomFieldInfoByID,DeleteOBCField,DeleteOBCForm,DeleteOBCRequirementGroup,DeleteOBCDocumentType,RestoreOBCDeletedFields,RestoreOBCDeletedCustomForms,RestoreOBCDeletedRequirementGroups,RestoreOBCDeletedDocumentTypes,AddLookUp,AddLookUpItem,UpdateLookUp,UpdateLookUpItem,AddOBCLookup,UpdateOBCLookup,AddOBCLookupItem,UpdateOBCLookupItem,GetOBCLookUpItemInfoByID,GetOBCLookUpValuesByLookUpItemID,DoesOBCLookUpNameExist,GetMultiFactorVerificationEmailTemplate,CHANGEEMAIL,CheckUserHasFeature,CheckDepartmentHasFeature,GetFeatureList,GetEnabledFeaturesForUserAndDepartment,GetCustomLookupItems,GetUserTypeList,UserID,GetManagedFieldsByInstitutionId,GetFieldsOnNhbSettingByInstitutionId,GetDegreeFieldsOnNhbSettingByInstitutionId,GetTaxandWithholdingsFieldsOnNhbSettingByInstitutionId,GetMilitaryFieldsOnNhbSettingByInstitutionId,GetManageDepartmentFieldsByInstitutionId,GetManageFieldsDataTypesList,UpdateManagedFieldsData,GetFirstLevelMenuItems,GetPageHierarchy,GetOBCGroupParticipantsListByCriteriaForAllUsers,GetOBCGroupParticipantsInfoByGroupIDForAllUsers,UpdateOBCGroupParticipantsInfo,DeleteOBCGroupParticipantsInfo,GetPreceptorsList,AddOBCGroupParticipants,DoesOBCGroupNameExist,GetOBCDepartmentGroups,GetOBCUsersListByGroup,usp_GetPreceptorSessionDetails,GetPreceptorDetails,GetHoldPreceptorDetails,DeletePreceptorDetails,HoldPreceptorDetails,ApprovePreceptorDetails,HoldPreceptorDetailsTrainee,ApprovePreceptorDetailsTrainee,InsertLinkTraineesToCampusCluster,GetPreceptorDetailsForTraineeRequest,GetHoldPreceptorDetailsForTraineeRequest,GetCampusLinkedTrainees,GetPreceptorDetailsForTraineeRequestLogin,GetPreceptorDetailsbyIDForTrainee,ApprovePreceptorDetailsTraineeDetails,DeletePreceptorDetailsTraineeDetails,GetSubModuleList,GetRoleListByCriteria,GetPrivilegesForRole,CheckPrivilegesLastUpdatedStatus,AddRole,GetRoleInfoByID,GetServiceMessage,EmailAutoLoginFeature,AddServiceMessage,GetUserSpecialities,DeleteSpecialityName,GetUIC,InsertUIC,GetUICByID,DeleteUIC,UpdateUIC,GenerateAuthCode,VerifyAuthCode,GetMFARequirementForRoleIdByDepartmentIds",
  "keyClasses": [
    {"name": "RoleManager", "purpose": "RBAC role and privilege management with sub-module scoping", "keyMethods": ["GetPrivilegesForRole", "AddRole", "GetRoleInfoByID", "GetSubModuleList", "GetRoleListByCriteria"]},
    {"name": "FeatureManager", "purpose": "Feature flag system for users and departments enabling per-institution customization", "keyMethods": ["CheckUserHasFeature", "CheckDepartmentHasFeature", "GetFeatureList", "GetEnabledFeaturesForUserAndDepartment"]},
    {"name": "AccessHistoryManager", "purpose": "User access event tracking and querying scoped to academic years", "keyMethods": ["GetAccessHistoryByFilter", "GetAccessHistoryByID", "GetCurrentAcademicYear"]},
    {"name": "AuditTrailManager", "purpose": "Compliance audit trail management for healthcare education accreditation", "keyMethods": ["GetAuditTrailList", "GetAuditTrailListByCriteria"]},
    {"name": "AuthCodeService", "purpose": "MFA authentication code generation and verification", "keyMethods": ["GenerateAuthCode", "VerifyAuthCode"]},
    {"name": "AuthFactorService", "purpose": "Abstract base class for authentication factors (email, SMS, password)", "keyMethods": []},
    {"name": "EmailFactorService", "purpose": "Email-based MFA factor with template-driven verification emails", "keyMethods": ["GetMultiFactorVerificationEmailTemplate"]},
    {"name": "SmsFactorService", "purpose": "SMS-based MFA factor", "keyMethods": []},
    {"name": "PasswordFactorService", "purpose": "Password-based primary authentication factor", "keyMethods": []},
    {"name": "MultiFactorAuthentication", "purpose": "MFA requirement evaluation per role and department combination", "keyMethods": ["GetMFARequirementForRoleIdByDepartmentIds"]},
    {"name": "UserManager", "purpose": "Core user lifecycle management including merging and profile operations", "keyMethods": []},
    {"name": "EmailManager", "purpose": "User email address change management", "keyMethods": ["CHANGEEMAIL"]},
    {"name": "MenuManager", "purpose": "Role-based navigation menu visibility and hierarchy control", "keyMethods": ["GetFirstLevelMenuItems", "GetPageHierarchy"]},
    {"name": "CustomFieldsManager", "purpose": "Onboarding custom fields CRUD with soft-delete and restoration", "keyMethods": ["AddOBCField", "UpdateOBCField", "DeleteOBCField", "RestoreOBCDeletedFields"]},
    {"name": "CustomLookUpItemManager", "purpose": "Onboarding and standard lookup items management", "keyMethods": ["AddOBCLookup", "AddOBCLookupItem", "GetOBCLookUpItemInfoByID"]},
    {"name": "OnboardingGroupParticipantsManager", "purpose": "Onboarding group and participant lifecycle management with preceptor integration", "keyMethods": ["AddOBCGroupParticipants", "GetPreceptorsList", "GetOBCDepartmentGroups"]},
    {"name": "ManageFieldsManager", "purpose": "Institution-level field visibility control for NHB settings", "keyMethods": ["GetManagedFieldsByInstitutionId", "UpdateManagedFieldsData"]},
    {"name": "CertificateTemplateManager", "purpose": "Certificate template lifecycle, assignment, and signature role management", "keyMethods": ["InsertCertificateTemplate", "AssignCertificateTemplate", "GetCertificateSignatureRoles"]},
    {"name": "PreceptorTemplateManager", "purpose": "Preceptor approval workflow with hold/approve/delete states for both preceptor and trainee paths", "keyMethods": ["ApprovePreceptorDetails", "HoldPreceptorDetails", "InsertLinkTraineesToCampusCluster"]},
    {"name": "SpecialityTemplateManager", "purpose": "Medical speciality template CRUD operations", "keyMethods": ["InsertUpdateSpeciality", "GetUserSpecialities", "DeleteSpecialityName"]},
    {"name": "BuildScheduleManager", "purpose": "Training schedule creation, publishing, and speciality association", "keyMethods": ["InsertBuildSchedule", "PublishSchedules", "UpdateBuildSchedule"]},
    {"name": "ServiceMessageManager", "purpose": "System-wide service messages and email auto-login feature management", "keyMethods": ["GetServiceMessage", "AddServiceMessage", "EmailAutoLoginFeature"]},
    {"name": "AOCAndMOSManager", "purpose": "Military AOC/MOS and training frequency/skill level management", "keyMethods": ["InsertAOCAndMOS", "GetAOCAndMOC", "GetTrainingFrequency"]},
    {"name": "UICManager", "purpose": "Military Unit Identification Code (UIC) CRUD", "keyMethods": ["GetUIC", "InsertUIC", "UpdateUIC", "DeleteUIC"]},
    {"name": "LookUpManager", "purpose": "Standard lookup data services for dropdowns and selection lists", "keyMethods": ["GetCustomLookupItems", "GetUserTypeList"]},
    {"name": "PasswordEncryptor", "purpose": "Password hashing and encryption utilities", "keyMethods": []},
    {"name": "EncryptValue", "purpose": "Value-level encryption wrapper for sensitive data", "keyMethods": []},
    {"name": "LoginUserInfo", "purpose": "DTO for authenticated user session data", "keyMethods": []},
    {"name": "UserMergeResult", "purpose": "DTO for user merge operation results implementing IUserMergeResult", "keyMethods": []}
  ],
  "businessRules": [
    "Users are assigned roles scoped to sub-modules; each role contains a set of privileges checked via RoleManager",
    "Features can be enabled/disabled at both user and department granularity via FeatureManager, allowing institution-specific customization",
    "MFA is configurable per department and role combination; supports email and SMS as second factors with password as primary",
    "Auth codes are time-limited and generated/verified via AuthCodeService stored procedures",
    "Onboarding custom fields (OBC) support soft-delete with full restoration capability for fields, forms, requirement groups, and document types",
    "Custom lookup items provide configurable dropdown options within onboarding forms, supporting both standard and OBC-specific lookups",
    "Certificate templates are created, assigned to users, and support custom data fields and multiple signature roles",
    "Preceptor assignments follow a multi-step approval process with hold/approve/delete states and separate workflows for preceptor-initiated and trainee-initiated requests",
    "Institution administrators control field visibility on the New Hire Board settings, including specialized field groups for degrees, tax/withholdings, and military info",
    "Access history and audit queries are scoped to academic years via GetCurrentAcademicYear and GetAcademicDateRange",
    "User accounts can be merged via UserMergeResult which implements IUserMergeResult interface",
    "Navigation menus are dynamically generated based on user roles and page hierarchy via MenuManager",
    "Onboarding group names must be unique (enforced by DoesOBCGroupNameExist), and similarly for OBC field names and lookup names",
    "Sensitive values are encrypted via PasswordEncryptor and EncryptValue with extension methods"
  ],
  "migrationNotes": [
    "Authentication flow (AuthCodeService, AuthFactorService hierarchy, MFA classes) should be migrated first since NestJS already has JWT-based auth; MFA stored procedures need NestJS equivalents",
    "Feature flag system (FeatureManager, 4 SPs) is a strong candidate for migration to a modern feature flag service or custom NestJS module backed by PostgreSQL",
    "RBAC (RoleManager/MenuManager) maps naturally to NestJS Guards and custom decorators; consider CASL library for authorization",
    "Onboarding subsystem (CustomFieldsManager, CustomLookUpItemManager, OnboardingGroupParticipantsManager, ManageFieldsManager) with ~30 SPs forms a cohesive bounded context -- migrate as single NestJS module",
    "CertificateTemplateManager (13 SPs) interacts with signature roles and user assignments; migration requires coordination with user management module",
    "PreceptorTemplateManager (17 SPs) implements complex approval workflow requiring a state machine in NestJS (e.g., xstate)",
    "GetUserSpecialityByID and InsertUpdateSpeciality are shared across 3 managers -- create a shared SpecialityService in NestJS",
    "AuditTrailManager and AccessHistoryManager are critical for healthcare compliance; during migration both systems must write to same audit tables",
    "Military features (AOCAndMOSManager, UICManager) should be isolated into an optional NestJS module enabled/disabled per institution",
    "PasswordEncryptor and EncryptValue need careful migration -- password hashing algorithms must be compatible or use re-hash-on-login strategy",
    "UserManager appears in UserMergeResult.cs as partial class -- verify all partial class files are captured before migration",
    "8 SearchCriteria classes should map to NestJS DTO classes with class-validator decorators for input validation"
  ],
  "mermaidDiagram": "graph TD\n    A[WebForms UI / API Layer] --> B[Manager Classes]\n    B --> C[SQL Server Stored Procedures]\n    C --> D[(SQL Server Database)]\n    B --> E[Info/DTO Classes]\n    E --> A\n\n    subgraph Authentication Flow\n        F[Login Request] --> G[PasswordFactorService]\n        G --> H{MFA Required?}\n        H -->|Yes| I[MultiFactorAuthentication]\n        I --> J{Factor Type}\n        J -->|Email| K[EmailFactorService]\n        J -->|SMS| L[SmsFactorService]\n        K --> M[AuthCodeService]\n        L --> M\n        M --> N[GenerateAuthCode SP]\n        M --> O[VerifyAuthCode SP]\n        H -->|No| P[Session Created]\n        O -->|Valid| P\n    end\n\n    subgraph Authorization Flow\n        Q[Page Request] --> R[FeatureManager]\n        R --> S[CheckUserHasFeature SP]\n        R --> T[CheckDepartmentHasFeature SP]\n        Q --> U[RoleManager]\n        U --> V[GetPrivilegesForRole SP]\n        Q --> W[MenuManager]\n        W --> X[GetFirstLevelMenuItems SP]\n    end\n\n    subgraph Onboarding Flow\n        Y[Admin Config] --> Z[CustomFieldsManager]\n        Z --> AA[AddOBCField / UpdateOBCField SPs]\n        Y --> AB[CustomLookUpItemManager]\n        AB --> AC[AddOBCLookup / AddOBCLookupItem SPs]\n        Y --> AD[OnboardingGroupParticipantsManager]\n        AD --> AE[AddOBCGroupParticipants SP]\n        AD --> AF[GetPreceptorsList SP]\n    end\n\n    subgraph Institutional Hierarchy\n        AG[Institution] --> AH[Department Groups]\n        AH --> AI[Departments]\n        AI --> AJ[Users / Roles]\n        AI --> AK[Features per Department]\n        AG --> AL[Managed Fields per Institution]\n    end",
  "mdxContent": "---\ntitle: \"MyEvaluations.Business.Security\"\ndescription: \"Auto-generated documentation for the MyEvaluations.Business.Security module\"\nsidebar_label: \"Security\"\ntags: [dotnet, business-layer, priority]\n---\n\n{/* Auto-generated by ai-enrich-dotnet.ts on 2026-02-20T00:00:00.000Z */}\n\n## Architecture Overview\n\nThe `MyEvaluations.Business.Security` module is the foundational security and identity layer of the MyEvaluations platform -- a healthcare education management system serving 10,000+ users across 900+ institutions for GME (Graduate Medical Education), CME, Nursing, and PA programs. With **119 classes** (including **23 Manager classes**), this module is the single largest business-layer assembly and touches virtually every aspect of the platform.\n\nThe module implements a classic **Manager/Info pattern**: Manager classes encapsulate business logic and orchestrate SQL Server stored procedure calls, while Info classes serve as Data Transfer Objects (DTOs) that carry data between layers. All database access is mediated through stored procedures -- there is no raw SQL or ORM usage. This pattern is consistent across the entire .NET 4.6.1 WebForms backend.\n\n### Functional Domains\n\nThe Security module spans seven major functional domains:\n\n1. **Authentication and Multi-Factor Authentication (MFA)** -- Login verification, password encryption, multi-factor auth via email and SMS, auth code generation/verification, and user impersonation.\n\n2. **Authorization and Role-Based Access Control (RBAC)** -- Role definitions, privilege assignments, sub-module permissions, feature flags per user and department, and menu visibility control.\n\n3. **User Management** -- User profiles, user search, user merging, demographics reporting, extended user info, login history, and email management.\n\n4. **Institutional Hierarchy** -- Institutions, departments, department groups, institution-level department groups, training types, time zones, sub-specialities, and GME/IGA administrative structures.\n\n5. **Onboarding (OBC)** -- Custom fields, custom forms, requirement groups, document types, onboarding group participants, lookup items, and managed fields with institution-level configurability.\n\n6. **Certificates and Credentials** -- Certificate templates, user certificate assignments, certificate signatures, preceptor management, speciality templates, exam tracking, and training agreements.\n\n7. **Operational Support** -- Audit trails, access history, service messages, build schedules, curriculum management, UIC management, New Relic logging, encryption utilities, and application settings.\n\n### Class Distribution\n\n| Category | Count | Examples |\n|----------|-------|----------|\n| Manager classes (business logic) | 23 | `RoleManager`, `FeatureManager`, `UserManager` |\n| Info/DTO classes | ~55 | `RoleInfo`, `InstitutionInfo`, `LoginUserInfo` |\n| SearchCriteria classes | 8 | `UserSearchCriteria`, `RoleSearchCriteria` |\n| Authentication services | 5 | `AuthFactorService`, `EmailFactorService`, `SmsFactorService` |\n| Utility/Infrastructure | ~10 | `PasswordEncryptor`, `EncryptValue`, `Utility` |\n| Business helper classes | ~18 | `AccessHistoryBusiness`, `CurriculumBusiness`, `ManageUsers` |\n\n---\n\n*This documentation was auto-generated from source code analysis. Last updated: 2026-02-20T00:00:00.000Z*"
}
