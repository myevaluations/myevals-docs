{"module":"perf","displayName":"Performance Schema","procedureCount":71,"procedures":[{"name":"AddDefaultFieldsToGroup","schema":"perf","parameters":[{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PRC_FieldGroups","PRC_Fields","PRC_ProcedureGroups"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Copies field groups and system fields from the default procedure group to a newly created procedure group within the same department. Used during department procedure group setup to ensure new groups start with the standard system fields.","businessPurpose":"Supports the procedure tracking (PRC) module when a new procedure group is created, seeding it with the department's default system-defined field groups and fields so administrators do not need to manually recreate them.","optimizationRecommendations":["Add indexes on PRC_FieldGroups(ProcedureGroupID) and PRC_FieldGroups(ProcedureGroupID, IsDel) to speed the two INSERT...SELECT lookups.","Add a composite index on PRC_Fields(FieldGroupID, IsSystem) to optimize the field-copy query."],"migrationRelevance":"medium"},{"name":"AddEncounterTypeForImport","schema":"perf","parameters":[],"lineCount":20,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Inserts a new competence level (encounter type) into perf.PTL_CompetenceLevels for a given department and returns the new ID via SCOPE_IDENTITY(). Used during patient log data import to create missing encounter type references.","businessPurpose":"Enables data import pipelines for the Patient Tracking Log (PTL) module to dynamically create encounter type lookup values when importing historical patient log records that reference encounter types not yet in the system.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddLevelOfParticipationForImport","schema":"perf","parameters":[],"lineCount":37,"tablesReferenced":["PRC_ParticipationTypes","PRC_ParticipationTypesCustom"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Inserts a participation type into PRC_ParticipationTypes if it does not already exist, then creates a department-specific customization record in PRC_ParticipationTypesCustom and returns the new custom record ID. Handles upsert semantics for the global type before inserting the department link.","businessPurpose":"Supports data import for the procedures module by ensuring participation type lookup values (e.g., 'Performed', 'Observed') exist before linking them to a specific department, allowing imported procedure records to reference valid foreign keys.","optimizationRecommendations":["Add an index on PRC_ParticipationTypes(Description, IsDel) to speed the existence check and lookup used at the start of the SP."],"migrationRelevance":"low"},{"name":"AddPatient","schema":"perf","parameters":[{"name":"@PatientName","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["PRC_Patients"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["NiImportManager.cs.FillPRC","PatientManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Performs a find-or-create operation on perf.PRC_Patients: searches for an existing patient by PatientName and MRNumber, inserts a new record only if none is found, and returns the PatientID. Uses @@IDENTITY after insert.","businessPurpose":"Centralizes patient deduplication for procedure submissions in the PRC module, preventing duplicate patient records when residents submit procedures for the same patient multiple times.","optimizationRecommendations":["Use SCOPE_IDENTITY() instead of @@IDENTITY to avoid identity collisions if triggers are ever added to PRC_Patients.","Add a composite index on PRC_Patients(PatientName, MRNumber) to accelerate the existence check query.","Wrap the SELECT + conditional INSERT in an explicit transaction to prevent race conditions under concurrent load."],"migrationRelevance":"medium"},{"name":"AddPatientLogPatient","schema":"perf","parameters":[{"name":"@PatientName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@MRNumber","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@DateOfBirth","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":15,"tablesReferenced":["PRC_Patients"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["NiImportManager.cs.FillPTL","PatientManager.cs.Save"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a new patient record with DOB and gender if one matching PatientName and MRNumber does not already exist, then returns the patient ID. More complete than AddPatient as it includes DateOfBirth and GenderID.","businessPurpose":"Supports the Patient Tracking Log (PTL) import flow by ensuring patient demographic records are created exactly once, returning the existing ID if the patient is already on file.","optimizationRecommendations":["Replace the EXISTS + separate SELECT pattern with a single SELECT TOP 1 plus conditional insert to halve the number of table scans.","Add a composite index on PRC_Patients(PatientName, MRNumber) shared with AddPatient."],"migrationRelevance":"medium"},{"name":"AddProcedureForImport","schema":"perf","parameters":[],"lineCount":36,"tablesReferenced":["PRC_ProcedureCategories","PRC_Procedures","PRC_ProceduresBase"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Ensures a default procedure category exists for a department, finds or creates a base procedure record in PRC_ProceduresBase, then inserts a department-specific procedure entry in PRC_Procedures and returns its new ID.","businessPurpose":"Supports the procedure import pipeline by creating the full procedure hierarchy (category, base, department-specific) needed before imported procedure submissions can reference valid foreign keys.","optimizationRecommendations":["Replace the two LIKE-based lookups with exact equality checks (=) on ProcedureName where possible to allow index use.","Add an index on PRC_ProceduresBase(ProcedureName) to speed the base procedure lookup.","Replace @@IDENTITY with SCOPE_IDENTITY() for safety."],"migrationRelevance":"medium"},{"name":"AddProcedureImportSession","schema":"perf","parameters":[{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":10,"tablesReferenced":["PRC_ProcedureImportSession"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["ImportProceduresManager.cs.AddProcedureImportSession"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Creates a new import session record in Perf.PRC_ProcedureImportSession capturing the user, department, and selected user, then returns the session ID via SCOPE_IDENTITY().","businessPurpose":"Tracks each procedure data import batch initiated by an administrator in the PRC module, enabling audit trails and linking imported procedure submissions back to the originating session.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddPtLogLocationForImport","schema":"perf","parameters":[],"lineCount":18,"tablesReferenced":["PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a new location record into perf.PTL_Locations for a given department and returns the new ID via SCOPE_IDENTITY(). Used during patient log data import to create missing location lookup values.","businessPurpose":"Supports the PTL import pipeline by dynamically creating location lookup entries when imported patient logs reference locations not yet present in the system.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddSubmitedProcedureImport","schema":"perf","parameters":[{"name":"@ProcedureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SupervisorID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@CompletedDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ConsentTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresStatusID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@IsGrandFathered","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@ParticipationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ComplicationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@IsDeleted","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@ModifiedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":66,"tablesReferenced":["PRC_ProceduresSubmitted"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Inserts a fully-populated procedure submission record into perf.PRC_ProceduresSubmitted with all associated metadata (participation type, complication type, consent type) using CASE expressions to handle zero/null defaults, and returns the new submission ID.","businessPurpose":"Core import SP for the procedure module, used to bulk-load historical or externally-sourced procedure submissions (e.g., from NI imports or Excel imports) into the system with correct field mapping and sensible defaults.","optimizationRecommendations":["The subquery SELECT UserTypesLevelID FROM dbo.sec_users WHERE UserID=@UserId runs on every call; consider passing this value as a parameter from the calling context to eliminate the nested SELECT.","Add SET NOCOUNT ON to suppress row-count messages during import batches."],"migrationRelevance":"high"},{"name":"DecryptValue","schema":"perf","parameters":[{"name":"@input1","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@input2","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":5,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Calls dbo.fnDecryptValue on up to three input values and returns the decrypted results as a single row with three columns. A thin wrapper around the encryption function for multi-value decryption in one call.","businessPurpose":"Provides a convenient multi-value decryption utility used by the MyEvaluations platform when displaying patient PII (e.g., patient name, MRN, date of birth) that is stored in encrypted form.","optimizationRecommendations":[],"migrationRelevance":"high"},{"name":"Draw_PRC_DepartmentProcedurePGYReport","schema":"perf","parameters":[],"lineCount":37,"tablesReferenced":["RPT_Res_PRC_DepartmentProcedurePGYReport"],"sprocsCalledFromBody":[],"crudType":"report","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Reads pre-computed report data from RPT_Res_PRC_DepartmentProcedurePGYReport for a given ReportID, returning both per-PGY-level detail rows and aggregate totals using a UNION with a sentinel lvl of -1.","businessPurpose":"Powers the Department Procedure PGY Report in the PRC reporting module, which shows supervisors and program directors a breakdown of procedure activity (approved, performed, participated, etc.) by training year level for their department.","optimizationRecommendations":["Ensure an index on RPT_Res_PRC_DepartmentProcedurePGYReport(ReportID) to avoid full table scans for both branches of the UNION."],"migrationRelevance":"medium"},{"name":"Draw_PRC_ErrorReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["RPT_Res_PRC_ErrorReport"],"sprocsCalledFromBody":[],"crudType":"report","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Dynamically pivots error report data from RPT_Res_PRC_ErrorReport, constructing a column per resident (UserName) using STRING_AGG and sp_executesql, producing a crosstab of error counts by error category and name.","businessPurpose":"Renders the Procedure Error Report in a pivot table format where each resident is a column, allowing program directors to see error patterns by category and individual resident at a glance.","optimizationRecommendations":["The dynamic SQL pivot exposes SQL injection risk if UserName values are not sanitized; validate or quote names defensively.","Ensure an index on RPT_Res_PRC_ErrorReport(ReportID) to make the STRING_AGG subquery and the final pivot query efficient.","Consider caching the column list in the report generation SP to avoid rebuilding it on every Draw call."],"migrationRelevance":"medium"},{"name":"Draw_PRC_SummaryCompetencyReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["RPT_Res_PRC_SummaryReport_Summary"],"sprocsCalledFromBody":[],"crudType":"report","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Pivots pre-computed summary report data from RPT_Res_PRC_SummaryReport_Summary into a resident-per-column layout showing CertifiedStatus per procedure, using dynamic SQL constructed with STRING_AGG.","businessPurpose":"Renders the Summary Competency Report pivot table that allows program directors to see each resident's certification status across all required procedures in a single matrix view.","optimizationRecommendations":["Same SQL injection risk as Draw_PRC_ErrorReport for UserName values in dynamic column names.","Add an index on RPT_Res_PRC_SummaryReport_Summary(ReportID, ProcedureName) to speed the pre-aggregation and final pivot."],"migrationRelevance":"medium"},{"name":"Draw_PRC_SummaryLOSReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["RPT_Res_PRC_SummaryReport_Summary"],"sprocsCalledFromBody":[],"crudType":"report","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Pivots summary report data from RPT_Res_PRC_SummaryReport_Summary into a resident-per-column layout showing Level of Supervision per procedure, using dynamic SQL with a PRINT statement for debugging and an ORDER BY clause that surfaces 'Date Last Updated' last.","businessPurpose":"Renders the Level of Supervision Summary Report showing each resident's supervision level for every procedure, enabling program directors to assess trainee autonomy across the cohort.","optimizationRecommendations":["Remove the PRINT @query statement from production code; it outputs noise and slightly degrades performance.","Same SQL injection mitigation needed for UserName-based dynamic columns."],"migrationRelevance":"medium"},{"name":"Draw_PTL_DepartmentReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["RPT_Res_PTL_DepartmentReport"],"sprocsCalledFromBody":[],"crudType":"report","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Pivots patient tracking log department report data into a dynamic PGY-level-per-column format using STRING_AGG, with column headers derived from the department's training type configuration and a Total column appended.","businessPurpose":"Renders the PTL Department Report as a crosstab with one column per training year (PGY-1, PGY-2, etc.) showing diagnosis encounter counts per department, supporting ACGME program tracking requirements.","optimizationRecommendations":["The query against master..spt_values to generate column numbers is a SQL Server internal hack; replace with a user-defined number table for clarity and portability.","Ensure an index on RPT_Res_PTL_DepartmentReport(ReportID) to make the STRING_AGG subquery efficient."],"migrationRelevance":"medium"},{"name":"Draw_PTL_SummaryReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":31,"tablesReferenced":["RPT_Res_PTL_SummaryReport"],"sprocsCalledFromBody":[],"crudType":"report","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Pivots patient tracking log summary report data into a PGY-per-column layout using dynamic SQL, with a PRINT statement, an ORDER BY sorting 'No diagnosis specified' to the end, and Total and Total_DEP aggregate columns.","businessPurpose":"Renders the PTL Summary Report pivot table showing diagnosis encounter counts by resident and training year, giving program directors a comprehensive view of patient log activity across the cohort.","optimizationRecommendations":["Remove the PRINT @query statement from production code.","Same master..spt_values concern as Draw_PTL_DepartmentReport.","Add an index on RPT_Res_PTL_SummaryReport(ReportID, DepartmentName, UserName, DiagnosisName) to support the GROUP BY."],"migrationRelevance":"medium"},{"name":"EncryptValue","schema":"perf","parameters":[{"name":"@input1","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@input2","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":5,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Calls dbo.fnEncryptValue on up to three input values and returns the encrypted results as a single row. Symmetric counterpart to DecryptValue.","businessPurpose":"Used to encrypt patient PII (name, MRN, date of birth) before storage, ensuring sensitive data at rest meets the platform's security requirements.","optimizationRecommendations":[],"migrationRelevance":"high"},{"name":"Fill_PRC_AbilityReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":111,"tablesReferenced":["PRC_LevelsOfSupervision","PRC_ProcedureCategories","PRC_Procedures","PRC_ProceduresAvailability","PRC_ProceduresBase","PRC_ProceduresCertification","PRC_ProceduresSubmitted","PRC_ReportLanguages","PRC_SupervisionRequirements","RPT_Res_PRC_AbilityReport","RPT_Res_PRC_AbilityReport_CategoryName","RPT_Res_PRC_AbilityReport_Certifications","SEC_Certifications","SEC_Departments","SEC_UserCertifications","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":2,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Populates three report result tables (RPT_Res_PRC_AbilityReport, RPT_Res_PRC_AbilityReport_CategoryName, RPT_Res_PRC_AbilityReport_Certifications) for a specific user's ability/certification report using an upsert (insert-new, delete-removed, update-changed) pattern via temp tables to avoid full deletes.","businessPurpose":"Generates the data for the Ability Report (also called the Certification Report) that shows a resident's certification status, level of supervision, and medical certifications (BLS, ACLS, etc.) across all required procedures in their department.","optimizationRecommendations":["The upsert pattern (insert missing, delete removed, update existing) across three temp/permanent table pairs is correct but verbose; consider replacing with DELETE+INSERT for simplicity given these are per-ReportID isolated sets.","The hardcoded list of CertificateIDs (1,6,22,5,2,...) in the certifications query should be moved to a configuration table to avoid SP modification when new certifications are added.","The subquery filtering with NOLOCK across PRC_ProceduresSubmitted inside the WHERE EXISTS clause may cause full scans; ensure an index on PRC_ProceduresSubmitted(ProcedureID, UserID, IsDel).","The sort_order temp table for certificate ordering is rebuilt every call; extract to a permanent reference table."],"migrationRelevance":"high"},{"name":"Fill_PRC_IndividualReport_Mobile","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null}],"lineCount":485,"tablesReferenced":["EVAL_AnswerScales","EVAL_AnswerTypes","EVAL_Answers","EVAL_Questions","EVAL_QuestionsCategories","PRC_ConsentTypes","PRC_Diagnosis","PRC_ErrorCategories","PRC_Errors","PRC_FieldGroups","PRC_FieldValues","PRC_Fields","PRC_LookupItems","PRC_ParticipationTypes","PRC_Patients","PRC_ProcedureCategories","PRC_Procedures","PRC_ProceduresBase","PRC_ProceduresQuestions","PRC_ProceduresSubmitted","PRC_ProceduresSubmittedAnswers","PRC_ProceduresSubmittedDiagnosis","PRC_ProceduresSubmittedErrors","PRC_ProceduresSubmittedStatus","RPT_RES_PRC_IndividualReport","RPT_RES_PRC_IndividualReport_Questions","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":19,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Populates RPT_RES_PRC_IndividualReport and RPT_RES_PRC_IndividualReport_Questions for a mobile individual procedure report: uses a large CTE to unpivot procedure submission data into name-value pairs, adds custom field values, computes evaluation question answers with supervisor/group/total averages, and handles department-specific (dept 1433/MEDCOM) cleanup logic.","businessPurpose":"Generates the data for the Individual Procedure Report used in the mobile application, providing residents and supervisors with a detailed per-submission view including all fields, evaluation answers, and comparative scores (user vs supervisor vs group vs total).","optimizationRecommendations":["The FOR XML PATH('') pattern for building comma-separated lists (Diagnosis, Errors, etc.) inside the CTE has known performance issues at scale; replace with STRING_AGG() (SQL Server 2017+).","Multiple UNION ALL branches with identical joins to PRC_ProceduresSubmitted and PRC_Procedures inside the left join unpivot create redundant reads; consolidate into a single unpivot or pre-aggregate into a temp table.","The SuperAnswer and TotalAnswer CTEs scan the entire PRC_ProceduresSubmittedAnswers table; add indexes on PRC_ProceduresSubmittedAnswers(ProceduresSubmittedID, ProceduresQuestionID) and PRC_ProceduresSubmitted(SupervisorID, ProcedureID).","The upsert pattern on RPT_RES_PRC_IndividualReport (insert-new, update-changed) re-joins on all key columns; add a covering index on (ReportID, UserID, ProceduresSubmittedID, ParamName).","The department 1433 special-case cleanup logic (DELETE of 'Not Available' rows, etc.) adds significant complexity; consider isolating into a separate SP or applying via a view."],"migrationRelevance":"high"},{"name":"Fill_PRC_SummaryReport_11092023","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@MasterDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@ProcedureType","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@LocalRules","dataType":"SMALLINT","direction":"IN","defaultValue":"0"},{"name":"@ProceduresCategoryID","dataType":"bigint","direction":"IN","defaultValue":"0"},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":"NULL"},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":"NULL"},{"name":"@LevelsOfSupervision","dataType":"smallint","direction":"IN","defaultValue":null},{"name":"@IncludeLinkDepartment","dataType":"bit","direction":"IN","defaultValue":"1"}],"lineCount":250,"tablesReferenced":["PRC_LevelsOfSupervision","PRC_ProcedureCategories","PRC_Procedures","PRC_ProceduresBase","PRC_ProceduresCertification","PRC_ProceduresSubmitted","PRC_ReportLanguages","PRC_SupervisionRequirements"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":3,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Populates a summary of procedure activity per user per procedure (performed, participated, present, unsuccessful, pending, rejected, complications, surgical counts) into temp tables #calc and #procedures using READ UNCOMMITTED isolation, then drops tables without writing to permanent report tables. This appears to be a historical/deprecated version that was refactored.","businessPurpose":"An older version (dated 2023-11-09) of the summary report fill logic that computes procedure counts per resident but does not insert results into the permanent report tables; likely superseded by Fill_PRC_SummaryReport_20231109.","optimizationRecommendations":["This SP does not insert results into any permanent table and only populates temp tables that are dropped at the end; verify whether it is still invoked anywhere and deprecate if not.","The commented-out GROUP AVERAGE subquery was replaced but its remnants add noise; clean up dead code."],"migrationRelevance":"low"},{"name":"Fill_PRC_SummaryReport_20231109","schema":"perf","parameters":[{"name":"@ReportID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@ProcedureType","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@LocalRules","dataType":"SMALLINT","direction":"IN","defaultValue":"0"},{"name":"@ProceduresCategoryID","dataType":"BIGINT","direction":"IN","defaultValue":"0"},{"name":"@StartDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@EndDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@LevelsOfSupervision","dataType":"SMALLINT","direction":"IN","defaultValue":null}],"lineCount":222,"tablesReferenced":["PRC_LevelsOfSupervision","PRC_ProcedureCategories","PRC_Procedures","PRC_ProceduresBase","PRC_ProceduresCertification","PRC_ProceduresSubmitted","PRC_ReportLanguages","PRC_SupervisionRequirements","RPT_Res_PRC_SummaryReport","RPT_Res_PRC_SummaryReport_Certifications","RPT_Res_PRC_SummaryReport_Summary","SEC_Certifications","SEC_UserCertifications","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":true,"nolockCount":4,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"perf","summary":"The production version of the summary report fill SP: populates RPT_Res_PRC_SummaryReport, RPT_Res_PRC_SummaryReport_Summary, and RPT_Res_PRC_SummaryReport_Certifications using multiple pre-computed temp tables for group averages, supervisor counts, supervision requirements, and certification verification status. Replaces nested subqueries with temp table joins for performance.","businessPurpose":"Generates the core data for the Procedure Summary Report showing each resident's certification status, total procedure counts (performed/participated/present/etc.), level of supervision, and medical certifications. This is the primary report consumed by program directors for resident competency review.","optimizationRecommendations":["The CROSS JOIN #UserIDs combined with the outer apply for supervision requirements may produce large intermediate result sets; ensure #UserIDs is indexed on UserID.","The CertifiedStatus update uses an UPDATE with a subquery join against #procedures; add a covering index on #procedures(ProceduresBaseIDProcedureID, UserID, DepartmentID) to speed this.","The #SupervisorProceduresBaseCount temp table scans all of PRC_ProceduresSubmitted for the date range; ensure an index on PRC_ProceduresSubmitted(IsDel, CompletedDate, SupervisorID, ProcedureID).","Consider adding SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED to the SELECT from PRC_ProceduresCertification to match the pattern used for other reads."],"migrationRelevance":"high"},{"name":"Fill_PRC_SummaryReport_Mobile","schema":"perf","parameters":[{"name":"@ReportID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@ProcedureType","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@LocalRules","dataType":"SMALLINT","direction":"IN","defaultValue":"0"},{"name":"@ProceduresCategoryID","dataType":"BIGINT","direction":"IN","defaultValue":"0"},{"name":"@StartDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@EndDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@LevelsOfSupervision","dataType":"SMALLINT","direction":"IN","defaultValue":null},{"name":"@IncludeLinkDepartment","dataType":"BIT","direction":"IN","defaultValue":"1"},{"name":"@TaskHistory","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@IsFromMobile","dataType":"TINYINT","direction":"IN","defaultValue":"0 /*@IsFromMobile=0 From Web and"}],"lineCount":554,"tablesReferenced":["PRC_LevelsOfSupervision","PRC_ParticipationTypes","PRC_ParticipationTypesCustom","PRC_ProcedureCategories","PRC_ProcedureSpeciality","PRC_Procedures","PRC_ProceduresCertification","PRC_ProceduresSubmitted","PRC_ProceduresSubmittedStatus","PRC_ProceduresSupervisors","PRC_ReportLanguages","PRC_SupervisionRequirements","RPT_Res_PRC_SummaryReport","RPT_Res_PRC_SummaryReport_Certifications","RPT_Res_PRC_SummaryReport_Mobile","RPT_Res_PRC_SummaryReport_ParticipationTypes","RPT_Res_PRC_SummaryReport_Summary","SEC_Certifications","SEC_UserCategoryCodes","SEC_UserCertifications","SEC_UserRoles","SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":12,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"perf","summary":"Populates the mobile-specific summary report for a single user, computing task readiness, MOC task assignments, procedure summaries (performed/participated/certified), supervisor coverage, and evaluation question answers. Includes MEDCOM-specific (dept 1433) logic for AOC/MOS filtering and military-specific field handling.","businessPurpose":"Drives the mobile app's summary dashboard for individual residents, showing their procedure completion progress, certification status, evaluation scores, and MEDCOM-specific task readiness metrics in a consolidated dataset.","optimizationRecommendations":["The SP uses PRINT statements throughout for debugging; remove in production to reduce output overhead.","Multiple large temp tables are created and joined in sequence; verify that all temp table columns used in JOINs have appropriate indexes added after population.","The MEDCOM-specific logic (department 1433 branches) is interleaved throughout the SP; consider parameterizing or extracting into a sub-SP to reduce code complexity.","Several FOR XML PATH('') concatenation patterns should be replaced with STRING_AGG() for SQL Server 2017+."],"migrationRelevance":"high"},{"name":"Fill_PTL_CategoryReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@ReportByFilter","dataType":"int","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"bigint","direction":"IN","defaultValue":"0"},{"name":"@IsOneSessionPerDay","dataType":"bit","direction":"IN","defaultValue":"1"}],"lineCount":259,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_Locations","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_CategoryReport","RPT_Res_PTL_CategoryReportByEncounters","RPT_Res_PTL_CategoryReportByLocation","SEC_Departments","SEC_UserTypesLevel"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Populates RPT_Res_PTL_CategoryReport, RPT_Res_PTL_CategoryReportByEncounters, and RPT_Res_PTL_CategoryReportByLocation from PTL_PatientLogSubmitted, aggregating patient log counts by diagnosis classification, encounter type, and location using GROUPING SETS for subtotals. Supports 6 report-by-filter modes.","businessPurpose":"Generates the PTL Category Report data that shows program directors how many patient encounters residents have logged, broken down by diagnosis classification, encounter type, or location, compared against required minimums for accreditation compliance.","optimizationRecommendations":["The SplitIDs TVF is called up to 6 times for different filter parameters; consider combining into a single call with filter type parameterization or using STRING_SPLIT().","The correlated subquery in OUTER APPLY to find the primary diagnosis is called per row; pre-compute into a temp table.","Add indexes on PTL_PatientLogSubmitted(UserID, FirstLogDate, IsDel, DiagnosisClassificationID, DepartmentID) to support the main filter query.","GROUPING SETS with ORDER BY inside an INSERT can cause optimizer confusion; consider separating the SELECT and INSERT."],"migrationRelevance":"high"},{"name":"Fill_PTL_DepartmentReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":94,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_DepartmentReport","SEC_DepartmentTrainingTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Populates RPT_Res_PTL_DepartmentReport with patient log counts per department, diagnosis, and PGY level. Uses a view MDV_UserPGYLevels (replacing an earlier direct table join) and conditional temp table population for multi-filter parameters.","businessPurpose":"Generates the PTL Department Report data showing diagnosis encounter counts by department and training year, supporting program-level accreditation reporting across linked departments.","optimizationRecommendations":["The multiple LEFT JOINs to filter temp tables (#Ages, #Location, etc.) combined with OR-based filter conditions can prevent index use; consider rewriting as WHERE clause EXISTS/IN filters against the populated temp tables.","Add an index on PTL_PatientLogSubmitted(FirstLogDate, IsDel, DepartmentID) for the primary date range filter.","The LEFT JOIN to MDV_UserPGYLevels converts dates with CONVERT(DATE,...) on both sides; ensure the view has appropriate indexes on (UserID, StartDate, EndDate)."],"migrationRelevance":"high"},{"name":"Fill_PTL_DepartmentReport_1","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":80,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_DepartmentReport","SEC_DepartmentTrainingTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"An earlier version of Fill_PTL_DepartmentReport that uses SEC_UserPGYOnDate directly (instead of the MDV_UserPGYLevels view) to resolve PGY level at the time of each log entry, joining to SEC_UserTypesLevel. The core logic is identical but uses the older PGY resolution path.","businessPurpose":"Historical version of the PTL Department Report fill SP, likely kept for rollback or reference; the view-based version (Fill_PTL_DepartmentReport) is the current production version.","optimizationRecommendations":["Verify if this SP is still invoked; if superseded by Fill_PTL_DepartmentReport, consider dropping or renaming as deprecated.","Uses the older SplitIDs TVF without BEGIN/END block around the IF-INSERT pattern, creating a potential issue if the IF block changes."],"migrationRelevance":"low"},{"name":"Fill_PTL_DetailReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SelectedUserIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"bit","direction":"IN","defaultValue":"0"}],"lineCount":157,"tablesReferenced":["PRC_ComplicationTypes","PRC_ConsentTypes","PRC_Diagnosis","PRC_Gender","PRC_ParticipationTypes","PRC_Patients","PRC_Procedures","PRC_ProceduresBase","PRC_ProceduresSubmitted","PTL_CompetenceLevels","PTL_Locations","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_DetailReport","RPT_Res_PTL_DetailReport_Procedures","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Populates the PTL detail report result table with per-log-entry details for patient tracking logs, joining to patient demographics, locations, supervisors, encounter types, diagnosis classifications, and diagnosis lists with multi-filter parameter support.","businessPurpose":"Generates the row-level detail data for the PTL Detail Report, showing supervisors and program directors each individual patient encounter log with full metadata for audit and compliance review.","optimizationRecommendations":["Add indexes on PTL_PatientLogSubmitted(UserID, FirstLogDate, IsDel, DepartmentID) for the primary filter.","The SplitIDs TVF calls can be replaced with STRING_SPLIT() on SQL Server 2016+."],"migrationRelevance":"high"},{"name":"Fill_PTL_DxClassificationReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SelectedUserIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"int","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"bit","direction":"IN","defaultValue":"0"}],"lineCount":184,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_DxClassificationReport","SEC_DepartmentTrainingTypes","SEC_Departments","SEC_UserTypesLevel","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":4,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Fills the PTL diagnosis classification report by aggregating patient log entries by diagnosis classification, computing completion counts versus required minimums with support for PGY-level-specific requirements and one-session-per-day counting logic.","businessPurpose":"Generates the Diagnosis Classification Report data for the PTL module, tracking resident progress toward meeting required diagnosis exposure counts for ACGME accreditation.","optimizationRecommendations":["Add indexes on PTL_PatientLogSubmitted(UserID, DiagnosisClassificationID, FirstLogDate, IsDel) for the main aggregation query.","The OUTER APPLY for RequiredCount and the OUTER APPLY for primary diagnosis add per-row subqueries; pre-aggregate these into temp tables."],"migrationRelevance":"high"},{"name":"Fill_PTL_DxClassificationReport_old","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"bigint","direction":"IN","defaultValue":"0"},{"name":"@AgeGroup","dataType":"int","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"bit","direction":"IN","defaultValue":"0"},{"name":"@SelectedUserIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":191,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_DxClassificationReport","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"An older version of the diagnosis classification report fill SP, kept for reference or rollback. Uses an older date calculation approach and lacks the one-session-per-day logic of the newer versions.","businessPurpose":"Historical version of the PTL Diagnosis Classification Report fill SP; superseded by newer variants. Should not be called in production.","optimizationRecommendations":["Verify this SP is not invoked in production; if superseded, add deprecation notice or drop."],"migrationRelevance":"none"},{"name":"Fill_PTL_DxClassificationReport_v2","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"int","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"bit","direction":"IN","defaultValue":"0"}],"lineCount":225,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_DxClassificationReport","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"A v2 refactoring of the diagnosis classification report fill that pre-computes user list, department list, and diagnosis requirements into temp tables before the main aggregation, improving performance for large cohorts.","businessPurpose":"Improved version of the PTL Diagnosis Classification Report fill SP used when the older version was too slow for large department cohorts; may be the currently active version depending on which is called by the report generation layer.","optimizationRecommendations":["Add indexes on all temp table join columns after population.","Verify which version (DxClassificationReport, DxClassificationReport_v2, or DxClassificationReport2) is active in production and deprecate the others."],"migrationRelevance":"medium"},{"name":"Fill_PTL_DxClassificationReport2","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SelectedUserIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"int","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"bit","direction":"IN","defaultValue":"0"},{"name":"@SelectedUserID","dataType":"bigint","direction":"IN","defaultValue":"0"}],"lineCount":200,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_DxClassificationReport","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Another variant of the diagnosis classification report fill SP, possibly used for a specific department scenario or to fix an edge case not handled by the base or v2 versions.","businessPurpose":"Variant of the PTL Diagnosis Classification Report fill used for specific department configurations or edge cases in the ACGME diagnosis exposure tracking workflow.","optimizationRecommendations":["Consolidate the three DxClassificationReport variants (base, old, v2, 2) into a single parameterized SP to reduce maintenance burden."],"migrationRelevance":"medium"},{"name":"Fill_PTL_SummaryReport","schema":"perf","parameters":[{"name":"@ReportID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@LocationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SupervisorIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@EncounterTypeIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@DiagnosisIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"varchar(max)","direction":"IN","defaultValue":null},{"name":"@SelectedUserIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":97,"tablesReferenced":["PRC_Diagnosis","PRC_Patients","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","RPT_Res_PTL_SummaryReport","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Populates RPT_Res_PTL_SummaryReport with patient log summary data per user, computing total encounter counts by diagnosis classification against required minimums, with support for PGY-level-specific requirements and one-session-per-day counting.","businessPurpose":"Generates the PTL Summary Report data showing each resident's cumulative diagnosis encounter totals compared to required minimums, the primary accreditation compliance view for program directors.","optimizationRecommendations":["Add indexes on PTL_PatientLogSubmitted(UserID, FirstLogDate, IsDel, DiagnosisClassificationID) for the core aggregation.","Verify the RetrieveDepartments TVF returns results efficiently for large linked department hierarchies."],"migrationRelevance":"high"},{"name":"Fill_RPT_Reports_Mobile","schema":"perf","parameters":[{"name":"@IsDel","dataType":"SMALLINT","direction":"IN","defaultValue":null},{"name":"@CreateDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@UpdateDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@CreatedByID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@UpdatedByID","dataType":"BIGINT","direction":"IN","defaultValue":"NUll"},{"name":"@Code","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@ReportParams","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@ReportParamsDisplay","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@IsShared","dataType":"BIT","direction":"IN","defaultValue":"NULL"},{"name":"@IsSavedReport","dataType":"SMALLINT","direction":"IN","defaultValue":null},{"name":"@InsertedID","dataType":"BIGINT","direction":"OUTPUT","defaultValue":null}],"lineCount":12,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a new saved report record into PERF.RPT_REPORTS with all provided metadata and captures the inserted ID via SCOPE_IDENTITY() into an output parameter.","businessPurpose":"Allows mobile users to save report configurations (filters, date ranges, etc.) for later retrieval in the MyEvaluations mobile application.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetDataForPatientLogExport_20220325","schema":"perf","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"DATETIME","direction":"IN","defaultValue":null}],"lineCount":124,"tablesReferenced":["PRC_ConsentTypes","PRC_Diagnosis","PRC_FieldGroups","PRC_FieldValues","PRC_Fields","PRC_Patients","PRC_Procedures","PRC_ProceduresBase","PRC_ProceduresSubmitted","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_Locations","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Dynamically constructs and executes a pivot query that exports patient log data from PTL_PatientLogSubmitted along with all custom field values, masking patient names with asterisks while preserving MRN, and joining to demographic and classification tables. Uses PIVOT via sp_executesql with a dynamically built field list from PRC_Fields.","businessPurpose":"Powers the patient log data export feature, generating a flat-file-ready dataset with all standard and custom fields for compliance reporting and external data transfers from the PTL module.","optimizationRecommendations":["The dynamic SQL pivot with nested subqueries for custom field values is extremely complex and difficult to optimize; consider pre-materializing custom field values into a temp table before the pivot.","The FOR XML PATH('') pattern for building the field list from PRC_Fields should be replaced with STRING_AGG().","The @LocalOnlyMode branching for DepartmentID join creates two different query plans within the same dynamic SQL; consider separate SPs for each mode.","Validate and sanitize field names before injecting them into dynamic SQL to prevent SQL injection."],"migrationRelevance":"high"},{"name":"GetDepartmentParticipationTypes","schema":"perf","parameters":[],"lineCount":41,"tablesReferenced":["PRC_ParticipationTypes","PRC_ParticipationTypesCustom"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Returns all participation types for a department, merging global types with department-specific customizations (aliases, sort orders, active flags, colors, abbreviations, etc.) via a LEFT JOIN. Ordered by department-specific sort order.","businessPurpose":"Supplies the participation type dropdown options (e.g., 'Performed', 'Assisted', 'Observed') when residents submit procedure logs, respecting department-specific customizations like renamed or reordered types.","optimizationRecommendations":["Add a composite index on PRC_ParticipationTypesCustom(DepartmentID, ParticipationTypeID) to speed the LEFT JOIN.","Add an index on PRC_ParticipationTypes(ParticipationTypeCategoryID) for the OR filter in the WHERE clause."],"migrationRelevance":"medium"},{"name":"GetLinkedDepartmentList","schema":"perf","parameters":[{"name":"@UserId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":1,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentUsersManager.cs.GetLinkedDepartmentList","DepartmentManager.cs.GetLinkedDepartments"],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Returns the list of active departments linked to a given department via the RetrieveDepartments TVF, filtered to non-disabled departments and ordered by name.","businessPurpose":"Used in report filters and department selectors throughout the PRC/PTL modules to populate the linked department dropdown, enabling multi-department program setups where residents rotate across affiliated sites.","optimizationRecommendations":["Verify that RetrieveDepartments is an inline TVF (not multi-statement) for optimal performance.","Add NOLOCK hint to SEC_Departments read since this is a reference lookup with READ UNCOMMITTED isolation."],"migrationRelevance":"low"},{"name":"GetMedcomActiveUsersAndSupervisorMobile_20250617","schema":"perf","parameters":[{"name":"@ZoneID","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":"'Eastern Standard Time'"}],"lineCount":200,"tablesReferenced":["EVAL_EvaluateEvaluation","PRC_ProceduresSupervisors","SEC_Ranks","SEC_UserCategoryCodes","SEC_Users","SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":2,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Retrieves all active users and marks supervisors for the MEDCOM department (ID 1433) with incremental sync support via @LastSyncTime, computes AOC/MOS category codes, flags supervisors from PRC_ProceduresSupervisors, and logs slow executions (>5 seconds) to EVAL_EvaluateEvaluation.","businessPurpose":"Provides the mobile app sync endpoint for MEDCOM military training programs, delivering the complete user/supervisor roster with AOC/MOS specialty codes needed by the mobile client to display task readiness and procedure assignment data.","optimizationRecommendations":["The index hints IDX_Missing_DepartmentID and IDX_SEC_Users_DepartmentID_20240725 suggest prior performance tuning; verify these indexes still exist and are not fragmented.","The CategoryCode computation using a sub-SELECT with FOR XML PATH aggregation inside UPDATE runs per user; pre-aggregate into a temp table join.","The complex CASE expression in the WHERE clause for incremental sync prevents index use on LastUpdatedDateTime; consider adding a computed/persisted column.","Remove PRINT statements from production code."],"migrationRelevance":"medium"},{"name":"GetParticipationTypesNew","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmetID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PRC_ParticipationTypes","PRC_ParticipationTypesCustom"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Returns active participation types for a department using a UNION: active custom types for the department, plus the type of the current procedure submission if it exists. Orders by custom sort order then name.","businessPurpose":"Populates the participation type selector when editing an existing procedure submission, ensuring the currently-selected type always appears even if it has since been deactivated for the department.","optimizationRecommendations":["The join to prc_proceduressubmitted using prc.ID = @ProcedureSubmittedID AND PT.ID = prc.ID appears logically incorrect (joining ParticipationType.ID to ProceduresSubmitted.ID); review and correct the join condition."],"migrationRelevance":"medium"},{"name":"GetPatientLogDetails","schema":"perf","parameters":[{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["PRC_Diagnosis","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_Locations","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosis","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetPatientLogDetails"],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Returns full details for a single patient log entry (PTL_PatientLogSubmitted) including related patient demographics, diagnosis classifications, competence level, location, department, supervisor, reviewer, submitted-by user, all associated diagnoses (via STRING_AGG), and patient gender.","businessPurpose":"Powers the patient log detail view in the mobile and web applications, providing all information needed to display a complete patient encounter record for review by residents and supervisors.","optimizationRecommendations":["Add an index on PTL_PatientLogSubmitted(ID) if not already the primary key to ensure the TOP 1 WHERE p.id = @PatientLogID lookup is an index seek.","The STRING_AGG in the OUTER APPLY for diagnoses is efficient; no change needed there."],"migrationRelevance":"high"},{"name":"GetPatientLogSupervisors","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedPatientLog","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"}],"lineCount":54,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSupervisors","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.GetSuperVisorsForViewMode"],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Returns a list of supervisors filtered by page mode: mode 1 returns active supervisors designated for a department, mode 2 adds the current log's existing supervisor even if not on the list, mode 3 returns supervisors across linked departments with union of log-history supervisors for report filters.","businessPurpose":"Populates the supervisor dropdown when submitting or editing a patient log entry, and provides the supervisor filter list for PTL reports, handling the three different UI contexts (submit, edit, report filter) with a single SP.","optimizationRecommendations":["Add an index on PTL_PatientLogSupervisors(DepartmentID, IsDel) to speed modes 1 and 3.","Mode 3 uses a legacy dbo.SplitTextCSV function; consider replacing with STRING_SPLIT() for consistency with other SPs.","The UNION in mode 3 between designated supervisors and history-based supervisors could produce a large result set for active programs; verify DISTINCT is applied correctly."],"migrationRelevance":"medium"},{"name":"GetPatientsByUserID","schema":"perf","parameters":[],"lineCount":12,"tablesReferenced":["PRC_Patients","PRC_ProceduresSubmitted","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Returns all patients associated with a user via either procedure submissions or patient log submissions, decrypting PatientName and MRNumber via dbo.ufn_DecryptValue, and includes a discharge status flag via OUTER APPLY.","businessPurpose":"Populates the patient list when residents are submitting or reviewing their procedure/patient log entries, showing all patients they have previously logged to support reuse of existing patient records.","optimizationRecommendations":["The UNION ALL inside the INNER JOIN subquery scans both PRC_ProceduresSubmitted and PTL_PatientLogSubmitted without indexes on UserID and PatientID; add indexes on both tables.","Decrypting PatientName and MRNumber row-by-row via a scalar function can be very slow for users with many patients; consider a set-based decryption approach if the function supports it."],"migrationRelevance":"high"},{"name":"GetProcedureAnswersForReview","schema":"perf","parameters":[{"name":"@ProcedureID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["EVAL_AnswerTypes","EVAL_Answers","EVAL_Questions","EVAL_QuestionsCategories","PRC_ProceduresQuestions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Returns all answer options for a procedure's evaluation questions for a given department, joining EVAL_Questions, PRC_ProceduresQuestions, EVAL_QuestionsCategories, EVAL_AnswerTypes, and EVAL_Answers to produce the complete answer scale for review.","businessPurpose":"Supplies the evaluation answer options displayed to supervisors when reviewing a procedure submission, enabling them to score each question on the appropriate scale.","optimizationRecommendations":["Add a composite index on PRC_ProceduresQuestions(ProcedureID) and EVAL_Questions(QuestionsCategoryID, DepartmentID, IsDel) to optimize the multi-table join."],"migrationRelevance":"medium"},{"name":"GetProcedureListForMerge","schema":"perf","parameters":[],"lineCount":9,"tablesReferenced":["PRC_ProcedureCategories","PRC_Procedures","PRC_ProceduresBase"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Returns the list of active procedures for a department with display names formatted as 'ProcedureName(Category / SubmissionCount)', suitable for populating the source/destination selectors in the procedure merge UI.","businessPurpose":"Powers the procedure merge feature that allows administrators to consolidate duplicate procedures by showing each procedure alongside its submission count to help identify the correct target for merging.","optimizationRecommendations":["The OUTER APPLY subquery counting submissions runs per procedure; for large departments, pre-aggregate into a temp table.","Add an index on PRC_ProceduresSubmitted(ProcedureID) for the count subquery."],"migrationRelevance":"low"},{"name":"GetProcedureQuestionsForReview","schema":"perf","parameters":[{"name":"@ProcedureID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@ProcedureSubmittedID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":31,"tablesReferenced":["EVAL_AnswerScales","EVAL_AnswerTypes","EVAL_Questions","EVAL_QuestionsCategories","PRC_ProceduresQuestions","PRC_ProceduresSubmittedAnswers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Returns the evaluation questions and existing answers for a procedure submission during review, ordered by question code using custom alpha-numeric sorting via perf.fn_GetAlphaAndNumeric and fn_GetLastNumericNumbers, including the current answer and comments via OUTER APPLY.","businessPurpose":"Supplies the full evaluation questionnaire with pre-populated answers to supervisors reviewing a resident's procedure submission, enabling them to score competencies and add comments.","optimizationRecommendations":["The custom sort using fn_GetAlphaAndNumeric and fn_GetLastNumericNumbers scalar functions runs per row; consider persisting question sort order in the table.","Add a composite index on PRC_ProceduresQuestions(ProcedureID) and EVAL_Questions(DepartmentID, IsDel) for the main join."],"migrationRelevance":"medium"},{"name":"GetProceduresSupervisorsForReport","schema":"perf","parameters":[{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@UserTypeID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":19,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Returns a distinct list of supervisor IDs and full names for a department (or all linked departments if SelectedDepartmentID is -1), filtered by user type and active status, using the vProceduresSupervisors_v2 view.","businessPurpose":"Populates the supervisor filter dropdown in procedure reporting screens, allowing program directors to filter reports to show only procedures supervised by a specific individual.","optimizationRecommendations":["The table variable @DepartmentList populated from RetrieveDepartments is joined to the view; verify the view vProceduresSupervisors_v2 has appropriate indexes.","Replacing the table variable with a temp table may improve cardinality estimation for larger department hierarchies."],"migrationRelevance":"low"},{"name":"GetProceduresSupervisorsList","schema":"perf","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@UserType","dataType":"BIGINT","direction":"IN","defaultValue":"-1"}],"lineCount":35,"tablesReferenced":["PRC_ProceduresSupervisors","SEC_UserTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Returns a distinct list of supervisors for a department, filtered by user type codes (A, FE, PD, CR, R, OT, NS), supporting shared-user scope via a linked departments temp table. Uses READ UNCOMMITTED isolation.","businessPurpose":"Populates the supervisor selector when submitting procedure logs, showing only qualified supervisor roles (Attending, Fellow, Program Director, etc.) for the department.","optimizationRecommendations":["The OR condition in the WHERE clause (U.DepartmentID = @DepartmentID OR (U.DepartmentID IN ... AND U.IsShared=1 AND @UserScope=-1)) prevents index use; consider rewriting as a UNION.","Add an index on PRC_ProceduresSupervisors(DepartmentID, UserID, IsDel)."],"migrationRelevance":"medium"},{"name":"GetProceduresSupervisorsList1","schema":"perf","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@UserType","dataType":"BIGINT","direction":"IN","defaultValue":"-1"}],"lineCount":65,"tablesReferenced":["PRC_ProceduresSupervisors","SEC_UserTypes","SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"An optimized replacement for GetProceduresSupervisorsList that rewrites the OR-based WHERE clause as a UNION of two queries (local users + shared linked-department users) into a temp table, eliminating the OR-based index block. Includes EDIPI display for military programs.","businessPurpose":"Improved supervisor list retrieval for procedure submission, adding EDIPI (military ID) display for MEDCOM programs and fixing the performance issue from the OR condition in the predecessor SP.","optimizationRecommendations":["Add an index on SEC_UsersExt(UserID) if not already present to speed the EDIPI join.","The commented-out original query block should be removed from the SP body to reduce maintenance confusion."],"migrationRelevance":"medium"},{"name":"GetProcedureSupervisors","schema":"perf","parameters":[{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedProcedure","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@ProcedureSubmittedID","dataType":"bigint","direction":"IN","defaultValue":"NULL"}],"lineCount":49,"tablesReferenced":["PRC_ProceduresCertification","PRC_ProceduresSubmitted","PRC_ProceduresSupervisors","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Returns supervisor candidates for a procedure submission from three sources (UNION ALL): department supervisors, users who have certified the procedure, and the existing supervisor on the specific submission. Supports mobile mode (IsForMobile) which includes deleted supervisors.","businessPurpose":"Provides the complete supervisor candidate list for a procedure submission, including both designated supervisors and anyone who has historically certified that procedure, ensuring residents can attribute their procedure to the correct supervisor.","optimizationRecommendations":["The UNION ALL into a temp table #Results with SELECT DISTINCT is correct but creates an intermediate full materialization; verify this is necessary vs. a UNION with DISTINCT directly.","Add an index on PRC_ProceduresCertification(ProcedureID, ProceduresCertificationStatusID) for the Case2 UNION branch.","Add a composite index on PRC_ProceduresSupervisors(DepartmentID, UserID) for the Case1 branch."],"migrationRelevance":"medium"},{"name":"GetSubmittedPatientLogs","schema":"perf","parameters":[{"name":"@UserID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedUser","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SelectedAcademicYear","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@SortBy","dataType":"smallint","direction":"IN","defaultValue":null},{"name":"@PageNumber","dataType":"int","direction":"IN","defaultValue":"0"},{"name":"@RowsPerPage","dataType":"int","direction":"IN","defaultValue":"65534534"},{"name":"@SortExpression","dataType":"varchar(255)","direction":"IN","defaultValue":"NULL"},{"name":"@SubmittedStartDate","dataType":"datetime","direction":"IN","defaultValue":"NULL"}],"lineCount":123,"tablesReferenced":["PTL_PatientLogSubmitted","SEC_UserRoles","SEC_UserTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetSubmittedPatientLogByCriteria"],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Returns a paginated, sortable list of patient log submissions for a user/department with status computation (Pending/Reviewing/Completed/Discharged), primary diagnosis lookup via a scalar function, and support for academic year filtering. Uses dynamic SQL for sort expression.","businessPurpose":"Powers the Patient Log list view for supervisors and program directors, enabling them to browse, sort, and filter submitted patient encounters with pagination for performance.","optimizationRecommendations":["The scalar function perf.GetPrimaryDiagnosisForPatientLog is called per row inside the initial SELECT INTO #t1; this is a row-by-row scalar function call that can severely degrade performance for large datasets. Pre-aggregate diagnoses into a temp table.","The dynamic sort via EXEC(@Query) prevents plan caching; consider using sp_executesql with a parameterized query instead.","Add an index on PTL_PatientLogSubmitted(IsDel, DepartmentId, UserID, FirstLogDate, SubmittedDate) to support the multi-filter WHERE clause.","The ROW_NUMBER() + COUNT(*) OVER() pattern in the dynamic SQL is correct for pagination but re-sorts the full result set on each page; ensure adequate memory grants."],"migrationRelevance":"high"},{"name":"GetTaskReadinessFilterData_20250702","schema":"perf","parameters":[{"name":"@DepartmentID","dataType":"INT","direction":"IN","defaultValue":"1433"},{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":178,"tablesReferenced":["PRC_Procedures","PRC_ProceduresSupervisors","PRC_TaskReadiness","SEC_TrainingFrequency","SEC_TrainingSkillLevel","SEC_UserRoles","SEC_Users","SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":21,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Returns filter data for the Task Readiness screen based on @IsUserFilter mode: mode 0 returns UserIDs, mode 1 returns UICs, mode 2 returns training skill levels, mode 3 returns AOC/MOS codes, and the default returns ProcedureIDs. Handles supervisor/role-based scoping via temp tables and inline indexes.","businessPurpose":"Supplies the dynamic filter dropdown data for the MEDCOM Task Readiness dashboard, which shows military medical personnel's training task completion status. Supports five distinct filter types from one SP to minimize round trips.","optimizationRecommendations":["Creating a nonclustered index (IDX_001) on a temp table (#Users) inside a frequently-called SP adds creation overhead on every execution; evaluate if this is consistently beneficial.","The five IsUserFilter branches have significant code duplication in the task readiness queries; consider extracting the common task readiness join into a single temp table populated once.","Add an index on PRC_TaskReadiness(DepartmentID, UserID, IsDel, ProcedureID) for all filter branches."],"migrationRelevance":"medium"},{"name":"GetTaskReadinessRequirements_Mobile","schema":"perf","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PageIndex","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@PageSize","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@SortField","dataType":"NVARCHAR(50)","direction":"IN","defaultValue":"''"},{"name":"@SortOrder","dataType":"NVARCHAR(4)","direction":"IN","defaultValue":"'ASC'"},{"name":"@SearchValue","dataType":"NVARCHAR(100)","direction":"IN","defaultValue":"''"},{"name":"@FilterExpression","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":"''"},{"name":"@IsExport","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@TotalCount","dataType":"INT","direction":"OUTPUT","defaultValue":null},{"name":"@RequestedUserID","dataType":"BIGINT","direction":"IN","defaultValue":"0"},{"name":"@RequestedUIC","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":"''"},{"name":"@RequestedAOCMOS","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":"''"},{"name":"@RequestedProcedureID","dataType":"BIGINT","direction":"IN","defaultValue":"0"},{"name":"@TaskReadinessID","dataType":"BIGINT","direction":"IN","defaultValue":"0"}],"lineCount":200,"tablesReferenced":["PRC_ParticipationTypes","PRC_ParticipationTypesCustom","PRC_Procedures","PRC_ProceduresSupervisors","PRC_TaskReadiness","SEC_TrainingFrequency","SEC_TrainingSkillLevel","SEC_UserRoles","SEC_Users","SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"perf","summary":"Returns paginated and sortable task readiness records for mobile display, computing skill level, frequency, last/next evaluation dates, and status (Expired/Ready/Upcoming/Pending) using dynamic SQL. Supports export mode with all columns and search mode with text filtering. Computes a filtered count for pagination via a secondary sp_executesql call.","businessPurpose":"Powers the Task Readiness list view in the MEDCOM mobile application, showing military medical personnel their training task status with color-coded urgency (Expired, Upcoming, Pending, Ready) and supporting supervisor oversight of subordinate readiness.","optimizationRecommendations":["The dynamic SQL is nested three layers deep (outer SQL -> @ESQL -> @SQLForCount); this makes query plans difficult to cache and debug. Consider refactoring the status CASE logic into a view or inline TVF.","The filtered count query executes a second sp_executesql call wrapping the same SQL; if the result set is small enough, use COUNT(*) OVER() in the main query instead.","Add a covering index on PRC_TaskReadiness(DepartmentID, UserID, IsDel, ProcedureID, TrainingSkillLevelID, TrainingFrequencyID) for the main data load.","Remove PRINT statements from production code."],"migrationRelevance":"medium"},{"name":"GetTaskReadinessRequirementsDetailsByID_Mobile","schema":"perf","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PageIndex","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@PageSize","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@SortField","dataType":"NVARCHAR(50)","direction":"IN","defaultValue":"''"},{"name":"@SortOrder","dataType":"NVARCHAR(4)","direction":"IN","defaultValue":"'ASC' -- ASC or DESC"},{"name":"@SearchValue","dataType":"NVARCHAR(100)","direction":"IN","defaultValue":"''"},{"name":"@FilterExpression","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":"''"},{"name":"@IsExport","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@TaskReadinessID","dataType":"BIGINT","direction":"IN","defaultValue":"0"}],"lineCount":260,"tablesReferenced":["PRC_FieldValues","PRC_LookupItems","PRC_ParticipationTypes","PRC_ParticipationTypesCustom","PRC_Procedures","PRC_ProceduresSupervisors","PRC_TaskReadiness","SEC_TrainingFrequency","SEC_TrainingSkillLevel","SEC_UserRoles","SEC_Users","SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"perf","summary":"Returns task readiness detail for a single task readiness record (by @TaskReadinessID), additionally fetching delivery location and method of delivery from custom field values in PRC_FieldValues using fixed field IDs (15427 and 15367) for onboarding scenarios. Supports export and non-export modes via dynamic SQL.","businessPurpose":"Powers the Task Readiness detail view in the MEDCOM mobile app for a specific task assignment, including training delivery metadata (location and method) needed for onboarding and periodic recertification workflows.","optimizationRecommendations":["The hardcoded field IDs (15427 for DeliveryLocation, 15367 for MethodOfDelivery) and lookup item IDs (8847, 8848) are brittle; store in a configuration table.","The multiple PRINT statements throughout should be removed from production.","The ROW_NUMBER() OVER PARTITION approach for getting the latest field value is correct but creates intermediate temp tables (#Result_DeliveryLocation_Temp, etc.); these could be merged into a single CTE.","Add an index on PRC_FieldValues(ProceduresSubmittedID, FieldID, IsDel) for the field value lookups."],"migrationRelevance":"medium"},{"name":"GetUserInfoForSummaryReport","schema":"perf","parameters":[],"lineCount":31,"tablesReferenced":["PRC_ProceduresCertificationStatus","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Returns a formatted display name, PGY level, department name, and last procedure certification modification date for a selected user. Uses the dbo.GetPGYLevelForUser scalar function and queries PRC_ProceduresCertificationStatus for the latest date.","businessPurpose":"Populates the user information header on the Procedure Summary Report, showing program directors the resident's name, current training level, department, and last activity date at a glance.","optimizationRecommendations":["The TOP 1 query on PRC_ProceduresCertificationStatus ordered by DateModified DESC for a user should have an index on (UserID, DateModified DESC).","The scalar function GetPGYLevelForUser is called once; verify it is not itself executing a heavy query."],"migrationRelevance":"low"},{"name":"InsertMedcomCacheUsers","schema":"perf","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":"0"}],"lineCount":134,"tablesReferenced":["DH_DepartmentCMEGroupUsers","PRC_ProceduresSubmitted","SEC_MedcomUsersCacheLog","UserListForFilterCache"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"perf","summary":"Maintains the UserListForFilterCache table for the MEDCOM department (1433) by inserting new users, updating changed attributes, deleting removed users (if doing a full refresh), and optionally scoping to a single user or department group. Also resets self-supervised pending submissions and corrects SubmittedDate/CompletedDate mismatches.","businessPurpose":"Keeps the MEDCOM user filter cache synchronized with the source user tables, enabling fast user-list filtering in the mobile app without repeated heavy joins. Also performs two data fixup operations for MEDCOM-specific data quality issues.","optimizationRecommendations":["The two UPDATE statements at the end (reset self-supervised submissions and correct SubmittedDate) are data fixup operations with hardcoded date thresholds ('06/23/2025'); these should be one-time migrations, not recurring SP logic.","The CROSS APPLY string_split(GroupIDs,',') pattern for group filtering can be expensive for large GroupIDs strings; consider normalizing the GroupIDs into a junction table.","Add an index on UserListForFilterCache(UserID, DepartmentID) to speed the LEFT OUTER JOIN deduplication checks."],"migrationRelevance":"medium"},{"name":"MEDCOMSummaryNotice","schema":"perf","parameters":[],"lineCount":267,"tablesReferenced":["PRC_Procedures","PRC_ProceduresSubmitted","SCHE_ApplicationEmailSchedules","SEC_Departments","SEC_KeyTxtInfo","SEC_Users","SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Generates and queues email notifications for MEDCOM supervisors with pending procedure reviews, building HTML email templates row-by-row using cursor-based iteration and inserting the results into SCHE_ApplicationEmailSchedules. Respects department-configured email frequency settings per user type.","businessPurpose":"Drives the automated email reminder workflow for MEDCOM supervisors, notifying them of pending task submissions that require their acknowledgement, with frequency throttling (daily/weekly/monthly) per user type to prevent email fatigue.","optimizationRecommendations":["The cursor-based iteration over supervisors and the inner WHILE loop over tasks is extremely inefficient for large datasets; replace with a set-based INSERT using string aggregation for the task table HTML rows.","Building HTML email bodies inside T-SQL using string concatenation is an anti-pattern; consider pushing this to the application layer or a templating engine.","The query against #TasksInfoDetails uses a cross-join style (FROM #TasksInfoDetails TT, dbo.SEC_Users SU) which is a CROSS JOIN; change to an explicit INNER JOIN.","Encrypting the login URL with dbo.EncryptingString inside a loop is called per supervisor; batch this computation.","Add a covering index on PRC_ProceduresSubmitted(DepartmentID, ProceduresStatusID, IsDel, EmailSendDate) for the initial task load query."],"migrationRelevance":"medium"},{"name":"MergeProcedures","schema":"perf","parameters":[{"name":"@SourceProcedureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DestinationProcedureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PRC_MergeProcedureLog","PRC_MergeProcedureLogDetails","PRC_Procedures","PRC_ProceduresBase","PRC_ProceduresSubmitted"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Merges a source procedure into a destination procedure: logs the merge to PRC_MergeProcedureLog and PRC_MergeProcedureLogDetails, updates all submissions from the source to point to the destination, then soft-deletes the source procedure.","businessPurpose":"Supports the administrator workflow for consolidating duplicate procedures, redirecting all historical submissions and preserving audit history before marking the source as deleted.","optimizationRecommendations":["Wrap the three DML operations (INSERT log, UPDATE submissions, UPDATE procedure) in an explicit transaction to ensure atomicity; if the UPDATE submissions succeeds but the IsDel update fails, submissions will reference a non-deleted duplicate.","Add an index on PRC_ProceduresSubmitted(ProcedureID) to speed the INSERT into the log details and the UPDATE."],"migrationRelevance":"high"},{"name":"ProcessNiImport","schema":"perf","parameters":[],"lineCount":262,"tablesReferenced":["PRC_NiImport","PTL_CompetenceLevels","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":["AddPatient","AddPatientLogPatient","AddSubmitedProcedureImport"],"crudType":"mixed","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["NiImportManager.cs.FillRecords"],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Processes a NI (National Institutions) import batch identified by @guid using a cursor over PRC_NiImport, encrypting patient PII before inserting PTL patient log and PRC procedure submission records. Calls AddPatientLogPatient, AddPatient, and AddSubmitedProcedureImport as sub-SPs. Tracks patient log IDs in a temp table to handle multi-procedure visits.","businessPurpose":"Handles bulk import of external medical encounter data from National Institutions into the MyEvaluations procedure and patient tracking log modules, creating all necessary patient, log, and submission records while maintaining patient data encryption.","optimizationRecommendations":["Cursor-based row-by-row processing is the primary performance bottleneck for large import batches; replace with a set-based approach that inserts patients and log entries in bulk.","The cursor fetches 34 columns per row; reduce to only the columns actually used.","The temp table #PtLogIds used to track ExtPtLogId to PatientLogSubmittedID mappings is correct but would be more efficient as a hash map; ensure an index on ExtPtLogId.","Patient PII encryption (fnEncryptValue) is called three times per row inside the cursor; for large imports, pre-encrypt in a staging step.","Add explicit transaction handling around the cursor loop to allow rollback on partial failure."],"migrationRelevance":"high"},{"name":"SaveFreeTextFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.SaveSubmittedProcedure"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a single free-text custom field value for a procedure submission into PRC_FieldValues.","businessPurpose":"Persists free-text custom field responses (e.g., open-ended comments or notes) captured during procedure submission in the PRC module.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SaveLargeDateFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.SaveSubmittedProcedure"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a large date custom field value (stored in LargeDateFieldValue) for a procedure submission into PRC_FieldValues.","businessPurpose":"Persists date-type custom field values captured during procedure submission, supporting departments that track additional date information (e.g., procedure authorization date) beyond the standard fields.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SaveLargeNumberFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.SaveSubmittedProcedure"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a large-number custom field value into PRC_FieldValues for a procedure submission.","businessPurpose":"Persists numeric custom field responses requiring precision beyond standard integer fields during procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SaveLongTextFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.SaveSubmittedProcedure"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a long-text custom field value (stored in LongTextFieldValue) into PRC_FieldValues for a procedure submission.","businessPurpose":"Persists long-form text custom field responses (e.g., detailed clinical notes) captured during procedure submission in departments that require extended free-text documentation.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SaveLookupFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.SaveSubmittedProcedure"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a lookup (dropdown) custom field value into PRC_FieldValues for a procedure submission, storing the LookupItemID reference.","businessPurpose":"Persists dropdown/lookup custom field selections made during procedure submission, linking to the master lookup item table.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SaveNumberFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.SaveSubmittedProcedure"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a numeric custom field value into PRC_FieldValues for a procedure submission.","businessPurpose":"Persists integer or numeric custom field responses captured during procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SaveShortTextValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.SaveSubmittedProcedure"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Inserts a short-text custom field value (stored in ShortTextFieldValue) into PRC_FieldValues for a procedure submission.","businessPurpose":"Persists short alphanumeric custom field responses (e.g., a procedure code, a brief identifier) captured during procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateFreeTextFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Updates an existing free-text custom field value in PRC_FieldValues for a specific procedure submission and field ID, setting the new value and update audit fields.","businessPurpose":"Supports editing of free-text custom fields on an existing procedure submission when a resident or supervisor corrects previously entered information.","optimizationRecommendations":["Add a composite index on PRC_FieldValues(ProceduresSubmittedID, FieldID) if not already present to make the WHERE clause an index seek."],"migrationRelevance":"low"},{"name":"UpdateLargeDateFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.Update"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Updates an existing large-date custom field value in PRC_FieldValues for a specific procedure submission and field ID.","businessPurpose":"Supports editing of date-type custom fields on an existing procedure submission.","optimizationRecommendations":["Same index recommendation as UpdateFreeTextFieldValues: composite index on (ProceduresSubmittedID, FieldID)."],"migrationRelevance":"low"},{"name":"UpdateLargeNumberFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Updates an existing large-number custom field value in PRC_FieldValues for a specific procedure submission and field ID.","businessPurpose":"Supports editing of large-number custom fields on an existing procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateLongTextFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.Update"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Updates an existing long-text custom field value in PRC_FieldValues for a specific procedure submission and field ID.","businessPurpose":"Supports editing of long-form text custom fields on an existing procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateLookupFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupItemID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.Update"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Updates an existing lookup/dropdown custom field value in PRC_FieldValues for a specific procedure submission and field ID.","businessPurpose":"Supports editing of dropdown custom field selections on an existing procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateNumberFieldValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"decimal(25,2)","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"perf","summary":"Updates an existing numeric custom field value in PRC_FieldValues for a specific procedure submission and field ID.","businessPurpose":"Supports editing of numeric custom fields on an existing procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateProceduresCertificationStatus","schema":"perf","parameters":[{"name":"@ProceduresImportSessionID","dataType":"bigint","direction":"IN","defaultValue":null},{"name":"@XMLData","dataType":"Nvarchar(MAX)","direction":"IN","defaultValue":"''"}],"lineCount":193,"tablesReferenced":["PRC_ProcedureImportSessionProcedure","PRC_Procedures","PRC_ProceduresCertification","PRC_ProceduresSubmitted","PRC_ProceduresSupervisors","PRC_SupervisionRequirements"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["ImportProceduresManager.cs.ImportProcedures"],"complexity":"complex","aiEnrichment":null,"module":"perf","summary":"Processes a batch of procedure certification updates encoded as a delimited string (@XMLData, caret-separated, field-separated by !), parsing rows into a temp table via dynamic SQL and a WHILE loop, then for each record: upserts PRC_ProceduresCertification, optionally upserts PRC_SupervisionRequirements, inserts grandfathered procedure submissions (repeated @NoOfProceduresToSubmit times), and auto-promotes users to supervisor if their submission count meets the certification threshold.","businessPurpose":"Handles the bulk import of procedure certification statuses from external systems or Excel imports, including setting level-of-supervision requirements and grandfathering historical submissions to bring residents' records up to date with their actual experience.","optimizationRecommendations":["Parsing the delimited string via dynamic SQL (sp_executesql of INSERT statements) inside a WHILE loop is fragile and poses SQL injection risk; replace with a robust TVF or XML parsing approach.","The WHILE loop inserting grandfathered submissions (@NoOfProceduresToSubmit iterations per procedure per user) is extremely slow for large counts; replace with a set-based tally/numbers table insert.","The entire operation runs without an explicit transaction; if the loop fails mid-way, partial state is committed. Wrap in a transaction with error handling.","The auto-promote-to-supervisor logic at the end of each iteration queries PRC_ProceduresSubmitted for every procedure; cache the result or batch the check."],"migrationRelevance":"high"},{"name":"UpdateShortTextValues","schema":"perf","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["PRC_FieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SubmittedProcedureManager.cs.Update"],"complexity":"trivial","aiEnrichment":null,"module":"perf","summary":"Updates an existing short-text custom field value in PRC_FieldValues for a specific procedure submission and field ID.","businessPurpose":"Supports editing of short-text custom fields on an existing procedure submission.","optimizationRecommendations":[],"migrationRelevance":"low"}]}