{"module":"(uncategorized)","displayName":"Uncategorized","procedureCount":123,"procedures":[{"name":"AddAutoTaskQueue","schema":"dbo","parameters":[{"name":"@ProcessID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":19,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Inserts a new task queue entry into Email_AutoTaskQueue with a process ID and start time, returning the generated AutoTaskQueueID via SCOPE_IDENTITY().","businessPurpose":"Supports the email automation pipeline by registering new background task processes; called when the system initiates scheduled email jobs that need tracking.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"AddProceduresSystemFields","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":233,"tablesReferenced":[],"sprocsCalledFromBody":["AddProceduresField","AddProceduresFieldToGroup","AddProceduresFieldsGroup"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Initializes a new department's procedure log form by inserting all required system fields (UserID, DepartmentID, ProcedureID, SupervisorID, ParticipationTypeID, PatientID, CompletedDate, Diagnosis, Indications, ConsentTypeID, Complications, Comments) via repeated calls to AddProceduresField, also creating field groups for Patient Information and Diagnosis Information.","businessPurpose":"Used during department setup or onboarding to provision the standard set of procedure logging fields required for resident case logging in the Procedures module.","optimizationRecommendations":["Replace 12 sequential EXEC AddProceduresField calls with a set-based approach using a table-valued parameter or a staging temp table to reduce round-trips.","Consider wrapping all EXECs in a single explicit transaction to ensure atomicity in case any field insert fails midway."],"migrationRelevance":"high"},{"name":"AgreementInfoofUser","schema":"dbo","parameters":[],"lineCount":31,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves key user information from Sec_users for a given UserID, including login credentials, department, user type, email, and agreement/first logon dates, filtering to rows where MainEmail is not null.","businessPurpose":"Called during the terms-of-use/agreement acceptance workflow to fetch user profile data needed to verify and record user agreement status.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"ApplicationURL","schema":"dbo","parameters":[],"lineCount":22,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Queries SEC_settings for the ApplicationURL configuration key and returns its Name and Value.","businessPurpose":"Provides the base application URL from system settings, used by email and notification templates that need to generate absolute links back to the platform.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"aspnet_CheckSchemaVersion","schema":"dbo","parameters":[{"name":"@Feature","dataType":"nvarchar(128)","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["aspnet_SchemaVersions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Checks whether a specific ASP.NET schema feature and version combination exists in aspnet_SchemaVersions, returning 0 if found or 1 if not found.","businessPurpose":"Part of the legacy ASP.NET membership provider infrastructure; validates that the database schema version matches the expected membership feature version during application startup.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"aspnet_RegisterSchemaVersion","schema":"dbo","parameters":[{"name":"@Feature","dataType":"nvarchar(128)","direction":"IN","defaultValue":null},{"name":"@CompatibleSchemaVersion","dataType":"nvarchar(128)","direction":"IN","defaultValue":null},{"name":"@IsCurrentVersion","dataType":"bit","direction":"IN","defaultValue":null},{"name":"@RemoveIncompatibleSchema","dataType":"bit","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":["aspnet_SchemaVersions"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Registers or updates an ASP.NET schema version entry in aspnet_SchemaVersions, optionally removing incompatible schemas or marking previous versions as non-current before inserting the new version record.","businessPurpose":"Maintains the ASP.NET membership provider schema version registry; used during database migrations or provider upgrades to track compatibility versions.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"aspnet_UnRegisterSchemaVersion","schema":"dbo","parameters":[{"name":"@Feature","dataType":"nvarchar(128)","direction":"IN","defaultValue":null}],"lineCount":14,"tablesReferenced":["aspnet_SchemaVersions"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Deletes a specific ASP.NET schema version record from aspnet_SchemaVersions matching both the feature name and compatible schema version.","businessPurpose":"Part of the ASP.NET membership provider schema management; used to unregister deprecated schema versions during provider cleanup or rollback.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"aspnet_Users_CreateUser","schema":"dbo","parameters":[{"name":"@ApplicationId","dataType":"uniqueidentifier","direction":"IN","defaultValue":null},{"name":"@UserName","dataType":"nvarchar(256)","direction":"IN","defaultValue":null},{"name":"@IsUserAnonymous","dataType":"bit","direction":"IN","defaultValue":null},{"name":"@LastActivityDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@UserId","dataType":"uniqueidentifier","direction":"OUTPUT","defaultValue":null}],"lineCount":25,"tablesReferenced":["aspnet_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Creates a new user record in aspnet_Users for a given application, generating a new GUID if none is provided, and returns -1 if the provided UserId already exists.","businessPurpose":"Part of the legacy ASP.NET membership provider; creates the base user entry in the ASP.NET users table when a new account is registered.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"aspnet_Users_DeleteUser","schema":"dbo","parameters":[{"name":"@ApplicationName","dataType":"nvarchar(256)","direction":"IN","defaultValue":null},{"name":"@UserName","dataType":"nvarchar(256)","direction":"IN","defaultValue":null},{"name":"@TablesToDeleteFrom","dataType":"int","direction":"IN","defaultValue":null},{"name":"@NumTablesDeletedFrom","dataType":"int","direction":"OUTPUT","defaultValue":null}],"lineCount":146,"tablesReferenced":["aspnet_Users"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Deletes a user and optionally their membership, role assignments, profile, and personalization data from ASP.NET provider tables based on a bitmask parameter, using a transaction with rollback on error.","businessPurpose":"Handles ASP.NET membership user deletion, cascading removals across membership, roles, profiles, and web parts personalization tables when a user account is fully removed.","optimizationRecommendations":["Replace deprecated sysobjects view references with sys.objects for checking view existence.","Consider using MERGE or conditional DELETEs rather than multiple discrete DELETE statements to reduce transaction duration."],"migrationRelevance":"low"},{"name":"aspnet_WebEvent_LogEvent","schema":"dbo","parameters":[{"name":"@EventId","dataType":"char(32)","direction":"IN","defaultValue":null},{"name":"@EventTimeUtc","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EventTime","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EventType","dataType":"nvarchar(256)","direction":"IN","defaultValue":null},{"name":"@EventSequence","dataType":"decimal(19,0)","direction":"IN","defaultValue":null},{"name":"@EventOccurrence","dataType":"decimal(19,0)","direction":"IN","defaultValue":null},{"name":"@EventCode","dataType":"int","direction":"IN","defaultValue":null},{"name":"@EventDetailCode","dataType":"int","direction":"IN","defaultValue":null},{"name":"@Message","dataType":"nvarchar(1024)","direction":"IN","defaultValue":null},{"name":"@ApplicationPath","dataType":"nvarchar(256)","direction":"IN","defaultValue":null},{"name":"@ApplicationVirtualPath","dataType":"nvarchar(256)","direction":"IN","defaultValue":null},{"name":"@MachineName","dataType":"nvarchar(256)","direction":"IN","defaultValue":null},{"name":"@RequestUrl","dataType":"nvarchar(1024)","direction":"IN","defaultValue":null},{"name":"@ExceptionType","dataType":"nvarchar(256)","direction":"IN","defaultValue":null}],"lineCount":48,"tablesReferenced":["aspnet_WebEvent_Events"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Inserts a single ASP.NET health monitoring event record into aspnet_WebEvent_Events with full event metadata including type, timing, application path, machine name, and exception details.","businessPurpose":"Supports ASP.NET health monitoring infrastructure by persisting web application events (errors, security audits, etc.) to the database for review and alerting.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"CheckHelpContentForKeyID","schema":"dbo","parameters":[],"lineCount":45,"tablesReferenced":["Help_KeyValues"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves help content from Help_Contents for a given KeyID by first resolving the key value and section from Help_KeyValues, then filtering by active, non-folder content matching the section and key.","businessPurpose":"Powers the platform's contextual help system, serving role-appropriate help articles to users based on a page key and the user's role ID.","optimizationRecommendations":["The pattern of building a dynamic IN clause by replacing commas in @Section with quoted delimiters using REPLACE is fragile and SQL-injection prone; parameterize or parse the section list properly.","Consider indexing Help_Contents on (KeyValue, SectionID, IsFolder, IsActive) to improve lookup performance."],"migrationRelevance":"medium"},{"name":"CopyCMEEvaluationToAll","schema":"dbo","parameters":[{"name":"@SourceTemplateID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SourceDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":38,"tablesReferenced":[],"sprocsCalledFromBody":["CopyCMEEvaluation"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates through a hardcoded list of department IDs using a while loop and calls CopyCMEEvaluation for each department to copy a CME evaluation template from a source department and template.","businessPurpose":"Used for bulk propagation of CME evaluation templates across multiple departments, typically during system setup or when new CME evaluation designs need to be distributed platform-wide.","optimizationRecommendations":["The hardcoded comma-separated department list embedded in the SP body is a maintenance liability; store the target list in a configuration table instead.","Replace the WHILE loop with a set-based approach or use a single call to CopyCMEEvaluation that accepts a list of target departments."],"migrationRelevance":"low"},{"name":"CreateIndexesForRotationAssignmentDetailAuto","schema":"dbo","parameters":[],"lineCount":43,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Conditionally creates indexes on EVAL_RotationAssignmentMasterAuto and EVAL_RotationAssignmentDetailAuto tables (AmionUniqueID, DepartmentRotationID, StartDate, EndDate) only if they do not already exist, with a bug where the composite index is created only when it already exists.","businessPurpose":"Called before bulk Amion rotation data import operations to ensure the necessary indexes are in place for efficient data loading and subsequent queries.","optimizationRecommendations":["Fix the logic bug: the composite index NONCI_RotationAssignmentDetailAuto is created only when it EXISTS (condition should be NOT EXISTS).","Use sys.indexes instead of deprecated sysindexes for checking index existence.","Consider making these permanent indexes rather than creating/dropping them around import operations, which adds DDL overhead."],"migrationRelevance":"medium"},{"name":"DeleteAdminChatbotData","schema":"dbo","parameters":[{"name":"@ChatbotFilePath","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":15,"tablesReferenced":["ChatbotAdminData"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Deletes records from ChatbotAdminData where the ChatbotFileURL or ChatbotFileName matches the provided file path parameter.","businessPurpose":"Supports the AI chatbot administration feature by allowing admins to remove uploaded training files or documents from the chatbot data store.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DropIndexesForRotationAssignmentDetailAuto","schema":"dbo","parameters":[],"lineCount":43,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Drops indexes on EVAL_RotationAssignmentMasterAuto and EVAL_RotationAssignmentDetailAuto tables (AmionUniqueID, DepartmentRotationID, StartDate, EndDate, NONCI composite) if they exist, to be called before bulk Amion data imports.","businessPurpose":"Paired with CreateIndexesForRotationAssignmentDetailAuto; removes indexes before large Amion schedule data loads to improve insert performance, then recreates them afterwards.","optimizationRecommendations":["Use sys.indexes instead of deprecated sysindexes for existence checks.","Consider whether the drop-create-drop approach is necessary versus keeping permanent filtered indexes."],"migrationRelevance":"medium"},{"name":"EmailAutoLoginFeature_01082025","schema":"dbo","parameters":[{"name":"@Crypt","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":55,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Decrypts an encrypted auto-login URL parameter using URLDecode and DecryptString, splits the decrypted string on a delimiter ('##' or '{~}'), and returns the parsed key-value pairs from the encrypted token.","businessPurpose":"Implements email-based auto-login functionality, processing encrypted tokens embedded in email links so users can be authenticated and redirected to specific platform modules without a manual login.","optimizationRecommendations":["The SP name contains a date suffix (01082025) suggesting it is a versioned copy; consolidate with the main EmailAutoLoginFeature SP.","Debug SELECT @DecryptString statements are left in production code and should be removed.","The SP uses a temp table (#EncryptString) without explicit cleanup on error paths."],"migrationRelevance":"high"},{"name":"EmailAutoLoginFeature_Test","schema":"dbo","parameters":[],"lineCount":56,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Test version of the email auto-login decryption procedure that includes a hardcoded encrypted key string for testing purposes; performs the same decrypt-and-parse logic as the production version.","businessPurpose":"Development/testing artifact for validating the auto-login email token decryption mechanism; should not be called in production.","optimizationRecommendations":["Contains a hardcoded encryption key in the SP body which is a security risk; remove or restrict access to this SP.","This is a test SP that should not exist in production; should be dropped."],"migrationRelevance":"none"},{"name":"error_register","schema":"dbo","parameters":[{"name":"@message","dataType":"varchar(MAX)","direction":"IN","defaultValue":null}],"lineCount":15,"tablesReferenced":["mobile_app_error"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Inserts a mobile app error record into mobile_app_error with the current timestamp, error message, and stack trace.","businessPurpose":"Supports the mobile application error reporting pipeline by persisting client-side errors to the database for analysis and debugging.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"ExcelImport","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["Sheet1"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Constructs and executes a dynamic SQL statement using OPENROWSET with the Microsoft Jet OLEDB driver to import data from an Excel file into a Test1 table.","businessPurpose":"Legacy data import utility for loading Excel spreadsheet data into the database; the hardcoded file path and table name suggest this was a one-time or development tool.","optimizationRecommendations":["The OPENROWSET with Jet OLEDB driver is deprecated and unsupported in modern SQL Server; replace with BULK INSERT or SSIS.","The hardcoded file path and table name make this non-reusable; parameterize properly.","This appears to be a development/testing artifact and should be removed from production."],"migrationRelevance":"none"},{"name":"FindText","schema":"dbo","parameters":[{"name":"@text","dataType":"VARCHAR(100)","direction":"IN","defaultValue":null}],"lineCount":92,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Searches all stored procedure bodies in syscomments for a given text pattern using a cursor, then returns matching procedure names, line numbers, and the matching line of code; optionally returns only distinct procedure names.","businessPurpose":"DBA utility for finding text patterns across all stored procedure source code, useful for code audits, refactoring, and identifying which procedures reference specific tables or functions.","optimizationRecommendations":["Uses syscomments which is deprecated; use sys.sql_modules for more reliable and complete SP text.","Cursor-based line-by-line character scanning is extremely slow for large databases; rewrite to use sys.sql_modules with LIKE or CONTAINS for full-text search.","The temp table #TempResults is created but there is no error cleanup path if the cursor fails."],"migrationRelevance":"low"},{"name":"GenerateImageName","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":7,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns a new GUID as NewGUID using NEWID().","businessPurpose":"Generates unique identifiers for image file naming in the platform, ensuring no naming conflicts when users upload images.","optimizationRecommendations":["This functionality can be replaced by generating the GUID on the application side, eliminating a database round-trip."],"migrationRelevance":"low"},{"name":"GetAllDeptPassFailCount","schema":"dbo","parameters":[],"lineCount":31,"tablesReferenced":[],"sprocsCalledFromBody":["Getdept_passfail_count"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Uses a cursor to iterate over departments with ID less than 30, calling Getdept_passfail_count for each and aggregating results in a temp table, then returns all rows and drops the temp table.","businessPurpose":"Generates a pass/fail count summary across the first 30 departments, likely for a system-wide dashboard or administrative report on quiz/evaluation outcomes.","optimizationRecommendations":["The hardcoded condition departmentid < 30 is fragile; parameterize the department range.","Replace the cursor and INSERT-EXEC loop with a set-based solution.","The temp table #temptable must be created by the caller before this SP is called, creating tight coupling."],"migrationRelevance":"low"},{"name":"GetAmmionDataUsersToSync","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserType","dataType":"ShortCounterNumber","direction":"IN","defaultValue":null},{"name":"@UserScope","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@FirstYear","dataType":"ShortCounterNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":[],"sprocsCalledFromBody":["GetSyncAmionUsers"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves Amion schedule users not yet synced by calling GetSyncAmionUsers, then returns Amion data records whose AMIONUniqueID is not in the already-synced list.","businessPurpose":"Identifies Amion scheduling users that need to be imported into MyEvaluations for resident-attending rotation sync; used during the Amion data synchronization process.","optimizationRecommendations":["Depends on caller-created temp table #amnion_data; this coupling should be documented and ideally refactored to use a table-valued parameter.","The NOT IN subquery on AMIONUniqueID can be slow for large datasets; consider a LEFT JOIN / IS NULL pattern or NOT EXISTS."],"migrationRelevance":"high"},{"name":"GetAnonymousEvalAverageResults","schema":"dbo","parameters":[{"name":"@SQL","dataType":"Varchar(Max)","direction":"IN","defaultValue":null}],"lineCount":58,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Executes a dynamic SQL query (passed in via @SQL parameter) that returns evaluation answer counts, then iterates over results to categorize Yes/No/Inconsistent responses and assembles a formatted result string.","businessPurpose":"Computes aggregate Yes/No/Inconsistent response statistics for anonymous evaluation reports, formatting the output as an HTML-ready summary string for display.","optimizationRecommendations":["Accepts raw SQL as input (@SQL parameter), creating significant SQL injection risk; refactor to pass structured parameters instead of dynamic SQL.","The WHILE loop over temp table results should be replaced with a set-based PIVOT or conditional aggregation.","Assigning ISNULL(AvgAnswerIndex,'') to an int variable is invalid and will cause a runtime error with non-numeric data."],"migrationRelevance":"medium"},{"name":"GetAutoLoginLinksByUserID","schema":"dbo","parameters":[{"name":"@UserName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Password","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Generates an encrypted auto-login URL for a user by combining their username and password into an encrypted string using EncryptingStringV2 and appending it to the platform's base website URL from SEC_settings.","businessPurpose":"Creates time-limited (15-minute) encrypted login links for email notifications, enabling recipients to click through and be automatically authenticated to the platform.","optimizationRecommendations":["Storing and passing plaintext passwords to build the encryption payload is a security concern; consider token-based authentication instead.","The encryption key (@EncryptText) is passed as a parameter from the application, which may expose it in query logs; use server-side key management."],"migrationRelevance":"high"},{"name":"GetChaptersTreeView_New","schema":"dbo","parameters":[{"name":"@SectionID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":72,"tablesReferenced":["HELP_Contents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns a hierarchical tree view of help content chapters and pages from HELP_Contents filtered by section and role (user/admin/super-admin access levels), joining with access level master data.","businessPurpose":"Drives the help system's navigation tree view, showing appropriate chapters and pages based on the logged-in user's role to provide contextual documentation.","optimizationRecommendations":["Uses implicit JOIN syntax (comma-separated tables) for HELP_UserAccessLevelMaster; should be replaced with explicit JOIN syntax for clarity.","The three nearly identical SELECT blocks for different role types could be consolidated using a single query with role-based WHERE conditions.","Add an index on HELP_Contents (SectionID, IsActive, AccessLevel) to improve filtering performance."],"migrationRelevance":"medium"},{"name":"GetChatbotData","schema":"dbo","parameters":[],"lineCount":15,"tablesReferenced":["ChatbotAdminData"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves all chatbot admin data records from ChatbotAdminData ordered by creation date descending, returning formatted date, file metadata, module, access role, and document type.","businessPurpose":"Provides the AI chatbot administration interface with the list of all uploaded training documents and their metadata for management by administrators.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetCMEMultiSpeakersInfo","schema":"dbo","parameters":[{"name":"@AssignID","dataType":"numeric(18,0)","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"numeric(18,0)","direction":"IN","defaultValue":null}],"lineCount":49,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Calls the scalar function udfnGetCMEMultiSpeakers twice (once for LecturerIDs and once for Speakers names) and returns both as a single row result set.","businessPurpose":"Retrieves the formatted speaker names and IDs for a CME schedule topic, used by CME certificate and attendance views to display presenter information.","optimizationRecommendations":["Calling the same UDF twice with different parameters can be replaced by a single call if the UDF is refactored, or by using a TVF instead of two scalar calls.","The large commented-out code block should be cleaned up."],"migrationRelevance":"medium"},{"name":"GetCoefficientAlpha_Departments","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":53,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Calculates Cronbach's Coefficient Alpha (a measure of internal consistency/reliability) for quiz results grouped by department, joining quiz assignment users, answered questions, correct answers, and quiz templates over a date range.","businessPurpose":"Provides statistical reliability analysis for quiz instruments across departments, used in educational assessment quality reporting to validate that quiz items are measuring the same construct.","optimizationRecommendations":["Uses fnSplit for multi-value parameters; parameterize with table-valued parameters instead for better performance.","The use of a table variable for intermediate aggregation followed by a derived table query adds unnecessary complexity; simplify with CTEs."],"migrationRelevance":"medium"},{"name":"GetCombinedVoluntaryTemplatesMobile","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@SubjectIDs","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@TargetID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@IsVoluntary","dataType":"TINYINT","direction":"IN","defaultValue":null},{"name":"@TemplateIDs","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@IsShared","dataType":"TINYINT","direction":"IN","defaultValue":"1"}],"lineCount":28,"tablesReferenced":[],"sprocsCalledFromBody":["GetAvailableVoluntaryTemplates"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves both shared and local voluntary evaluation templates by calling GetAvailableVoluntaryTemplates twice and combining results in a temp table, flagging each record as shared (IsLocal=0) or local (IsLocal=1).","businessPurpose":"Provides the mobile application with a combined list of available voluntary evaluation templates, distinguishing between locally created and platform-shared templates.","optimizationRecommendations":["The conditional logic for IsLocal flag assignment via two UPDATE statements after INSERT is unnecessarily complex; set the flag during the INSERT using EXEC with a flag parameter."],"migrationRelevance":"medium"},{"name":"GetCompletionReportData_BackupPrabha20171023","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"largeNumber","direction":"IN","defaultValue":null},{"name":"@RequiredDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PGYLevel","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ReportStartDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@ReportEndDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@ResultByRotation","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@GroupBYRotation","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@SortOrder","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@SortBy","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":688,"tablesReferenced":[],"sprocsCalledFromBody":["GenerateDepartmentCompletionStatusReportInfo","GetMissingDatesbyUserID","RotationList","UserReviewList"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"(uncategorized)","summary":"A backup copy (dated 2017-10-23) of the completion report SP that generates rotation schedule completion statistics for trainees, showing confirm vs. schedule shift/moonlight counts and percentage completion, with optional grouping by rotation or trainee.","businessPurpose":"Historical backup of the department completion status report that shows what percentage of their scheduled shifts trainees have confirmed in the Amion rotation system.","optimizationRecommendations":["This is a backup copy with a date suffix; it should be removed from production once the current version is verified.","The SP contains extensive commented-out code from multiple iterations; clean up dead code.","Multiple INSERT-EXEC patterns into table variables create significant overhead; consider materializing to temp tables for better plan reuse.","Dynamic ORDER BY using CASE expressions prevents index utilization; consider separate sorted queries based on parameter values."],"migrationRelevance":"none"},{"name":"GetDataUsersToSync","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserType","dataType":"ShortCounterNumber","direction":"IN","defaultValue":null},{"name":"@UserScope","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@FirstYear","dataType":"ShortCounterNumber","direction":"IN","defaultValue":null},{"name":"@OnCallServiceID","dataType":"LargeNumber","direction":"IN","defaultValue":"1"}],"lineCount":73,"tablesReferenced":[],"sprocsCalledFromBody":["GetSyncAmionUsers","GetUserListByCriteriaBasic"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Compares Amion scheduling users against MyEvaluations users to identify sync candidates, returning three result sets: matched pairs for sync, MyEvaluations users without an Amion match, and Amion users without a MyEvaluations match.","businessPurpose":"Core Amion-to-MyEvaluations user synchronization utility that identifies which users need to be linked, are new in MyEvaluations, or are unmatched in the Amion feed for a department.","optimizationRecommendations":["Depends on caller-created temp table #amnion_data which must be pre-populated; this tight coupling should be replaced with a TVP or structured input.","Contains commented-out duplicate logic blocks that should be removed."],"migrationRelevance":"high"},{"name":"GetDepartmentAdminsForIncorrectSync","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LARGENUMBER","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves department admins (RoleID 2 or 4, non-archived, with active email) for a given department, returning their name and email address for use in sync error notifications.","businessPurpose":"Identifies the appropriate department administrators to notify via email when an Amion synchronization error occurs, ensuring issues are escalated to the right people.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"Getdept_HighLow_Score","schema":"dbo","parameters":[],"lineCount":13,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Selects all records from Demo_uc6 table.","businessPurpose":"Returns demo/sample data for high-low score visualization at the department level; appears to be a placeholder or development artifact using a demo table.","optimizationRecommendations":["The SP selects from a Demo table rather than production data; this should be replaced with actual business logic querying real evaluation data."],"migrationRelevance":"none"},{"name":"GetDuplicateQuestionsByDepartment","schema":"dbo","parameters":[],"lineCount":40,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Identifies duplicate evaluation questions within a department by grouping on all question fields and returning groups where the count of descriptions, category IDs, and question codes is greater than 1.","businessPurpose":"Data quality utility for administrators to identify and clean up duplicate evaluation questions within a department's question bank, preventing redundancy in evaluation forms.","optimizationRecommendations":["The HAVING clause checks COUNT > 1 for QuestionDescription, QuestionsCategoryID, and QuestionCode separately rather than using a single COUNT(*) > 1; simplify to COUNT(*) > 1.","Add an index on eval_questions (DepartmentID, IsDeleted, QuestionDescription) to improve the GROUP BY performance."],"migrationRelevance":"low"},{"name":"GetDutyHourViolationToReviewCount_V2","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":41,"tablesReferenced":[],"sprocsCalledFromBody":["GetCountNotation","GetViolationList"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Calls GetViolationList to populate a temp table of duty hour violations, then returns either the total count or a formatted notation string via GetCountNotation depending on the @MainPage parameter.","businessPurpose":"Provides duty hour violation counts for dashboard display and the violation review page, supporting ACGME compliance monitoring by showing how many unreviewed violations exist.","optimizationRecommendations":["INSERT-EXEC into a temp table (from GetViolationList) prevents the caller from being inside a transaction; consider using a table-valued function instead.","The SELECT @Count = COUNT(*) after INSERT is redundant; use @@ROWCOUNT immediately after the INSERT."],"migrationRelevance":"high"},{"name":"GetExamsList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns the list of board exams from Sec_exams, filtered differently based on the department's program ID (program 159 excludes exams 1-4, all others exclude exams 17-21).","businessPurpose":"Provides the exam selection dropdown for resident profiles, with program-specific filtering to show only relevant board exams (e.g., different exam sets for different specialty programs).","optimizationRecommendations":["The hardcoded program ID (159) and exam ID exclusion lists are maintenance liabilities; store these configurations in a lookup table."],"migrationRelevance":"medium"},{"name":"GetFieldTypes","schema":"dbo","parameters":[{"name":"@UserId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":13,"tablesReferenced":["MGMT_FieldTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns all field type ID and name pairs from MGMT_FieldTypes.","businessPurpose":"Provides the list of available field data types (e.g., text, number, date) for the procedure log custom fields configuration interface.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetFrequencyDistribution_Departments","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":308,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Calculates quiz score frequency distribution by percentage range (0-40, 41-50, 51-60, 61-70, 71-80, 81-90, 91-100) aggregated by department, joining quiz assignment users, answered questions, correct answers, and quiz templates over a date range.","businessPurpose":"Generates score distribution histograms for quiz results across departments, used in educational analytics dashboards to show how residents' quiz scores are distributed.","optimizationRecommendations":["Uses fnSplit for multi-value parameters; replace with table-valued parameters.","Contains a large commented-out alternative implementation that should be removed.","Consider pre-computing score percentages in a CTE before applying CASE binning to improve readability."],"migrationRelevance":"medium"},{"name":"GetInstitutionalCompilanceEvaluations","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SubjectID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TargetID","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"}],"lineCount":48,"tablesReferenced":[],"sprocsCalledFromBody":["GetAvailableTemplates"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates over a comma-delimited list of DepartmentIDs using a WHILE loop, calling GetAvailableTemplates for each department and accumulating results in a table variable, then returns deduplicated evaluation templates grouped by ID and Name.","businessPurpose":"Retrieves the set of evaluation templates available for Institutional Compliance review across multiple departments at once; used by the compliance reporting workflow to gather all eligible templates for a given set of programs.","optimizationRecommendations":["Replace the WHILE loop with a set-based approach: pass all department IDs to GetAvailableTemplates once (if that SP supports TVP input) or use a single JOIN against fnSplit output to eliminate N round-trips.","The GROUP BY without an aggregate is effectively a DISTINCT; use SELECT DISTINCT instead for clarity, or add an appropriate aggregate if duplicate IDs with differing names are expected.","The typo 'GRoup By' (mixed case) works in SQL Server but is a code quality issue  standardize casing."],"migrationRelevance":"medium"},{"name":"GetLearningModuleAssignmentNoticeEmailInformation","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExpiryDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@LiteratureName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":232,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Builds email notification content for learning module assignments by iterating over users retrieved via GetUsersFullNameWithPhoneDetails using a WHILE loop, constructing per-user HTML email bodies from templates stored in the database, and collecting results into a temp table.","businessPurpose":"Drives the learning module assignment notification email pipeline, generating personalized HTML emails for each assigned user when a new learning module is assigned  part of the LMS notification workflow.","optimizationRecommendations":["The WHILE loop with individual row fetches (one user at a time) is a row-by-row anti-pattern; refactor to a set-based email template approach.","Variables declared inside the WHILE loop body (DECLARE @UserName, etc.) are re-declared on each iteration without being reset  these should be declared once before the loop.","The DECLARE inside the loop for @UserName/etc. is valid but wasteful; consolidate all variable declarations to before the loop.","Consider using a cursor with FAST_FORWARD instead of the WHILE+rownum pattern for clarity and correctness, or better yet, a set-based batch email generation approach."],"migrationRelevance":"medium"},{"name":"GetMailGunSchedulerExecutionTime","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["MailGunSchedulerExecutionTime"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns the most recent MailGun scheduler execution record from MailGunSchedulerExecutionTime, calculating the next scheduled start time (StartDateTime + 1 hour) and end time (StartDateTime + 1 hour 59 minutes).","businessPurpose":"Provides the MailGun email scheduler with its next execution window so the scheduler service knows when to send the next batch of queued emails.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetMappedMedicalSchoolforERAS","schema":"dbo","parameters":[{"name":"@CountryID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":94,"tablesReferenced":["PendingMedschools"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Fuzzy-matches medical school names from the ERAS (Electronic Residency Application Service) PendingMedschools table against the Sec_MedSchools master list for a given country, using word-level splitting via fnSplit and outer apply to produce a mapping of ERAS institution names to system MedSchoolIDs.","businessPurpose":"Supports the ERAS medical school import workflow by identifying which ERAS applicant medical schools correspond to existing Sec_MedSchools records, enabling automated matching of incoming residency applications to known institutions.","optimizationRecommendations":["Creating four temp tables (#PendingMedschools, #tempSec_MedSchools, #TempMedSchools, #TempErasSchools) with OUTER APPLY word-splitting is memory-intensive; consider a single-pass LIKE-based matching with indexed computed columns instead.","The commented-out REPLACE/normalization lines suggest name normalization was never completed  implement consistent name cleaning (remove punctuation, normalize spaces) before the word-split join for better match rates.","Add indexes on the temp tables after insert to speed up the subsequent join operations."],"migrationRelevance":"medium"},{"name":"GetMeanMedianRange_users_new","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":107,"tablesReferenced":[],"sprocsCalledFromBody":["SPGetMedianByQuiz"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Calculates mean score, score range, and median (via a PERCENTILE_CONT-style approach) per quiz for a filtered set of users within a date range, using temp tables (#tblval, #TempUsers, #TempQuizs) to stage per-user quiz scores before computing aggregate statistics.","businessPurpose":"Powers quiz performance analytics reporting by computing descriptive statistics (mean, range, median) for selected users and quizzes within a date range  the '_new' version uses temp tables for better performance than the '_old' table-variable version.","optimizationRecommendations":["The '_new' vs '_old' naming pattern is a maintenance anti-pattern; consolidate into a single parameterized SP and deprecate the old version.","Add indexes on the temp tables (#TempUsers, #TempQuizs) after INSERT to speed up the subsequent JOIN operations.","The GROUP BY in the outer aggregation includes ORDER BY which is non-deterministic for median calculation without a stable PARTITION  verify the median logic is mathematically correct."],"migrationRelevance":"medium"},{"name":"GetMeanMedianRange_users_old","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":104,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Calculates mean score, score range, and median per quiz for a filtered set of users within a date range, using table variables (@tblval) instead of temp tables  functionally equivalent to GetMeanMedianRange_users_new but with different staging mechanism and group-by column (assignmentId vs assignid).","businessPurpose":"Legacy version of the quiz mean/median/range analytics SP; retained alongside the '_new' version, likely due to a query change that broke the '_old' version or a behavioral difference in the assignmentId column name.","optimizationRecommendations":["This SP should be removed and all callers migrated to GetMeanMedianRange_users_new; having two near-identical SPs with different temp storage mechanisms creates maintenance confusion.","The GROUP BY column difference (assignmentId vs assignid) between old and new versions may indicate a schema rename  verify which column name is correct before deprecating.","Table variables do not support statistics and cannot benefit from parallelism; the temp table approach in the _new version is preferable for large datasets."],"migrationRelevance":"low"},{"name":"Getpatientid","schema":"dbo","parameters":[],"lineCount":31,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns the top 1000 unencrypted patient records (where UpdateEncrypt = 0) from prc_Patients, filtering for rows where PatientName and MRNumber do not contain the '=' character and PatientName is non-empty.","businessPurpose":"Used by the data encryption migration pipeline to retrieve the next batch of patient records whose PatientName and MRNumber fields have not yet been encrypted, driving the incremental PII encryption process.","optimizationRecommendations":["Add an index on (UpdateEncrypt, PatientName, MRNumber) to support the WHERE clause without a full table scan on what is likely a large patient table.","The TOP 1000 batch size is hardcoded; make it a parameter to allow the encryption job to tune batch size based on system load.","The commented-out alternative queries suggest this SP evolved through multiple iterations  clean up the dead code."],"migrationRelevance":"high"},{"name":"GetPointBiserialCorrelationCoefficient_Departments","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":174,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Computes the point-biserial correlation coefficient between quiz question correctness (binary: correct/incorrect) and total quiz score for each question, aggregated by department and quiz, for evaluating item discrimination in quiz assessments.","businessPurpose":"Provides psychometric analysis (point-biserial correlation) for quiz item quality evaluation  used by department administrators to identify poorly discriminating quiz questions that should be revised or removed.","optimizationRecommendations":["The multi-step aggregation using a table variable followed by complex CROSS JOIN arithmetic is difficult to read; consider breaking into a CTE chain for clarity.","Add an index on Quiz_AssignmentUsers (CompletedDate, QuizID, IsDeletedUserAssignment) to support the date-range filter efficiently.","The CROSS JOIN for computing department-level means creates O(n^2) rows before the final GROUP BY  verify this does not produce a Cartesian explosion for large department/quiz combinations."],"migrationRelevance":"medium"},{"name":"GetProcedureEmailReminderSend","schema":"dbo","parameters":[{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":38,"tablesReferenced":[],"sprocsCalledFromBody":["GetPostSubmissionProcedureEmailReminderSend","GetSummativeProcedureEmailReminderSend"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Aggregates procedure email reminder information from two sub-queries by calling GetPostSubmissionProcedureEmailReminderSend and GetSummativeProcedureEmailReminderSend via INSERT-EXEC into a unified temp table, then returns all results ordered by DepartmentID.","businessPurpose":"Orchestrates the two streams of procedure reminder emails (post-submission reminders and summative assessment reminders) into a single result set for the email dispatch service to process.","optimizationRecommendations":["Using INSERT-EXEC twice from a single SP prevents nesting  if either sub-SP itself uses INSERT-EXEC, this will fail at runtime with 'An INSERT EXEC statement cannot be nested'; validate the call chain.","Consider replacing the INSERT-EXEC pattern with table-valued functions or a unified SP that accepts a type parameter to avoid the nesting limitation."],"migrationRelevance":"high"},{"name":"GetProcedureFieldsList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns the list of procedure log fields for a department, ordering by a user-defined sort order from prc_departmentfieldorder if custom sorting exists, falling back to the field's default ORDER column if no custom sort has been configured.","businessPurpose":"Drives the procedure log form field rendering by providing the correctly ordered list of fields for a department's procedure entry form  respects per-department field ordering customizations.","optimizationRecommendations":["The two COUNT(*) subqueries to check for custom sort records could be replaced with a single EXISTS check for better performance.","Both branches of the IF return all columns (SELECT f.*)  consider specifying only the columns needed by the calling application to reduce data transfer."],"migrationRelevance":"high"},{"name":"GetQuestionOptionPerc_UserTypes_Gridss","schema":"dbo","parameters":[{"name":"@QuestionId","dataType":"int","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"int","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@AssignId","dataType":"int","direction":"IN","defaultValue":null}],"lineCount":155,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Computes per-answer-option percentage distributions for a specific quiz question, broken down by user type and user, joining Quiz_Answers with RptQuestionAnalysis_New and QUIZ_QuizUserTypes to produce a pivot-style result showing option selection rates.","businessPurpose":"Powers the quiz question analysis report grid view that shows how different user types (residents, faculty, etc.) answered each question option, enabling educators to identify option-level patterns across learner groups.","optimizationRecommendations":["The deeply nested subquery structure (3 levels of derived tables) is hard to maintain; refactor using CTEs for clarity.","The RIGHT JOIN against Quiz_Answers ensures all options appear even with zero responses  ensure this is the intended behavior and document it.","Add an index on RptQuestionAnalysis_New (QuestionId, QuizId, AssignId, UserId) to support the WHERE clause filters efficiently.","The ROW_NUMBER OVER (PARTITION BY UserType, Users ORDER BY AnswerId) is computed before the outer aggregation  verify the partition semantics produce correct per-user-type percentages."],"migrationRelevance":"medium"},{"name":"GetQuestions","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves distinct quiz questions and their correct answers for a filtered set of users, departments, and quizzes within a date range, joining QUIZ_QuestionAnalysis, Quiz_Answers, Quiz_CorrectAnswer, and Quiz_Template.","businessPurpose":"Provides the base question-answer data for quiz performance analysis reports, returning each question with its correct answer for the selected quiz and user cohort.","optimizationRecommendations":["The fnSplit calls on @DeptId, @QuizId, and @userid produce inline table results used in IN subqueries; replacing with table-valued parameters would improve performance for large ID lists.","The DISTINCT may mask duplicate rows caused by missing join conditions; verify the join between QUIZ_QuestionAnalysis and Quiz_Answers is correct (no explicit ON clause shown  check the full body)."],"migrationRelevance":"medium"},{"name":"GetQuestionsDetails_New","schema":"dbo","parameters":[{"name":"@SelectedQIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":40,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns formatted quiz question details including all answer options (labeled A-F using fnGetAlphabets()) and the correct answer letter for a comma-delimited list of question IDs, using a CTE with row_number to assign alphabet labels to options, then pivoting into a single-row-per-question format via MAX(CASE RowNum...).","businessPurpose":"Used by quiz reporting and review screens to display formatted question text, all answer options in labeled order, and the correct answer letter  the '_New' version uses a CTE-based approach replacing the cursor-based '_Old' version.","optimizationRecommendations":["The MAX(CASE RowNum WHEN N THEN Answer ELSE '' END) pivot pattern supports only 5 answer options hardcoded; add cases for options 6+ or use dynamic SQL if questions can have more options.","The CTE is clean and set-based  this is the preferred pattern; ensure GetQuestionsDetails_Old callers are migrated here.","The fn_SepTable function used for @SelectedQIDs should be evaluated against fnSplit for consistency across the codebase."],"migrationRelevance":"medium"},{"name":"GetQuestionsDetails_Old","schema":"dbo","parameters":[{"name":"@SelectedQIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":70,"tablesReferenced":[],"sprocsCalledFromBody":["GetQuestionAnswers"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves quiz question details using a cursor-like WHILE loop that iterates over question IDs, calling GetQuestionData via dynamic SQL per question and accumulating results in temp tables  a row-by-row approach that predates the CTE-based GetQuestionsDetails_New.","businessPurpose":"Legacy version of quiz question details retrieval; retained alongside GetQuestionsDetails_New, which replaces the cursor/WHILE pattern with a set-based CTE approach.","optimizationRecommendations":["This SP uses sp_executesql inside a WHILE loop  one dynamic SQL execution per question ID  which is a severe performance anti-pattern; remove and migrate all callers to GetQuestionsDetails_New.","The dynamic SQL string concatenation with sp_executesql to build a comma-delimited AnswerID list is unnecessary; a simple subquery would achieve the same result without dynamic SQL.","The INSERT-EXEC of GetQuestionData (visible in truncated body) adds another level of procedural overhead; the _New version's CTE approach eliminates all of this."],"migrationRelevance":"low"},{"name":"GetQueueListForPromotion","schema":"dbo","parameters":[{"name":"@Status","dataType":"BigNumber","direction":"IN","defaultValue":null}],"lineCount":36,"tablesReferenced":[],"sprocsCalledFromBody":["spLOG_ErrorHandling"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves all pending promotion queue entries (Status = 0, meaning In Queue/Incomplete) by joining Sche_PromotionScheduleQueue with Sche_PromotionQueueUsers, returning queue metadata including target user type, target department, archive flag, and promoting-only flag, wrapped in TRY/CATCH with error logging.","businessPurpose":"Called by the promotion scheduler service to fetch the list of users whose department/year promotion is pending processing, driving the automated academic year promotion workflow.","optimizationRecommendations":["The NOLOCK hints on both tables reduce locking but risk reading uncommitted data mid-promotion; evaluate whether dirty reads are acceptable for this queue polling scenario.","Add an index on Sche_PromotionQueueUsers (Status, QueueID) to support the WHERE Status = 0 filter efficiently.","The ORDER BY QueueUsers.QueueID ensures FIFO processing  document this explicitly as it is a functional requirement."],"migrationRelevance":"high"},{"name":"GetQuizAssignmentSummary_Cmpl","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@SelectedQuizID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":81,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns completed quiz assignment results for selected users and quiz IDs within a date range, showing each user's answer count vs total questions, percentage score, pass/fail result, and completion date.","businessPurpose":"Provides the quiz completion summary report showing individual trainee performance on assigned quizzes, used by program directors to monitor educational assessment compliance.","optimizationRecommendations":["Uses NOLOCK hints extensively which may cause dirty reads; evaluate whether this is appropriate for reporting.","The fnSplit-based parameter splitting for user and quiz IDs should be replaced with TVPs.","Contains large commented-out alternative result aggregation code that should be removed."],"migrationRelevance":"medium"},{"name":"GetReportDepartmentList","schema":"dbo","parameters":[],"lineCount":24,"tablesReferenced":["Department","Program"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns department ID, name, maximum PGY level, and program type code (PGY/FPGY/MSY) for a comma-separated list of department IDs, joining Department and Program tables.","businessPurpose":"Provides department metadata for multi-department reports, enabling report generation across selected departments with correct PGY label formatting based on program category.","optimizationRecommendations":["Uses SplitTextCSVNames function; consider replacing with a TVP for better performance.","The CASE expression for PType could be stored as a column in the Program table to avoid repeated computation."],"migrationRelevance":"medium"},{"name":"GetRowValuesToString","schema":"dbo","parameters":[{"name":"@TableName","dataType":"VARCHAR(100)","direction":"IN","defaultValue":null},{"name":"@ColumnName","dataType":"VARCHAR(100)","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Uses sp_executesql with dynamic SQL to concatenate all values of a specified column from a specified table into a comma-separated output string via an OUTPUT parameter.","businessPurpose":"Generic utility for building comma-separated value strings from database table columns, used when constructing dynamic IN-clause lists or formatted outputs for reporting.","optimizationRecommendations":["Dynamic table and column names are vulnerable to SQL injection; add validation for @TableName and @ColumnName inputs.","This pattern can be replaced by application-side string aggregation or STRING_AGG() in SQL Server 2017+."],"migrationRelevance":"low"},{"name":"GetRowValuesToStringWithSemiColon","schema":"dbo","parameters":[{"name":"@TableName","dataType":"VARCHAR(100)","direction":"IN","defaultValue":null},{"name":"@ColumnName","dataType":"VARCHAR(100)","direction":"IN","defaultValue":null},{"name":"@ReturnString","dataType":"VARCHAR(8000)","direction":"OUTPUT","defaultValue":null}],"lineCount":21,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Identical to GetRowValuesToString but uses a semicolon delimiter instead of a comma to join the column values into the output string.","businessPurpose":"Semicolon-delimited variant of GetRowValuesToString; used when comma-separated output would conflict with CSV parsing in email or export contexts.","optimizationRecommendations":["Dynamic SQL with table/column name concatenation is vulnerable to SQL injection; validate inputs.","Consolidate with GetRowValuesToString by adding a delimiter parameter to reduce code duplication.","Use STRING_AGG() in SQL Server 2017+ as a replacement."],"migrationRelevance":"low"},{"name":"GetSelectedDataUsersToSync","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserType","dataType":"ShortCounterNumber","direction":"IN","defaultValue":null},{"name":"@UserScope","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@FirstYear","dataType":"ShortCounterNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":[],"sprocsCalledFromBody":["GetSyncAmionUsers"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Matches selected Amion users against the caller-provided #amnion_data temp table to return already-synced user pairs with their sync field and ident columns.","businessPurpose":"Used in the Amion user synchronization UI to show which Amion users from the current data set are already matched to MyEvaluations users.","optimizationRecommendations":["Depends on caller-created temp table #amnion_data; this coupling should be documented and replaced with a TVP."],"migrationRelevance":"medium"},{"name":"GetSubmittedProceduresSupervisorsListByProcedureIDs","schema":"dbo","parameters":[{"name":"@ProcedureIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":[],"sprocsCalledFromBody":["GetSubmittedProceduresSupervisorsList"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Parses a comma-separated string of procedure IDs into a table variable using SplitTextCSV, then delegates to GetSubmittedProceduresSupervisorsList with the structured list.","businessPurpose":"Provides the supervisor list for submitted procedure logs when procedure IDs are passed as a comma-separated string, bridging string input to the typed table parameter expected by the main SP.","optimizationRecommendations":["This is an adapter/wrapper SP; if the application can pass a proper TVP, this SP becomes unnecessary overhead."],"migrationRelevance":"medium"},{"name":"Getuser_HighLow_Score","schema":"dbo","parameters":[],"lineCount":13,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Selects all records from Demo_uc5 table.","businessPurpose":"Returns demo/sample data for high-low score visualization at the user level; appears to be a placeholder or development artifact using a demo table.","optimizationRecommendations":["Selects from a Demo table rather than actual production data; should be replaced with real evaluation score query logic."],"migrationRelevance":"none"},{"name":"GetUserInfoByIdForEncryption","schema":"dbo","parameters":[{"name":"@UserId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns user credentials (UserID, UserName, Password, MainEmail, DSINumber) from sec_users for a given UserID, with empty string defaults for null values, conditioned on the user existing.","businessPurpose":"Supports the user data encryption migration process by retrieving user credentials that need to be encrypted, used by the encryption batch job.","optimizationRecommendations":["Returning Password in plaintext via a SP is a significant security risk; ensure this is only accessible to privileged processes and the channel is encrypted."],"migrationRelevance":"medium"},{"name":"GetUsersIdsToEncrypt","schema":"dbo","parameters":[{"name":"@LoggedInUser","dataType":"LargeNumber","direction":"IN","defaultValue":"1"}],"lineCount":20,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":1,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns up to 300 user records from sec_users where all encrypted fields (EncryptedUserName, EncryptedPassword, EncryptedEmail, EncryptedDSINumber) are empty, for batch encryption processing.","businessPurpose":"Drives the user data encryption migration by identifying users whose sensitive data has not yet been encrypted, processed in batches of 300 by the encryption job.","optimizationRecommendations":["Add an index on sec_users (EncryptedUserName, EncryptedPassword, EncryptedEmail, EncryptedDSINumber) to efficiently filter unencrypted users.","The TOP 300 without ORDER BY is non-deterministic; add ORDER BY UserID for consistent batching."],"migrationRelevance":"medium"},{"name":"INS","schema":"dbo","parameters":[],"lineCount":82,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":1,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Generates INSERT statements for all rows in a given table matching a WHERE condition by dynamically building a SELECT that produces INSERT INTO syntax for each row, printing the result without executing it.","businessPurpose":"DBA utility for generating INSERT scripts from existing table data, useful for creating data migration scripts, seeding test environments, or exporting configuration records.","optimizationRecommendations":["The generated INSERT script is PRINTed but not executed; ensure this is intentional (the EXEC is commented out).","The dynamic SQL building is vulnerable to SQL injection via @Query; add input validation.","For SQL Server 2017+, consider using FOR XML PATH or JSON for cleaner script generation."],"migrationRelevance":"low"},{"name":"InsertAdminChatbotData","schema":"dbo","parameters":[{"name":"@ChatbotFileName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ChatbotFileURL","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ChatbotFileDescrption","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ChatbotFileModule","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ChatbotFileAccessRole","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ChatbotVideoId","dataType":"LargeText","direction":"IN","defaultValue":"''"},{"name":"@ChatbotDocumentType","dataType":"LargeText","direction":"IN","defaultValue":"''"}],"lineCount":17,"tablesReferenced":["ChatbotAdminData"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Inserts a new record into ChatbotAdminData with chatbot file metadata including name, URL, description, module, access role, video ID, and document type.","businessPurpose":"Supports the AI chatbot administration interface by saving newly uploaded training documents or video references to the chatbot data store.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"InsertMailGunSchedulerLastExecutionTime","schema":"dbo","parameters":[{"name":"@StartDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":15,"tablesReferenced":["MailGunSchedulerExecutionTime"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Inserts a record into MailGunSchedulerExecutionTime with start time, end time, and bounce count for a MailGun scheduler run.","businessPurpose":"Tracks MailGun email scheduler execution history for monitoring email delivery performance and identifying bounce rate trends over time.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"InsertQuizTime","schema":"dbo","parameters":[],"lineCount":62,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"A development/test procedure that generates a list of department IDs (multiples of 5 from 125 to 4500) in a loop and selects the TimeLimit values from a table variable; the actual INSERT INTO Quiz_TimeLimit is commented out.","businessPurpose":"Appears to be an unfinished or abandoned data seeding script for quiz time limits across departments; the main INSERT statement is commented out.","optimizationRecommendations":["The INSERT INTO Quiz_TimeLimit is commented out, making this SP non-functional for its stated purpose; either complete or remove it.","Should be removed from production as it serves no current business function."],"migrationRelevance":"none"},{"name":"launch_scheme_changes_trace","schema":"dbo","parameters":[],"lineCount":63,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Creates a SQL Server Profiler trace that captures all SQL batch completion events containing DDL keywords (alter, create, drop, truncate) from the myevals database, filtering to the .Net SqlClient provider, and starts the trace.","businessPurpose":"DBA tool for monitoring and auditing schema changes (DDL) in the myevals database by capturing trace events to a file, used for change control and troubleshooting.","optimizationRecommendations":["SQL Server Trace (sp_trace_*) is deprecated; replace with Extended Events for DDL monitoring.","The hardcoded trace file path to a SQL Server 2008 directory (MSSQL10_50) needs to be updated for current SQL Server versions."],"migrationRelevance":"low"},{"name":"long_print","schema":"dbo","parameters":[],"lineCount":25,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates through a long text string and prints it in chunks of up to 4000 characters, splitting at newline boundaries to work around SQL Server's PRINT statement 4000-character limit.","businessPurpose":"DBA utility for printing long messages or SQL scripts to the SSMS output window without truncation, used for debugging and development support.","optimizationRecommendations":[],"migrationRelevance":"none"},{"name":"MergeUsers_ProcessQueue","schema":"dbo","parameters":[],"lineCount":36,"tablesReferenced":["sys_merged_users"],"sprocsCalledFromBody":["MergeUsers_ProcessRow"],"crudType":"mixed","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates over all pending user merge requests in sys_merged_users (where IsCompleted = 0) using a cursor and calls MergeUsers_ProcessRow for each source/destination/admin user ID combination.","businessPurpose":"Processes the queue of user merge operations, consolidating duplicate user accounts by delegating each merge to the row-level processing SP, used when users switch programs or have duplicate accounts.","optimizationRecommendations":["The cursor with WHILE(1=1) pattern should be replaced with a WHILE @@FETCH_STATUS = 0 loop for clarity.","Add error handling within the loop so a single failed merge does not stop the entire queue.","Log merge results back to sys_merged_users rather than just reading from it."],"migrationRelevance":"high"},{"name":"MoveClosedDepartmentUsers","schema":"dbo","parameters":[],"lineCount":49,"tablesReferenced":[],"sprocsCalledFromBody":["UpdateDHUserDepartmentID","UpdatePortfolioUserDepartmentIDs","UpdateUserDepartment"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves all trainee users (UserTypeID=3) from department 269 and moves each one to department 1464 using a WHILE loop with UpdateUserDepartment, UpdatePortfolioUserDepartmentIDs, and UpdateDHUserDepartmentID.","businessPurpose":"One-time or administrative operation to migrate all trainees from a closed department to a new one, cascading the department change across users, portfolios, and duty hour records.","optimizationRecommendations":["Hardcoded department IDs (269, 1464) make this non-reusable; parameterize the source and target department IDs.","The WHILE loop calling three SPs per user is inefficient for large user counts; investigate if the underlying SPs can be called with bulk inputs."],"migrationRelevance":"low"},{"name":"PointOfContactUsersForEmail","schema":"dbo","parameters":[],"lineCount":23,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Calls ufnGetPointOfContactUsersForEmail for a given department and returns the point of contact users ordered by department and first name.","businessPurpose":"Provides the list of department point-of-contact staff (name, phone, email) for inclusion in outgoing email notifications, ensuring emails show the correct support contacts.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"SendReviewEmailTemplate","schema":"dbo","parameters":[{"name":"@EvaluationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":37,"tablesReferenced":[],"sprocsCalledFromBody":["GetReviewEmailTemplate","InsertAssignmentEmailsInApplicationScheduler"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":1,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves a review email template for a given evaluation, populates a table variable with recipient data, and inserts the email into the application scheduler via InsertAssignmentEmailsInApplicationScheduler, returning the count of emails queued.","businessPurpose":"Triggers the sending of review request emails to evaluators or trainees for a specific evaluation, integrating with the email scheduler to deliver notifications through MailGun.","optimizationRecommendations":["The join to vSEC_Users on MainEmail for recipient validation is fragile; a user could receive duplicate or no emails if email addresses change.","The temp table #tempEmail could be replaced by a TVP passed directly to InsertAssignmentEmailsInApplicationScheduler."],"migrationRelevance":"high"},{"name":"spGetInstIDByUser","schema":"dbo","parameters":[],"lineCount":16,"tablesReferenced":["InstitutionGMEA"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns the distinct institution IDs from InstitutionGMEA for a given user ID.","businessPurpose":"Retrieves the GMEA institution affiliations for a user, used in institutional reporting and IRIS/GMEA data exchange workflows.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"SPGetMedianByQuiz","schema":"dbo","parameters":[{"name":"@QuizId","dataType":"INT","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Calculates the statistical median score for a given quiz from a caller-provided #tblval temp table, using TOP 50 PERCENT to find the middle value(s) and averaging for even counts.","businessPurpose":"Computes median quiz scores for educational analytics reports, providing a more robust central tendency measure than average for skewed score distributions.","optimizationRecommendations":["Depends on caller-created temp table #tblval; replace with a TVP parameter for better encapsulation.","The PRINT debug statements should be removed from production code.","Use PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY Score) in SQL Server 2012+ as a cleaner median calculation."],"migrationRelevance":"medium"},{"name":"spLOG_ErrorHandling","schema":"dbo","parameters":[],"lineCount":44,"tablesReferenced":["LOG_ErrorHandling"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Captures the current SQL error context (number, message, severity, state, line, procedure) along with system session info and inserts a structured error log record into LOG_ErrorHandling.","businessPurpose":"Central error logging utility called from CATCH blocks across the application's stored procedures to persist error details for DBA monitoring and application debugging.","optimizationRecommendations":["Should be called from within a CATCH block; using READ UNCOMMITTED isolation for an error logger is appropriate to avoid blocking.","Consider adding an index on LOG_ErrorHandling (Time_Stamp, Error_Procedure) for efficient log querying."],"migrationRelevance":"medium"},{"name":"StaffAdminInfo","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Calls ufnGetPointOfContactUsersForEmail for a given department and returns staff admin contact information (FirstName, LastName, Phone, MainEmail) ordered by department and first name.","businessPurpose":"Provides administrator contact details for outgoing email notifications, replacing earlier logic that directly queried vSEC_ActiveUsers for admin roles.","optimizationRecommendations":["Duplicates PointOfContactUsersForEmail functionality with a different column selection; consider consolidating the two SPs."],"migrationRelevance":"medium"},{"name":"SupplierStats","schema":"dbo","parameters":[],"lineCount":49,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves all trainee users from department 269 and iterates through them in a WHILE loop, only printing each user ID without performing any actual processing.","businessPurpose":"Appears to be a development shell or placeholder; the loop body comment says 'INSERT PROCESSING HERE' but no actual logic is implemented.","optimizationRecommendations":["This is a stub SP with no actual business logic; it should be removed or completed.","The SP name 'SupplierStats' is misleading for what is clearly an internal user iteration utility."],"migrationRelevance":"none"},{"name":"tempScales","schema":"dbo","parameters":[],"lineCount":67,"tablesReferenced":[],"sprocsCalledFromBody":["AddAnswerType"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates over up to 20 pending department IDs from tempDepartmentIDs and calls AddAnswerType to provision two answer scales ('Barrier to Entry 1' and 'Competency Improvement 1') for each department, then marks the department as processed.","businessPurpose":"Data provisioning utility for bulk-seeding specific evaluation answer scales across multiple departments during system setup or when adding new evaluation scale types.","optimizationRecommendations":["References a tempDepartmentIDs table with a 'status' column that must pre-exist; this coupling is fragile.","The hardcoded answer type values embedded in the SP body are maintenance liabilities; store scale configurations in a table.","Should be refactored into a proper parameterized provisioning SP rather than a script-style procedure."],"migrationRelevance":"none"},{"name":"TestProc1","schema":"dbo","parameters":[],"lineCount":3,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Prints 'Test TestProc1'.","businessPurpose":"Test/placeholder stored procedure with no business function; should be removed from production.","optimizationRecommendations":["Remove from production database."],"migrationRelevance":"none"},{"name":"testtest","schema":"dbo","parameters":[],"lineCount":77,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Declares a table variable with the full CME certificate data schema and immediately selects from it (returning zero rows), serving as a schema reference or test scaffold.","businessPurpose":"Development artifact defining the schema of CME certificate data; provides a reference for the structure of CME certificate-related columns but has no production function.","optimizationRecommendations":["Remove from production database; this is a development reference artifact."],"migrationRelevance":"none"},{"name":"UpdateAdminChatbotData","schema":"dbo","parameters":[{"name":"@ChatbotFileName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ChatbotVideoId","dataType":"LargeText","direction":"IN","defaultValue":"''"}],"lineCount":15,"tablesReferenced":["ChatbotAdminData"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Updates the ChatbotVideoId for a chatbot admin record identified by ChatbotFileName.","businessPurpose":"Allows administrators to attach or update a video ID to an existing chatbot training document in the chatbot admin data management interface.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateAutoTaskQueue","schema":"dbo","parameters":[{"name":"@AutoTaskQueueID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProcessEndDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@Status","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Updates an Email_AutoTaskQueue record with process end time, status, and any error info for a given AutoTaskQueueID, then returns the updated AutoTaskQueueID.","businessPurpose":"Completes the lifecycle of an email auto-task queue entry by recording when the task finished, whether it succeeded, and any error details for monitoring.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdateImportData","schema":"dbo","parameters":[],"lineCount":22,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Inserts rows from a table-valued parameter (@tblImportData) into TempUserData with FirstName, LastName, ProgramName, Affiliation, and MedicaidLegacy columns.","businessPurpose":"Supports user data import workflows by staging imported user records from a TVP into a temporary holding table for further validation and processing.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientProcedureEncrypt","schema":"dbo","parameters":[],"lineCount":36,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates over a table-valued parameter of patient records and updates prc_patients with encrypted patient name and MR number values, marking each as encrypted (Updateencrypt=1), then returns the list of updated patient IDs.","businessPurpose":"Part of the patient data encryption migration; encrypts stored patient names and MR numbers in the procedure log to protect PHI in compliance with privacy requirements.","optimizationRecommendations":["The row-by-row WHILE loop can be replaced with a set-based UPDATE joining the TVP directly to prc_patients.","Add error handling in case encryption fails for individual records."],"migrationRelevance":"high"},{"name":"UpdateSSNEncyptedInfo","schema":"dbo","parameters":[],"lineCount":38,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates over a table-valued parameter of user records and updates sec_usersext with encrypted SSN values using ufn_EncryptValue, marking each as encrypted (SsnUpdate=3), then returns updated user IDs.","businessPurpose":"Part of the SSN data encryption migration; encrypts stored Social Security Numbers in the user extension table to protect PII in compliance with privacy regulations.","optimizationRecommendations":["The row-by-row WHILE loop should be replaced with a set-based UPDATE joining the TVP directly to sec_usersext.","Add error handling with rollback to ensure all-or-nothing encryption updates."],"migrationRelevance":"high"},{"name":"usp_ApiAudit_AddNextPartition","schema":"dbo","parameters":[],"lineCount":33,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Checks if next month's partition boundary already exists in the pf_ApiAudit_ByMonth partition function and, if not, expands the partition scheme and splits the function to add it.","businessPurpose":"Maintenance SP for the API response audit table's monthly partitioning scheme; called by a scheduled job to pre-provision next month's partition before data starts arriving.","optimizationRecommendations":["Add error handling for partition DDL failures to alert the DBA.","The NEXT USED [PRIMARY] assumes data and index partitions are both on PRIMARY; validate this matches the actual partition scheme design."],"migrationRelevance":"low"},{"name":"usp_ApiAudit_ArchiveOldPartitions","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["Api_Response_Audit_Config"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Archives a partition from Api_Response_Audit to Api_Response_Audit_Archive by switching the partition identified by a configurable retention day cutoff.","businessPurpose":"Manages API audit log retention by switching old partitions to an archive table, keeping the main audit table lean while preserving historical data for compliance.","optimizationRecommendations":["Partition switching requires both tables to have identical structure and be on the same filegroup; add validation to confirm this before attempting the SWITCH.","The retention days are read from a config table on every call; cache the value in a variable set once."],"migrationRelevance":"low"},{"name":"usp_ApiAudit_PurgeArchive","schema":"dbo","parameters":[],"lineCount":7,"tablesReferenced":["Api_Response_Audit_Archive"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Deletes all records from Api_Response_Audit_Archive that are older than 3 years.","businessPurpose":"Enforces the maximum retention policy for the API audit archive by permanently removing records beyond the 3-year retention period.","optimizationRecommendations":["A single unbounded DELETE on a potentially large archive table can cause blocking and long transaction log growth; implement batch deletion with WHILE loop and TOP N.","Add rowcount logging to track how much data was purged."],"migrationRelevance":"low"},{"name":"usp_ArchiveAndPurge_Api_Response_Audit","schema":"dbo","parameters":[],"lineCount":112,"tablesReferenced":["Api_Response_Audit","Api_Response_Audit_Archive","Api_Response_Audit_Config"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Performs batched archival and deletion of API audit records from Api_Response_Audit to Api_Response_Audit_Archive, archiving successful records older than a configurable number of days (default 60), failure records older than 180 days, and then purging archive records older than 3 years.","businessPurpose":"Comprehensive API audit data lifecycle management SP; called by a scheduled job to maintain Api_Response_Audit table size within operational bounds while preserving historical data for compliance and debugging.","optimizationRecommendations":["The INSERT then DELETE pattern (copy-then-delete) risks data loss if the DELETE fails after INSERT; wrap each batch in a transaction.","WAITFOR DELAY between batches is appropriate for throttling but the 1-second delay may be too long during high-volume archival; make it configurable.","The final DELETE from archive without batching can be problematic for large archives; add batch processing there as well."],"migrationRelevance":"low"},{"name":"usp_AutoDisabledIndexesRebuilding","schema":"dbo","parameters":[],"lineCount":30,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Checks for two specific disabled indexes on SEC_Users (IDX_Missing_DepartmentID and IDX_SEC_Users_DepartmentID_20240725) and rebuilds them if disabled.","businessPurpose":"Automated index maintenance SP called by a SQL Agent job to recover indexes on the critical SEC_Users table that may have been automatically disabled by SQL Server after bulk operations.","optimizationRecommendations":["Hardcodes specific index names; make this more generic to rebuild any disabled index on specified tables.","Add logging of rebuild events with timestamps for audit purposes."],"migrationRelevance":"low"},{"name":"usp_CaptureCPUSpike_DecisionSnapshot","schema":"dbo","parameters":[],"lineCount":54,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"report","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Captures a three-part CPU diagnostic snapshot: current SQL Server and system CPU utilization from ring buffers, scheduler runnable task counts, and the top CPU-consuming query from the plan cache.","businessPurpose":"DBA monitoring SP invoked during or after CPU spikes to capture the state of SQL Server at a point in time, identifying the root cause query and system pressure for incident response.","optimizationRecommendations":["Queries sys.dm_os_ring_buffers with XML parsing which is CPU-intensive; consider using sys.dm_os_ring_buffers with cached XML for performance.","Consider persisting capture results to a dedicated monitoring table rather than returning ad-hoc result sets."],"migrationRelevance":"none"},{"name":"Usp_CompareSQLScript","schema":"dbo","parameters":[{"name":"@pTextA","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@pTextB","dataType":"NVARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":56,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Compares two text strings character-by-character using ASCII values, returning whether they are identical via an output parameter and logging each character's ASCII codes.","businessPurpose":"DBA utility for detecting differences between two SQL script texts or stored procedure bodies, used for change verification and code comparison during deployments.","optimizationRecommendations":["Character-by-character comparison in a WHILE loop is extremely inefficient; use BINARY_CHECKSUM or HASHBYTES for quick equality checks.","The #Result table stores all character comparisons which is unnecessary for a simple equality check; only track differences."],"migrationRelevance":"none"},{"name":"usp_ConvertQuery2HTMLTable","schema":"dbo","parameters":[],"lineCount":31,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Takes a SQL query string and dynamically generates an HTML table from its results using sys.dm_exec_describe_first_result_set to introspect the schema, then builds and executes a FOR XML RAW query to produce the HTML.","businessPurpose":"Utility for converting arbitrary query results into HTML tables for embedding in email notifications or formatted reports sent through the MailGun email system.","optimizationRecommendations":["Accepts raw SQL as input, creating SQL injection risk; restrict access to privileged users only.","sys.dm_exec_describe_first_result_set may not handle all query types (temp tables, dynamic SQL); add error handling for unsupported patterns."],"migrationRelevance":"low"},{"name":"usp_Daily_QuickIndexReorg","schema":"dbo","parameters":[],"lineCount":44,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Reorganizes indexes with fragmentation between 10-30% and more than 10,000 pages using a cursor, stopping after 5 minutes to limit impact on production workload.","businessPurpose":"Scheduled daily index maintenance SP that performs fast, online REORGANIZE operations on moderately fragmented indexes to maintain query performance without blocking production.","optimizationRecommendations":["The 5-minute time limit is a good practice; consider making it configurable.","Uses FAST_FORWARD cursor which is appropriate; ensure the query on sys.dm_db_index_physical_stats uses 'LIMITED' mode for speed (it does).","Add error handling so a failure on one index does not abort the entire maintenance run."],"migrationRelevance":"none"},{"name":"usp_DropPerfTables","schema":"dbo","parameters":[],"lineCount":130,"tablesReferenced":["PERF_DeleteDataTracker"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Drops all tables in the 'perf' schema in a transaction, logging the result to PERF_DeleteDataTracker; used to clean up a performance testing schema after load tests.","businessPurpose":"Post-performance-test cleanup SP that removes the perf schema test tables after a load test run, resetting the environment for the next test cycle.","optimizationRecommendations":["Dropping 80+ tables in a single transaction creates a large lock scope; consider dropping in smaller batches.","Add a check that the perf schema exists before attempting drops to avoid errors in production environments where it may not exist."],"migrationRelevance":"none"},{"name":"usp_EstimateDeleteImpact","schema":"dbo","parameters":[{"name":"@RootTable","dataType":"SYSNAME","direction":"IN","defaultValue":null}],"lineCount":240,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Recursively traverses the foreign key dependency graph from a root table to estimate how many rows would be affected (directly or via cascading) by a DELETE operation matching a given WHERE condition.","businessPurpose":"DBA utility for impact analysis before large delete operations; helps estimate the scope of cascading deletes across dependent tables to prevent unintended data loss.","optimizationRecommendations":["The recursive CTE with sp_executesql per table is slow for wide dependency graphs; consider caching the dependency graph and batching count queries.","The cycle detection via CHARINDEX on PathTrace works but is O(n) per path; use a proper visited set for large schemas."],"migrationRelevance":"none"},{"name":"usp_GetBlockingSessions","schema":"dbo","parameters":[],"lineCount":36,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns a hierarchical view of blocking session chains using a recursive CTE on sys.dm_exec_requests, joining session and request DMVs to show blocked/blocking session IDs, login names, statuses, database name, and query text.","businessPurpose":"DBA monitoring SP for identifying and diagnosing SQL Server blocking chains during production incidents or slow-query investigations.","optimizationRecommendations":["The recursive CTE anchored on blocking_session_id = 0 will miss sessions that are blocked but not themselves blockers of others; adjust to show all sessions in the blocking chain.","Add a MAXRECURSION hint to prevent infinite loops in circular blocking scenarios."],"migrationRelevance":"none"},{"name":"usp_GetCPUSpikeDiagnostics","schema":"dbo","parameters":[],"lineCount":91,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Captures comprehensive CPU spike diagnostics in five result sets: current SQL/system CPU from ring buffers, scheduler pressure by core, top 10 CPU-consuming queries, plan cache compilation stats, and SOS_SCHEDULER wait events.","businessPurpose":"Advanced DBA diagnostic SP for root-cause analysis of CPU spikes; provides a complete picture of SQL Server CPU consumption patterns, scheduler pressure, and query plan reuse issues.","optimizationRecommendations":["Querying sys.dm_exec_query_stats with CROSS APPLY sys.dm_exec_sql_text for the full plan cache is expensive; consider limiting to top N by total_worker_time.","Consider persisting diagnostic captures to a table with a timestamp for trending analysis."],"migrationRelevance":"none"},{"name":"usp_GetDatabaseObjectsCountByType","schema":"dbo","parameters":[],"lineCount":35,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns a count of database objects (tables, views, procedures, functions, triggers, type tables) grouped by object type, ordered by count descending.","businessPurpose":"DBA reporting utility for tracking the size and composition of the MyEvaluations database schema, used for capacity planning and schema documentation.","optimizationRecommendations":[],"migrationRelevance":"none"},{"name":"usp_GetDatabaseSessionDetails","schema":"dbo","parameters":[{"name":"@FilterColumn","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":"''"},{"name":"@FilterValue","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":"''"}],"lineCount":33,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Calls sp_who2 to capture active session details into a temp table, then filters and sorts the results for the current database using dynamic SQL based on provided filter column, value, and sort column parameters.","businessPurpose":"DBA session monitoring SP for viewing active connections to the MyEvaluations database, with flexible filtering for incident investigation.","optimizationRecommendations":["Dynamic SQL construction with @FilterColumn and @SortColumn concatenated directly is vulnerable to SQL injection; validate against an allowed list of column names.","sp_who2 is informal; consider sys.dm_exec_sessions + sys.dm_exec_requests for more reliable, structured data."],"migrationRelevance":"none"},{"name":"usp_GetMissingIndexes","schema":"dbo","parameters":[],"lineCount":33,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Queries sys.dm_db_missing_index_groups and related DMVs to return suggested missing indexes for the current database, including CREATE INDEX statements and estimated impact scores.","businessPurpose":"DBA optimization tool that reads SQL Server's missing index recommendations and generates ready-to-run CREATE INDEX statements for the MyEvaluations database.","optimizationRecommendations":["Missing index DMVs reset on SQL Server restart and are cumulative but not always reliable; use alongside actual query execution plans for validation.","Consider filtering by a minimum Avg_Estimated_Impact threshold to avoid trivial index suggestions."],"migrationRelevance":"none"},{"name":"usp_GetMissingSuggestedMissingIndexes","schema":"dbo","parameters":[],"lineCount":33,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Queries sys.dm_db_missing_index_groups and related DMVs to return suggested missing indexes with estimated impact and CREATE INDEX statements, very similar to usp_GetMissingIndexes.","businessPurpose":"Alternative version of the missing index suggestion SP; appears to be an earlier version or duplicate of usp_GetMissingIndexes.","optimizationRecommendations":["Consolidate with usp_GetMissingIndexes to eliminate duplication.","The SP name is redundant ('Missing' appears twice); rename for clarity."],"migrationRelevance":"none"},{"name":"usp_GetObjectByTypeReport","schema":"dbo","parameters":[],"lineCount":117,"tablesReferenced":["DataBaseLog"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Reports on database objects (from DataBaseLog) that were modified within a specified time window (current week, last 2-3 weeks, current/last months, current/last years) based on a @ReportFor parameter.","businessPurpose":"Provides DBA and development management with a report of database object changes over time, supporting change management, release tracking, and audit requirements.","optimizationRecommendations":["The 10 IF-ELSE branches for different time periods are repetitive; refactor using calculated date range variables at the top of the SP.","DATEPART(WEEK) comparisons without year boundaries can incorrectly span years; add year filters."],"migrationRelevance":"none"},{"name":"usp_GetOutdatedStatistics","schema":"dbo","parameters":[],"lineCount":25,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns statistics on the SEC_Users table that have not been updated in more than 365 days, showing the index name, statistics name, last updated date, and days since last update.","businessPurpose":"DBA maintenance SP for identifying stale query statistics on the critical SEC_Users table that may be causing suboptimal query plans.","optimizationRecommendations":["Hardcoded to SEC_Users only; parameterize the table name to make it reusable across all tables.","The 365-day threshold should be configurable.","Consider expanding to all tables rather than a specific one."],"migrationRelevance":"none"},{"name":"usp_GetSQLTextForSPID","schema":"dbo","parameters":[],"lineCount":42,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Retrieves the currently executing SQL text for one or more session IDs (SPIDs) passed as a comma-separated string, using sys.sysprocesses and sys.dm_exec_sql_text to look up each session's active query.","businessPurpose":"DBA diagnostic SP for identifying what SQL query a specific session is currently executing, used during blocking and performance incident investigations.","optimizationRecommendations":["sys.sysprocesses is deprecated; use sys.dm_exec_sessions and sys.dm_exec_requests instead.","The WHILE loop can be replaced by a set-based JOIN between the split SPID list and sys.dm_exec_requests with CROSS APPLY dm_exec_sql_text."],"migrationRelevance":"none"},{"name":"usp_GetTableDependencyHierarchy","schema":"dbo","parameters":[{"name":"@RootSchema","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@RootTable","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":112,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Builds a complete parent-to-child foreign key dependency hierarchy starting from a root table using a recursive CTE on cached FK metadata, with cycle detection via path trace string matching.","businessPurpose":"DBA and developer tool for understanding the full cascade of table dependencies from a given root table, critical for migration planning, delete impact analysis, and schema documentation.","optimizationRecommendations":["CHARINDEX-based cycle detection on the path string is O(depth * path_length); for very deep hierarchies consider a SET-based visited table.","OPTION (MAXRECURSION 0) with an unlimited depth is safe here due to the cycle guard, but add a comment explaining this.","The LEFT JOIN to sys.foreign_key_columns in the FK cache (Step 1) should be an INNER JOIN since every FK has at least one FK column."],"migrationRelevance":"none"},{"name":"usp_GetTableDependents","schema":"dbo","parameters":[],"lineCount":26,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns the names and types (Procedure, Function, View, Trigger) of all database objects that reference a specified table, using sys.sql_expression_dependencies.","businessPurpose":"DBA and developer tool for finding all code objects (procedures, functions, views, triggers) that depend on a given table, essential before renaming, modifying, or dropping tables.","optimizationRecommendations":["The CASE for type 'P ' includes a trailing space which is correct for sys.all_objects but may be confusing; add a comment.","Consider including the object's last modification date in the output for change tracking."],"migrationRelevance":"none"},{"name":"usp_GetTableProperties","schema":"dbo","parameters":[],"lineCount":30,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns storage properties (row counts, total/used/unused space in KB and MB) for database tables whose names match a LIKE pattern, joining sys.tables, indexes, partitions, allocation_units, and schemas.","businessPurpose":"DBA capacity planning SP for monitoring table storage consumption in the MyEvaluations database, supporting disk space management and identifying large tables.","optimizationRecommendations":["The LIKE ''+@TableName+'%' pattern is equivalent to LIKE @TableName+'%'; remove the empty string concatenation.","Consider adding schema filtering parameter alongside the table name filter."],"migrationRelevance":"none"},{"name":"usp_GetUserPGYIRISValue","schema":"dbo","parameters":[],"lineCount":38,"tablesReferenced":[],"sprocsCalledFromBody":["usp_CalculateUserPGYIRISValue"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Calls usp_CalculateUserPGYIRISValue to compute IRIS PGY level values for a user and returns the StartDate, EndDate, UserLevel, and IRISValue columns from the results.","businessPurpose":"Retrieves the IRIS (Intern and Resident Information System) PGY level calculation for a specific user, used in IRIS reporting and compliance workflows for CMS reimbursement.","optimizationRecommendations":["The INSERT-EXEC pattern with a temp table prevents nesting; consider using a TVF for usp_CalculateUserPGYIRISValue.","The temp table schema defines many columns but only four are selected; document which are needed for clarity."],"migrationRelevance":"high"},{"name":"usp_GetUserProgramHistoryBulkTransfer","schema":"dbo","parameters":[],"lineCount":59,"tablesReferenced":[],"sprocsCalledFromBody":["usp_GetUserProgramHistory","usp_TraceProgramHistoryMyGMERequest"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Iterates over a comma-separated list of user IDs, calls usp_GetUserProgramHistory for each, and aggregates all program history records into a unified result set ordered by user and ID.","businessPurpose":"Supports the MyGME integration by transferring program training history for multiple selected users in a single call, used when syncing residency program history from MyEvaluations to the MyGME platform.","optimizationRecommendations":["The WHILE loop calling usp_GetUserProgramHistory per user is O(n) round-trips; if usp_GetUserProgramHistory can be adapted for batch input, eliminate the loop.","Add error handling per user so one failure does not abort the entire batch transfer.","The INSERT-EXEC pattern cannot be nested inside a transaction; document this constraint."],"migrationRelevance":"high"},{"name":"usp_GetUserTableBySize","schema":"dbo","parameters":[],"lineCount":43,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Returns tables where used space exceeds a specified size threshold (in GB), ordered by size descending, with schema name, table name, row counts, and used space in GB.","businessPurpose":"DBA capacity monitoring SP for identifying the largest tables in the MyEvaluations database, supporting storage management and archiving prioritization decisions.","optimizationRecommendations":["Two temp tables (#Tables and #Result) are used sequentially where a single CTE or subquery would suffice.","Excluding DataBaseLog from results is hardcoded; make the exclusion list configurable or parameterized."],"migrationRelevance":"none"},{"name":"usp_IsUserDataExistsInTableColumn","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@Schema","dataType":"VARCHAR(100)","direction":"IN","defaultValue":null},{"name":"@ColumnName","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":61,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Scans all tables in a specified schema that contain a given column name and checks whether a specific user ID value exists in each of those tables, returning the results with an IsDataExists flag.","businessPurpose":"DBA utility for auditing user data presence across all tables before user deletion or anonymization, ensuring no orphaned data remains after account removal.","optimizationRecommendations":["The dynamic SQL with CONVERT(VARCHAR(10),@UserID) concatenated directly is vulnerable to SQL injection if @UserID is not properly typed; use sp_executesql with parameters.","A WHILE loop executing dynamic SQL per table is extremely slow for schemas with hundreds of tables; consider generating a single batch query."],"migrationRelevance":"medium"},{"name":"usp_ListOfDependentObjects","schema":"dbo","parameters":[{"name":"@pDatabaseName","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":"''"}],"lineCount":58,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Searches all non-system databases (or a specified one) for a given object name and returns all objects that depend on it using the deprecated sp_Depends system SP.","businessPurpose":"Cross-database dependency analysis tool for understanding the full impact of changing or dropping a database object across multiple databases in the SQL Server instance.","optimizationRecommendations":["Uses deprecated sp_Depends which does not handle cross-schema references or all modern object types; replace with sys.sql_expression_dependencies.","The dynamic SQL building database names without validation is vulnerable to SQL injection; validate database names against sys.databases."],"migrationRelevance":"none"},{"name":"usp_ParentTableDirectReferenceAndRecordsCount","schema":"dbo","parameters":[{"name":"@pSchemaName","dataType":"VARCHAR(20)","direction":"IN","defaultValue":null},{"name":"@pTableName","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@pTableIdentityColumnValue","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":118,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Builds a recursive FK dependency tree from a root table using a CTE, then for each parent-child table pair executes dynamic SQL to count the actual records that would be related to a specific root table row, returning the reference count hierarchy.","businessPurpose":"DBA impact analysis SP for counting how many related records exist across all FK-dependent tables for a specific root record, used before targeted data deletion to understand the full scope of cascading deletes.","optimizationRecommendations":["The dynamic SQL per table in a WHILE loop is extremely slow for large FK trees; batch the counts where possible.","The JOIN condition logic for TableLevel=0 vs others in the dynamic SQL is complex and error-prone; document with examples.","Add MAXRECURSION to the CTE to prevent runaway recursion."],"migrationRelevance":"none"},{"name":"usp_QuizQuestionFormatedText","schema":"dbo","parameters":[{"name":"@pQuestion","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":124,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Strips and normalizes complex HTML formatting from quiz question text by iterating through a lookup table of 70+ HTML tag/style replacements, simplifying rich-text editor output to standard span-based HTML.","businessPurpose":"Cleans up quiz question HTML imported from rich-text editors (TinyMCE, etc.) to normalize formatting for consistent display in the quiz interface and PDF exports.","optimizationRecommendations":["A WHILE loop applying 70+ individual REPLACE operations is very slow; consider using a CLR function or application-side HTML sanitization.","The replacement table could be stored in a permanent configuration table rather than being rebuilt on every call.","The 70 hardcoded style replacement pairs will need constant maintenance as new rich-text editors produce different markup."],"migrationRelevance":"medium"},{"name":"usp_ReadErrorLogDetails","schema":"dbo","parameters":[{"name":"@SearchDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"}],"lineCount":22,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"(uncategorized)","summary":"Reads the SQL Server error log via sp_readerrorlog, stores results in a temp table, and returns rows filtered optionally by date and/or search text.","businessPurpose":"DBA diagnostic SP for searching the SQL Server error log for specific error messages or events on a given date, used during incident investigations.","optimizationRecommendations":["sp_readerrorlog returns the entire active log before filtering; for large logs, use the @p3 (filter) parameter of sp_readerrorlog directly to reduce rows loaded into the temp table."],"migrationRelevance":"none"},{"name":"usp_SendCPUSpikeAnHourReport","schema":"dbo","parameters":[],"lineCount":82,"tablesReferenced":[],"sprocsCalledFromBody":["dbo"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Reads the top CPU spike event from the vw_CPU_Spike_1Hour_Summary view and builds a formatted plain-text email body containing root cause details; the actual sp_send_dbmail call is commented out.","businessPurpose":"Automated CPU spike notification SP that formats a DBA alert email with the root cause query identified from the 1-hour CPU monitoring view; email sending is currently disabled.","optimizationRecommendations":["The sp_send_dbmail call is commented out, meaning no emails are actually sent; enable after configuring the database mail profile.","The PRINT @Body is a debug statement and should be removed once email is enabled."],"migrationRelevance":"none"},{"name":"usp_TableScalarFunctionDependencies","schema":"dbo","parameters":[],"lineCount":134,"tablesReferenced":[],"sprocsCalledFromBody":["FindText"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"For each table in the database (or a specified table), calls FindText to identify which of a large curated list of scalar functions are referenced in each table's related stored procedure code, returning a count of scalar function dependencies per table.","businessPurpose":"DBA analysis SP for identifying which tables have the most scalar function dependencies in their associated procedures, used to prioritize scalar function optimization efforts (since scalar UDFs can be performance bottlenecks).","optimizationRecommendations":["The hardcoded list of 300+ scalar function names in the WHERE IN clause is extremely long and fragile; query sys.all_objects dynamically to get the function list.","Calling FindText (which itself uses a cursor over syscomments) for every table is O(n*m) and will be very slow for large schemas; rewrite using a set-based approach with sys.sql_modules.","Uses deprecated syscomments indirectly via FindText; the entire approach should be replaced with sys.sql_modules text searching."],"migrationRelevance":"none"},{"name":"USP_TableSize","schema":"dbo","parameters":[],"lineCount":78,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"(uncategorized)","summary":"Collects table storage statistics (row counts, total/used/unused space in KB and MB) for all non-system tables matching an optional name filter, presenting them ordered by used space descending with a total used space sum.","businessPurpose":"DBA capacity management SP for understanding the storage profile of the MyEvaluations database, identifying the largest tables for archiving, partitioning, or optimization decisions.","optimizationRecommendations":["Very similar to usp_GetUserTableBySize and usp_GetTableProperties; consolidate these three overlapping SPs into one parameterized utility.","Returns two result sets (detail + total); consider making this a single result set with a rollup or providing separate SPs for each."],"migrationRelevance":"none"},{"name":"usp_UpdateStatistics_AllTables","schema":"dbo","parameters":[],"lineCount":5,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"(uncategorized)","summary":"Runs UPDATE STATISTICS with FULLSCAN on the EVAL_EvaluationAnswer table.","businessPurpose":"Targeted statistics refresh SP for the critical EVAL_EvaluationAnswer table, likely called after large data loads or as part of a scheduled maintenance job when query plans become stale.","optimizationRecommendations":["Hardcoded to a single table; should be generalized to accept a table parameter or loop over all tables.","FULLSCAN on a large table like EVAL_EvaluationAnswer can be slow and resource-intensive; consider using a sample percentage for most runs."],"migrationRelevance":"none"},{"name":"usp_Weekly_IndexRebuild","schema":"dbo","parameters":[],"lineCount":40,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Rebuilds all indexes with fragmentation greater than 30% and more than 20,000 pages using a FAST_FORWARD cursor, processing all qualifying indexes without a time limit.","businessPurpose":"Weekly scheduled index maintenance SP that fully rebuilds heavily fragmented large indexes to restore optimal query performance, run during off-peak maintenance windows.","optimizationRecommendations":["No time limit on the cursor means this could run for hours during peak times if many indexes are fragmented; add a configurable time budget.","REBUILD is offline by default in standard editions; ensure Enterprise Edition is in use or add WITH (ONLINE=ON) where supported.","Add error handling so a rebuild failure on one index does not abort the entire maintenance run."],"migrationRelevance":"none"},{"name":"usp_Weekly_SmartStatsUpdate","schema":"dbo","parameters":[],"lineCount":38,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"(uncategorized)","summary":"Updates statistics for all user tables where the modification counter exceeds 500,000 since the last statistics update, using a cursor to generate and execute UPDATE STATISTICS statements.","businessPurpose":"Weekly scheduled statistics maintenance SP that targets only heavily modified tables, ensuring query optimizer statistics remain current without the overhead of updating all tables indiscriminately.","optimizationRecommendations":["The dynamically generated UPDATE STATISTICS SQL has a syntax issue: the index/stats name should be inside the UPDATE STATISTICS statement, not appended with a space (missing square brackets around @Stats).","Add error handling so a failure on one table does not abort the entire maintenance run.","The 500,000 modification threshold should be configurable as a parameter."],"migrationRelevance":"none"}]}