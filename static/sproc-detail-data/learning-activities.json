{"module":"LA","displayName":"Learning Activities","procedureCount":83,"procedures":[{"name":"AddAssignmentDetails","schema":"dbo","parameters":[{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentRotationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@AssignedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@MaxTimeLimitID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@NumberOfTimesRetakeAllowed","dataType":"SmallNumber","direction":"IN","defaultValue":null}],"lineCount":40,"tablesReferenced":["QUIZ_Assignment"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.SaveQuizDetails"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Inserts a new QUIZ_Assignment record that links a quiz template to a learning assignment, setting access/due dates, pass percentage, retake limit, and display settings.","businessPurpose":"Called when an admin attaches a quiz to a learning assignment. Creates the binding record in QUIZ_Assignment so that learners see the quiz requirement when they access their assignment.","optimizationRecommendations":["No major issues; simple single-row INSERT. Ensure QUIZ_Assignment(LearningAssignmentID) has an index if queries filter by this column."],"migrationRelevance":"medium"},{"name":"AddLAAdmin","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["LA_Admins"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentAdminManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Upserts a user as a Learning Activities admin for a department. If the user already exists as an LA admin (even if soft-deleted), restores them; otherwise inserts a new LA_Admins record.","businessPurpose":"Grants a user LA admin privileges for a department, enabling them to create and manage learning assignments for that department's users.","optimizationRecommendations":["The IF EXISTS + INSERT/UPDATE pattern can be replaced with a single MERGE statement for atomicity and clarity."],"migrationRelevance":"medium"},{"name":"AddLearninAssignmentWithUsers","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExpiryDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@IsReviewRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"},{"name":"@VideoID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"null"}],"lineCount":132,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","SEC_EventDetail","SEC_Events","SEC_Users"],"sprocsCalledFromBody":["AddLearningAssgnmentNotification"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.Save"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Creates a learning assignment with duplicate detection, assigns a list of users (from a table-valued parameter), inserts OBC requirement group records if applicable, fires email notifications, and optionally links a quiz. Returns the new LearningAssignmentID.","businessPurpose":"The primary SP for creating a learning assignment and distributing it to a set of users in one transaction. Handles the complete 'assign learning module' workflow including OBC cohort linking and notification triggering.","optimizationRecommendations":["Very large SP doing too many things: creation, user assignment, OBC linking, and email. Split into separate SPs called from a transaction wrapper in application code.","Duplicate detection query (EXISTS check) should be covered by a unique index on LA_LearningAssignments(LiteratureID, DepartmentID) or similar.","Consider moving email dispatch to an asynchronous queue rather than inline SP logic."],"migrationRelevance":"high"},{"name":"AddLearningAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExpiryDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@IsReviewRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"},{"name":"@VideoID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"null"}],"lineCount":27,"tablesReferenced":["LA_LearningAssignments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Simple INSERT into LA_LearningAssignments with all assignment metadata fields. Returns the newly generated LearningAssignmentID.","businessPurpose":"Creates the base learning assignment record without associating users. Used as the first step in a multi-step assignment creation flow.","optimizationRecommendations":["No issues. Straightforward single-row INSERT with SCOPE_IDENTITY()."],"migrationRelevance":"medium"},{"name":"AddLearningAssignmentComments","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignedToUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DocumentName","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":31,"tablesReferenced":["LA_AssignmentComments","LA_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.AddComments"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Inserts a comment record into LA_AssignmentComments for a given LearningAssignmentUserID, capturing the commenter's identity and timestamp.","businessPurpose":"Allows admins or learners to add comments/feedback to a specific user's learning assignment instance.","optimizationRecommendations":["No issues. Simple INSERT."],"migrationRelevance":"low"},{"name":"AddLearningAssignmentUserDocuments","schema":"dbo","parameters":[{"name":"@LearningAssignmentCommentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DocumentName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DocumentUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DocumentFilePath","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DocumentFileSize","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@DocumentDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CreatedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":86,"tablesReferenced":["LA_UserDocuments"],"sprocsCalledFromBody":["spLOG_ErrorHandling"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":["LearningAssignmentManager.cs.AddLearningAssignmentUserDocuments","MyEvaluations.Business.Portfolio/DocDetailsManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Inserts a document attachment record into LA_UserDocuments for a specific learning assignment comment, using a TRY/CATCH with an explicit transaction to ensure atomicity.","businessPurpose":"Attaches a document file (stored in the file system, referenced by path) to a comment on a user's learning assignment — used for evidence upload during review.","optimizationRecommendations":["TRY/CATCH pattern is appropriate. Consider adding a unique constraint on (LearningAssignmentCommentID, DocumentName) to prevent duplicate uploads."],"migrationRelevance":"low"},{"name":"AddLearningAssignmentUsers","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":50,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","PF_UserDocuments","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.Save"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Inserts user assignments into LA_AssignmentUsers from a table-valued parameter. For users linked to OBC requirement groups, also inserts OBC_RequirementGroupAssignment records. Handles both new-assignment and existing-assignment (add users) scenarios.","businessPurpose":"Adds one or more learners to an existing learning assignment. If the assignment is part of an OBC cohort workflow, simultaneously creates the OBC requirement group assignment record.","optimizationRecommendations":["The OBC insertion logic is conditional but not transactional; wrap both INSERT operations in a transaction.","Batch inserts via table-valued parameter are appropriate and efficient."],"migrationRelevance":"high"},{"name":"AddLiterature","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@NumberOfTimesRetakeAllowed","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@CompletionTime","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@CompletionPath","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@DocumentName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DocumentSize","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@DocumentFilePath","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@VideoID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsReviewRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsQuesDisplayorder","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0 --added by charan"}],"lineCount":32,"tablesReferenced":["LA_Literature","LA_LiteratureData"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Inserts a new literature module record into LA_Literature and its associated data (document path, file size) into LA_LiteratureData. Returns the new LiteratureID.","businessPurpose":"Creates a new learning module definition (literature item) that can subsequently be assigned to users. Stores both the metadata and the associated document/file reference.","optimizationRecommendations":["Two-table INSERT is straightforward. Consider wrapping in a transaction if not already handled by the caller."],"migrationRelevance":"medium"},{"name":"AddOBCLiterature","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":64,"tablesReferenced":["OBC_RequirementGroupLiteraturesDetails"],"sprocsCalledFromBody":["DeleteOBCPendingAssignments"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.OBCSaveLearningModule"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Upserts an OBC requirement group literature link (OBC_RequirementGroupLiteraturesDetails). If a literature item is being added to a group that has pending auto-assignments, triggers deletion of those pending assignments to force reassignment with the new literature.","businessPurpose":"Associates a learning module with an OBC onboarding requirement group. The cascade-delete of pending auto-assignments ensures that newly hired users will receive the updated literature set when they are next onboarded.","optimizationRecommendations":["The cascading delete of pending assignments could have unintended side effects. Add logging/audit trail before deletion.","The UPSERT pattern (IF EXISTS UPDATE ELSE INSERT) should use MERGE for atomicity under concurrent load."],"migrationRelevance":"high"},{"name":"AddPreceptors","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PreceptorUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["LA_Preceptors"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Upserts a preceptor record in LA_Preceptors. If the user is already a preceptor in the department (even soft-deleted), reactivates them; otherwise inserts a new record.","businessPurpose":"Designates a user as a preceptor for a department, enabling them to supervise trainees and review their learning assignments.","optimizationRecommendations":["Standard UPSERT; can be replaced with MERGE. Ensure index on LA_Preceptors(UserID, DepartmentID)."],"migrationRelevance":"medium"},{"name":"AddReadingAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ReadingUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@OtherDetails","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@TopicSubject","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SummaryNotes","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["LA_ReadingAssignments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"LA","summary":"Inserts a new reading assignment record into LA_ReadingAssignments, linking a literature item to a department with a specified period and description.","businessPurpose":"Creates a reading assignment (distinct from a learning assignment) which allows departments to define recommended reading materials without the full assignment/review workflow.","optimizationRecommendations":["No issues. Simple INSERT."],"migrationRelevance":"low"},{"name":"CheckQuizCompleted","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.CheckQuizCompleted"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Counts the number of completed (non-deleted) QUIZ_AssignmentUsers records for a given quiz assignment and user, returning a count to indicate whether the quiz has been completed.","businessPurpose":"Used as a prerequisite check before allowing a user to submit their learning assignment — verifies that the linked quiz was actually completed before submission is permitted.","optimizationRecommendations":["Simple COUNT query. Ensure index on QUIZ_AssignmentUsers(AssignmentID, UserID, IsDeletedUserAssignment)."],"migrationRelevance":"low"},{"name":"CloseLearningAssignmentsByID","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":100,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","QUIZ_Assignment"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.CloseLearningAssignmentsByID"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Toggles the IsClosed status of a learning assignment (open/close). Updates LA_LearningAssignments and returns the new IsClosed value to the caller.","businessPurpose":"Allows admins to close an active learning assignment (preventing new completions) or reopen a closed one. Returns the updated status so the UI can reflect the change without an additional query.","optimizationRecommendations":["Simple UPDATE with output. No issues."],"migrationRelevance":"low"},{"name":"CompleteUserLearningAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessedDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@TopicSubject","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SummaryNotes","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["LA_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Marks a user's learning assignment as completed by updating LA_AssignmentUsers with CompletedDateTime, CompletedBy, and review metadata.","businessPurpose":"Called by an admin after reviewing a submitted assignment to mark it as fully reviewed and complete, closing the assignment lifecycle for that user.","optimizationRecommendations":["Simple UPDATE. Ensure a composite index on LA_AssignmentUsers(LearningAssignmentID, UserID) for the WHERE clause lookup."],"migrationRelevance":"medium"},{"name":"DeleteLAAdmin","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":15,"tablesReferenced":["LA_Admins"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentAdminManager.cs.Save"],"complexity":"trivial","aiEnrichment":null,"module":"LA","summary":"Soft-deletes an LA admin record by setting IsDeleted=1 on the LA_Admins row identified by LAAdminID.","businessPurpose":"Removes LA admin privileges from a user for a department without permanently destroying the audit record.","optimizationRecommendations":["No issues. Simple soft-delete UPDATE."],"migrationRelevance":"low"},{"name":"DeleteLADocumentDetails","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DocumentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":50,"tablesReferenced":["LA_UserDocuments"],"sprocsCalledFromBody":["spLOG_ErrorHandling"],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":["LearningAssignmentManager.cs.DeleteLADocumentDetails","MyEvaluations.Business.Portfolio/DocDetailsManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Hard-deletes a document record from LA_UserDocuments using a TRY/CATCH with transaction to ensure atomicity. Returns the deleted DocumentID.","businessPurpose":"Removes a document attachment from a learning assignment comment, used when users or admins want to remove an uploaded file from a review.","optimizationRecommendations":["Hard deletion of document records loses audit history. Consider soft-delete with IsDeleted flag instead."],"migrationRelevance":"low"},{"name":"DeleteLearningAssignments","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["LA_LearningAssignments"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"LA","summary":"Hard-deletes one or more LA_LearningAssignments records by LearningAssignmentID, with NO audit trail or cascading soft-delete logic.","businessPurpose":"Permanently removes a learning assignment definition. Appears to be used for cleanup of test/erroneous data — risky in production as it hard-deletes without cascading to LA_AssignmentUsers.","optimizationRecommendations":["Critical: this SP hard-deletes without cascading to LA_AssignmentUsers, leaving orphaned user assignment records. Should be replaced with a soft-delete that cascades IsDeleted to child records.","No audit trail — add SEC_Events logging as done in similar delete SPs."],"migrationRelevance":"high"},{"name":"DeleteLearningAssignmentsByID","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":70,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","OBC_RequirementGroupAssignment","QUIZ_AssignmentUsers","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.DeleteLearningAssignmentsByID"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Batch soft-deletes learning assignment user records from LA_AssignmentUsers based on a table-valued parameter (@tblCloseAllAssignments). Also soft-deletes linked OBC_RequirementGroupAssignment and QUIZ_AssignmentUsers records. Logs all deleted IDs to SEC_Events/SEC_EventDetail for audit.","businessPurpose":"Bulk-removes selected users from a set of learning assignments in a single operation (e.g., batch close/delete from an admin grid view). Maintains referential integrity with OBC and Quiz modules and creates a full audit trail.","optimizationRecommendations":["Audit log INSERT uses SELECT TOP 1 from a table variable for EventID — fragile under concurrency; use OUTPUT clause directly.","Multiple correlated subqueries joining to @tblCloseAllAssignments could be replaced with a single CTE pass."],"migrationRelevance":"high"},{"name":"DeleteLearningAssignmentUsers","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":85,"tablesReferenced":["LA_AssignmentUsers","QUIZ_AssignmentUsers","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.DeleteAssignmentUsers"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Soft-deletes all incomplete LA_AssignmentUsers records for a learning assignment (CompletedDateTime IS NULL). Optionally soft-deletes linked QUIZ_AssignmentUsers records if a QuizAssignmentID is provided. Full audit trail via SEC_Events/SEC_EventDetail.","businessPurpose":"Removes all pending users from a learning assignment — typically used when an admin wants to cancel/unassign a learning module for an entire group before it is completed.","optimizationRecommendations":["Contains large commented-out hard-delete code that should be cleaned up.","Audit EventID retrieval via SELECT TOP 1 from table variable is fragile — use OUTPUT clause."],"migrationRelevance":"medium"},{"name":"DeleteLearningModuleDocument","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["LA_LiteratureData","LA_LiteratureDocumentHistory"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.DeleteLearningModuleDocument"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Archives a literature document before deletion by inserting its file metadata into LA_LiteratureDocumentHistory, then blanks out the document fields in LA_LiteratureData.","businessPurpose":"Removes an uploaded document from a literature module while preserving the document metadata in a history table for audit purposes. This allows admins to replace documents without losing evidence of what was previously attached.","optimizationRecommendations":["Good pattern — history insert before nullification. Wrap in an explicit transaction to prevent partial state if the UPDATE fails."],"migrationRelevance":"low"},{"name":"DeleteLiterature","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":["LA_LearningAssignments","LA_Literature","LA_ReadingAssignments"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.Delete"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Soft-deletes (or restores) a literature record in LA_Literature by setting IsDeleted to the passed value. Checks whether the literature is referenced by existing learning or reading assignments — regardless of the check result, the same UPDATE runs (the IF/ELSE branches have identical logic, making the check vestigial).","businessPurpose":"Soft-deletes or restores a learning module definition. The intent was to prevent deletion of in-use literature, but all branches currently execute the same UPDATE, making the guard check non-functional.","optimizationRecommendations":["Bug: all three branches of the IF/ELSE execute identical UPDATE statements. The guard check to prevent deletion of referenced literature has no effect. Should return an error or block deletion if assignments exist.","Commented-out hard DELETE should be removed."],"migrationRelevance":"medium"},{"name":"DeletePreceptors","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["LA_Preceptors"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"LA","summary":"Soft-deletes a preceptor record in LA_Preceptors by setting IsDeleted=1 for a given user in a department.","businessPurpose":"Removes a user's preceptor designation for a department, preventing them from appearing as a preceptor for future trainee assignments.","optimizationRecommendations":["No issues. Simple soft-delete UPDATE. Ensure index on LA_Preceptors(UserID, DepartmentID)."],"migrationRelevance":"low"},{"name":"DeleteQuizAndLearningAssignmentUser","schema":"dbo","parameters":[{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsDelete","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":78,"tablesReferenced":["LA_AssignmentUsers","QUIZ_AssignmentUsers","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.DeleteQuizAndLearningAssignmentUser"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Soft-deletes (or restores, via @IsDelete parameter) a specific user's record in LA_AssignmentUsers for a learning assignment. If a QuizAssignmentID is provided, also soft-deletes/restores the corresponding QUIZ_AssignmentUsers record. Logs the action to SEC_Events/SEC_EventDetail with appropriate event codes (13059=delete, 13060=restore).","businessPurpose":"Removes or restores a single user's participation in a specific learning assignment and its linked quiz. Used when an admin wants to remove one user from an assignment without affecting others.","optimizationRecommendations":["Audit EventID via SELECT TOP 1 from table variable — use OUTPUT clause instead.","Large blocks of commented-out code should be removed to improve maintainability.","Duplicated logic with DeleteLearningAssignmentUsers and DeleteLearningAssignmentsByID — consolidation opportunity."],"migrationRelevance":"medium"},{"name":"DeleteReadingAssignments","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["LA_ReadingAssignments"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"LA","summary":"Hard-deletes a reading assignment record from LA_ReadingAssignments by ReadingAssignmentID. Returns the deleted ID.","businessPurpose":"Permanently removes a reading assignment. Unlike learning assignments, reading assignments don't have user completion records, making hard deletion acceptable.","optimizationRecommendations":["Consider soft-delete for consistency with other deletion patterns in the module."],"migrationRelevance":"low"},{"name":"DoesLiteratureExits","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":37,"tablesReferenced":["LA_Literature"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.DoesLiteratureExits"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Checks for duplicate literature names within a department. In Add mode (PageMode=1), returns any existing record with the same name. In Edit mode (PageMode=2), returns records with the same name excluding the current literature being edited.","businessPurpose":"Client-side duplicate prevention for literature creation/editing forms. Returns a LiteratureID if a duplicate exists, which the UI uses to block saving.","optimizationRecommendations":["Note: function name is a misspelling of 'Exists'. Should be renamed in a future refactor (requires caller updates).","Consider adding a unique index on LA_Literature(DepartmentID, Name, IsDeleted) to enforce uniqueness at the DB level rather than relying solely on this SP check."],"migrationRelevance":"low"},{"name":"GenerateBSNOnboardingEmails","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":68,"tablesReferenced":["LA_Preceptors","PF_EmailTemplate","SCHE_ApplicationEmailSchedules","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Generates an onboarding email for a BSN (nursing) program user by selecting the appropriate PF_EmailTemplate based on whether the user is a preceptor, student (UserTypeID=5), or faculty, then performing token substitution (LastName, UserName, Password, ApplicationUrl) and inserting the result into SCHE_ApplicationEmailSchedules for async delivery.","businessPurpose":"Sends welcome/onboarding emails to newly created BSN program users (Chamberlain University). Differentiates between preceptors (using Preceptor Onboarding template), students, and faculty, with role-appropriate content and credentials.","optimizationRecommendations":["Email template token substitution via REPLACE in T-SQL should be moved to application layer for testability.","Credentials (Password) are embedded in plain text in email — security concern; reference password reset URL instead.","Hardcoded ReplyToEmailAddress (BSNLabClinicalTracking@chamberlain.edu) is a maintenance liability; should be in SEC_settings."],"migrationRelevance":"medium"},{"name":"GetAssignmentUsersByIDs","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":79,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","PF_UserDocuments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetAssignmentUsersByIDs"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Retrieves assignment user details for a set of learning assignments (either by OBC batch ID or a comma-delimited list of assignment IDs). Uses a temp table (#TempAssignments) to join user, assignment, literature, and document data, then returns non-reviewed/closed records with computed status, and concatenated UserIDs/AssignmentIDs strings.","businessPurpose":"Populates the admin view of who has been assigned a set of learning modules, showing each user's completion status, document upload, and review state. Supports both OBC batch-based and individual assignment-based lookups.","optimizationRecommendations":["The FOR XML PATH concatenation for UserIDs and LearningAssignmentIDs is O(n²) — for large assignment sets this creates heavy CPU load. Replace with STRING_AGG (SQL Server 2017+).","The GetLearningAssignmentAndQuizStatus UDF is called twice per row (Status and ActionText) — rewrite as a single call returning both values.","Temp table could be replaced with a CTE for simpler plans."],"migrationRelevance":"high"},{"name":"GetCommentsForAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["LA_AssignmentComments","LA_AssignmentUsers","LA_UserDocuments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetCommentsForAssignment"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Retrieves all comments for a specific user's learning assignment, joining LA_AssignmentComments with user info, linked documents, and assignment user record. Ordered by CommentDate DESC.","businessPurpose":"Displays the comment thread for a user's assignment on the assignment detail/review page, showing who commented, when, and any attached documents.","optimizationRecommendations":["No major issues. Ensure indexes on LA_AssignmentComments(LearningAssignmentUserID) and LA_UserDocuments(LearningAssignmentCommentID)."],"migrationRelevance":"low"},{"name":"GetDeletedLearningAssignmentsByCriteria","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@AdministratorID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@RequestedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@LocalAllUsers","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"},{"name":"@LocalAllAssignment","dataType":"VerySmallNumber","direction":"IN","defaultValue":"2"}],"lineCount":106,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","QUIZ_Assignment","QUIZ_Template","SEC_Users"],"sprocsCalledFromBody":["GetListOfDepartmentsForLearningAssignments"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetDeletedLearningAssignmentsByCriteria"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns a list of soft-deleted (IsDeleted=1) user assignment records filtered by department hierarchy, literature selection, and user scope. Joins with quiz data and returns status via the GetLearningAssignmentAndQuizStatus UDF.","businessPurpose":"Powers the 'Deleted Assignments' admin view, allowing admins to see which assignments were deleted for which users, with the ability to scope by department, literature module, or specific user.","optimizationRecommendations":["Multiple table variables with conditional population logic make the query optimizer unable to produce efficient plans — consider temp tables with statistics.","GetLearningAssignmentAndQuizStatus UDF called twice per row; consolidate."],"migrationRelevance":"medium"},{"name":"GetDetailedAssignmentInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignedTo","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":123,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","PF_UserDocuments","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","Quiz_TimeLimit"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetDetailedAssignmentInfo"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns full details for a single learning assignment for a specific user, including assignment metadata, quiz linkage, document attachments, and computed status. Branches on @Action='review' vs. default — in both cases the same columns are returned from identical queries (the branch appears vestigial). Uses RetrieveDepartments() to handle cross-department literature.","businessPurpose":"Populates the Assignment Detail page (assignment.aspx) with all information needed for a user to read/submit their assignment or for an admin to review a submitted assignment.","optimizationRecommendations":["The two branches of the IF/ELSE return identical result sets with identical queries — deduplicate into a single query.","The GetLearningAssignmentStatusText scalar UDF is called per row — consider materializing status in LA_AssignmentUsers.","Temp table #LinkedDepartments from RetrieveDepartments() is dropped at the end — ensure cleanup happens even on error (TRY/CATCH with DROP in CATCH)."],"migrationRelevance":"high"},{"name":"GetDetailedLearningAssignmentReport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ReportStartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ReportEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedLiteratureID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@IsFlagArchived","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@Status","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0 --Added by amit 5/4/2016 for New filter Status and Sortby"}],"lineCount":205,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Departments","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentReportManager.cs.GetDetailedAssignmentsReportData"],"complexity":"very-complex","aiEnrichment":null,"module":"LA","summary":"Generates a multi-section detailed report for a selected set of users and literature modules within a date range. Returns up to 7 result sets: the main assignment data sorted by @SortBy parameter, plus pivot data for each sort dimension (users list, departments list, modules list, date list, completion date list), plus the full result set ordered by LastName. Uses temp tables extensively.","businessPurpose":"Powers the 'Detailed Learning Assignment Report' page, which allows department admins to analyze assignment completion across multiple users, modules, and time periods, with drill-down filtering capabilities.","optimizationRecommendations":["7 result sets returned from one SP is extreme coupling to the UI layer — makes caching, testing, and API migration impossible.","Multiple scalar UDF calls (GetLearningAssignmentStatusText, udfnQuizPercentageForLearningAssignment, GetAttemptedMinutesforQuiz) per row in the main query — major performance risk on large datasets.","The @SortBy branching that returns different pivot result sets is better handled in the application layer.","Split into a primary data SP + separate SP for each pivot dimension."],"migrationRelevance":"medium"},{"name":"GetFilteredTraineeslist","schema":"dbo","parameters":[{"name":"@PreceptorGroupID","dataType":"Largenumber","direction":"IN","defaultValue":"0"},{"name":"@DepartmentID","dataType":"Largenumber","direction":"IN","defaultValue":null}],"lineCount":57,"tablesReferenced":["LA_Preceptors","LA_Trainee","SEC_UserTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Returns users in a department who are NOT already assigned as trainees to the specified preceptors (or preceptor group). Uses two temp tables to find the 'available' trainee pool by subtracting already-assigned trainees from all eligible users in the department.","businessPurpose":"Populates the 'Add Trainees' multi-select on the Manage Preceptors page, showing only users who can still be added as trainees to a preceptor (i.e., not already assigned).","optimizationRecommendations":["The coalesce-based string concatenation to build @str from preceptor IDs is an old pattern — use STRING_AGG.","Hardcoded DepartmentID=13 in the ELSE branch is a bug — should use @DepartmentID parameter.","Temp tables with no indexes may cause performance issues for large departments."],"migrationRelevance":"medium"},{"name":"GetLAAdmins","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["LA_Admins","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentAdminManager.cs.FetchLAAdmin"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Returns a list of active LA admins for a department, joining LA_Admins to SEC_Users and filtering to specific role IDs (2,3,4,5,6,7,12,16,18,24,25,26,27,31,32) to ensure only users with LA-relevant roles appear.","businessPurpose":"Populates the LA admin management list for a department. The role filter ensures only users with appropriate roles (admin, preceptor, coordinator, etc.) can be designated as LA admins.","optimizationRecommendations":["The hardcoded role ID list (14 role IDs) is a maintenance liability — consider a role-permission table lookup or a configuration flag instead.","Ensure index on LA_Admins(DepartmentID, IsDeleted)."],"migrationRelevance":"low"},{"name":"GetLearningAssignmentCount","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":209,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","LA_Preceptors","LA_Trainee","SEC_UserRoles"],"sprocsCalledFromBody":["GetCountNotation"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentCount"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Computes dashboard badge counts for the learning module: pending review count, submit-pending count, and new (started) message counts. Returns formatted count notations for both the module badge (MainPage=0/1) and populates a shared #Counts temp table for API cache updates (MainPage=9). Uses dynamic SQL to support preceptor role branching. Very large SP with multiple temp tables.","businessPurpose":"Drives the 'Learning Module' badge count on the main dashboard and module navigation bar, showing admins and preceptors how many assignments need review and how many learners have pending submissions.","optimizationRecommendations":["Multiple temp table creations and scalar UDF calls (GetLearningAssignmentStatusText) per row make this a performance bottleneck — it runs on every dashboard page load.","The @MainPage=9 path (API cache update) should be a separate SP for clarity.","Dynamic SQL prevents plan reuse; the preceptor branching logic can be done with conditional JOINs.","The @tmpDepartments string concatenation pattern is pre-STRING_AGG legacy — replace."],"migrationRelevance":"high"},{"name":"GetLearningAssignmentDepartmentDetails","schema":"dbo","parameters":[],"lineCount":29,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentDepartmentDetails"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Returns a list of departments that have expired, unsubmitted learning assignments (ExpiryDate in the past, no CompletedDateTime/SubmittedDateTime/ReviewedDateTime). Used to trigger reminder processing.","businessPurpose":"Identifies which departments have overdue learning assignments so that the system can send targeted reminder emails or flag them for admin attention.","optimizationRecommendations":["CONVERT-based date comparison prevents index use on LA_LearningAssignments(ExpiryDate) — use direct date comparison: ExpiryDate < CAST(GETDATE() AS DATE).","Ensure indexes on LA_LearningAssignments(ExpiryDate, StartDate) and LA_AssignmentUsers(IsDeleted, SubmittedDateTime, CompletedDateTime)."],"migrationRelevance":"low"},{"name":"GetLearningAssignmentDocumentDetails","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":48,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","PF_UserDocuments","QUIZ_Assignment","QUIZ_Template","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentDocumentDetails"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns document details for a learning assignment user record — the uploaded file path, name, size, and associated literature info. Uses TOP(1) to return a single record.","businessPurpose":"Retrieves the uploaded document information for a user's assignment submission, used on the assignment review page to display the submitted file.","optimizationRecommendations":["The TOP(1) without ORDER BY is non-deterministic — add explicit ORDER BY.","Large commented-out SELECT list makes the SP harder to read; remove dead code."],"migrationRelevance":"low"},{"name":"GetLearningAssignmentEmailTemplates","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExpiryDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":302,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","PF_EmailTemplate","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Departments","SEC_Privileges","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentEmailTemplates","MyEvaluations.Business.Portfolio/DocDetailsManager.cs"],"complexity":"very-complex","aiEnrichment":null,"module":"LA","summary":"The most complex email SP in the module. Selects the appropriate email template based on user's first-logon status, assignment start date, and EnableLoginLinkInEmails setting. Performs extensive HTML token substitution using fn_GetReplacedHTML and REPLACE, building encrypted auto-login URLs, quiz deep-links, contact info sections, and department staff lists via a WHILE loop. Returns the fully rendered email (From, To, Subject, HtmlTemplate).","businessPurpose":"Generates the assignment notification email content for a specific user when they are assigned a learning module. Handles multiple template variants (first-login, already-logged-in, future-date, standard) and embeds role-appropriate content including quiz links and department contact information.","optimizationRecommendations":["This SP should be entirely migrated to the application layer — HTML template rendering in T-SQL is untestable, unmaintainable, and a security concern (plaintext credentials embedded in email URLs).","The WHILE loop for building @DepartmentStaff contact HTML iterates row-by-row — replace with SELECT...FOR XML or application-layer loop.","Password-based encrypted URLs in emails are a security anti-pattern; use token-based links.","Multiple single-row SELECT statements (SEC_settings lookups) should be batched.","The PRINT statements left in production code are debugging artifacts that should be removed."],"migrationRelevance":"high"},{"name":"GetlearningAssignmentInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":80,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","PF_UserDocuments","QUIZ_Assignment","QUIZ_Template"],"sprocsCalledFromBody":["GetListOfDepartmentsForLearningAssignments"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetAssignment"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Retrieves summary info for a single learning assignment including quiz details, attachment names, video, period, and OBC requirement group linkage. Uses a temp table (#FinalResult) and branches on whether the assignment is OBC-linked to decide whether to apply department filtering.","businessPurpose":"Populates the learning assignment summary header on the assignment management/edit page, providing the admin with all key metadata for a specific assignment.","optimizationRecommendations":["The @DepartmentList table variable populated via EXEC call (GetListOfDepartmentsForLearningAssignments) prevents optimizer statistics from flowing through — use inline subquery or temp table.","Temp table #FinalResult dropped at end but not on error — add TRY/CATCH with cleanup."],"migrationRelevance":"medium"},{"name":"GetLearningAssignmentLedgerReport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ReportStartDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedLiteratureID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Status","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":692,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_Template","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentReportManager.cs.GetLedgerOfAssignmentsReportData"],"complexity":"very-complex","aiEnrichment":null,"module":"LA","summary":"A massive ledger report SP returning up to 6 result sets: completed assignments, pending assignments, sort-pivot data (users/departments/modules/dates/completion dates), and a summary count table. Uses four temp tables and multiple scalar UDF calls per row. Supports @SortBy-driven drill-down filtering.","businessPurpose":"Powers the 'Learning Assignment Ledger Report' page which provides department admins with a comprehensive view of both completed and pending assignments with multi-dimensional drill-down sorting capabilities.","optimizationRecommendations":["6 result sets from one SP — decompose into separate SPs by concern (completed data, pending data, summary, pivots).","udfnQuizPercentageForLearningAssignment and GetAttemptedMinutesforQuiz scalar UDF calls per row are severe performance issues on large datasets.","The commented-out code is extensive and should be removed entirely.","Large amount of duplicate SQL between completed/pending assignment branches — extract into shared CTE or view.","Temp table management without TRY/CATCH risks table leak on error."],"migrationRelevance":"medium"},{"name":"GetLearningAssignmentListByCriteria","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"},{"name":"@AdministratorID","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"},{"name":"@BatchID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@RequestedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@LocalAllUsers","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"},{"name":"@LocalAllAssignment","dataType":"VerySmallNumber","direction":"IN","defaultValue":"2"},{"name":"@SelectedAssignmentID","dataType":"LargeText","direction":"IN","defaultValue":"'-1'"},{"name":"@ReportType","dataType":"verySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@StartIndex","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@PageSize","dataType":"LargeNumber","direction":"IN","defaultValue":"50"},{"name":"@SortBy","dataType":"SmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":562,"tablesReferenced":["DH_DepartmentRotations","LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","OBC_RequirementGroupAssignment","QUIZ_Assignment","QUIZ_Template","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":["GetListOfDepartmentsForLearningAssignments"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentsByCriteria"],"complexity":"very-complex","aiEnrichment":null,"module":"LA","summary":"Returns a paginated, filterable list of learning assignments for an admin's management view. Handles scope via BatchID (OBC batch), AdminID, or SelectedUserID. Uses multiple temp tables and conditional branching to populate the assignment list with status, quiz info, and user details.","businessPurpose":"Powers the 'Manage Learning Assignments' list page, the primary admin interface for viewing, filtering, and acting on learning assignments across a department.","optimizationRecommendations":["Multiple temp table population paths based on scope parameters create very different execution plans — parameterization and plan stability would benefit from sp_executesql with specific parameter sets.","GetLearningAssignmentAndQuizStatus UDF called twice per row (Status and ActionText) — consolidate.","Consider adding a covering index on LA_AssignmentUsers(LearningAssignmentID, UserID, IsDeleted, CompletedDateTime, SubmittedDateTime)."],"migrationRelevance":"high"},{"name":"GetLearningAssignmentLiteratureList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PageMode","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"},{"name":"@IsDeletedflag","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@IsFlagArchived","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":150,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":["GetListOfDepartmentsForLearningAssignments"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.FetchLiteratureList","DocDetailsManager.cs.GetPFLiteratureList"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns literature modules available for assignment within a department hierarchy. Supports scope filtering (PageMode), OBC batch filtering, and admin-only filtering. Joins LA_Literature with department hierarchy and QUIZ_Template info.","businessPurpose":"Populates the 'Select Learning Module' dropdown/list on the Assign Learning Module form, showing only literature items available to the current admin's scope.","optimizationRecommendations":["PageMode branching generates very different WHERE clauses — consider splitting into separate SPs per use case.","Ensure index on LA_Literature(DepartmentID, IsDeleted)."],"migrationRelevance":"medium"},{"name":"GetLearningAssignmentLiteratureList_Voluntary","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PageMode","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"},{"name":"@IsDeletedflag","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@IsFlagArchived","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":145,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":["GetListOfDepartmentsForLearningAssignments"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.FetchLiteratureListForVoluntary"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Same as GetLearningAssignmentLiteratureList but adds ISVoluntary=0 filter to return only non-voluntary (required) learning modules.","businessPurpose":"Provides a filtered literature list for the OBC assignment flow, where only mandatory (non-voluntary) modules should be assignable.","optimizationRecommendations":["Consider merging with GetLearningAssignmentLiteratureList and adding an @IsVoluntary parameter rather than maintaining two nearly identical SPs."],"migrationRelevance":"medium"},{"name":"GetLearningAssignmentQuizDetails","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignedTo","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":36,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentQuizDetails"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Simple SELECT joining QUIZ_AssignmentUsers and QUIZ_Assignment to return quiz completion details (UserAssignmentID, scores, completion status) for a specific user and quiz assignment.","businessPurpose":"Retrieves quiz completion status for a user's learning assignment to display on the assignment detail page.","optimizationRecommendations":["No issues. Simple lookup. Ensure index on QUIZ_AssignmentUsers(AssignmentID, UserID)."],"migrationRelevance":"low"},{"name":"GetLearningAssignmentSubmitCount","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":64,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentSubmitCount"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns a count of pending ('Submit/Pending' status) learning assignments for a specific user, using the GetLearningAssignmentStatusText UDF per row in a WHERE filter.","businessPurpose":"Drives the 'Submit Pending' badge count for a learner, showing how many assignments they need to submit.","optimizationRecommendations":["Scalar UDF in WHERE clause (GetLearningAssignmentStatusText) prevents index use and forces a table scan — this is a known anti-pattern. Materialize status in LA_AssignmentUsers or use a computed column.","This SP is potentially called on every page load for every active user."],"migrationRelevance":"high"},{"name":"GetLearningAssignmentToReview","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserRole","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@Status","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@SelectRole","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@PersonalItemsflag","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@RequiredDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":418,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","LA_Preceptors","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_MyEvalMainPageLinks","SEC_ToDoAdmRevLrnAssignments","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":["usp_TraceMyEvalMainPageCounts"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningAssignmentsForReview"],"complexity":"very-complex","aiEnrichment":null,"module":"LA","summary":"A highly complex SP that powers the 'Things To Do' / 'Pending Review' dashboard section. Uses dynamic SQL (sp_executesql) with extensive preceptor vs. PD/PDPR role branching, multiple temp tables, and OBC integration. Returns assignment lists needing review and counts for badge display. Also supports a @MainPage=9 mode for API cache updates.","businessPurpose":"Shows admins and preceptors the list of submitted learning assignments that require their review, filtered to their scope (department hierarchy, preceptor's trainees, or PD's supervised residents). This is a core dashboard SP called frequently.","optimizationRecommendations":["Dynamic SQL prevents plan caching — the heavy branching logic should be refactored to use conditional JOINs or split into role-specific SPs.","The @MainPage=9 API cache path should be separated into its own lightweight SP.","Multiple temp table creations on every call make this expensive for dashboard badge refresh — results should be cached at the application layer.","Scalar UDF calls (GetLearningAssignmentStatusText) per row in large result sets are the primary performance bottleneck."],"migrationRelevance":"high"},{"name":"GetLearningCommentInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":19,"tablesReferenced":["LA_AssignmentComments","LA_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.FetchCommentsInfo"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Returns admin comments associated with a specific learning assignment user record, filtering to comments NOT made by the learner themselves (IsCommentedByLearner=0).","businessPurpose":"Displays admin/reviewer feedback comments on a learner's assignment submission page.","optimizationRecommendations":["No major issues. Simple JOIN query."],"migrationRelevance":"low"},{"name":"GetLearningModuleAssignmentEmailNoticeInformation","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@MailType","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":500,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","PF_EmailTemplate","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Departments","SEC_KeyTxtInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetLearningModuleAssignmentEmailNoticeInformation"],"complexity":"very-complex","aiEnrichment":null,"module":"LA","summary":"Large email batch generation SP. Iterates over users with expiring/expired/reminder-eligible assignments via a WHILE loop and builds a custom email per user by substituting tokens into PF_EmailTemplate HTML. Handles three mail types (future, expire, reminder) and inserts results into SCHE_ApplicationEmailSchedules. Uses multiple temp tables and cursor-like sequential processing.","businessPurpose":"Generates and queues reminder and expiry notification emails for learning assignments — runs on a scheduled basis (scheduler/batch job) to notify users of upcoming and expired assignments.","optimizationRecommendations":["The WHILE loop over users is a fundamental anti-pattern for batch email generation — should be replaced with set-based INSERT into the email schedule table.","HTML token substitution in T-SQL belongs in the application/template layer.","Multiple SELECT statements inside the WHILE loop for each user create N+1 query patterns.","Email template selection and rendering logic should be abstracted to a dedicated service."],"migrationRelevance":"high"},{"name":"GetLearningModules","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["LA_Literature"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.GetLearningModules"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Simple SELECT from LA_Literature filtered by DepartmentID and IsDeleted=0, returning literature module metadata.","businessPurpose":"Returns all active learning modules for a department — used to populate dropdowns and lists in the LA admin interface.","optimizationRecommendations":["No issues. Trivial query. Ensure index on LA_Literature(DepartmentID, IsDeleted)."],"migrationRelevance":"low"},{"name":"GetListOfDepartmentsForLearningAssignments","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":40,"tablesReferenced":["SEC_Departments","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetListOfDepartmentsForLearningAssignments"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Returns the list of departments visible to the current user for LA operations. If the user is an LA admin, returns the full department hierarchy via RetrieveDepartments(); otherwise returns only the user's own department.","businessPurpose":"Determines the department scope for learning assignment operations — called by multiple other LA SPs to establish which departments a user can see/manage.","optimizationRecommendations":["RetrieveDepartments() is a recursive TVF — its cost depends on department hierarchy depth. Monitor execution plans for departments with deep hierarchies.","This SP is called via EXEC inside other SPs, preventing optimizer from seeing through it; consider inlining as a CTE where possible."],"migrationRelevance":"medium"},{"name":"GetLiteratureInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":33,"tablesReferenced":["LA_Literature","LA_LiteratureData","QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.FetchLiteratureInfo"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Returns full details for a single literature module including all LA_Literature fields, joined to LA_LiteratureData (document info) and QUIZ_Assignment (optional quiz linkage). Also retrieves quiz display settings.","businessPurpose":"Populates the Edit Literature / Learning Module edit form with all existing data for a given module.","optimizationRecommendations":["No major issues. Straightforward lookup. Ensure index on LA_Literature(LiteratureID)."],"migrationRelevance":"medium"},{"name":"GetLiteratureInfoByIDs","schema":"dbo","parameters":[],"lineCount":31,"tablesReferenced":["LA_Literature","LA_LiteratureData","QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.GetLiteratureInfoByIDs"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Same as GetLiteratureInfo but accepts a comma-delimited list of LiteratureIDs, using STRING_SPLIT to filter multiple modules at once.","businessPurpose":"Retrieves literature details for multiple modules simultaneously — used in bulk display scenarios or OBC batch workflows.","optimizationRecommendations":["STRING_SPLIT usage is good (SQL Server 2016+). Ensure the result set size is bounded to prevent excessive data return for large ID lists."],"migrationRelevance":"medium"},{"name":"GetOBCBatchMergeStatusByDepartmentID","schema":"dbo","parameters":[],"lineCount":120,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","OBC_RequirementGroup","OBC_RequirementGroupAssignment","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Determines which OBC requirement group batches need merging. Returns batch pairs (old BatchID vs. matching records in OBC_RequirementGroupAssignment) to identify cohorts that have been split and need consolidation.","businessPurpose":"Supports the OBC batch merge process by identifying which cohort batches can be merged, ensuring correct grouping of users who were onboarded in the same batch cycle.","optimizationRecommendations":["Complex join logic with nested subqueries — review execution plan for potential hash match vs. nested loop issues.","Ensure indexes on OBC_RequirementGroup(DepartmentID) and OBC_RequirementGroupAssignment(BatchID)."],"migrationRelevance":"medium"},{"name":"GetOBClearningAssignmentInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":45,"tablesReferenced":["LA_Literature","OBC_RequirementGroup","OBC_RequirementGroupQuizDetails","QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetOBClearningAssignmentInfo"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Returns learning assignment and user details for a specific OBC requirement group, joining OBC_RequirementGroup to LA_LearningAssignments and LA_AssignmentUsers.","businessPurpose":"Retrieves the learning assignments associated with an OBC onboarding requirement group, used on the OBC management page to show which learning modules are part of a cohort's requirements.","optimizationRecommendations":["Straightforward multi-table JOIN. No major issues."],"migrationRelevance":"medium"},{"name":"GetOBCLearningAssignmentUsers","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":90,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","PF_UserDocuments","QUIZ_Assignment","QUIZ_Template","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetOBCLearningAssignmentUsers"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns all users (both active and soft-deleted) for a learning assignment, joining SEC_Users with LA_AssignmentUsers and computing status via GetLearningAssignmentAndQuizStatus UDF.","businessPurpose":"Populates the user roster view for an OBC-linked learning assignment, showing both current and previously removed users for audit/management purposes.","optimizationRecommendations":["GetLearningAssignmentAndQuizStatus called twice per row (Status, ActionText) — consolidate into single call.","Returning soft-deleted rows with active rows in one result set complicates client filtering — consider a @IncludeDeleted parameter."],"migrationRelevance":"medium"},{"name":"GetPendingAutoLearningAssignmentDocuments","schema":"dbo","parameters":[],"lineCount":34,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_LiteratureData","PF_UserDocuments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Finds users who have auto-generated learning assignment documents not yet uploaded (PFUserDocumentID IS NULL where document is expected). Then marks those records as uploaded by updating the PFUserDocumentID. This is a side-effect SP that both queries and mutates in one call.","businessPurpose":"Part of the automated document assignment pipeline — identifies users who should have auto-generated documents but don't yet, then marks them as processed. Used by a scheduled job to track document generation progress.","optimizationRecommendations":["An SP that both SELECT-queries for display and mutates data (UPDATE) violates the command-query separation principle — split into separate query and command SPs.","The auto-commit UPDATE without explicit transaction risks partial updates if the query portion fails."],"migrationRelevance":"medium"},{"name":"GetPreceptorAndTraineesEmailInformation","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ImageType","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PreceptorGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":391,"tablesReferenced":["LA_PreceptorGroups","LA_Preceptors","LA_Trainee","PF_EmailTemplate","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Large email generation SP. Uses a WHILE loop to iterate over preceptors, building an HTML email with their trainee roster and learning assignment status for each trainee. Performs token substitution on PF_EmailTemplate and inserts into SCHE_ApplicationEmailSchedules.","businessPurpose":"Sends preceptors a digest email showing their trainees' pending/overdue learning assignments, enabling preceptors to follow up with trainees who haven't completed required assignments.","optimizationRecommendations":["WHILE loop over preceptors is a row-by-row anti-pattern — replace with set-based email batch generation.","HTML table building in T-SQL (FOR XML, string concatenation) should move to application layer.","Multiple per-iteration SELECT statements inside the WHILE loop create N+1 problems."],"migrationRelevance":"high"},{"name":"GetPreceptorbyTraineeID","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["LA_Preceptors","LA_Trainee","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetPreceptorbyTraineeID"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Returns the preceptor(s) assigned to a given trainee user by joining LA_Preceptors and LA_Trainee.","businessPurpose":"Looks up who is supervising a specific trainee — used when sending notifications or displaying preceptor information to a trainee.","optimizationRecommendations":["Simple JOIN. Ensure indexes on LA_Trainee(UserId) and LA_Preceptors(PreceptorID)."],"migrationRelevance":"low"},{"name":"GetPreceptorDetailsByDepartmentID","schema":"dbo","parameters":[],"lineCount":25,"tablesReferenced":["LA_Preceptors","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetPreceptorDetailsByDepartmentID"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Returns a list of active preceptors in a department with their email addresses, joining LA_Preceptors to SEC_Users.","businessPurpose":"Retrieves the contact details of all preceptors in a department for use in email notifications or administrative displays.","optimizationRecommendations":["No major issues. Ensure index on LA_Preceptors(DepartmentID, IsDeleted)."],"migrationRelevance":"low"},{"name":"GetPreceptorsInfoByPreceptorGroupID","schema":"dbo","parameters":[{"name":"@PreceptorGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["LA_PreceptorGroups"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Returns preceptors belonging to a specific preceptor group, joining LA_Preceptors to SEC_Users for full user details.","businessPurpose":"Retrieves the preceptor roster for a preceptor group, used on the group management page.","optimizationRecommendations":["No major issues. Ensure index on LA_Preceptors(PreceptorGroupID)."],"migrationRelevance":"low"},{"name":"GetPreceptorTraineesEmailInformation","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ImageType","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PreceptorGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":261,"tablesReferenced":["LA_PreceptorGroups","LA_Preceptors","LA_Trainee","PF_EmailTemplate","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Similar to GetPreceptorAndTraineesEmailInformation — generates preceptor roster/trainee status emails via a WHILE loop with HTML string building and template substitution, inserting into SCHE_ApplicationEmailSchedules.","businessPurpose":"Variant of the preceptor email digest SP, likely serving a slightly different trigger context or format. Both SPs share the same core WHILE-loop email generation pattern.","optimizationRecommendations":["Near-duplicate of GetPreceptorAndTraineesEmailInformation — should be consolidated with a @TemplateMode parameter.","Same WHILE loop / HTML building anti-patterns apply — move to application layer.","Hardcoded template names reduce maintainability."],"migrationRelevance":"high"},{"name":"GetReminderAssignmentsforAdmin","schema":"dbo","parameters":[],"lineCount":26,"tablesReferenced":["LA_Admins","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetReminderAssignmentsforAdmin"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Returns a list of admins who should receive reminder notifications about overdue learning assignments, joining LA_Admins to department and user data filtered by expiry conditions.","businessPurpose":"Identifies which LA admins need to be notified about assignments that have expired or are about to expire, feeding the reminder email batch process.","optimizationRecommendations":["Ensure index on LA_LearningAssignments(ExpiryDate) and LA_AssignmentUsers(CompletedDateTime, SubmittedDateTime) for the expiry filter.","Date comparison patterns may prevent index range scans — verify execution plans."],"migrationRelevance":"medium"},{"name":"GetReminderAssignmentsForPreceptors","schema":"dbo","parameters":[{"name":"@PreceptorID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserType","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":47,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","LA_Preceptors","LA_Trainee"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetReminderAssignmentsForPreceptors"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns pending assignment records for preceptors' trainees that are due for reminder emails, filtering on incomplete/unsubmitted status and upcoming/past expiry.","businessPurpose":"Feeds the preceptor reminder email batch, identifying which preceptor-trainee combinations have overdue learning assignments so reminder emails can be sent.","optimizationRecommendations":["Similar to GetReminderAssignmentsforAdmin — consider consolidating admin and preceptor reminder queries into a single SP with a @RecipientType parameter.","Scalar UDF calls in WHERE filters prevent index use."],"migrationRelevance":"medium"},{"name":"GetSubmittedLearningAssignments","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserRole","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@Status","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":195,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_MyEvalMainPageLinks","SEC_ToDoAdmLrnAssignment"],"sprocsCalledFromBody":["usp_TraceMyEvalMainPageCounts"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetSubmittedLearningAssignments"],"complexity":"very-complex","aiEnrichment":null,"module":"LA","summary":"Complex SP for the learner's 'My Assignments' view. Uses dynamic SQL (sp_executesql) to handle multiple filter combinations. Tracks user's visit to the page (updates LA_AssignmentUsers.AccessedDateTime). Returns paginated assignments with status, quiz info, and document details. Also handles a @MainPage=9 mode for API cache badge count updates.","businessPurpose":"Powers the learner's primary assignment list page, showing all their assignments with current status, quiz requirements, and submission state. The AccessedDateTime update means this SP has a side effect on every page view.","optimizationRecommendations":["Side-effect UPDATE (AccessedDateTime) inside a SELECT SP mixes query and command concerns — separate into distinct operations.","Dynamic SQL prevents plan reuse for a high-traffic, per-user SP.","The @MainPage=9 cache-update path should be its own SP.","Scalar UDF calls per row for status computation are the primary performance risk."],"migrationRelevance":"high"},{"name":"GetTemplatesForAssessorsAndPreceptors","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@FirstName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@LastName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Email","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@EmailType","dataType":"VARCHAR(100)","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"Varchar(MAX)","direction":"IN","defaultValue":null},{"name":"@ImageType","dataType":"VARCHAR(20)","direction":"IN","defaultValue":null}],"lineCount":60,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.GetTemplatesForAssessorsAndPreceptors"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Retrieves an email template for assessors/preceptors and performs basic token substitution (preceptor name, trainee name, assignment details), returning the rendered template for sending.","businessPurpose":"Generates assessment notification emails directed at preceptors/assessors, informing them that a trainee has submitted a learning assignment for review.","optimizationRecommendations":["Token substitution should move to application layer.","Straightforward otherwise — single template SELECT with REPLACE calls."],"migrationRelevance":"medium"},{"name":"GetUsersWithLevel","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserType","dataType":"ShortCounterNumber","direction":"IN","defaultValue":null},{"name":"@UserScope","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@FirstYear","dataType":"ShortCounterNumber","direction":"IN","defaultValue":"NULL"},{"name":"@SearchDate","dataType":"SmallDate","direction":"IN","defaultValue":"NULL"}],"lineCount":168,"tablesReferenced":["LA_Preceptors","LA_Trainee","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Returns a list of users with their quiz group level, scoped based on the caller's role — preceptors see their trainees, admins see department users. Joins QUIZ_Assignment group level data with user info.","businessPurpose":"Populates user selection dropdowns in the quiz assignment UI, showing users along with their current quiz group level to help admins assign appropriate quiz difficulty.","optimizationRecommendations":["Role-based scoping via IN clauses on role IDs — consider a role-permission table approach for maintainability.","Ensure proper indexes on QUIZ_Assignment and SEC_UserRoles for the role filter."],"migrationRelevance":"medium"},{"name":"GetVideoTitle","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":45,"tablesReferenced":["PF_UserDocuments","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.GetVideoTitle","MyEvaluations.Business.Quiz/DesignQuizManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Returns portfolio video document records filtered by access level — admins see all department videos, learners see only their own. Simple JOIN between PF_UserDocuments and SEC_Users.","businessPurpose":"Populates the video attachment selector on the learning assignment form, showing admins all department videos or restricting learners to their own uploaded videos.","optimizationRecommendations":["Access level branching (admin vs. learner) can be simplified with a single query using conditional WHERE logic.","Ensure index on PF_UserDocuments(UserID, DepartmentID, DocumentType)."],"migrationRelevance":"low"},{"name":"LearningAssignmentReviewtoPD","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":166,"tablesReferenced":["LA_LearningAssignments","LA_Literature","LA_Preceptors","LA_Trainee","PF_EmailTemplate","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.LearningAssignmentReviewtoPD"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Sends review notification emails to PD (Program Director) and/or preceptors when a learner submits their learning assignment. Uses a WHILE loop to iterate through recipients, builds HTML content via token substitution, and inserts into SCHE_ApplicationEmailSchedules. Handles multiple role-based recipient types.","businessPurpose":"Notifies program directors and preceptors when a learner submits a learning assignment for review, triggering the review workflow. This is called as part of the submission flow.","optimizationRecommendations":["WHILE loop email generation — replace with set-based INSERT into email schedule.","HTML generation in T-SQL — move to application layer.","Called inline during user submission — async email dispatch would improve user-facing response time."],"migrationRelevance":"high"},{"name":"ReviewUserLearningAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessedDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@TopicSubject","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SummaryNotes","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["LA_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Updates LA_AssignmentUsers to record that an admin has reviewed a submitted assignment, setting ReviewedBy and ReviewedDateTime.","businessPurpose":"Records the admin's review action on a submitted assignment, advancing the assignment through the review workflow.","optimizationRecommendations":["Simple UPDATE. No issues."],"migrationRelevance":"low"},{"name":"SendBSNMailstoArchivedUsers","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsArchived","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":92,"tablesReferenced":["LA_Preceptors","PF_EmailTemplate","SCHE_ApplicationEmailSchedules","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Sends archive or unarchive notification emails to BSN program users. Selects the appropriate PF_EmailTemplate based on @IsArchived flag, performs token substitution (username, password, application URL), and inserts into SCHE_ApplicationEmailSchedules.","businessPurpose":"Notifies BSN (Chamberlain University nursing) users when their account is archived or restored, providing updated access credentials and links.","optimizationRecommendations":["Credentials in email body (UserName/Password via REPLACE) — security concern.","Hardcoded email addresses and program-specific logic — should be driven by configuration.","Move template rendering to application layer."],"migrationRelevance":"medium"},{"name":"SendDevryFNPMailstoArchivedUsers","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsArchived","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":101,"tablesReferenced":["LA_Preceptors","PF_EmailTemplate","SCHE_ApplicationEmailSchedules","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Nearly identical to SendBSNMailstoArchivedUsers but for Devry FNP (Family Nurse Practitioner) program users. Same archive/unarchive email pattern with Devry-specific template names and configuration lookups.","businessPurpose":"Notifies Devry FNP program users when their account is archived or restored.","optimizationRecommendations":["Duplicate of SendBSNMailstoArchivedUsers with different template names — consolidate both into a single parameterized SP.","Same credentials-in-email and template rendering concerns apply."],"migrationRelevance":"medium"},{"name":"SubmitUserLearningAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessedDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@TopicSubject","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SummaryNotes","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SendLater","dataType":"VerySmallNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":44,"tablesReferenced":["LA_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.SubmitUserAssignment"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Updates LA_AssignmentUsers to record a learner's submission. Handles two modes: immediate submit (sets SubmittedDateTime) and 'send later' (sets TopicSubject, SummaryNotes, AccessedDateTime without submitting). Returns updated assignment data.","businessPurpose":"Records a learner's submission of their learning assignment. The 'send later' mode allows learners to save progress before formally submitting.","optimizationRecommendations":["The two-mode behavior (submit vs. save-for-later) via a flag parameter is acceptable but could be clearer with a separate SP for each action.","Ensure index on LA_AssignmentUsers(LearningAssignmentID, UserID) for the UPDATE WHERE clause."],"migrationRelevance":"high"},{"name":"UpdateAssignLearningModule","schema":"dbo","parameters":[{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExpiryDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@IsReviewRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"},{"name":"@VideoID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@NumberOfTimesRetakeAllowed","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@MaxTimeLimit","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"1"}],"lineCount":55,"tablesReferenced":["LA_LearningAssignments","QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.UpdateLearningAssignmentModule"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Updates both LA_LearningAssignments and the linked QUIZ_Assignment (if one exists) with new dates, quiz settings, and pass percentage. Handles the case where the assignment has a quiz by updating QUIZ_Assignment in the same call.","businessPurpose":"Allows admins to edit an existing learning assignment's configuration — dates, quiz requirements, pass threshold — keeping the linked quiz synchronized.","optimizationRecommendations":["Two-table UPDATE is appropriate. Consider wrapping in an explicit transaction to ensure atomicity.","The linked QUIZ_Assignment update should check if the quiz assignment is still valid before updating dates."],"migrationRelevance":"medium"},{"name":"UpdateLARequiredStatus","schema":"dbo","parameters":[{"name":"@learningAssignmentID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["LA_LearningAssignments"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.UpdateLARequiredStatus"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Updates the IsReviewRequired flag on a specific LA_LearningAssignments record.","businessPurpose":"Allows admins to toggle whether admin review is required for a learning assignment after it has been created.","optimizationRecommendations":["Simple single-column UPDATE. No issues."],"migrationRelevance":"low"},{"name":"UpdateLearningAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExpiryDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@LearningAssignmentID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["LA_LearningAssignments"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Updates multiple fields of an LA_LearningAssignments record: literature ID, assignment details, start/expiry dates, video ID, review requirement, and voluntary status.","businessPurpose":"General-purpose update SP for the core learning assignment record, used when an admin edits assignment metadata.","optimizationRecommendations":["Simple multi-column UPDATE. No major issues. Consider optimistic concurrency check (version/timestamp) to prevent lost updates."],"migrationRelevance":"medium"},{"name":"UpdateLearningAssignmentPeriod","schema":"dbo","parameters":[{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExpiryDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["LA_LearningAssignments","QUIZ_Assignment"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.UpdateLearningAssignmentPeriod"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Updates start and expiry dates on LA_LearningAssignments and propagates the date change to the linked QUIZ_Assignment (if one exists).","businessPurpose":"Allows admins to extend or adjust the assignment period (e.g., for users who need extra time), keeping the quiz assignment dates in sync.","optimizationRecommendations":["Two-table UPDATE is appropriate. Wrap in transaction. Validate that ExpiryDate > StartDate before updating."],"migrationRelevance":"medium"},{"name":"UpdateLearningAssignmentReview","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssigneTo","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":140,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","OBC_RequirementGroupAssignmentSpecificLearningAssignment","OBC_RequirementGroupLiteraturesDetails"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.UpdateLearningAssignmentReview"],"complexity":"moderate","aiEnrichment":null,"module":"LA","summary":"Complex review state management SP. Handles three cases: (1) Open review — sets ReviewedDateTime and optionally CompletedDateTime; (2) Close review — completes the assignment and optionally marks OBC requirement group assignment as complete; (3) Quiz Submission case — handles quiz-linked completion. Also updates QUIZ_AssignmentUsers state and OBC_RequirementGroupAssignment status based on the review outcome.","businessPurpose":"The central SP for the admin review workflow — manages the transition of an assignment from 'submitted' to 'reviewed' to 'complete', with cascading updates to OBC and quiz records as appropriate.","optimizationRecommendations":["Three-case branching logic with very different UPDATE targets makes this hard to test and reason about — split into separate SPs per review action.","OBC cascading logic is implicit and fragile — document and test all OBC integration paths explicitly.","Wrap all branches in explicit transactions with error handling."],"migrationRelevance":"high"},{"name":"UpdateLearningAssignmentUsers","schema":"dbo","parameters":[{"name":"@LearningAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DocumentIDs","dataType":"LargeText","direction":"IN","defaultValue":"''"},{"name":"@DocumentName","dataType":"LargeText","direction":"IN","defaultValue":"''"},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":"''"},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":205,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","QUIZ_Assignment","QUIZ_AssignmentUsers","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":["AddLearningAssgnmentNotification","GetLearningAssignmentEmailTemplates"],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.UpdateLearningAssignmentUsers"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Adds or removes users from an existing learning assignment. Handles soft-delete of removed users, inserts new users into LA_AssignmentUsers and QUIZ_AssignmentUsers (if linked), sends email notifications for newly added users, and fires audit trail events.","businessPurpose":"Allows admins to modify the user roster of an existing learning assignment after creation — adding late additions or removing users who should not complete the module.","optimizationRecommendations":["Very large SP doing user add, user remove, quiz user sync, email dispatch, and audit logging — decompose into focused operations.","Email dispatch inline during user modification slows the admin action — queue asynchronously.","Audit EventID via table variable SELECT TOP 1 — use OUTPUT clause."],"migrationRelevance":"high"},{"name":"UpdateLiterature","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AssignmentDetails","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@NumberOfTimesRetakeAllowed","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@CompletionTime","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@CompletionPath","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@DocumentName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DocumentSize","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@DocumentFilePath","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@VideoID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsReviewRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsQuesDisplayorder","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0 --added by charan"}],"lineCount":41,"tablesReferenced":["LA_Literature","LA_LiteratureData"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Updates LA_Literature fields and upserts the corresponding LA_LiteratureData record (document path, file size, name). Handles both update of existing data and insert if no data record exists yet.","businessPurpose":"Allows admins to edit all aspects of a learning module definition including name, description, and the associated document file.","optimizationRecommendations":["IF EXISTS UPSERT pattern — replace with MERGE for atomicity.","Two-table update should be in explicit transaction."],"migrationRelevance":"medium"},{"name":"UpdateNonVoluntaryLearningModule","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["LA_Literature"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LiteratureManager.cs.UpdateNonVoluntaryLearningModule"],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Toggles the IsVoluntary flag on a LA_Literature record, changing whether a learning module is required or optional.","businessPurpose":"Allows admins to reclassify a learning module between voluntary and required status, which affects OBC assignment flows and user visibility.","optimizationRecommendations":["Simple single-column UPDATE. No issues."],"migrationRelevance":"low"},{"name":"UpdateOBCEditRecordByID","schema":"dbo","parameters":[{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@BatchID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":176,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","OBC_RequirementGroupAssignment","QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":["AddAssignmentDetails","AddLearningAssignment","GetRowValuesToString","UpdateOBCQuizCompleteddate"],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Handles OBC batch reassignment when learning assignment dates change. Detects whether the new dates create a new OBC batch period, creates a new OBC_RequirementGroup batch record if needed, reassigns OBC_RequirementGroupAssignment records to the new batch, and updates the learning assignment dates. Complex date-based batch management.","businessPurpose":"Ensures OBC cohort batch integrity when a learning assignment's dates are modified — if the new dates fall into a different batch period, users are moved to the appropriate OBC batch to maintain cohort grouping.","optimizationRecommendations":["Highly complex date-based batch detection logic — document with examples and add comprehensive integration tests.","The batch creation and reassignment logic should be wrapped in a transaction to prevent partial batch splits.","Consider moving OBC batch management to a dedicated OBC SP rather than embedding it in LA update flow."],"migrationRelevance":"high"},{"name":"UpdateOBCLearningAssignmentInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@BatchID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@VideoID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":151,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","OBC_RequirementGroupAssignment","OBC_RequirementGroupLiteraturesDetails","PF_UserDocuments"],"sprocsCalledFromBody":["UpdateOBCEditRecordByID"],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LearningAssignmentManager.cs.UpdateOBCLearningAssignmentInfo"],"complexity":"complex","aiEnrichment":null,"module":"LA","summary":"Updates an OBC learning assignment's dates and linked document reference. Updates both LA_LearningAssignments dates and the OBC_RequirementGroup's attachment document ID.","businessPurpose":"Allows admins to modify the dates and document reference for an OBC-linked learning assignment.","optimizationRecommendations":["Two-table UPDATE — wrap in explicit transaction.","No major issues otherwise."],"migrationRelevance":"medium"},{"name":"UpdateReadingAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ReadingUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessedDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@LiteratureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@OtherDetails","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@TopicSubject","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SummaryNotes","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ReadingAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["LA_ReadingAssignments"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Updates all fields of a LA_ReadingAssignments record: literature ID, description, period, and date fields.","businessPurpose":"Allows admins to edit the details of an existing reading assignment.","optimizationRecommendations":["Simple single-table UPDATE. No issues."],"migrationRelevance":"low"},{"name":"usp_GetMyPUserList","schema":"dbo","parameters":[],"lineCount":25,"tablesReferenced":["LA_Preceptors","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"LA","summary":"Returns the list of users visible to a preceptor in the 'MyP' (My Preceptor) view — their own trainees plus themselves. Joins LA_Preceptors to LA_Trainee and SEC_Users to return the preceptor's supervised user list.","businessPurpose":"Populates the user selector in the preceptor's dashboard view, showing the preceptor which trainees are under their supervision plus themselves.","optimizationRecommendations":["Simple JOIN query. Ensure indexes on LA_Preceptors(UserID) and LA_Trainee(PreceptorID).","The 'usp_' prefix is an older naming convention — consistent with GetUsersWithLevel and other Gets; consider renaming for consistency."],"migrationRelevance":"low"}]}