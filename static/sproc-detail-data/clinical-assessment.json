{"module":"OBC","displayName":"Clinical Assessment","procedureCount":26,"procedures":[{"name":"ApproveOBCLoaGaps","schema":"dbo","parameters":[{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CustomFormFieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsApprove","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":51,"tablesReferenced":["OBC_LoaGapsData","OBC_RequirementGroupAssignment","SEC_UserTrainingGapHistory"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"OBC","summary":"Approves or rejects a Leave of Absence (LOA) gap record for a specific requirement group assignment and custom form field. On approval, it upserts a corresponding record in SEC_UserTrainingGapHistory; on rejection it marks the gap unapproved and removes the history record.","businessPurpose":"Supports the clinical credentialing workflow by allowing program administrators to validate or reject LOA gap periods that affect a trainee's competency requirement timeline, ensuring the training gap history accurately reflects approved absences.","optimizationRecommendations":["The UPSERT pattern (IF NOT EXISTS INSERT ... ELSE UPDATE) can be replaced with a MERGE statement to reduce round trips and improve readability.","Index OBC_LoaGapsData on (RequirementGroupAssignmentID, CustomFormFieldID) and SEC_UserTrainingGapHistory on the same columns if not already present to support the equality filters used in both branches.","READ UNCOMMITTED isolation is acceptable for the initial SELECT but the subsequent DML runs within the same transaction — consider using a snapshot isolation level to balance consistency and concurrency for DML operations."],"migrationRelevance":"medium"},{"name":"AutoCompletePendingOCDForms","schema":"dbo","parameters":[],"lineCount":150,"tablesReferenced":["OBC_CustomFields","OBC_CustomFormSpecificDemographicFields","OBC_CustomFormSpecificFields","OBC_FieldTypeInfo","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupSpecificForms"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Identifies pending custom form assignments for one or more requirement group assignments, finds previously completed versions of the same forms for the same user in other assignments, and copies the form data and completion status forward to auto-complete the pending forms.","businessPurpose":"Reduces redundant data entry for trainees during onboarding and credentialing by automatically carrying forward completed form responses when the same custom form requirement appears in a new assignment cycle.","optimizationRecommendations":["The WHILE loop over table types and dynamic sp_executesql calls should be replaced with a set-based INSERT using a known list of target table names, or the dynamic tables should be consolidated into a single polymorphic structure to eliminate the loop entirely.","Multiple temporary tables (#tblRequirementGroupAssignments, #tblPendingCustomForms, #tblCompletedCustomForms, #tblCustomFormFields, #tblTableInfo) are created but some could be replaced with CTEs or table variables for simpler queries.","STRING_SPLIT(@RequirementGroupAssignmentIDs, ',') is used inline — consider persisting the parsed IDs into the temp table once and reusing rather than splitting twice.","The ROW_NUMBER() window function filtering (RowNum=1) is correct but the subquery could benefit from covering indexes on (UserID, CustomFormFieldID) over OBC_RequirementGroupAssignment and OBC_RequirementGroupAssignmentSpecificForms."],"migrationRelevance":"high"},{"name":"DeleteOBCPendingAssignments","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsCustomForm","dataType":"tinyint","direction":"IN","defaultValue":null}],"lineCount":197,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","OBC_CustomFormFieldStatus","OBC_CustomFormFields","OBC_DocumentType","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","QUIZ_Assignment","QUIZ_AssignmentUsers","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":["GetOBCVerifyCustomFieldStatus"],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Soft-deletes pending requirement group assignment items (custom forms, document types, or literature assignments) by setting IsDeleted=1, after verifying each item's current status via helper functions and stored procedures.","businessPurpose":"Allows administrators to remove pending or unwanted assignment items from an onboarding or credentialing requirement group without affecting already-completed items, supporting requirement group lifecycle management.","optimizationRecommendations":["The correlated scalar subquery calling dbo.GetOBCRequirementGroupStatusWithIndicator inside a SELECT per row is a major performance bottleneck — this function should be inlined as a TVF or its result materialized into a temp table once.","The EXEC GetOBCVerifyCustomFieldStatus call inside the IsCustomForm=1 branch introduces hidden side effects and cross-procedure state via the MethodName/DateAdded correlation pattern — this coupling makes the code fragile and hard to migrate.","Using the legacy dbo.fnSplit function should be replaced with STRING_SPLIT or a TVF that returns a typed result set.","The three code branches (IsCustomForm=0, 1, 2) share similar logic and should be refactored into a unified pattern to reduce maintenance surface area."],"migrationRelevance":"high"},{"name":"DeleteOBCRequirementGroupCustomForm","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["OBC_RequirementGroupSpecificForms"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"OBC","summary":"Deletes all specific form associations for a given requirement group from OBC_RequirementGroupSpecificForms and returns the RequirementGroupID.","businessPurpose":"Supports the requirement group configuration workflow by allowing administrators to clear all custom form associations from a requirement group, typically before reassigning a new set of forms.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteOBCRequirementGroupDocuments","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["OBC_RequirementGroupSpecificDocumentType"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"OBC","summary":"Deletes all document type associations for a given requirement group from OBC_RequirementGroupSpecificDocumentType and returns the RequirementGroupID.","businessPurpose":"Supports the requirement group configuration workflow by allowing administrators to clear all document type requirements from a requirement group.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GenerateOBCAssignmentReminderDetails","schema":"dbo","parameters":[],"lineCount":172,"tablesReferenced":["OBC_EmailReminderSettings","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupType","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"OBC","summary":"Retrieves OBC requirement group assignments eligible for email reminders based on configurable schedule rules — including initial notifications on access date, periodic assignment reminders, and overdue reminders — filtered by department email settings.","businessPurpose":"Drives the automated daily email reminder scheduler for the Onboarding and Credentialing module, ensuring trainees receive timely notifications about new assignments, upcoming due dates, and overdue requirements.","optimizationRecommendations":["The WHERE clause performs repeated CONVERT(DATETIME, CONVERT(VARCHAR(10), ..., 110)) date truncation on indexed date columns (AccessDate, DueDate, CreatedDate), preventing index seeks — storing or computing date-only values separately would allow index usage.","The complex OR-based reminder logic (5 separate OR branches) is difficult to maintain and could be extracted into a scalar function or rewritten as a CASE expression with a lookup against a reminder schedule table.","The SELECT INTO #TEMPOBCEmailReminder combines many joins and the result is immediately SELECTed — if this is called frequently, consider materializing the active assignment set as a persisted view or indexed temp staging table.","The inline comment block documenting business rules should be externalized to application documentation rather than embedded in the SP body."],"migrationRelevance":"medium"},{"name":"GenerateOBCEmailTemplateForNotes","schema":"dbo","parameters":[{"name":"@IsUserNotes","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CustomFormFieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsCustom","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@IsRequiredReview","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":158,"tablesReferenced":["OBC_EmailReminderSettings","OBC_NewSubmissionNoticeAdmins","PF_EmailTemplate","SCHE_ApplicationEmailSchedules","Sec_CustomerSupportInfromation"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"OBC","summary":"Generates and queues HTML email notifications when a note is submitted or reviewed in an OBC requirement group assignment, sending either to configured admin recipients (for user-submitted notes) or back to the user (for admin review notes), with personalized auto-login links.","businessPurpose":"Enables bidirectional communication between administrators and trainees within the OBC notes workflow, notifying the appropriate party when a note requiring review is created or responded to.","optimizationRecommendations":["The cursor-like WHILE loop over @tblOBCAdmins (fetching by ID) should be replaced with a set-based INSERT into SCHE_ApplicationEmailSchedules using a JOIN, which would eliminate the loop entirely.","Password and UserName are embedded in URL query strings as plain text before encryption — the EncryptingString function should be verified to use strong encryption; if migrating, this pattern should be replaced with token-based deep links.","The correlated scalar function calls (dbo.GetUserFirstNameLatnameWithSalutation, dbo.fnGetOBCRequirementGroupFullName) inside loops create N+1 query patterns — these should be pre-materialized."],"migrationRelevance":"medium"},{"name":"GenerateOverDueAdminEmails","schema":"dbo","parameters":[],"lineCount":203,"tablesReferenced":["LA_AssignmentUsers","LA_Literature","OBC_CustomFormFields","OBC_DocumentType","OBC_EmailReminderSettings","OBC_OverdueReminderAdmins","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Identifies OBC assignments in overdue status for a department by querying the requirement group status function, then returns both the list of admin recipients configured for overdue alerts and the list of overdue user/assignment details filtered by the admin overdue reminder schedule.","businessPurpose":"Powers the daily overdue notification workflow for program administrators, providing a consolidated view of all trainees with past-due onboarding or credentialing items so administrators can take action.","optimizationRecommendations":["The call to dbo.GetOBCRequirementGroupStatusByDepartmentID as a table-valued function for the entire department is expensive — results should be cached or pre-staged in a summary table for scheduler use.","The UNION of three sub-queries (DocumentType, CustomForm, Literature) within the INSERT into #TempDocuments each individually join against the full assignment table — a single pass with CASE-based type discrimination would reduce scan count.","Date comparison using CONVERT(DATETIME, CONVERT(VARCHAR(10), ...)) in the WHERE clause prevents index seeks on DueDate and CreatedDate columns.","The temporary table #TempAdminList is created without an explicit column list, relying on SELECT INTO — this should use an explicit CREATE TABLE for schema clarity."],"migrationRelevance":"high"},{"name":"GetOBCAllRequirementGroups_Test","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":405,"tablesReferenced":["OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupAssignmentSpecificLearningAssignment","SEC_DepartmentInstitution","SEC_Departments","SEC_InstitutionUsers","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Retrieves the full list of OBC requirement groups visible to a given user, applying role-based access control to include department-specific, institution-level, and system groups, then filters by academic year if specified.","businessPurpose":"Populates the requirement group selection dropdowns and management views in the OBC administrative interface, ensuring users only see requirement groups they are authorized to manage based on their role and department hierarchy.","optimizationRecommendations":["The CTE-based DELETE (tblGroups WHERE RowNumber > 1) to de-duplicate @tblRequirementGroups is unconventional — using DISTINCT in the initial population or a GROUP BY in the final SELECT would be cleaner.","The three-way UNION in the initial INSERT (department groups, linked-department groups, system groups) could benefit from a single pass with a UNION ALL followed by de-duplication rather than multiple table scans.","The repeated three-branch institution lookup (for RoleID 1, 6/21/GA user, and others) shares identical logic — this could be extracted into a common sub-query or helper.","The academic year filtering uses three separate UNION queries against OBC_RequirementGroupAssignment for three different assignment types — this triple scan could be consolidated with a UNION ALL and DISTINCT.","The function dbo.RetrieveDepartments is called via a temp table (#LinkedDepartments) which is an improvement over direct inline calls, but the function itself should be reviewed for recursive CTE efficiency."],"migrationRelevance":"high"},{"name":"GetOBCEmailforUpdatedRequirements","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@AdminUserID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":325,"tablesReferenced":["LA_AssignmentUsers","LA_Literature","OBC_CustomFormFieldStatus","OBC_CustomFormFields","OBC_DocumentType","OBC_EmailInfo","OBC_EmailReminderSettings","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RequirementGroupType","PF_EmailTemplate","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":["GetOBCVerifyCustomFieldStatus"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"OBC","summary":"Generates and queues an email notification to users (or their assigned admin) when their OBC requirement group assignment is updated, personalizing the email with assignment details, auto-login links, and contact footer information.","businessPurpose":"Notifies trainees and administrators when requirement group assignments are modified, ensuring all parties stay informed of changes to onboarding or credentialing requirements.","optimizationRecommendations":["Credentials (UserName, Password) are embedded in encrypted URL parameters — on migration, replace with stateless signed tokens or OAuth-based deep links.","The EXEC GetOBCVerifyCustomFieldStatus side-channel pattern (storing status results by MethodName + DateAdded) introduces temporal coupling — this should be replaced with direct result passing.","The #EmailInfo temp table is created but the SP appears to use separate scalar variables — confirm the temp table is actually populated and used, otherwise it is dead code.","String concatenation to build HTML email bodies inside SQL is maintenance-heavy — this logic should move to the application layer or a templating engine."],"migrationRelevance":"medium"},{"name":"GetOBCRequirementAssignmentAdminEmail","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":330,"tablesReferenced":["LA_AssignmentUsers","LA_Literature","OBC_CustomFormFieldStatus","OBC_CustomFormFields","OBC_DocumentType","OBC_EmailReminderSettings","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RequirementGroupType","PF_EmailTemplate","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":["GetOBCVerifyCustomFieldStatus"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Builds and queues HTML email notifications to administrators when OBC requirement group assignment events occur, including assignment details, user information, status tables, and auto-login URLs for direct review access.","businessPurpose":"Enables automated admin notifications for the Onboarding and Credentialing module, alerting program coordinators when trainees are assigned or complete requirements so they can take timely administrative action.","optimizationRecommendations":["Plain-text credentials in encrypted URL parameters must be replaced with secure token-based links during migration.","The status check via EXEC GetOBCVerifyCustomFieldStatus with MethodName/DateAdded correlation is a fragile side-effect pattern that should be eliminated in any migration.","Building HTML content via VARCHAR(MAX) string concatenation inside SQL creates unmanageable code — move email rendering to application layer.","The #TempUserList temp table with a SELECT INTO from OBC_RequirementGroupAssignment filtered to a specific user and RequirementGroupID should use a direct variable assignment rather than a temp table for single-row lookups."],"migrationRelevance":"medium"},{"name":"GetOBCRequirementAssignmentAdminOverDueEmail","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":432,"tablesReferenced":["LA_AssignmentUsers","LA_Literature","OBC_CustomFormFieldStatus","OBC_CustomFormFields","OBC_DocumentType","OBC_EmailReminderSettings","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RequirementGroupType","PF_EmailTemplate","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":["GetOBCVerifyCustomFieldStatus"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Generates overdue email notifications for administrators by aggregating pending and overdue OBC assignment items (documents, custom forms, literature) per user, building personalized HTML email content with document status tables and queuing them via SCHE_ApplicationEmailSchedules.","businessPurpose":"Automates the overdue alert process for OBC administrators, providing detailed per-user summaries of all outstanding requirements so administrators can follow up with trainees who have not completed their onboarding or credentialing obligations.","optimizationRecommendations":["The triple-UNION query aggregating document types, custom forms, and literature assignments into a temp table scans the full OBC_RequirementGroupAssignment table three times — consolidating into a single scan with type flags would improve performance.","Row-by-row HTML construction using WHILE loops over @tblOBCAdmins is an N+1 anti-pattern — replace with a set-based approach using FOR XML PATH or STRING_AGG to build the email table rows.","The status summary table is built using nested string concatenation inside a loop — this should be moved to the application layer or a reporting view.","Scalar function calls (dbo.GetUserFirstNameLatnameWithSalutation) inside WHILE loops cause repeated single-row lookups — pre-join this data once."],"migrationRelevance":"high"},{"name":"GetOBCRequirementAssignmentUserEmail_App","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@AdminUserID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":436,"tablesReferenced":["LA_AssignmentUsers","LA_Literature","OBC_CustomFormFieldStatus","OBC_CustomFormFields","OBC_DocumentType","OBC_EmailInfo","OBC_EmailReminderSettings","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RequirementGroupType","PF_EmailTemplate","SEC_Departments","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":["GetOBCVerifyCustomFieldStatus"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Generates and queues personalized HTML email notifications to individual users about their OBC requirement group assignments, including assignment details, document/form status tables, auto-login links, and point-of-contact footer information.","businessPurpose":"Delivers assignment notification emails to trainees in the Onboarding and Credentialing module, used both when assignments are created and when requirements change, ensuring trainees have direct access to their pending items.","optimizationRecommendations":["Credential-based auto-login URL construction must be replaced with secure token links during migration.","WHILE-loop-based per-user email generation should be replaced with set-based INSERT into the email schedule table.","The GetOBCVerifyCustomFieldStatus side-effect coupling via MethodName/DateAdded should be eliminated and replaced with direct result return.","This SP is nearly identical to GetOBCRequirementAssignmentAdminEmail with minor differences — the two should share a common helper or be consolidated to reduce code duplication."],"migrationRelevance":"medium"},{"name":"GetOBCRequirementGroupAssignmentInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":["OBC_RequirementGroup","OBC_RequirementGroupAssignment"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"OBC","summary":"Returns the core assignment metadata for a single OBC requirement group assignment, including assignment dates (period start/end, access, due), completion requirements, and mail settings.","businessPurpose":"Provides assignment summary data for display in the OBC assignment detail view, used by the application to show trainees and administrators the key dates and settings for a specific assignment.","optimizationRecommendations":["The JOIN to OBC_RequirementGroup (RG) is performed but no columns from RG are selected in the output — if RG is only used to validate existence, consider removing the join or adding a relevant column.","The JOIN to vSEC_ActiveUsers (U) is also not contributing any output columns — verify if this is intended as an existence filter and document accordingly."],"migrationRelevance":"low"},{"name":"GetOBCRequirementGroupStatusByDepartmentID1","schema":"dbo","parameters":[{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsCustom","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@CustomFormFieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":397,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","OBC_CustomFormFields","OBC_DocumentType","OBC_FormOrDocumentRequiredStatus","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentAdminNotes","OBC_RequirementGroupAssignmentNotes","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupAssignmentSpecificLearningAssignment","OBC_RequirementGroupAssignmentUserNotes","OBC_RequirementGroupLiteraturesDetails","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RightSignatureDocument","QUIZ_Assignment","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"OBC","summary":"Computes the completion status (Pending, User Action Required, Admin Review Required, Completed, Closed) and color coding for all OBC requirement group assignment items across custom forms, document types, and literature assignments, aggregated at the department or individual assignment level.","businessPurpose":"Serves as the core status calculation engine for the OBC module, powering the assignment status dashboards that show administrators and trainees the current state of all pending and completed requirements across an entire department.","optimizationRecommendations":["This SP is called as a table-valued function (GetOBCRequirementGroupStatusByDepartmentID) by other SPs and performs full department-wide scans — the result should be materialized in a scheduled summary table for dashboard queries to avoid repeated expensive computation.","Multiple conditional branches (IF @IsCustom=2, @IsCustom=1, @DepartmentID>0) each independently INSERT into the same #tblCustomFormStatus temp table — this could be unified into a single INSERT with WHERE conditions.","The status color mapping (hex codes per status) is hardcoded in the SP — this should be stored in a configuration table to allow non-code changes.","The aggregate status rollup (MIN of SubmitStatus) is computed after loading all individual form statuses — an indexed view or pre-aggregated summary could significantly reduce computation time for large departments.","Using three separate temp tables (#tblResult, #resultTable, #tblCustomFormStatus) with sequential processing adds overhead — evaluate whether a single-pass CTE approach would suffice."],"migrationRelevance":"high"},{"name":"GetOBCRequirementGroupStatusWithIndicator1","schema":"dbo","parameters":[{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsCustom","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@CustomFormFieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":594,"tablesReferenced":["LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","OBC_CustomFormFields","OBC_DocumentType","OBC_FormOrDocumentRequiredStatus","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentAdminNotes","OBC_RequirementGroupAssignmentNotes","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupAssignmentSpecificLearningAssignment","OBC_RequirementGroupAssignmentUserNotes","OBC_RequirementGroupLiteraturesDetails","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RightSignatureDocument","OBC_SignatureStatus","OBC_SignatureTemplates","OBC_VerifiedDocumentLocation","PF_UserDocuments","QUIZ_Assignment","SEC_Certifications","SEC_UserCertifications","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":true,"nolockCount":16,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Calculates the status and traffic-light color indicator for a specific OBC requirement group assignment item (a single custom form, document type, or literature item), considering completion state, admin review, signature requirements, and academic year boundaries.","businessPurpose":"Provides the per-item status indicator used throughout the OBC UI to show whether individual requirements within an assignment are pending, in review, or complete — called both interactively and by batch status operations.","optimizationRecommendations":["This SP is called as a scalar or row-level function from within other SPs (including loops), making it an N+1 query source — the status computation should be moved to a set-based batch query or replaced with an inline table expression.","The academic year date range computation calls two scalar functions (fnGetAcademicStartDate, fnGetAcademicEndDate) per invocation — pre-compute these and pass as parameters when called in batch contexts.","The @tblCustomFormStatus table variable is populated via multiple conditional branches for custom forms, document types, and literature — unifying these into a UNION ALL with type discriminators would reduce code duplication.","The IsClosed status check (OBC_RightSignatureDocument.IsClosed) involves a left outer join that may produce NULL values treated inconsistently — verify ISNULL handling is applied everywhere this column is read.","Status logic uses magic numbers (1=Pending, 2=User Action, 3=Admin Review, 4=Complete, 5=Closed) — create a reference/enum table and document the status codes."],"migrationRelevance":"high"},{"name":"GetOBCUserAssignments_20250408","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@FormID","dataType":"ShortText","direction":"IN","defaultValue":"''"},{"name":"@Status","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentIDs","dataType":"LargeText","direction":"IN","defaultValue":"''"},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@LoginDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":1239,"tablesReferenced":["BSN_ClinicalGroups","BSN_CourseCampusAcademicLeadership","BSN_CourseCampusClinicalCoordinator","BSN_OrganizationBillingDetails","BSN_PreceptorOrganization","DH_DepartmentRotations","LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","LA_Preceptors","OBC_CustomFormFieldStatus","OBC_CustomFormFields","OBC_DocumentType","OBC_DocumentUploadHistory","OBC_EmailReminderSettings","OBC_FormOrDocumentRequiredStatus","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentAdminNotes","OBC_RequirementGroupAssignmentNotes","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupAssignmentSpecificLearningAssignment","OBC_RequirementGroupAssignmentUserNotes","OBC_RequirementGroupLiteraturesDetails","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RightSignatureDocument","OBC_SignatureAdmin","OBC_SignatureStatus","OBC_SignatureTemplates","OBC_VerifiedDocumentLocation","PF_UserDocuments","Prep_LinkTraineesToCampusCluster","Prep_RotationLinkedSites","Prep_RotationSites","Prep_SessionDetails","Prep_TraineeReSchedulecalendar","Prep_TraineeSchedulecalendar","QUIZ_Assignment","SEC_Certifications","SEC_Departments","SEC_MyEvalMainPageLinks","SEC_ToDoOnBoardingCredentialing","SEC_UserCertifications","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":["GetAdminCampusLocations","GetOBCVerifyCustomFieldStatus","usp_TraceMyEvalMainPageCounts"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Retrieves all OBC requirement group assignment items for a user (custom forms, document types, literature) with their current completion status, signature states, admin review dates, and visit counts, supporting filtering by status, academic year, form type, and campus location.","businessPurpose":"Powers the main OBC 'My Assignments' dashboard view for trainees, providing the complete list of pending and completed onboarding/credentialing items with status indicators, due dates, and navigation links.","optimizationRecommendations":["At 74KB, this is one of the largest and most complex SPs in the codebase — it should be decomposed into smaller targeted SPs (one per requirement type: custom forms, documents, literature) that are called and unioned at the application layer.","Multiple temp tables and table variables (#tblCustomFormStatus, #tblUserAssignments, #tblPrevDocuments, #tblCampusLocations, #tblCampusTrainees, #tblSignatureStaus, #Results) are created and populated sequentially, with intermediate updates — this linear pipeline pattern makes the SP extremely difficult to maintain and test in isolation.","The status check integration via EXEC GetOBCVerifyCustomFieldStatus and the MethodName/DateAdded correlation pattern should be replaced with direct set-based status computation.","Campus-based filtering uses a WHILE loop over campus locations — replace with a set-based JOIN.","The usp_TraceMyEvalMainPageCounts call at the end performs a write operation (caching) as a side effect of a read query — this should be moved to an explicit application-layer cache update.","Indexes on OBC_RequirementGroupAssignment(UserID, IsDeleted, RequirementGroupID) and OBC_RequirementGroupAssignmentSpecificForms(RequirementGroupAssignmentID, IsDeleted, ReviewDate) are critical for this SP's performance."],"migrationRelevance":"high"},{"name":"GetOBCUserAssignments_Test","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@FormID","dataType":"ShortText","direction":"IN","defaultValue":"''"},{"name":"@Status","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentIDs","dataType":"LargeText","direction":"IN","defaultValue":"''"},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@LoginDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":1378,"tablesReferenced":["BSN_ClinicalGroups","BSN_CourseCampusAcademicLeadership","BSN_CourseCampusClinicalCoordinator","BSN_OrganizationBillingDetails","BSN_PreceptorOrganization","DH_DepartmentRotations","LA_AssignmentUsers","LA_LearningAssignments","LA_Literature","LA_Preceptors","OBC_CustomFormFieldStatus","OBC_CustomFormFields","OBC_DocumentType","OBC_DocumentUploadHistory","OBC_EmailReminderSettings","OBC_FormOrDocumentRequiredStatus","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentAdminNotes","OBC_RequirementGroupAssignmentNotes","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupAssignmentSpecificLearningAssignment","OBC_RequirementGroupAssignmentUserNotes","OBC_RequirementGroupLiteraturesDetails","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","OBC_RightSignatureDocument","OBC_SignatureAdmin","OBC_SignatureStatus","OBC_SignatureTemplates","OBC_VerifiedDocumentLocation","PF_UserDocuments","Prep_LinkTraineesToCampusCluster","Prep_RotationLinkedSites","Prep_RotationSites","Prep_SessionDetails","Prep_TraineeReSchedulecalendar","Prep_TraineeSchedulecalendar","QUIZ_Assignment","SEC_Certifications","SEC_Departments","SEC_MyEvalMainPageLinks","SEC_ToDoOnBoardingCredentialing","SEC_UserCertifications","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":["GetAdminCampusLocations","GetOBCVerifyCustomFieldStatus","usp_TraceMyEvalMainPageCounts"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"A test variant of GetOBCUserAssignments_20250408 with the same core logic for retrieving a user's OBC assignment items, statuses, and signatures, likely used for debugging or parallel development with minor variations in the query logic.","businessPurpose":"Used during development and testing of the OBC user assignments dashboard, serving as a parallel implementation that can be compared against the production version during feature development.","optimizationRecommendations":["This SP duplicates approximately 95% of GetOBCUserAssignments_20250408's code — the two should be reconciled and a single production SP should be maintained; the _Test variant should be dropped once validated.","All optimization recommendations from GetOBCUserAssignments_20250408 apply equally here.","Having two near-identical 80KB+ SPs creates a maintenance burden where changes must be applied twice — any bug fix risks being missed in one version."],"migrationRelevance":"medium"},{"name":"GetOBCUsersDetailedDemographicsReport_20240423","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUsersList","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SelectedFieldIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":298,"tablesReferenced":["MGMT_FieldTypes","OBC_CustomFields","OBC_CustomFormFields","OBC_CustomFormSpecificDemographicFields","OBC_CustomFormSpecificFields","OBC_FieldTypeInfo","OBC_LookupItems","OBC_MappingSection","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupSpecificForms","OBC_UserCustomFieldValues","SEC_LayoutFields","SEC_LayoutSpecificFields","SEC_Layouts","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Generates a detailed demographics report for OBC users by extracting custom field values, demographic layout field values, and requirement group assignment data across multiple departments and selected users, pivoting the data for reporting output.","businessPurpose":"Supports administrative reporting in the OBC module by providing detailed demographic and custom field data for selected users across departments, used to generate compliance and workforce reports.","optimizationRecommendations":["Multiple temp tables (#TempCusotmFieldValues, #TempLookupItems, #tempDepartmentIDdata, #tblCustomFieldData) with sequential population are used — assess whether a single-pass CTE approach reduces I/O.","The dbo.fnsplit and dbo.fnSplit functions are used for comma-separated list parsing — replace with STRING_SPLIT for SQL Server 2016+ environments.","The department list is extended mid-procedure by a second INSERT into #tempDepartmentIDdata based on custom field values — this two-pass population could cause inconsistent results if the initial list is not a superset; document the intended behavior.","The report adds department IDs discovered from user custom field values (@UsersListtable) to the department filter — this implicit expansion should be made explicit and configurable."],"migrationRelevance":"medium"},{"name":"GetRequirementGroupEmailQueueDetails","schema":"dbo","parameters":[],"lineCount":28,"tablesReferenced":["OBC_RequirementGroup","OBC_RequirementGroupEmailQueue"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"OBC","summary":"Returns the list of requirement groups with pending email notifications (IsMailGenerated = 0) from the OBC_RequirementGroupEmailQueue, along with their associated department IDs.","businessPurpose":"Used by the email scheduler to identify which requirement groups have queued notification events that have not yet been processed, driving the email generation pipeline for OBC requirement changes.","optimizationRecommendations":["The OBC_RequirementGroupEmailQueue table should have an index on IsMailGenerated to efficiently filter for pending items.","The DISTINCT in the SELECT may indicate duplicate rows in the queue table — investigate whether the upstream INSERT process creates duplicate entries and prevent them at the source instead."],"migrationRelevance":"low"},{"name":"RestoreOBCRequirementGroupAssignment_Test","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CreatedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CreatedDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["OBC_RequirementGroup","OBC_RequirementGroupAssignment"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"OBC","summary":"Restores previously soft-deleted OBC requirement group assignments by setting IsDeleted = 0, searching by department, creation date, requirement group, and creator, though the INSERT into the local table variable is commented out and only a SELECT is executed.","businessPurpose":"Intended to support administrative recovery of accidentally deleted OBC assignments, allowing program coordinators to reinstate assignments without data loss.","optimizationRecommendations":["The INSERT INTO @RequirementGroupAssignments is commented out and only a SELECT is active — the SP as written performs a SELECT (showing candidates) but does NOT execute the UPDATE, making it non-functional as a restore operation; this must be reviewed and corrected.","The commented-out code should be cleaned up or the intent documented clearly before this SP is used in production.","The _Test suffix should be removed once the SP is validated, or this SP should be replaced with a proper restore operation."],"migrationRelevance":"low"},{"name":"SendBSNPastDueReminders","schema":"dbo","parameters":[],"lineCount":298,"tablesReferenced":["BSN_CampusCodes","BSN_ClinicalGroups","BSN_CourseCampusAcademicLeadership","BSN_CourseFaculty","BSN_Faculty","BSN_PreceptorCommitmentFormAssignments","BSN_PreceptorOrganization","LA_AssignmentUsers","LA_LearningAssignments","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentSpecificForms","OBC_RequirementGroupAssignmentSpecificLearningAssignment","OBC_RequirementGroupLiteraturesDetails","OBC_RequirementGroupSpecificDocumentType","OBC_RequirementGroupSpecificForms","PF_EmailTemplate","QUIZ_Assignment","SCHE_ApplicationEmailSchedules","SEC_KeyTxtInfo","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"OBC","summary":"Sends past-due reminder emails to BSN (Bachelor of Science in Nursing) preceptor qualification assignment users and preceptors at weekly intervals, targeting specific requirement groups by name and ID for department 2531, including preceptor qualification, commitment form, and clinical group notifications.","businessPurpose":"Automates the weekly reminder process for nursing preceptor qualification requirements, alerting both preceptors and students when BSN-specific onboarding steps are overdue to maintain clinical program compliance.","optimizationRecommendations":["Hardcoded department ID (2531) and requirement group names/IDs create a maintenance liability — these should be stored in a configuration table rather than embedded in SQL code.","The modulo-based date interval check (DATEDIFF(DAY, ...) % 7 = 0) does not account for weekends or holidays and will skip a reminder if the scheduler misses a day — a more robust scheduling approach would track last-sent dates.","Multiple INSERT INTO SCHE_ApplicationEmailSchedules blocks for different recipient types (students, preceptors, faculty) follow the same pattern and could be refactored into a common parameterized approach.","The hardcoded reply-to email address ('BSNLabClinicalTracking@chamberlain.edu') should be stored in a settings table."],"migrationRelevance":"medium"},{"name":"SendOBCSignatureTemplates","schema":"dbo","parameters":[{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":244,"tablesReferenced":["OBC_DocumentType","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentAdminNotes","OBC_RequirementGroupAssignmentNotes","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupAssignmentUserNotes","OBC_RequirementGroupSpecificDocumentType","OBC_RightSignatureDocument","OBC_SignatureStatus","OBC_SignatureTemplates","PF_EmailTemplate","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"OBC","summary":"Identifies OBC document-type assignments that require electronic signature and sends personalized reminder emails to users with pending signature documents, including document details, due dates, and auto-login links, while notifying point-of-contact administrators.","businessPurpose":"Manages the electronic signature reminder workflow for OBC credentialing documents, ensuring trainees are prompted to complete required signature forms before their due dates.","optimizationRecommendations":["The nested WHILE loops over users and then over documents per user is an O(n*m) row-by-row processing pattern — replace with a set-based JOIN that generates one email record per user/document combination and bulk-inserts into SCHE_ApplicationEmailSchedules.","Auto-login URL construction embeds plain credentials — replace with signed token approach.","The SP constructs an HTML table of assignments per user inside the loop using string concatenation — this should move to the application layer.","Multiple temp tables with IDENTITY columns used for sequential processing are a sign of cursor-equivalent logic — evaluate full set-based rewrite."],"migrationRelevance":"medium"},{"name":"SendSignatureReminders","schema":"dbo","parameters":[],"lineCount":193,"tablesReferenced":["OBC_DocumentType","OBC_EmailReminderSettings","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupSpecificDocumentType","OBC_RightSignatureDocument","OBC_SignatureAdmin","OBC_SignatureStatus","PF_EmailTemplate","SCHE_ApplicationEmailSchedules","SEC_DepartmentInstitution","SEC_DepartmentPointOfContact","SEC_Departments","SEC_InstitutionUsers","SEC_KeyTxtInfo","SEC_Settings","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"OBC","summary":"Sends electronic signature reminder emails to OBC document assignment users, aggregating all pending signature documents per user into a single email with auto-login links, while filtering out users from closed or disabled departments.","businessPurpose":"Drives the automated signature reminder notification for the OBC credentialing module, replacing the older SendOBCSignatureTemplates with an improved approach that consolidates multiple pending documents into a single email per user and respects department closure status.","optimizationRecommendations":["The closed-department filter using LIKE '%CLOSED%' on department names is fragile — use a dedicated IsDisabled flag or status column rather than name-based matching.","Similar to SendOBCSignatureTemplates, this SP uses WHILE loops for per-user email generation — migrate to set-based processing.","The auto-login URL encryption pattern must be replaced with token-based links during migration.","The TemplateName-based email template lookup ('OBCAdminSignatureReminder') should be validated to ensure the template exists and has fallback handling."],"migrationRelevance":"medium"},{"name":"SendSignatureReminders1","schema":"dbo","parameters":[],"lineCount":181,"tablesReferenced":["OBC_DocumentType","OBC_EmailReminderSettings","OBC_RGADocumentTypeValues","OBC_RequirementGroup","OBC_RequirementGroupAssignment","OBC_RequirementGroupAssignmentSpecificDocumentType","OBC_RequirementGroupSpecificDocumentType","OBC_RightSignatureDocument","OBC_SignatureAdmin","OBC_SignatureStatus","PF_EmailTemplate","SEC_DepartmentInstitution","SEC_DepartmentPointOfContact","SEC_Departments","SEC_InstitutionUsers","SEC_KeyTxtInfo","SEC_Settings","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"OBC","summary":"An alternate version of SendSignatureReminders that sends signature reminder emails to OBC document assignment users, with nearly identical logic but potentially minor variations in recipient targeting or template usage.","businessPurpose":"Serves as a parallel or successor version of SendSignatureReminders, likely used during feature development or A/B testing of the signature reminder notification workflow.","optimizationRecommendations":["This SP is nearly identical to SendSignatureReminders — the two should be reconciled and a single production SP maintained; the duplicate should be dropped after validation.","All optimization recommendations from SendSignatureReminders apply equally here.","The suffix '1' naming convention does not clearly indicate the difference — document or rename before production use."],"migrationRelevance":"low"},{"name":"UpdateAssignmentEmailSentStatusFromScheduler","schema":"dbo","parameters":[{"name":"@RequirementGroupAssignmentIDs","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":40,"tablesReferenced":["OBC_RequirementGroup","OBC_RequirementGroupAssignment"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"OBC","summary":"Updates the IsMailSentToUser flag to 1 for a batch of requirement group assignment IDs where the initial email has not yet been sent, using a CSV input list parsed via SplitTextCSV.","businessPurpose":"Called by the email scheduler after sending initial assignment notification emails to mark assignments as having had their welcome/notification email sent, preventing duplicate initial emails.","optimizationRecommendations":["The SplitTextCSV function should be replaced with STRING_SPLIT or a table-valued parameter to avoid string splitting overhead for large batches.","The EXISTS check before the UPDATE is redundant — the UPDATE with the ISNULL(IsMailSentToUser, 0)=0 condition in the INNER JOIN already limits changes to unsent records; remove the IF EXISTS wrapper.","The temp table #TempAssignment (SELECT INTO) and subsequent COUNT check could be eliminated by directly joining in the UPDATE statement."],"migrationRelevance":"low"}]}