{"module":"QUIZ","displayName":"Quizzes","procedureCount":176,"procedures":[{"name":"AddAssignmentUsersDetails","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":14,"tablesReferenced":["QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentUsersManager.cs.Save"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Inserts a single user into the QUIZ_AssignmentUsers table linking a user to a quiz assignment. Minimal operation with a single INSERT.","businessPurpose":"Used when assigning an individual user to a quiz assignment in the MyEvaluations platform, typically called as part of bulk assignment workflows.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddConferenceQuizAssignments","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@QuizDueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ScheduleTemplateID","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"},{"name":"@ConferenceScheduleID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":111,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Creates a quiz assignment for a clinic or conference module, inserts the assignment record with timezone support, and bulk-inserts users from a CSV list. Uses a transaction with TRY/CATCH for atomicity.","businessPurpose":"Handles quiz assignments within the Clinics/Conference scheduling module, allowing administrators to assign quizzes to all conference attendees at once.","optimizationRecommendations":["Replace the fnSplit CSV function with a proper TVP (table-valued parameter) to avoid repeated string splitting overhead.","The #TempUserList temp table is created but ultimately unused — the actual insert uses fnSplit directly; remove dead temp table code.","Large blocks of commented-out legacy WHILE-loop code should be removed to improve readability and maintenance."],"migrationRelevance":"high"},{"name":"AddNewQuestionOptionsWithCorrectAnswer","schema":"dbo","parameters":[{"name":"@QuestionIDForUpdate","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Answers","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Option1","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Option2","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Option3","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Option4","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Option5","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Option6","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@CorrectAnswer","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@PageMode","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DocumentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":239,"tablesReferenced":["QUIZ_Answers","QUIZ_CorrectAnswer","QUIZ_Questions"],"sprocsCalledFromBody":["usp_QuizQuestionFormatedText"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.AddNewQuestionOptionsWithCorrectAnswer"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Creates or updates a quiz question along with up to six answer options and marks the correct answer in QUIZ_CorrectAnswer; supports Add, Edit, and implicit Copy modes. Calls usp_QuizQuestionFormatedText to sanitize HTML in question text.","businessPurpose":"Core question-authoring SP used in the question bank editor when administrators create or modify multiple-choice quiz questions with their answer choices.","optimizationRecommendations":["The correct-answer selection logic uses ROW_NUMBER() OVER (ORDER BY (SELECT '')) which produces non-deterministic ordering; use a stable ORDER BY (e.g., AnswerID) to guarantee consistent behavior.","Up to six separate IF-guarded INSERTs for options could be replaced with a single INSERT ... SELECT from a TVP or XML parameter to reduce round-trips.","The Delete-then-reinsert pattern for answers on Edit causes identity gaps; consider a MERGE statement for cleaner upsert semantics."],"migrationRelevance":"high"},{"name":"AddNewSpecialty","schema":"dbo","parameters":[{"name":"@SpecialtyName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SessionID","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":27,"tablesReferenced":["QUIZ_Specialty"],"sprocsCalledFromBody":["GetAutoSpecialtyID"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.AddNewSpecialty"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Auto-generates a specialty code via GetAutoSpecialtyID and inserts a new quiz specialty record, returning the new identity.","businessPurpose":"Used in the quiz administration UI to create new specialty categories (e.g., Surgery, Cardiology) that organize quiz questions by medical specialty.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"AddNewTopic","schema":"dbo","parameters":[{"name":"@TopicName","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["QUIZ_Topic"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.AddNewTopic"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Inserts a new topic record into QUIZ_Topic for a given department and returns the generated identity.","businessPurpose":"Used in the quiz administration UI to create new topic categories that allow questions to be filtered by subject area within a specialty.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"AddQuizAssignmentAccessUsersLog","schema":"dbo","parameters":[],"lineCount":36,"tablesReferenced":["QUIZ_AssignmentAccessUsersLog","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.AddQuizAssignmentAccessUsersLog"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Logs a user's quiz access event (Accessed, Saved, or Completed) with browser details and timestamp into QUIZ_AssignmentAccessUsersLog, deriving status from QUIZ_AssignmentUsers completion state.","businessPurpose":"Provides an audit trail of when users access their quiz assignments, supporting compliance tracking and troubleshooting in the MyEvaluations platform.","optimizationRecommendations":["The status derivation subquery runs on every call; consider passing status from the application layer to avoid an extra SELECT."],"migrationRelevance":"medium"},{"name":"AddQuizTemplate","schema":"dbo","parameters":[{"name":"@QuizName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizTopDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizBottomDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":35,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.AddQuizTemplate"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Inserts a new quiz template record (name, descriptions, department, creator) into QUIZ_Template and returns the new QuizID.","businessPurpose":"Used when an administrator creates a new quiz shell in the quiz builder before associating questions with it.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"AddQuizTemplateQuestions","schema":"dbo","parameters":[{"name":"@QuizIDForUpdate","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizTopDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizBottomDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CreatedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":122,"tablesReferenced":["QUIZ_Template","QUIZ_TemplateQuestion"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.AddQuizTemplateQuestions"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Handles Add, Edit, and Copy modes for quiz template management: creates or updates the QUIZ_Template record and syncs associated questions in QUIZ_TemplateQuestion via fnSplit on a CSV of question IDs.","businessPurpose":"Primary SP for the quiz builder workflow — saving a quiz template with its selected questions whether creating, editing, or copying an existing quiz.","optimizationRecommendations":["The Copy mode builds a comma-separated string via a WHILE loop then calls fnSplit on it — a roundabout pattern; directly INSERT from QUIZ_TemplateQuestion WHERE QuizID = @QuizIDForUpdate.","Replace fnSplit CSV parameter with a TVP for better type safety and performance.","The Copy mode returns @QuizIDForUpdate (source) instead of the newly created ID; this appears to be a bug and should return the new quiz ID."],"migrationRelevance":"high"},{"name":"AddQuizTempplateQuestions","schema":"dbo","parameters":[{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":15,"tablesReferenced":["QUIZ_TemplateQuestion"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Simple single-row insert adding a question to a quiz template in QUIZ_TemplateQuestion. (Note: name has a typo — double 'p' in Tempplate.)","businessPurpose":"Used to add a single question to an existing quiz template, likely called in bulk from application code during quiz composition.","optimizationRecommendations":["This is a near-duplicate of the insert inside AddQuizTemplateQuestions; consolidate to reduce redundancy.","Fix the SP name typo (AddQuizTempplateQuestions -> AddQuizTemplateQuestions) to avoid confusion."],"migrationRelevance":"low"},{"name":"CheckAssignmentType","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.CheckUserAssignmentType"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns the IsVoluntary flag for a given user quiz assignment to determine if it was self-assigned or administrator-assigned.","businessPurpose":"Used in the quiz-taking flow to differentiate between voluntary (self-selected) and mandatory quiz assignments, which may affect UI behavior and scoring rules.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"CheckAvailabilitySpecialtyName","schema":"dbo","parameters":[{"name":"@SpecialtyName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["QUIZ_Specialty"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.CheckAvailabilitySpecialtyName"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Checks whether a specialty name already exists for a department (excluding the current specialty being edited) and returns 1 if a duplicate exists, 0 otherwise.","businessPurpose":"Provides server-side validation in the specialty management UI to prevent duplicate specialty names within a department.","optimizationRecommendations":["SELECT * in EXISTS check is fine but could use SELECT 1 for clarity; more importantly, ensure an index exists on (SpecialtyName, DepartmentID, IsDeleted) in QUIZ_Specialty."],"migrationRelevance":"low"},{"name":"CheckAvailabilityTopicName","schema":"dbo","parameters":[{"name":"@TopicName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["QUIZ_Topic"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.CheckAvailabilityTopicName"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Checks whether a topic name already exists for a department (excluding the current topic) and returns 1 for duplicate, 0 for available.","businessPurpose":"Server-side duplicate name validation for the topic management screen, ensuring unique topic names per department.","optimizationRecommendations":["Ensure composite index on (TopicName, DepartmentID, IsDeleted) in QUIZ_Topic to make the EXISTS check efficient."],"migrationRelevance":"low"},{"name":"CheckDepartmentDetails","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.CheckDepartmentDetailsForOncall"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves department details (DepartmentID, AMIONSchedulePassword, Name) for an active department that has an AMION integration password configured.","businessPurpose":"Used to verify AMION scheduling integration is configured for a department before processing on-call quiz assignments linked to AMION schedules.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"CheckQuizAssignment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RotationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"Decimal","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"verySmallNumber","direction":"IN","defaultValue":null},{"name":"@AssignedByID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"verySmallNumber","direction":"IN","defaultValue":null}],"lineCount":46,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":["InsertVoluntaryQuizInfo"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.CheckQuizAssignment"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Checks if a quiz is already assigned to a specific user within the current date window, and automatically creates a voluntary assignment if none exists. Returns the user assignment ID.","businessPurpose":"Gate-keeper SP called when a user tries to take a quiz — determines if they have an active assignment or need one created automatically for voluntary quizzes.","optimizationRecommendations":["The CONVERT(datetime, CONVERT(VARCHAR, getdate(), 101)) date-truncation pattern is not SARGable; use CAST(getdate() AS DATE) for better index utilization.","Implicit branching logic embeds InsertVoluntaryQuizInfo call; consider making the voluntary-creation path explicit with a flag parameter for clearer control flow."],"migrationRelevance":"high"},{"name":"CheckQuizAssignmentUsersDetails","schema":"dbo","parameters":[{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":40,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Checks whether a specific quiz has already been completed by a user, returning completion status details and cleaning up certain pending records.","businessPurpose":"Used to prevent duplicate quiz submissions and to validate completion state before allowing retakes or reviews.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"CheckQuizNameExists","schema":"dbo","parameters":[{"name":"@QuizName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":38,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.CheckQuizNameExists"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Checks whether a quiz template name already exists for a department, returning a flag to indicate a duplicate.","businessPurpose":"Validates uniqueness of quiz names at the department level when administrators create or rename quiz templates.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"CopyQuizTemplate","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentIDs","dataType":"Largetext","direction":"IN","defaultValue":null}],"lineCount":182,"tablesReferenced":["QUIZ_Answers","QUIZ_CorrectAnswer","QUIZ_Questions","QUIZ_Specialty","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_Topic","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.CopyQuizTemplate"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Copies one or more quiz templates across departments, duplicating template metadata, associated questions, and question answer options, while handling naming conflicts. Uses WHILE loops to iterate over department and quiz lists.","businessPurpose":"Allows administrators to share and replicate quiz templates from one department to another, a common need in multi-site medical education programs.","optimizationRecommendations":["WHILE-loop iteration over departments and quizzes should be replaced with set-based INSERT ... SELECT to eliminate row-by-row processing.","The shared status update pattern inside the loop creates N individual UPDATE statements; batch with a single UPDATE after the loop.","Duplicate quiz name conflict detection inside a loop is O(n) per iteration; consider a bulk EXISTS check before the loop."],"migrationRelevance":"high"},{"name":"DeleteCCConferenceSchedule","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["QUIZ_Assignment"],"sprocsCalledFromBody":["RemoveAllConferenceAssignPresenters","RemoveAllConferenceUserAttendance"],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Soft-deletes a conference schedule record related to quiz assignments by setting a DeletedDate timestamp.","businessPurpose":"Used when removing a clinic/conference schedule entry that has associated quiz assignments, maintaining referential integrity through soft deletion.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteOBCLearningAssignments","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsDeleted","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":56,"tablesReferenced":["LA_AssignmentUsers","QUIZ_Assignment","QUIZ_AssignmentUsers","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Deletes or clears OBC (On-Board Curriculum) learning assignment records associated with quiz assignments, handling related tables via a temp table and conditional UPDATE/DELETE logic.","businessPurpose":"Used in the OBC module to remove quiz-linked learning assignments when a curriculum item is cancelled or re-assigned.","optimizationRecommendations":["The temp table approach for storing target IDs before delete is safe but could be replaced with a direct DELETE with JOIN for clarity."],"migrationRelevance":"medium"},{"name":"DeleteQuizAssignmentByAssignmentID","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsDeleted","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":31,"tablesReferenced":["QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.DeleteQuizAssignmentByAssignmentID"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Soft-deletes a quiz assignment by setting IsDeleted=1 and CancelDate to current date, then hard-deletes associated user assignment records.","businessPurpose":"Used when an administrator cancels a quiz assignment, preserving the assignment header for audit purposes while removing user-level records.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DeleteQuizAssignmentUsersByAssignmentID","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsDeleted","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":43,"tablesReferenced":["QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.DeleteQuizAssignmentUsersByAssignmentID"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Soft-deletes user assignment records for a given assignment ID by setting IsDeleted=1, then hard-deletes certain related user records.","businessPurpose":"Used to remove specific users from a quiz assignment without deleting the assignment itself, supporting partial reassignment scenarios.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DeleteQuizSpecialtyDetails","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["QUIZ_Specialty"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.DeleteQuizSpecialtyDetails"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Soft-deletes a quiz specialty by setting IsDeleted=1 and DeletedDate, then re-checks and hard-deletes if no active references remain.","businessPurpose":"Used in the specialty management UI to retire specialty categories that are no longer needed, while protecting specialties still in use.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteQuizTemplateQuestionsByQuizId","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["QUIZ_TemplateQuestion"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.DeleteQuizTemplateQuestionsByQuizID"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Hard-deletes all questions from QUIZ_TemplateQuestion for a given QuizID.","businessPurpose":"Used when rebuilding a quiz template's question set (delete-then-reinsert pattern) or fully removing a quiz's questions.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteQuizTopicDetails","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["QUIZ_Topic"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.DeleteQuizTopicDetails"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Soft-deletes a quiz topic by setting IsDeleted=1, then hard-deletes if validation passes.","businessPurpose":"Removes topic categories from the quiz question bank management UI when they are no longer needed.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteQuizUserAssignment","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.DeleteQuizUserAssignment"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Hard-deletes a specific user's quiz assignment record from QUIZ_AssignmentUsers by UserAssignmentID.","businessPurpose":"Allows targeted removal of an individual user from a quiz assignment, used in assignment management screens.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteStatusForSpecialty","schema":"dbo","parameters":[],"lineCount":35,"tablesReferenced":["QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.DeleteStatusForSpecialty"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Checks if a specialty has associated active questions before allowing deletion; returns a status code indicating whether deletion is safe.","businessPurpose":"Prevents orphaned question references by validating that no active questions use the specialty before it is deleted from the system.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteStatusForTopic","schema":"dbo","parameters":[],"lineCount":31,"tablesReferenced":["QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.DeleteStatusForTopic"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Checks whether a topic has active questions associated with it and returns a status code to indicate if deletion is permitted.","businessPurpose":"Acts as a business-rule guard to prevent deletion of topics that still have questions assigned, ensuring data integrity in the question bank.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetAdminUsers","schema":"dbo","parameters":[],"lineCount":27,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":3,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetAdminUsers"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves a list of administrator users for a department by joining SEC_Users with user type information, filtered by admin role.","businessPurpose":"Used to populate admin user dropdowns or notify department administrators about quiz-related events.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetAllEnabledDepartmentList","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentUsersManager.cs.GetAllEnabledDepartmentList","MyEvaluations.Business.Security/UserManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns all active (non-disabled) departments from SEC_Departments.","businessPurpose":"Provides the department list for quiz assignment and reporting screens where administrators need to select a department scope.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetAnswerDetailsByAnswerID","schema":"dbo","parameters":[],"lineCount":24,"tablesReferenced":["QUIZ_Answers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetAnswerDetailsByAnswerID"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves answer text and associated question details for a specific answer ID by joining QUIZ_Answers with QUIZ_Questions.","businessPurpose":"Used in question editing and review interfaces to load answer details when a specific answer is selected.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetAnswerOrder","schema":"dbo","parameters":[],"lineCount":79,"tablesReferenced":["QUIZ_Answers","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Analyzes the answer-ordering patterns for quiz questions from QUIZ_UserAnsweredQuestion, using temp tables and WHILE loops to decode stored answer order strings into structured rows. Appears to be a diagnostic/analysis tool.","businessPurpose":"Used for auditing and debugging how users' answers were ordered during a quiz session, particularly when answer shuffling is enabled.","optimizationRecommendations":["The SP has hardcoded QuestionID values (e.g., WHERE QuestionID IN (217135)) indicating it was a one-off analysis script that should not be in production.","WHILE loop over question IDs should be replaced with set-based operations.","Large blocks of commented-out alternative SQL variants should be cleaned up."],"migrationRelevance":"low"},{"name":"GetAttemptedQuizDetails","schema":"dbo","parameters":[{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@QuestionOrder","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RetakeID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":149,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer","QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion","SEC_TimeZones","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetAttemptedQuizDetails"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves detailed information about a user's quiz attempt including scores, questions, answers, and timezone-adjusted dates using dynamic SQL built from parameters. Supports both regular and retake attempt views.","businessPurpose":"Powers the quiz review/result page shown to users after completing a quiz, displaying their answers and correct answers with explanations.","optimizationRecommendations":["Dynamic SQL construction via string concatenation is difficult to maintain and prevents query plan caching; consider using sp_executesql with proper parameters.","The ISNULL(A.Timezone, 'EST') default fallback should reference a configuration table rather than hardcoding the timezone string.","The complex timezone conversion inline in SELECT adds significant computation — consider pre-computing in a CTE or scalar UDF."],"migrationRelevance":"high"},{"name":"GetAttemptedQuizEmailTemplate","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EmailTemplateID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":300,"tablesReferenced":["DH_DepartmentRotations","LA_Preceptors","LA_Trainee","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_CorrectAnswer","QUIZ_EmailTemplate","QUIZ_Template","QUIZ_UserAnsweredQuestion","Quiz_TimeLimit","SEC_Departments","SEC_TimeZones","SEC_UserRoles","Sec_CustomerSupportInfromation"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetAttemptedQuizEmailTemplate"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Builds and returns a fully rendered HTML email template for quiz attempt notifications, including score, pass/fail status, question details, and user/PD recipient information. Uses cursors to iterate over enrolled users.","businessPurpose":"Generates the email sent to users (and program directors) upon quiz completion, containing their score, pass/fail result, and a summary of their answers.","optimizationRecommendations":["CURSOR usage for iterating users should be replaced with set-based operations where possible.","HTML template assembly via string concatenation in SQL is fragile and hard to maintain; this logic belongs in the application layer.","Multiple SELECT statements inside the cursor loop cause N+1 query patterns; consolidate into a single JOIN-based query."],"migrationRelevance":"high"},{"name":"GetAutoSpecialtyId","schema":"dbo","parameters":[{"name":"@SpcltNm","dataType":"VARCHAR(50)","direction":"IN","defaultValue":null},{"name":"@SessId","dataType":"VARCHAR(500)","direction":"IN","defaultValue":null}],"lineCount":59,"tablesReferenced":["QUIZ_TempGenerateSpecialtyID"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Auto-generates a unique specialty ID code by checking existing codes and incrementing, using a WHILE loop to find the next available identifier. Called by AddNewSpecialty.","businessPurpose":"Provides the internal specialty code generation logic used when creating new quiz specialty categories in the system.","optimizationRecommendations":["The WHILE loop for ID generation is a serial bottleneck under concurrent inserts; replace with a SEQUENCE object or IDENTITY column.","Risk of infinite loop if the code space is exhausted; add a loop iteration limit safeguard."],"migrationRelevance":"low"},{"name":"GetCoefficientAlpha_Users","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":106,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetCoefficientAlphaUsers"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Computes Cronbach's Alpha reliability coefficient for a quiz at the individual user level using temp tables and mathematical aggregations across items and their variances.","businessPurpose":"Powers the psychometric Item Analysis reporting section for program administrators, showing the internal consistency reliability of a quiz instrument for individual users.","optimizationRecommendations":["Temp table with multiple INSERT/SELECT passes can be replaced with a multi-CTE approach for better readability and potential optimizer benefits.","The mathematical calculations (variance, sum of item variances) involve multiple passes over the same temp table data; consider consolidating into fewer scans."],"migrationRelevance":"high"},{"name":"GetCoefficientAlpha_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":174,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetCoefficientAlpha_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes Cronbach's Alpha at the user-type (e.g., PGY level) level using cursors to iterate over user type groups and temp tables for intermediate aggregation.","businessPurpose":"Provides the Cronbach's Alpha reliability metric broken down by trainee type (intern, resident, fellow) in the psychometric analysis reports.","optimizationRecommendations":["CURSOR over user types should be replaced with set-based grouped aggregation using GROUP BY UserTypeID.","Multiple temp table insert/delete cycles inside the cursor loop create significant I/O overhead.","Consider materializing user-type groupings once and performing all computations in a single pass."],"migrationRelevance":"high"},{"name":"GetCompareUsers","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeId","dataType":"int","direction":"IN","defaultValue":null},{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":226,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":["GetUsersWithLevel"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetCompareUsers"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Generates a cross-tabulated comparison of quiz scores across multiple users for selected quizzes and rotations, using temp tables to pivot data into a user-by-quiz matrix.","businessPurpose":"Powers the 'Compare Users' report in quiz analytics, allowing program directors to see side-by-side performance of trainees across multiple quizzes.","optimizationRecommendations":["Dynamic pivot using WHILE loop and temp table inserts should be replaced with PIVOT or dynamic PIVOT using sp_executesql.","Multiple INSERT INTO temp table operations in sequence can be combined into fewer set-based operations.","Hardcoded date conversion patterns (CONVERT(VARCHAR, date, 101)) should use consistent date formatting functions."],"migrationRelevance":"high"},{"name":"GetCompareUsers_UserTypes","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeId","dataType":"int","direction":"IN","defaultValue":null},{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":271,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":["GetUsersWithLevel"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetComparativeReports_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Cross-tabulates quiz performance by user type groups using cursors and temp tables, producing a matrix comparison of PGY levels or other user categories across quizzes.","businessPurpose":"Powers the 'Compare User Types' report variant in quiz analytics, showing group-level performance comparisons by training level.","optimizationRecommendations":["CURSOR iteration over user types is a key performance bottleneck; rewrite using set-based PIVOT with sp_executesql for dynamic columns.","The nested temp table management (create, insert, select, drop) pattern is fragile and should use table variables or CTEs where possible.","Consider caching intermediate aggregation results in a persisted summary table for heavily-used reporting SPs."],"migrationRelevance":"high"},{"name":"GetCompletedQuizDetails","schema":"dbo","parameters":[{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@RotationID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ReportStrDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ReportEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":243,"tablesReferenced":["QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer","QUIZ_Questions","QUIZ_Template","QUIZ_UserAnsweredQuestion","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves detailed completion records for quizzes assigned to users in a department, including retake counts, scores, completion dates, and pass/fail status across multiple assignment types (rotation, conference, on-call). Uses multiple temp tables and sub-selects.","businessPurpose":"Powers the Completed Quizzes grid in the administrator's quiz monitoring view, showing who has finished quizzes with their results.","optimizationRecommendations":["Multiple temp tables with repeated INSERT/SELECT passes create excessive I/O; consolidate with CTEs or a single complex query.","The date-based filtering uses string conversion (CONVERT(VARCHAR, date, 101)) for comparison which is not SARGable.","The SP has a 20KB body suggesting it should be decomposed into smaller helper SPs for individual assignment type queries."],"migrationRelevance":"high"},{"name":"GetCompletedQuizDetails2","schema":"dbo","parameters":[{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@RotationID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ReportStrDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":183,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Alternative version of GetCompletedQuizDetails that retrieves completed quiz records filtered by date range, rotation, and user selection. Appears to be a variant for a different report view.","businessPurpose":"Supports a filtered view of completed quizzes for reporting, possibly used for date-range-based completion reports.","optimizationRecommendations":["This SP appears to duplicate much of GetCompletedQuizDetails logic; evaluate whether the two can be unified with conditional parameters.","The temp table create/insert/select pattern should be replaced with a single result set query where possible."],"migrationRelevance":"high"},{"name":"GetCompletedQuizInfo","schema":"dbo","parameters":[],"lineCount":51,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetCompletedQuizInfo"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves summary completion information for a specific user assignment, including completion date and score, after cleaning up related temp state.","businessPurpose":"Used on the user-facing completed quizzes list to display each quiz's completion summary.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetCorrectCountInfo","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":100,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_CorrectAnswer","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Computes the correct answer count and total question count for a quiz assignment across one or more attempts, using a WHILE loop to iterate through the question order string.","businessPurpose":"Provides scoring data used to calculate pass/fail status and display score percentages on quiz result screens.","optimizationRecommendations":["The WHILE loop for parsing a delimited question order string should be replaced with a set-based approach using fnSplit or a STRING_SPLIT equivalent.","Parsing ordered question IDs from a VARCHAR column is a design anti-pattern; consider storing question order as a proper relational table."],"migrationRelevance":"high"},{"name":"GetCorrectCountInfoWithRetakes","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RetakeID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":116,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Extended version of GetCorrectCountInfo that includes retake attempt data, computing correct/incorrect counts for each retake iteration using WHILE loops over attempt records.","businessPurpose":"Supports the quiz result display when a user has retaken a quiz multiple times, showing scores per attempt.","optimizationRecommendations":["Same WHILE loop over delimited order string anti-pattern as GetCorrectCountInfo; replace with set-based processing.","Consider merging with GetCorrectCountInfo using a parameter flag for retake mode."],"migrationRelevance":"high"},{"name":"GetDeletedQuizQuestionsList","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["QUIZ_Questions","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetDeletedQuizQuestionsList"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves a list of questions that have been marked as deleted for a quiz, then triggers a cleanup or restore operation on related records.","businessPurpose":"Used in quiz administration to review and manage soft-deleted questions, supporting question restoration workflows.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetDepartmentList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":83,"tablesReferenced":["SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetDepartmentList","MyEvaluations.Business.Security/DepartmentManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Returns a filtered list of departments available for quiz operations, joining department data with rotation and user-type information and applying various active/enabled filters.","businessPurpose":"Populates department selection dropdowns in quiz assignment and reporting screens, scoped to the current user's access level.","optimizationRecommendations":["The multi-join query spanning 9 JOINs could benefit from query plan review; ensure proper indexes on the filter columns (IsDisabled, IsDeleted)."],"migrationRelevance":"medium"},{"name":"GetDepartmentRotationDetails","schema":"dbo","parameters":[],"lineCount":50,"tablesReferenced":["DH_DepartmentRotations","DH_SyncAMIONRotations","Prep_BuildSchedules","Prep_TraineeReSchedulecalendar","Prep_TraineeReSchedulecalendarData","Prep_TraineeSchedulecalendar","Prep_TraineeSchedulecalendarData"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.FetchListOfRotationDetailsForOncall"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves rotation details for a department relevant to quiz assignments, using temp tables to stage and transform the data.","businessPurpose":"Used when assigning quizzes to users in specific rotations, providing rotation context (dates, type) for the assignment configuration.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"Getdept_passfail_count","schema":"dbo","parameters":[{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":69,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes pass/fail counts per department for quiz assignments using a cursor to iterate over departments and accumulate counts in a temp table.","businessPurpose":"Used in quiz summary dashboards to show department-level pass/fail statistics, helping program directors identify underperforming groups.","optimizationRecommendations":["CURSOR iteration over departments should be replaced with a set-based GROUP BY query.","The aggregation pattern (create temp table → cursor fill → return) is a classic anti-pattern; a single SELECT with GROUP BY DepartmentID would suffice."],"migrationRelevance":"medium"},{"name":"GetDetailedQuizAssignmentsResults","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@RotationID","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@SelectedQuizID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ReportStrDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ReportEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@IsForAPI","dataType":"TINYINT","direction":"IN","defaultValue":"0  /*1=For API 0 for normal Execution*/"},{"name":"@SelUserID","dataType":"BIGINT","direction":"IN","defaultValue":"0  /*Using this Column for API*//**/"},{"name":"@AcademicYear","dataType":"INT","direction":"IN","defaultValue":"0  /*Using this Column for API*/"},{"name":"@UserPGYLevel","dataType":"INT","direction":"IN","defaultValue":"0  /*Using this Column for API*/"},{"name":"@PGYStartDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@PGYEndDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@PeriodStartDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"},{"name":"@PeriodEndDate","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"}],"lineCount":647,"tablesReferenced":["DH_DepartmentRotations","MYEVAL_PerformanceUserQuizzScore","MYEVAL_UserQuizAssignmentDetails","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","QUIZ_UserAnsweredQuestionsLOG","SEC_TimeZones"],"sprocsCalledFromBody":["GetCorrectCountInfo","GetCorrectCountInfoWithRetakes","GetDetailedQuizQuestionAnswers","GetQuizName","GetRotationIDNameDetails","GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetDetailedQuizAssignmentsResults"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Generates a comprehensive detailed quiz results report for multiple assignments, iterating over quiz/user combinations with WHILE loops to compute per-question correct/incorrect counts and building a structured result set across multiple temp tables. This is the largest single SP in the module at 36KB.","businessPurpose":"Powers the Detailed Quiz Assignments Results report, the most granular quiz performance report used by program directors to analyze individual question performance.","optimizationRecommendations":["The nested WHILE loops (quiz × user) result in O(n×m) row-by-row processing; rewrite as a set-based query with GROUP BY.","Multiple temp tables created, populated, and dropped inside the loop create significant tempdb pressure at scale.","Dynamic SQL for pivoting question results should use sp_executesql with parameterized queries.","This SP does too much in a single unit; decompose into sub-SPs for data staging, computation, and presentation."],"migrationRelevance":"high"},{"name":"GetDetailedQuizQuestionAnswers","schema":"dbo","parameters":[{"name":"@QuestionID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@AnswerOrder","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Type","dataType":"INT","direction":"IN","defaultValue":null}],"lineCount":116,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves the detailed question and answer data for a specific quiz assignment attempt, building a structured answer table via WHILE loop iteration over question order.","businessPurpose":"Used to display the detailed question-by-question breakdown in the quiz results review page.","optimizationRecommendations":["WHILE loop over question order string should be replaced with set-based fnSplit/STRING_SPLIT approach.","The repeated SELECT inside the loop to fetch question data causes N+1 query pattern."],"migrationRelevance":"high"},{"name":"GetEmailInformation","schema":"dbo","parameters":[{"name":"@QuizName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@RotationName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DepartmentName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"Varchar(Max)","direction":"IN","defaultValue":null},{"name":"@EmailTemplateID","dataType":"int","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":299,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_EmailTemplate","Quiz_TimeLimit","SEC_Departments","SEC_TimeZones"],"sprocsCalledFromBody":["GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Builds and returns email notification data for quiz assignment reminders, using a cursor to iterate over assigned users and constructing per-user email records with login links, passwords, and assignment details. Handles timezone conversion.","businessPurpose":"Generates the initial quiz assignment notification emails sent to users when a new quiz is assigned to them.","optimizationRecommendations":["CURSOR over users for email assembly should be replaced with a set-based JOIN producing all rows at once.","Email template assembly (HTML concatenation) in SQL should be moved to the application layer or a templating engine.","The SP queries SEC_DEPARTMENTS for timezone on every call; consider caching this in a parameter.","61 SELECT statements detected indicates significant query fan-out; batch related lookups."],"migrationRelevance":"high"},{"name":"GetFailedAssignmentInfo","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmetnID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":107,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_UserAnsweredQuestion","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetFailedAssignmentInfo"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves information about failed quiz assignments for a department to support alert notifications to preceptors and program directors, joining across user, assignment, and quiz tables.","businessPurpose":"Used by the automated email notification system to identify who failed a quiz so preceptors and PDs can be alerted.","optimizationRecommendations":["The 18-JOIN query should be reviewed for index coverage — ensure indexes exist on the foreign key columns used in joins.","Filter conditions on score/pass percentage should leverage computed columns or function-based indexes if they appear frequently in WHERE clauses."],"migrationRelevance":"high"},{"name":"GetFailureAssignmentEmailInformation","schema":"dbo","parameters":[{"name":"@QuizName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@RotationName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CompletedDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@Score","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"largetext","direction":"IN","defaultValue":null},{"name":"@PDUserName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@PDPassword","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@PDLastName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@PDFirstName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":129,"tablesReferenced":["QUIZ_EmailTemplate"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetFailureAssignmentEmailInformation"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Constructs email notification data for quiz failure alerts, using WHILE loop iteration over enrolled users to build per-user email records with scores and contact information.","businessPurpose":"Generates the failure alert email payload sent to program directors when a trainee fails a quiz assignment, enabling timely intervention.","optimizationRecommendations":["WHILE loop over user IDs should be replaced with a set-based query returning all user email records at once.","Similar to GetEmailInformation, HTML construction in SQL should be moved to the application layer."],"migrationRelevance":"high"},{"name":"GetFPGY_MsyTextforDepartment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":13,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizUsers.cs.GetFPGY_MsyText"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves FPGY/MSY text label configuration for a department — a single simple SELECT.","businessPurpose":"Used to get the department-specific label text for PGY (post-graduate year) levels, which varies by program, for display in quiz reports.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetFrequencyDistribution_Users","schema":"dbo","parameters":[{"name":"@deptID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":127,"tablesReferenced":["QUIZ_AssignmentUsers","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_UserAnsweredQuestion","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetFrequencyDistributionUsers"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes frequency distribution of quiz scores (score ranges and count of users in each band) for individual users using temp tables and WHILE loop iterations over score ranges.","businessPurpose":"Powers the Frequency Distribution chart/table in quiz psychometric reports, showing how scores are distributed across users.","optimizationRecommendations":["Score-banding via WHILE loop is inefficient; use a CASE expression or a score-range lookup table with a JOIN.","Multiple INSERT/SELECT passes over temp tables can be consolidated into a single set-based operation with conditional aggregation."],"migrationRelevance":"high"},{"name":"GetFrequencyDistribution_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":150,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetFrequencyDistribution_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes score frequency distribution broken down by user type (PGY level) using WHILE loops and temp tables for iterative accumulation.","businessPurpose":"Powers the user-type-segmented Frequency Distribution report, showing score distribution curves per training level.","optimizationRecommendations":["Replace WHILE-loop score-banding with a set-based score-range table JOIN grouped by UserTypeID.","Consolidate temp table passes to reduce tempdb I/O."],"migrationRelevance":"high"},{"name":"GetHighLowScore_Users","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":98,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetHighLowScoreforUsers"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Identifies and returns users with the highest and lowest quiz scores, using cursors and temp tables to segment users into score quartiles or extremes.","businessPurpose":"Supports the High/Low Score analysis report used by program directors to identify top and bottom performers on quizzes.","optimizationRecommendations":["CURSOR over users should be replaced with window functions (ROW_NUMBER, NTILE) over a single result set.","Multiple temp table phases can be collapsed into CTEs using NTILE(4) for quartile segmentation."],"migrationRelevance":"high"},{"name":"GetHighLowScore_Users_Grids","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":102,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetHighLowScoreforUser_Grid"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Extended high/low score analysis for grid-format display, using cursors and multiple temp table operations to structure the data for grid rendering.","businessPurpose":"Powers the grid-view variant of the High/Low Score report for individual users.","optimizationRecommendations":["CURSOR-based grid construction should use dynamic PIVOT with sp_executesql.","Reduce temp table depth — the current pattern creates, inserts, re-selects multiple times needlessly."],"migrationRelevance":"high"},{"name":"GetHighLowScore_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":168,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetHighLowScoreforUsers_Types"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes high/low score distributions segmented by user type using cursors and temp tables, producing comparison data across training levels.","businessPurpose":"Provides the user-type breakdown of high/low performers for program-level quiz performance analytics.","optimizationRecommendations":["Replace cursor iteration over user types with set-based aggregation grouped by UserTypeID.","Window function NTILE(n) or PERCENT_RANK() can replace manual score-banding loops."],"migrationRelevance":"high"},{"name":"GetHighLowScore_UserTypes_Grids","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":180,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetHighLowScore_UserTypes_Grids"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format high/low score analysis by user type using cursors, WHILE loops, and multiple temp tables to build the cross-tabulated output.","businessPurpose":"Powers the grid-view variant of high/low score reporting segmented by training level (PGY, fellow, etc.).","optimizationRecommendations":["Use dynamic PIVOT with sp_executesql instead of cursor-driven column construction.","Consolidate multiple temp table passes into a single CTE chain."],"migrationRelevance":"high"},{"name":"GetImportTemplateColumnsAlias","schema":"dbo","parameters":[],"lineCount":39,"tablesReferenced":["SEC_ImportAliasNames"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetTemplateHeaders"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves column alias mappings for the quiz question import Excel template, joining alias configuration tables.","businessPurpose":"Supports the question import feature by providing column name translations between the Excel template headers and the internal database column names.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetItemAnalysis_Departments_new","schema":"dbo","parameters":[{"name":"@deptID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":79,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetItemAnalysisByDept"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes item (question) difficulty and discrimination statistics per department using a cursor over departments and temp tables for aggregation of correct/incorrect response rates.","businessPurpose":"Powers the Item Analysis report broken down by department, helping identify questions that are too easy, too hard, or poorly discriminating across programs.","optimizationRecommendations":["CURSOR over departments should be replaced with a set-based GROUP BY DepartmentID query.","The item analysis computations (p-values, difficulty indices) could be expressed as a single aggregation query rather than cursor-driven accumulation."],"migrationRelevance":"high"},{"name":"GetItemAnalysis_Users","schema":"dbo","parameters":[{"name":"@deptID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["QUIZ_Answers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetItemAnalysisUsers"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns item analysis statistics (question difficulty, discrimination) at the individual user level, joining quiz answers and user assignment data.","businessPurpose":"Supports item-level analysis filtered to specific user subsets in the Item Analysis reporting section.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetLearningAssignmentQuizResult","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":54,"tablesReferenced":["LA_LearningAssignments","QUIZ_AttemptedUserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetLearningAssignmentQuizResult"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves quiz result data tied to a learning assignment, returning score, pass/fail status, and completion details.","businessPurpose":"Used in the Learning Assignments module to show quiz completion results that were required as part of a formal learning curriculum.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetLedgerOfQuizAssignmentsReportResult","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"Varchar(Max)","direction":"IN","defaultValue":null},{"name":"@ReportStrDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ReportEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@RotationID","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":118,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template"],"sprocsCalledFromBody":["GetCompletedQuizDetails","GetRotationIDNameDetails","GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetLedgerOfQuizAssignmentsReportResult"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Produces a ledger-style report of all quiz assignments (completed and pending) per user within a date range, using temp tables to stage rotation and assignment data before joining for the final result set.","businessPurpose":"Powers the Ledger of Quiz Assignments report, which gives a user-by-user tabular view of all quiz activity in a period — a key administrative report.","optimizationRecommendations":["Temp table staging approach with separate INSERT passes could be consolidated into a single multi-table query.","Ensure indexes exist on the date range filter columns (AccessDate, DueDate) to support the WHERE clause efficiently."],"migrationRelevance":"high"},{"name":"GetLedgerOfQuizAssignmentsReportResult_20250630","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"Varchar(Max)","direction":"IN","defaultValue":null},{"name":"@ReportStrDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ReportEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@RotationID","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":118,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template"],"sprocsCalledFromBody":["GetCompletedQuizDetails","GetRotationIDNameDetails","GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Date-stamped copy of GetLedgerOfQuizAssignmentsReportResult (identical body), retained as a snapshot before a modification scheduled for 2025-06-30.","businessPurpose":"Rollback safety copy of the ledger report SP; not intended for direct use in production queries.","optimizationRecommendations":["This dated backup SP should be removed from production and archived in source control instead.","Maintain a single canonical version with the snapshot preserved in git history."],"migrationRelevance":"low"},{"name":"GetMaxPGYforUserTypes","schema":"dbo","parameters":[],"lineCount":18,"tablesReferenced":["SEC_DepartmentTrainingTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizUsers.cs.GetMaxPGYNumber"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Returns the maximum PGY (post-graduate year) value for specified user types, used for axis scaling in PGY-based reports.","businessPurpose":"Provides the upper bound for PGY-axis rendering in quiz performance charts that are segmented by training year.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMeanMedianRange_users","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":112,"tablesReferenced":[],"sprocsCalledFromBody":["SPGetMedianByQuiz"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetMeanMedianRange_users"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes mean, median, and score range statistics for quiz performance at the individual user level using cursors and temp tables for the statistical calculations.","businessPurpose":"Powers the Mean/Median/Range statistical section of quiz performance reports for individual users.","optimizationRecommendations":["Median calculation via cursor and temp-table sorting should use PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY score) for native set-based computation.","Mean and range are simple aggregates that should not require cursors; use AVG(), MIN(), MAX() directly."],"migrationRelevance":"high"},{"name":"GetMeanMedianRange_users_grids","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(10)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":93,"tablesReferenced":[],"sprocsCalledFromBody":["SPGetMedianByQuiz"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetMeanMedianRange_users_Grids"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format variant of mean/median/range statistics for users, using cursors and WHILE loops to build a pivoted output table.","businessPurpose":"Supports the grid-view display of mean/median/range statistics in quiz analytics.","optimizationRecommendations":["Use PERCENTILE_CONT and standard aggregate functions instead of cursors for median computation.","Dynamic PIVOT with sp_executesql can replace the WHILE-loop column construction."],"migrationRelevance":"high"},{"name":"GetMeanMedianRange_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":156,"tablesReferenced":[],"sprocsCalledFromBody":["SPGetMedianByQuizUserType"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetMeanMedianRange_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes mean, median, and range statistics segmented by user type, using cursors and temp tables to iterate over user type groups.","businessPurpose":"Powers the user-type-level mean/median/range view in quiz analytics reports.","optimizationRecommendations":["Replace cursor over user types with set-based aggregation using PERCENTILE_CONT grouped by UserTypeID.","Multiple temp table phases should be reduced to a minimal CTE chain."],"migrationRelevance":"high"},{"name":"GetMeanMedianRange_UserTypes_Grids","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(10)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":124,"tablesReferenced":[],"sprocsCalledFromBody":["SPGetMedianByQuizUserType"],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetMeanMedianRange_UserTypes_grids"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format mean/median/range statistics by user type, combining cursor iteration with WHILE-loop column building for the pivot output.","businessPurpose":"Powers the grid-view mean/median/range report segmented by training level.","optimizationRecommendations":["Use dynamic PIVOT and native aggregate functions to replace cursor and WHILE-loop pattern.","Consolidate the four-phase temp table pattern into a single CTE-based query."],"migrationRelevance":"high"},{"name":"GetNoOfRespondentsTabulations_Users","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizIds","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":80,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetNumberofRespondentsandTabulationsforUsers"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Tabulates the number of respondents per quiz question option for individual users, using temp tables and multiple aggregation passes to build a cross-question response count matrix.","businessPurpose":"Powers the Respondent Tabulations section of quiz analytics, showing how many users selected each answer option per question.","optimizationRecommendations":["The multi-pass temp table aggregation can be replaced with a single conditional COUNT grouped by QuestionID and AnswerID.","Ensure appropriate indexes on QUIZ_UserAnsweredQuestion for the filter columns."],"migrationRelevance":"high"},{"name":"GetNoOfRespondentsTabulations_Users_Grid","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizIds","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":89,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetNumberofRespondentsandTabulationsforUser_Grid"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format respondent tabulation for users using a cursor to pivot response counts into column-based output.","businessPurpose":"Supports the grid-view rendering of respondent tabulation data in quiz analytics.","optimizationRecommendations":["CURSOR-based column pivoting should use dynamic PIVOT with sp_executesql.","Reduce temp table depth by combining intermediate aggregation steps."],"migrationRelevance":"high"},{"name":"GetNoOfRespondentsTabulations_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizIds","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":212,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetNoOfRespondentsTabulations_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Tabulates respondent counts per answer option segmented by user type using cursors and extensive temp table operations across 37 JOINs.","businessPurpose":"Provides user-type-segmented response tabulations for quiz answer option analysis.","optimizationRecommendations":["Replace cursor with set-based aggregation grouped by UserTypeID, QuestionID, and AnswerID.","The 37-JOIN query structure indicates potential for query decomposition.","Consolidate the many SELECT passes into a single GROUP BY with conditional aggregation."],"migrationRelevance":"high"},{"name":"GetNoOfRespondentsTabulations_UserTypes_Grid","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizIds","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":199,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetNoOfRespondentsTabulations_UserTypes_Grid"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format respondent tabulation by user type using cursors and WHILE loops across 31 JOINs.","businessPurpose":"Powers the grid-view respondent tabulation report segmented by training level.","optimizationRecommendations":["Replace cursor-driven grid construction with dynamic PIVOT.","Reduce JOIN count by pre-aggregating user type data in a CTE."],"migrationRelevance":"high"},{"name":"GetPendingQuizCount","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":55,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Departments","SEC_TimeZones","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetPendingQuizCount"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Returns counts of new, normal, and overdue pending quiz assignments for a user, using a table variable to stage assignments then computing date-based categorizations.","businessPurpose":"Drives the notification badge and pending quiz indicator counts displayed on the user's dashboard or 'Things To Do' section.","optimizationRecommendations":["The date categorization (new/normal/overdue) uses UPDATE on a table variable in multiple passes; consolidate into a single CASE expression in the INSERT.","The usf_GetUserLastLoginDetails function call adds overhead; consider caching the last login date in the user session context."],"migrationRelevance":"high"},{"name":"GetPendingQuizInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"13"},{"name":"@CurrentTime","dataType":"DATETIME","direction":"IN","defaultValue":"NULL"}],"lineCount":236,"tablesReferenced":["CME_Evaluation","CME_ScheduleTemplate","DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","Quiz_TimeLimit","SEC_MyEvalMainPageLinks","SEC_TimeZones","SEC_ToDoAdmQuizTocomplete"],"sprocsCalledFromBody":["usp_TraceMyEvalMainPageCounts"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetPendingQuizInfo"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves full pending quiz assignment information for a user's dashboard, computing overdue/new/normal categorization and enriching with quiz metadata, rotation info, and timezone-adjusted dates. Uses multiple temp tables.","businessPurpose":"Powers the 'Pending Quizzes' section of the user dashboard, showing all quizzes a user needs to complete with due dates and urgency indicators.","optimizationRecommendations":["Multiple UPDATE passes on the @QuizAssignments table variable to set status flags should be consolidated into a single CASE expression at insert time.","Timezone conversion via dbo.ConvertToDepartmentLocalDateTimeGlobal on every row is expensive; consider pre-computing once per department.","The SP is 15KB and mixes data retrieval, business logic, and presentation concerns — decompose for maintainability."],"migrationRelevance":"high"},{"name":"GetPendingQuizInfo_test","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"13"}],"lineCount":184,"tablesReferenced":["CME_Evaluation","CME_ScheduleTemplate","DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","Quiz_TimeLimit","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Test/development variant of GetPendingQuizInfo with minor differences in the query structure, not intended for production use.","businessPurpose":"Development testing variant of the pending quiz dashboard SP; should not be called in production.","optimizationRecommendations":["This SP should be removed from production and preserved in source control only.","Any changes from the main SP should be merged into GetPendingQuizInfo."],"migrationRelevance":"low"},{"name":"GetPointBiserialCorrelationCoefficient_Questions","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":310,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetPointBiserialforques"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes point-biserial correlation coefficients for each quiz question, measuring how well each item discriminates between high and low scorers, using temp tables and statistical aggregation.","businessPurpose":"Provides psychometric question discrimination analysis, helping administrators identify questions that effectively differentiate knowledge levels.","optimizationRecommendations":["The statistical computation (mean, standard deviation, correlation) across multiple temp table passes can be expressed as a single CTE chain using window functions.","Index on #TempQuizs and #TempUsers temp tables should be created immediately after population (fnSplit results)."],"migrationRelevance":"high"},{"name":"GetPointBiserialCorrelationCoefficient_Users","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":351,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetPointBiserialCorrelationCoefficientUsers"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes point-biserial correlation at the individual user level using temp tables (with explicit temp table indexes created) and complex statistical aggregations.","businessPurpose":"User-level psychometric discrimination analysis for quiz performance reporting.","optimizationRecommendations":["The SP explicitly creates an index on #TempQuizs — good practice; ensure similar indexes on all heavily-queried temp tables.","Multiple aggregation passes over the same #tblVal can be reduced by computing all aggregates in a single GROUP BY pass."],"migrationRelevance":"high"},{"name":"GetPointBiserialCorrelationCoefficient_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":386,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetPointBiserialCorrelationCoefficient_Usertypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes point-biserial correlation coefficients by user type using cursors, WHILE loops, and temp tables for the most complex variant of this psychometric calculation.","businessPurpose":"User-type-level psychometric discrimination analysis providing per-PGY-level question quality metrics.","optimizationRecommendations":["CURSOR over user types for statistical computation is a significant bottleneck; replace with set-based statistical aggregation grouped by UserTypeID.","The cursor-within-cursor pattern (if present) should be entirely eliminated in favor of window functions.","This is the highest complexity psychometric SP and should be evaluated for pre-computation into a summary table refreshed nightly."],"migrationRelevance":"high"},{"name":"GetPreceptorUserIDDetails","schema":"dbo","parameters":[],"lineCount":16,"tablesReferenced":["LA_Preceptors"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.FetchPreceptorUserIDDetails"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Returns the UserID of a preceptor associated with a specific user or rotation context — a single simple SELECT.","businessPurpose":"Used to look up preceptor assignments for quiz failure notification routing.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPValues_users","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":101,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetPValuesUsers"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Computes p-values (item difficulty indices) for each quiz question at the user level using temp tables and aggregated correct response rates.","businessPurpose":"Provides the p-value item difficulty metric in the Item Analysis report, where p-value represents the proportion of users answering correctly.","optimizationRecommendations":["The COUNT(*) / total calculation can be expressed as AVG(CAST(IsCorrect AS FLOAT)) in a single GROUP BY query rather than multi-step temp table population."],"migrationRelevance":"high"},{"name":"GetPValues_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":142,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetPValues_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes p-values (item difficulty) per user type using a cursor and temp tables to iterate over user type groups.","businessPurpose":"Provides user-type-segmented item difficulty metrics for the psychometric Item Analysis report.","optimizationRecommendations":["Replace CURSOR over user types with a set-based GROUP BY UserTypeID aggregation.","Conditional average (SUM(correct) / COUNT(total)) can be computed in a single pass."],"migrationRelevance":"high"},{"name":"GetQuestionAnswers","schema":"dbo","parameters":[{"name":"@QuestionID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@AnswerOrder","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Type","dataType":"INT","direction":"IN","defaultValue":null}],"lineCount":108,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves all questions with their answer options and the correct answer for a quiz, using a WHILE loop and temp table to build a structured result set for each question.","businessPurpose":"Supports the quiz review/answer key view for administrators, showing all questions with correct answers highlighted.","optimizationRecommendations":["The WHILE loop over questions is unnecessary; a single set-based JOIN of QUIZ_Questions, QUIZ_Answers, and QUIZ_CorrectAnswer achieves the same result.","The loop-based approach causes N+1 queries for each question."],"migrationRelevance":"medium"},{"name":"GetQuestionOptionPerc_new","schema":"dbo","parameters":[{"name":"@QuestionID","dataType":"int","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@AssignID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":105,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":true,"nolockCount":3,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetQuestions_newOverall"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Computes the percentage of users selecting each answer option for all questions in a quiz assignment, joining quiz answer data across multiple assignments.","businessPurpose":"Powers the answer option percentage breakdown in quiz analytics, showing which answer options were most frequently selected.","optimizationRecommendations":["Ensure composite index on (QuestionID, AnswerID) in QUIZ_UserAnsweredQuestion for efficient aggregation.","The ALL-assignments aggregation note (from code comments) indicates query scope changed; verify WHERE clause correctly captures intent."],"migrationRelevance":"high"},{"name":"GetQuestionOptionPerc_newold","schema":"dbo","parameters":[{"name":"@QuestionID","dataType":"int","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@AssignID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":104,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Older version of GetQuestionOptionPerc_new, retained as a reference or fallback. Body is nearly identical to the current version.","businessPurpose":"Legacy/backup version of the option percentage SP; should not be used in new code.","optimizationRecommendations":["This SP should be deprecated and removed; maintain only the current version in production."],"migrationRelevance":"low"},{"name":"GetQuestionOptionPerc_newOverall","schema":"dbo","parameters":[{"name":"@QuestionID","dataType":"int","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@AssignID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":149,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Computes answer option percentages aggregated across all assignments (overall view) rather than per-assignment, using a more extensive JOIN chain of 15 tables.","businessPurpose":"Provides the overall-mode option percentage report, aggregating all assignment data to show cumulative response distributions.","optimizationRecommendations":["The 15-JOIN query structure warrants index review across all joined tables.","Consider materializing the overall aggregation in a summary table updated on quiz submission rather than computing on demand."],"migrationRelevance":"high"},{"name":"GetQuestionOptionPerc_UserTypes","schema":"dbo","parameters":[{"name":"@QuestionId","dataType":"int","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"int","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@AssignId","dataType":"int","direction":"IN","defaultValue":null}],"lineCount":152,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetQuestionOptions_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes answer option selection percentages segmented by user type using a cursor and temp tables to produce per-user-type breakdowns.","businessPurpose":"Provides user-type-segmented answer option analysis in quiz reporting, showing how different training levels respond to questions differently.","optimizationRecommendations":["Replace cursor with set-based aggregation grouped by UserTypeID and AnswerID.","The pivot output can use dynamic PIVOT rather than cursor-driven column construction."],"migrationRelevance":"high"},{"name":"GetQuestionOptionPerc_UserTypes_Grids","schema":"dbo","parameters":[{"name":"@QuestionID","dataType":"int","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"int","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@AssignID","dataType":"int","direction":"IN","defaultValue":null}],"lineCount":161,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetQuestionOptionPerc_UserTypes_Grids"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format answer option percentage by user type using cursor and WHILE loop for column-based pivoting of the output.","businessPurpose":"Supports the grid-view rendering of user-type answer option percentages in quiz analytics.","optimizationRecommendations":["Use dynamic PIVOT instead of cursor-driven grid construction.","Consolidate intermediate temp table operations."],"migrationRelevance":"high"},{"name":"GetQuestionOptions","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["QUIZ_Answers","QUIZ_CorrectAnswer"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns all answer options for a specific question by joining QUIZ_Answers with QUIZ_Questions.","businessPurpose":"Used in the question editing UI to load the current answer options for a selected question.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuestions_new","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":130,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetQuestions"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves questions filtered by specialty, topic, department, and deletion status using a complex 36-JOIN query and temp table staging, including questions used in specific quizzes.","businessPurpose":"Powers the question bank browser used by administrators to search and select questions when building or editing quiz templates.","optimizationRecommendations":["The 36-JOIN query is unusually large; review for unnecessary joins and ensure all join columns are indexed.","Temp table usage for staging questions before final SELECT is a performance overhead; evaluate if a single multi-table query can replace it."],"migrationRelevance":"high"},{"name":"GetQuestions_newOverall","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":139,"tablesReferenced":[],"sprocsCalledFromBody":["GetQuestionOptionPerc_newOverall"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetQuestions_newOverall"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves questions in 'overall' mode (across all departments/specialties) using temp tables and WHILE loop iteration, with 18 JOINs.","businessPurpose":"Supports cross-department question browsing in the question bank, used when administrators build quizzes that draw from shared question pools.","optimizationRecommendations":["WHILE loop for question iteration should be replaced with set-based operations.","Reduce JOIN count by pre-aggregating related data in CTEs."],"migrationRelevance":"high"},{"name":"GetQuestionsBySpecialtyIdTopicId","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"BigNumber","direction":"IN","defaultValue":null}],"lineCount":102,"tablesReferenced":["QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuestionsBySpecialtyIdTopicId"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves questions filtered by specialty and topic IDs, using temp tables and WHILE loop for building the result set with answer option data.","businessPurpose":"Used in the quiz builder to filter the question bank by medical specialty and topic when an administrator is selecting questions.","optimizationRecommendations":["The WHILE loop for aggregating answer options per question should be replaced with a FOR XML PATH / STRING_AGG approach.","Temp table intermediary can be eliminated with a direct JOIN query."],"migrationRelevance":"medium"},{"name":"GetQuestionsDetails","schema":"dbo","parameters":[{"name":"@SELECTedQIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":105,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions","QUIZ_TemplateQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizQuestionsOptions"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Returns detailed question information including question text, answers, correct answer, specialty, topic, and audit fields, joining across 9 quiz-related tables.","businessPurpose":"Used in question administration screens to load complete question details for editing or viewing.","optimizationRecommendations":["Ensure indexes on QUIZ_Questions.SpecialtyID and QUIZ_Questions.TopicID for efficient filtering.","The SP returns multiple result sets; ensure the calling application handles them correctly."],"migrationRelevance":"medium"},{"name":"GetQuestionsDetailsInfo","schema":"dbo","parameters":[{"name":"@QuestionID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":36,"tablesReferenced":["QUIZ_Answers","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuestionsDetailsInfo"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns basic question metadata (ID, text, specialty, topic) for a specific question.","businessPurpose":"Used for lightweight question lookup, such as displaying a question title in a list or breadcrumb navigation.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizAccessStatus","schema":"dbo","parameters":[],"lineCount":61,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizAccessStatus"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Determines whether a user can access a specific quiz assignment based on date window, completion status, and assignment state. Returns an access status code.","businessPurpose":"Gate-keeper function called before allowing a user to start or continue a quiz, enforcing access window and completion rules.","optimizationRecommendations":["The multiple conditional SELECT paths with date comparisons should use CAST(GETDATE() AS DATE) instead of CONVERT string patterns for SARGability."],"migrationRelevance":"high"},{"name":"GetQuizAssignedToAndStatus","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":105,"tablesReferenced":["DH_ConferenceSchedules","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_TimeZones","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetQuizAssignedToAndStatus"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Returns the assignment recipients and completion status for a specific quiz assignment, using temp tables to stage user data with their completion and pass/fail status.","businessPurpose":"Powers the 'Assigned To' panel in the quiz assignment management UI, showing which users are assigned and their progress.","optimizationRecommendations":["Temp table staging for user status data can be replaced with a direct JOIN query using CASE for status derivation."],"migrationRelevance":"medium"},{"name":"GetQuizAssignmentAccessUsersLog","schema":"dbo","parameters":[],"lineCount":27,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentAccessUsersLog","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.GetQuizAssignmentAccessUsersLog"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves the access log records for a quiz assignment, joining log entries with user details across 4 tables.","businessPurpose":"Displays the audit trail of user access events in the quiz assignment management screen for administrator monitoring.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizAssignments","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SortyBy","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@DeletedQuizAssignments","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":378,"tablesReferenced":["DH_ConferenceSchedules","DH_DepartmentRotations","LA_LearningAssignments","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetQuizAssignments"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"The primary quiz assignment listing SP, retrieving all quiz assignments for a department with filtering, sorting, paging, and comprehensive join data across 43 tables. Handles academic year filtering, timezone conversion, and multiple assignment type contexts. 33KB body.","businessPurpose":"Powers the main Quiz Assignments administrative grid — the central screen where program administrators view, filter, and manage all quiz assignments for their department.","optimizationRecommendations":["The 43-JOIN query is the most JOIN-heavy in the module; review each join for necessity and ensure all join columns have appropriate indexes.","Pagination is implemented at the SP level — verify that TOP/OFFSET-FETCH or ROW_NUMBER pattern is used correctly rather than filtering all rows then discarding.","Timezone conversion applied per-row via dbo.ConvertToDepartmentLocalDateTimeGlobal is expensive; pre-compute for the department once.","The academic year filter branch (IF ISNULL(@AcademicYear, 0) <> 0) adds conditional complexity; consider separate SPs or a unified query with optional parameters."],"migrationRelevance":"high"},{"name":"GetQuizAssignments_20250630","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SortyBy","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@DeletedQuizAssignments","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":381,"tablesReferenced":["DH_ConferenceSchedules","DH_DepartmentRotations","LA_LearningAssignments","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Date-stamped backup of GetQuizAssignments (body essentially identical), created as a rollback snapshot before a scheduled modification.","businessPurpose":"Backup/rollback copy of the main quiz assignments SP; not for direct use.","optimizationRecommendations":["Remove from production and preserve in source control history instead.","Maintain a single canonical GetQuizAssignments SP."],"migrationRelevance":"low"},{"name":"GetQuizAssignmentsAndUsersByAssignmentID","schema":"dbo","parameters":[],"lineCount":174,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","SEC_DepartmentInstitution","SEC_InstitutionUsers","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetQuizAssignmentsAndUsersByAssignmentID"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves complete assignment details including all assigned users, their completion status, and scores for a specific assignment ID, using temp tables for user data staging and 24 JOINs.","businessPurpose":"Powers the quiz assignment detail view showing administrators all users in an assignment with their progress and results.","optimizationRecommendations":["Temp table staging for user data can be simplified to a direct JOIN query.","The 24-JOIN structure should be reviewed for redundant joins."],"migrationRelevance":"high"},{"name":"GetQuizAssignmentsByAssignmentID","schema":"dbo","parameters":[],"lineCount":79,"tablesReferenced":["DH_ConferenceSchedules","DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_TimeZones","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetQuizAssignmentsByAssignmentID"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves assignment configuration details for a specific assignment (dates, quiz settings, pass percentage, user types) using 7 JOINs.","businessPurpose":"Used to load an existing assignment's settings into the assignment edit form for administrator modifications.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetQuizAssignmentsforAuditTrail","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetQuizAssignmentsforAuditTrail"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves assignment change history records for audit trail display, joining assignment data with audit log entries.","businessPurpose":"Supports compliance and audit requirements by showing who created or modified quiz assignments and when.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetQuizAssignmentSummary_Pend","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@SelectedQuizID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns a summary of pending quiz assignments with counts and status breakdowns, using temp tables to stage and aggregate pending assignment data.","businessPurpose":"Drives summary statistics panels showing counts of pending assignments in the quiz administration dashboard.","optimizationRecommendations":["The temp table staging for pending counts can be replaced with a single GROUP BY aggregation query."],"migrationRelevance":"medium"},{"name":"GetQuizAutoClosedDetail","schema":"dbo","parameters":[{"name":"@EventID","dataType":"LongText","direction":"IN","defaultValue":null}],"lineCount":58,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_EventDetail","SEC_Events","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizUsers.cs.GetQuizClosedInof"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves details of quiz assignments that were auto-closed due to time limit expiration, joining across 13 tables for assignment, user, and quiz data.","businessPurpose":"Supports the auto-close monitoring view where administrators can see which timed-out assignments were automatically closed by the system.","optimizationRecommendations":["Ensure appropriate index on the auto-close timestamp column for efficient range queries."],"migrationRelevance":"medium"},{"name":"GetQuizCompletedDetails","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizCompletedDetails"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves completion details for a specific user assignment and updates the ReviewDate timestamp, combining a data fetch with a side-effect update.","businessPurpose":"Called when a user views their completed quiz results, recording that they reviewed the results while returning the score and completion data.","optimizationRecommendations":["Mixing a SELECT and a side-effect UPDATE in a reporting SP is a design concern; separate into distinct operations or use an explicit flag parameter to control the UPDATE."],"migrationRelevance":"medium"},{"name":"GetQuizCompletedStatus","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["QUIZ_AssignmentUsers","QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizCompletedStatus"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns the completion status (CompletedDate, score, pass/fail) for a user's quiz assignment by joining assignment and user tables.","businessPurpose":"Used to check if a user has completed a quiz assignment before showing result or retake options.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetQuizDetailsByQuizId","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizDetailsByQuizID"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns quiz template details (name, description, department, settings) for a specific QuizID.","businessPurpose":"Used to load quiz configuration for display or editing in the quiz template management screens.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizInformation","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":38,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizInformation"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns quiz assignment configuration information for a user, using a WHILE loop to handle multiple quiz IDs passed as a list.","businessPurpose":"Used to display quiz details to users on their assignment dashboard, showing quiz name, settings, and access window.","optimizationRecommendations":["WHILE loop for iterating quiz IDs from a list should be replaced with a set-based fnSplit/STRING_SPLIT approach."],"migrationRelevance":"medium"},{"name":"GetQuizList","schema":"dbo","parameters":[],"lineCount":16,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["QuizList.cs.FetchQuizList"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Returns a list of active (non-deleted) quiz templates for a department.","businessPurpose":"Populates quiz selection dropdowns in the assignment creation and reporting filter screens.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizModuleAssignmentEmailNoticeInformation","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentRotationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FirstName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@LastName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Email","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Title","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UserName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Password","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":"'abc'"}],"lineCount":246,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_EmailTemplate","QUIZ_Template","Quiz_TimeLimit","SEC_Departments","SEC_KeyTxtInfo","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["AssignmentUsersManager.cs.GetQuizModuleAssignmentEmailNoticeInformation"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Builds email notification payload for quiz module assignment events, using a cursor to iterate over assigned users and constructing per-user email data with HTML body content, login links, and assignment details.","businessPurpose":"Generates assignment notification emails for the Quiz Module specifically, handling complex email template construction with timezone-aware dates and user-specific login credentials.","optimizationRecommendations":["CURSOR over users for email construction should be replaced with a set-based query producing all user rows at once.","HTML email assembly in SQL (string concatenation) should be moved to the application layer.","The SP produces intermediate temp tables then discards them — consider returning the data directly."],"migrationRelevance":"high"},{"name":"GetQuizName","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentUsersManager.cs.FetchListOfQuizzes"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns the QuizName for a given QuizID from QUIZ_Template — a trivial single-row SELECT.","businessPurpose":"Used for display purposes in various screens that need to show a quiz's name given its ID.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizNameList","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetQuizNames"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Returns a list of quiz names and IDs filtered by department, for use in dropdown or search interfaces.","businessPurpose":"Populates quiz name search/filter controls in reporting and assignment interfaces.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizQuestions","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":211,"tablesReferenced":["PF_UserDocuments","QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion","Quiz_TimeLimit"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizQuestions"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves all questions for a quiz that a user is about to take, including their previously saved partial answers (if any), applying question ordering logic via temp tables and 36 JOINs. This is the primary quiz-taking data loader.","businessPurpose":"The core SP called when a user begins or resumes a quiz, loading all questions with their options and pre-filling any previously saved answers.","optimizationRecommendations":["The 36-JOIN complexity warrants careful index review — ensure all foreign key and filter columns are indexed.","Partial answer restoration logic using temp tables could be simplified with a LEFT JOIN on QUIZ_UserAnsweredQuestion.","Question ordering from stored order strings should be replaced with a proper order table for efficiency."],"migrationRelevance":"high"},{"name":"GetQuizQuestions_","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":170,"tablesReferenced":["PF_UserDocuments","QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion","Quiz_TimeLimit"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Development variant of GetQuizQuestions with minor differences, using 27 JOINs. Appears to be a working copy.","businessPurpose":"Development/test variant of the primary quiz question loader; not intended for production use.","optimizationRecommendations":["Remove from production and merge any useful changes into GetQuizQuestions.","Single-underscore suffix naming convention does not indicate versioning clearly."],"migrationRelevance":"low"},{"name":"GetQuizQuestions__","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":181,"tablesReferenced":["PF_UserDocuments","QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion","Quiz_TimeLimit"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Another development variant of GetQuizQuestions with double-underscore suffix, 29 JOINs. Likely a different iteration.","businessPurpose":"Secondary development variant of the quiz question loader; not for production use.","optimizationRecommendations":["Remove from production and consolidate to a single canonical SP.","Double-underscore suffix is not a meaningful versioning strategy."],"migrationRelevance":"low"},{"name":"GetQuizQuestions_backup","schema":"dbo","parameters":[{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":170,"tablesReferenced":["PF_UserDocuments","QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion","Quiz_TimeLimit"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Explicit backup copy of GetQuizQuestions (27 JOINs), retained as a fallback snapshot.","businessPurpose":"Rollback copy of the quiz question loader; not for direct use in production.","optimizationRecommendations":["Remove from production and preserve in source control history.","Using SP naming with _backup is an anti-pattern for version management."],"migrationRelevance":"low"},{"name":"GetQuizQuestionsOptions","schema":"dbo","parameters":[{"name":"@SELECTedQIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":70,"tablesReferenced":["QUIZ_Answers","QUIZ_CorrectAnswer","QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves question options in their display order for a quiz, using a cursor and WHILE loop to build an ordered options list with correct-answer flags.","businessPurpose":"Used to load the ordered answer options for each question when displaying or previewing a quiz.","optimizationRecommendations":["CURSOR for option ordering should be replaced with ROW_NUMBER() OVER (PARTITION BY QuestionID ORDER BY AnswerID) in a set-based query."],"migrationRelevance":"medium"},{"name":"GetQuizRedirectInfoAfterSubmission","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizStatus","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":120,"tablesReferenced":["LA_LearningAssignments","OBC_RequirementGroupLiteraturesDetails","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion"],"sprocsCalledFromBody":["UpdateLearningAssignmentReview"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizRedirectInfoAfterSubmission"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Determines where to redirect the user after quiz submission by checking assignment type, retake eligibility, and result display settings. Updates completion-related fields as a side effect.","businessPurpose":"Controls the post-quiz submission redirect flow — whether to show results, go to a retake screen, or return to the dashboard.","optimizationRecommendations":["Side-effect UPDATEs in a data-retrieval SP should be separated into a distinct SP or made explicit with a parameter."],"migrationRelevance":"high"},{"name":"GetQuizReminderForPartialCompleted","schema":"dbo","parameters":[],"lineCount":176,"tablesReferenced":["QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_UserAnsweredQuestion","SEC_Departments","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":["GetAttemptedQuizEmailTemplate"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["AssignmentUsersManager.cs.GetQuizReminderForPartialCompleted"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Processes partial-completion reminders by finding in-progress quiz assignments past a threshold date, updating their PartialCompletedDate, and triggering failure notifications to PDs. Uses temp table and WHILE loop.","businessPurpose":"Used by a scheduled job or triggered process to send reminder notifications to users who started but did not finish a quiz within the allowed timeframe.","optimizationRecommendations":["WHILE loop for iterating over partial assignments should be replaced with set-based UPDATE and notification queuing.","The notification trigger inside the loop causes N email-send operations; batch them and fire once."],"migrationRelevance":"high"},{"name":"GetQuizReport","schema":"dbo","parameters":[],"lineCount":114,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Generates a basic quiz performance report with pass/fail counts, average score, and completion rate, using temp tables and WHILE loop aggregation.","businessPurpose":"Powers simple quiz performance summary reports used by administrators for quick overview of assignment outcomes.","optimizationRecommendations":["WHILE loop aggregation should be replaced with a single GROUP BY query.","The pass/fail counts and average score are standard aggregates (COUNT/AVG) that do not require iterative computation."],"migrationRelevance":"medium"},{"name":"GetQuizResult","schema":"dbo","parameters":[{"name":"@AssignedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":255,"tablesReferenced":["QUIZ_Answers","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_Questions","QUIZ_Template","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetQuizResult"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves the complete quiz result for a user's submission including score, pass/fail, correct/incorrect counts, question-level detail, and updates the ReviewDate. Uses 20 JOINs and handles retake scenarios.","businessPurpose":"Drives the quiz results page shown to users immediately after submission, displaying their final score and outcome.","optimizationRecommendations":["The UpdateReviewDate side effect should be separated from the result retrieval query.","Ensure the 20-JOIN query has appropriate indexes on all join columns.","Score computation uses multiple nested subqueries; consolidate with CTEs."],"migrationRelevance":"high"},{"name":"GetQuizSharedTemplates","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetQuizSharedTemplates"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns a list of quiz templates that have been marked as shared (available to other departments).","businessPurpose":"Populates the shared quiz template list used when administrators browse templates from other departments to copy.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizTimeDetails","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["Quiz_TimeLimit"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentUsersManager.cs.FetchQuizTimeDetails"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves time limit and remaining time details for a timed quiz assignment.","businessPurpose":"Used to display and enforce quiz time limits, feeding the countdown timer on the quiz-taking interface.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetQuizTopicDetails","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":31,"tablesReferenced":["QUIZ_Questions","QUIZ_Topic"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EvaluationsTemplateManager.cs.GetQuizTopicDetails","DesignQuizManager.cs.GetDepartmentQuizTopicDetails"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns topic details (name, specialty association, status) for a specific topic ID, joining QUIZ_Topic with QUIZ_Specialty.","businessPurpose":"Used in topic management screens to load a topic's properties for editing.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizTopicsBySpecialtyID","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["QUIZ_Questions","QUIZ_Topic"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizTopicsBySpecialtyID"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns all active topics for a given specialty ID, optionally cleaning up or filtering deleted records before returning the list.","businessPurpose":"Populates the Topic dropdown when a specialty is selected in quiz builder or question management screens.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizUserAssignmentLog","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":44,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","Quiz_AssignmentUsersLog","Quiz_TimeLimit"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizUserAssignmentLog"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves the log of a user's quiz assignment history, including access events and completion timestamps, joining assignment log tables across 4 tables.","businessPurpose":"Provides the administrator's view of a specific user's quiz engagement history for a given assignment.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetQuizViewDetailsInfo","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":88,"tablesReferenced":["QUIZ_Template","QUIZ_TemplateQuestion"],"sprocsCalledFromBody":["GetQuestionsDetails"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizViewDetailsInfo"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves complete quiz template details (name, description, questions, options, correct answers) for administrator preview, using a cursor to build the structured question list.","businessPurpose":"Powers the quiz preview/view screen that administrators use before publishing or assigning a quiz.","optimizationRecommendations":["CURSOR for building the question list should be replaced with a set-based JOIN query returning all questions and their options in a single result set.","The FOR XML PATH pattern or STRING_AGG can aggregate answer options per question."],"migrationRelevance":"medium"},{"name":"GetReviewCompletedQuizInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"},{"name":"@SelectedQuizId","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"},{"name":"@StartIndex","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@PageSize","dataType":"LargeNumber","direction":"IN","defaultValue":"10"}],"lineCount":468,"tablesReferenced":["DH_DepartmentRotations","LA_Preceptors","LA_Trainee","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_UserAnsweredQuestion","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":true,"nolockCount":12,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetQuizReviewURL"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves comprehensive completed quiz data for a user's review page including all questions, their answers, correct answers, explanations, and metadata, using 36 JOINs and temp tables for pagination.","businessPurpose":"Powers the detailed quiz review screen where users can go back after completion to see each question, their answer, the correct answer, and explanations.","optimizationRecommendations":["The 36-JOIN query should be analyzed for redundant joins; many may be moved to separate queries or CTEs.","Pagination logic using temp tables and ROW_NUMBER should be validated for correctness and efficiency.","Consider pre-computing explanation and answer data at submission time rather than re-joining on review."],"migrationRelevance":"high"},{"name":"GetReviewCompletedQuizInfo1","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"}],"lineCount":434,"tablesReferenced":["DH_DepartmentRotations","LA_Preceptors","LA_Trainee","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer","QUIZ_Template","SEC_TimeZones"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":12,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Variant of GetReviewCompletedQuizInfo (23KB vs 25KB) with minor differences, likely an earlier iteration preserved as a fallback.","businessPurpose":"Backup/variant of the quiz review data loader; evaluate if it is still in use before deprecation.","optimizationRecommendations":["Consolidate with GetReviewCompletedQuizInfo into a single canonical SP.","The numbered suffix naming does not provide meaningful versioning information."],"migrationRelevance":"medium"},{"name":"GetSpecialtyIdsDropDown","schema":"dbo","parameters":[],"lineCount":24,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetSpecialtyIdsDropDown"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns active specialties for a department for use in dropdown lists, filtering out deleted/disabled records.","businessPurpose":"Populates the Specialty dropdown in question filtering and quiz builder screens.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetStandardDeviationVariance_users","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":112,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetStandardDeviationVarianceUsers"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Computes standard deviation and variance of quiz scores at the individual user level, using temp tables and aggregation functions across 11 JOINs.","businessPurpose":"Provides standard deviation and variance metrics in the quiz psychometric reports for individual user analysis.","optimizationRecommendations":["SQL Server's native STDEV() and VAR() aggregate functions should be used directly instead of manual multi-pass computation.","A single GROUP BY with STDEV(score), VAR(score) replaces the multi-temp-table pattern."],"migrationRelevance":"high"},{"name":"GetStandardDeviationVariance_users_grids","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":78,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetStandardDeviationVarianceUsers_Grid"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format standard deviation and variance for users, structuring the output for tabular display with temp table staging.","businessPurpose":"Powers the grid-view rendering of standard deviation/variance in user-level quiz analytics.","optimizationRecommendations":["Use native STDEV()/VAR() with GROUP BY instead of multi-pass computation.","Simplify temp table usage to a single intermediary."],"migrationRelevance":"high"},{"name":"GetStandardDeviationVariance_UserTypes","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":111,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetStandardDeviationVariance_UserTypes"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Computes standard deviation and variance segmented by user type using a cursor and temp tables for iterative calculation per user type group.","businessPurpose":"Provides user-type-level standard deviation/variance metrics for quiz performance analytics.","optimizationRecommendations":["Replace cursor with GROUP BY UserTypeID and native STDEV()/VAR() aggregate functions.","Eliminate cursor-driven accumulation pattern entirely."],"migrationRelevance":"high"},{"name":"GetStandardDeviationVariance_UserTypes_grid","schema":"dbo","parameters":[{"name":"@deptid","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@QuizId","dataType":"varchar(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@userid","dataType":"varchar(8000)","direction":"IN","defaultValue":null}],"lineCount":70,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetStandardDeviationVariance_UserTypes_grid"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Grid-format standard deviation and variance by user type using cursor and WHILE loop for pivoted output.","businessPurpose":"Supports the grid-view standard deviation/variance report by training level.","optimizationRecommendations":["Use native aggregate functions and dynamic PIVOT instead of cursor-driven grid construction."],"migrationRelevance":"high"},{"name":"GetSubmittedQuizResult","schema":"dbo","parameters":[{"name":"@AssignedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":234,"tablesReferenced":["CME_Evaluation","CME_Events","CME_ScheduleTemplate","CME_Templates","QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetSubmittedQuizResult"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves the quiz result after submission including question-by-question correct/incorrect detail, total score, and pass/fail status, joining 28 tables for comprehensive result data.","businessPurpose":"Used on the immediate post-submission result screen to show users their detailed quiz outcome before they are redirected.","optimizationRecommendations":["The 28-JOIN query should be profiled under load to identify the most expensive joins.","Consider caching computed quiz results at submission time into a QUIZ_Results summary table to avoid expensive re-computation on result view."],"migrationRelevance":"high"},{"name":"GetSummaryQuizAssignmentsResult","schema":"dbo","parameters":[{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelQuizIds","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SelUserIds","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@SessId","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@OrderbyColumn","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@SelRotationId","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Module","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@FlagArchived_text","dataType":"VeryShortText","direction":"IN","defaultValue":"'no'"}],"lineCount":865,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_UserAnsweredQuestionsLOG","Quiz_TempSummaryQuizReport","SEC_DepartmentInstitution","SEC_InstitutionUsers","SEC_Institutions","SEC_TimeZones","SEC_Users"],"sprocsCalledFromBody":["GetQuizNameList","GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetSummaryQuizAssignmentsResult","GetQuizReportData.cs.GetSampleData"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"The largest SP in the module at 58KB. Generates the comprehensive Summary Quiz Performance Report by aggregating scores, pass/fail counts, averages, and group statistics across multiple dimensions (department, rotation, user type, PGY level), using WHILE loops, temp tables, and extensive multi-table processing.","businessPurpose":"Powers the flagship Summary Quiz Assignments Results report — the primary executive-level report that program directors use to evaluate overall quiz performance across cohorts.","optimizationRecommendations":["The WHILE loops should be replaced with set-based aggregation with GROUP BY; this is the single highest-impact optimization in the module.","The multiple temp table phases (create, insert, compute, insert, return) should be consolidated into a CTE chain.","Consider pre-aggregating quiz submission data into a nightly summary table to avoid on-demand computation of this report.","The SP's 58KB size indicates it is doing too much; decompose into sub-SPs for staging, computation, and output."],"migrationRelevance":"high"},{"name":"GetSummaryQuizAssignmentsResult_V2","schema":"dbo","parameters":[{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelQuizIds","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SelUserIds","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@SessId","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@OrderbyColumn","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@SelRotationId","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Module","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":1060,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_UserAnsweredQuestionsLOG","Quiz_TempSummaryQuizReport","SEC_DepartmentInstitution","SEC_InstitutionUsers","SEC_TimeZones","SEC_Users"],"sprocsCalledFromBody":["GetQuizNameList","GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Optimized V2 of GetSummaryQuizAssignmentsResult (52KB) with documented improvements: replaced repeated Split function calls with variable table population at the top, and removed unnecessary ORDER BY clauses from intermediate inserts.","businessPurpose":"Improved version of the Summary Quiz Performance Report SP, potentially the current production version with better performance characteristics.","optimizationRecommendations":["Further optimization possible by replacing remaining WHILE loops with set-based GROUP BY aggregations.","Verify this V2 is the version in active use and retire the original GetSummaryQuizAssignmentsResult if so.","The variable table pre-population optimization is good; extend this pattern to all repeated subqueries in the SP."],"migrationRelevance":"high"},{"name":"GetSummaryQuizAssignmentsResult1","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelQuizIds","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SelUserIds","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@SessId","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@OrderbyColumn","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@SelRotationId","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":169,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_CorrectAnswer","QUIZ_Template","QUIZ_UserAnsweredQuestion","SEC_Users"],"sprocsCalledFromBody":["GetQuizName","GetQuizNameList","GetRotationIDNameDetails","GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Simplified variant of the summary quiz report (7.9KB) with fewer dimensions, likely a focused sub-report or an earlier iteration.","businessPurpose":"Provides a simplified summary quiz results view, possibly used in a specific reporting context or legacy screen.","optimizationRecommendations":["Evaluate whether this simplified version is still used or can be retired in favor of the V2 SP."],"migrationRelevance":"medium"},{"name":"GetUserGradeReports","schema":"dbo","parameters":[{"name":"@deptID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"VARCHAR(8000)","direction":"IN","defaultValue":null}],"lineCount":135,"tablesReferenced":["QUIZ_Answers","QUIZ_Assignment","QUIZ_CorrectAnswer","QUIZ_Questions","QUIZ_Template","QUIZ_TemplateQuestion","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["GetQuizReportData.cs.GetUserGradeReports"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves user grade data from quiz assignments for grade reporting, using temp tables, WHILE loops, and 18 JOINs to compile scores across multiple assignment types.","businessPurpose":"Powers the User Grade Reports screen, providing administrators with a grade-book-style view of user quiz performance.","optimizationRecommendations":["WHILE loop for iterating assignment grades should be replaced with a set-based aggregation query.","Ensure proper indexes on the scoring and date filter columns."],"migrationRelevance":"high"},{"name":"GetUserNameByUserTypeIDs","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SortBy","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":92,"tablesReferenced":["SEC_Departments","SEC_Users"],"sprocsCalledFromBody":["GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetUserNameByUserTypeIDs"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Returns user names and IDs for specified user type IDs, using temp tables to stage user type lists before joining user data.","businessPurpose":"Used in quiz reporting filters to resolve user type IDs into user lists for display in report parameters.","optimizationRecommendations":["Temp table staging for user type IDs can be replaced with a direct JOIN using fnSplit or TVP."],"migrationRelevance":"low"},{"name":"GetUserPgyPeriodsList","schema":"dbo","parameters":[],"lineCount":26,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetCompletedQuizInfo"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns a list of PGY (post-graduate year) period records for a user — a single SELECT.","businessPurpose":"Used in quiz analytics to populate PGY period filters for reports that segment performance by training year.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetUsersFullNameDetails","schema":"dbo","parameters":[],"lineCount":17,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetSelectedUsersFullNameDetails"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"Returns user full name details (first name, last name, display name) for one or more user IDs.","businessPurpose":"Used across quiz reporting and notification screens to resolve user IDs into display names.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetUserTypeDetails","schema":"dbo","parameters":[],"lineCount":26,"tablesReferenced":["SEC_UserTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["GetDetailsManager.cs.GetUserTypeDetails","GetQuizUsers.cs.GetUserTypeList","UserManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns user type configuration details (name, level, settings) for a specific user type ID.","businessPurpose":"Used to resolve user type identifiers into human-readable labels and configuration in quiz assignment and reporting screens.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetVoluntaryQuizzes","schema":"dbo","parameters":[],"lineCount":42,"tablesReferenced":["QUIZ_Template","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.GetVoluntaryQuizzes"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Returns available voluntary quizzes for a user — quizzes that are self-service (not administrator-assigned) and accessible within the current date window.","businessPurpose":"Powers the voluntary quiz catalog shown to users who can self-select quizzes to take for self-directed learning.","optimizationRecommendations":["Date window filter should use CAST(GETDATE() AS DATE) rather than string conversion for SARGability."],"migrationRelevance":"medium"},{"name":"ImportQuestionsFromExcel","schema":"dbo","parameters":[{"name":"@Doc","dataType":"XML","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":300,"tablesReferenced":["QUIZ_Specialty","QUIZ_Topic"],"sprocsCalledFromBody":["AddNewQuestionOptionsWithCorrectAnswer"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.ImportQuestionsFromExcel"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Imports quiz questions from an XML-structured Excel export, parsing question text, options, correct answers, specialty, and topic via XML shredding, then inserting into QUIZ_Questions, QUIZ_Answers, and QUIZ_CorrectAnswer with duplicate detection and WHILE loop processing.","businessPurpose":"Allows administrators to bulk-import quiz questions from Excel files, a common workflow for seeding question banks from external sources.","optimizationRecommendations":["The XML-based import with WHILE loop row-by-row processing should use OPENXML or XQuery set-based methods for batch insertion.","Duplicate detection inside the WHILE loop (SELECT before each INSERT) creates N+1 query patterns; use MERGE or INSERT WHERE NOT EXISTS.","Error handling should be wrapped in TRY/CATCH with transaction management to ensure partial imports are rolled back."],"migrationRelevance":"high"},{"name":"InsertQuizInfoInDepts","schema":"dbo","parameters":[],"lineCount":96,"tablesReferenced":["QUIZ_Answers","QUIZ_CorrectAnswer","QUIZ_QuestionAnswersBase","QUIZ_Questions","QUIZ_QuestionsBase","QUIZ_Specialty","QUIZ_SpecialtyBase","QUIZ_Topic","QUIZ_TopicBase","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Inserts quiz assignment records for multiple departments, using a WHILE loop to iterate over department IDs and checking for existing assignments before inserting new ones with 9 JOINs for context data.","businessPurpose":"Used when rolling out a quiz across multiple departments simultaneously, creating per-department assignment records in batch.","optimizationRecommendations":["The WHILE loop over departments should be replaced with a set-based INSERT ... SELECT with NOT EXISTS duplicate check.","The INSERT-if-not-exists pattern inside a loop is a classic candidate for MERGE statement replacement."],"migrationRelevance":"high"},{"name":"InsertVoluntaryQuizInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RotationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"Decimal","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"verySmallNumber","direction":"IN","defaultValue":null},{"name":"@AssignedByID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"verySmallNumber","direction":"IN","defaultValue":null}],"lineCount":58,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.InsertVoluntaryQuizInfo"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Creates a voluntary quiz assignment record for a user who self-selects a quiz to take, inserting into QUIZ_Assignment and QUIZ_AssignmentUsers.","businessPurpose":"Called when a user clicks to start a voluntary quiz, creating the necessary assignment records for tracking completion.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"ReviewQuizInfo1","schema":"dbo","parameters":[],"lineCount":8,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.ReviewQuizInfo1"],"complexity":"trivial","aiEnrichment":null,"module":"QUIZ","summary":"A minimal SP (212 chars) that appears to return basic quiz info for review mode — essentially a stub or placeholder.","businessPurpose":"Possibly a placeholder or minimal helper SP used in the quiz review workflow; needs investigation of active call sites.","optimizationRecommendations":["The minimal body suggests this may be a stub that was never fully implemented or is now superseded; audit usage and remove if not called."],"migrationRelevance":"low"},{"name":"SaveOnCallQuizAssignmentDetails","schema":"dbo","parameters":[{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentRotationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@AssignedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"Varchar(MAX)","direction":"IN","defaultValue":null}],"lineCount":158,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Departments"],"sprocsCalledFromBody":["GetEmailInformation","GetRowValuesToString"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Saves on-call (emergency/call schedule) quiz assignment details into staging tables, using temp tables and multiple conditional INSERT paths for different user/schedule scenarios.","businessPurpose":"Supports on-call schedule integration where quiz assignments are automatically generated based on on-call scheduling data.","optimizationRecommendations":["Temp table staging with conditional INSERTs can be simplified into direct parameterized INSERTs.","Reduce the 31 SELECT statements by combining related lookups into single queries."],"migrationRelevance":"high"},{"name":"saveONcallQuizAssignments_New","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@RotationIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UserTypeId","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@AssignedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":319,"tablesReferenced":["DH_AmionScheduleRotationAssignments","DH_DepartmentRotations","DH_LightingBoltPersonnel","DH_LightingBoltRotations","DH_LightingBoltSchedule","DH_LightingBoltScheduleRange","DH_LightingBoltTasks","DH_MomentumSchedule","DH_MomentumTaskRoles","DH_QGendaSchedule","DH_QgendaScheduleEntry","DH_QgendaTaskRoles","DH_SyncAMIONRotations","DH_SyncAMIONUsers","Momentum_Assignments","Prep_BuildSchedules","Prep_TraineeReSchedulecalendar","Prep_TraineeReSchedulecalendarData","Prep_TraineeSchedulecalendar","Prep_TraineeSchedulecalendarData","SEC_Departments","SEC_DepartmentsAmionCredentials","SEC_DepartmentsLightningBoltCredentials","SEC_DepartmentsMECServiceCredentials","SEC_DepartmentsMomentumCredentials","SEC_DepartmentsQGendaCredentials","SEC_Users"],"sprocsCalledFromBody":["SaveOnCallQuizAssignmentDetails"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.saveONcallQuizAssignments"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Processes on-call quiz assignments from AMION schedule data, matching on-call rotations to users and creating quiz assignment records. Uses WHILE loops and temp tables for multi-user assignment processing with email notification support.","businessPurpose":"The primary on-call quiz assignment SP that ties the AMION on-call scheduling system to quiz assignments, automatically assigning quizzes to users when they have on-call shifts.","optimizationRecommendations":["The 42-JOIN query for matching on-call users to assignments indicates complex cross-system data integration; ensure all join columns have indexes.","WHILE loop over assignment batches should be replaced with set-based INSERT using JOIN-based matching.","The SP name uses camelCase inconsistently; standardize naming conventions."],"migrationRelevance":"high"},{"name":"SaveQuizAssignmentDetails","schema":"dbo","parameters":[{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentRotationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@NumberOfTimesRetakeAllowed","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@AssignedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@MaxTimeLimitID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@IsAdminPDGAsUsers","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":335,"tablesReferenced":["DH_DepartmentRotations","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Departments","SYS_SystemNotificationSettings"],"sprocsCalledFromBody":["AddSysBroadcastNotification","GetEmailInformation","SaveQuizAuditTrailInfo"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.SaveQuizAssignmentDetails"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Saves a new quiz assignment with all configuration details (users, dates, pass percentage, answer display settings), using temp tables to process user lists and conditional logic for different assignment types.","businessPurpose":"Primary SP for creating quiz assignments from the administrator UI, handling all assignment configuration including user targeting, date windows, and notification settings.","optimizationRecommendations":["Temp table usage for user list staging can be replaced with TVP (table-valued parameter) for cleaner parameter passing.","The 36 SELECT statements indicate extensive data lookup — consolidate related reads into single queries.","Ensure transaction wrapping around the INSERT sequence for atomicity."],"migrationRelevance":"high"},{"name":"SubmitQuizUserAssignmentLog","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ExitDateTime","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@BrowserDetails","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@Errors","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Exemptions","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizStatus","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@AttemptedTime","dataType":"ShortText","direction":"IN","defaultValue":"''"}],"lineCount":32,"tablesReferenced":["Quiz_AssignmentUsersLog"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.SubmitQuizUserAssignmentLog"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Records a quiz submission event in the assignment log, capturing submission timestamp and status.","businessPurpose":"Creates an audit log entry when a user submits a quiz, supporting completion tracking and compliance requirements.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"SubmitUserAnsweredQuestionByQuestionID","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedAnswerID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AnswerOrder","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuestionOrderIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":88,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.SubmitUserAnsweredQuestionByQuestionID"],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Saves or updates a user's answer for a single quiz question (used in auto-save/per-question submission mode), upserting into QUIZ_UserAnsweredQuestion.","businessPurpose":"Supports the per-question answer saving feature in timed or auto-save quiz mode, preserving answers as users progress through questions.","optimizationRecommendations":["The INSERT/UPDATE upsert pattern should use a MERGE statement for clarity and atomicity.","Ensure proper indexes on (UserAssignmentID, QuestionID) in QUIZ_UserAnsweredQuestion for efficient upsert lookups."],"migrationRelevance":"high"},{"name":"SubmitUserAnsweredQuestions","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AnswerIDList","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AnswerOrderList","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AssignedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionDisplayOrder","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@SubmitType","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":322,"tablesReferenced":["QUIZ_Answers","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_Questions","QUIZ_Template","QUIZ_UserAnsweredQuestion","QUIZ_UserAnsweredQuestionsLOG"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.SubmitUserAnsweredQuestions"],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Processes final quiz submission: saves all user answers to QUIZ_AttemptedUserAnsweredQuestion, calculates the score against correct answers, determines pass/fail, and marks the assignment as completed. Uses temp tables for batch answer processing.","businessPurpose":"The core quiz submission handler — called when a user clicks 'Submit Quiz', persisting all answers, computing the final score, and marking completion.","optimizationRecommendations":["Batch answer INSERT into QUIZ_AttemptedUserAnsweredQuestion using a set-based INSERT ... SELECT from the temp table.","Score calculation iterating over answers in temp tables should use a single SUM(CASE WHEN correct) aggregation.","Ensure the completion UPDATE to QUIZ_AssignmentUsers is wrapped in a transaction with the answer inserts."],"migrationRelevance":"high"},{"name":"UpdateActiveQuizQuestions","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":49,"tablesReferenced":["QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateActiveQuizQuestions"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Marks specified quiz questions as active (IsDisabled=0) and removes their soft-delete flag, then updates the quiz template's modified timestamp.","businessPurpose":"Used in the question management UI to restore previously disabled or soft-deleted questions back to active status.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateDeleteQuizQuestions","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuestionID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":49,"tablesReferenced":["QUIZ_Questions"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateDeleteQuizQuestions"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Soft-deletes quiz questions by setting IsDeleted=1 and IsDisabled=1, then updates the quiz template's modified timestamp.","businessPurpose":"Used to remove questions from a quiz template without permanently deleting them from the question bank, supporting soft-delete workflows.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateDeleteQuizStatus","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateDeleteQuizStatus"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Soft-deletes a quiz template and its associated question links by setting IsDeleted=1, then clears shared status.","businessPurpose":"Used when an administrator deletes a quiz template from the system, preserving the data but removing it from active use.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdateInActiveQuizQuestions","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateInActiveQuizQuestions"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Marks specified quiz questions as inactive (IsDisabled=1) without deleting them.","businessPurpose":"Allows administrators to temporarily disable quiz questions without removing them from the question bank.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateNonVoluntaryQuizTemplate","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":36,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateNonVoluntaryQuizTemplate"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Updates the IsVoluntary flag on a quiz template to make it non-voluntary (mandatory), along with related assignment settings.","businessPurpose":"Used when converting a quiz template from self-service to mandatory assignment mode.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateOBCQuizCompleteddate","schema":"dbo","parameters":[{"name":"@LearningAssignmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DateAdded","dataType":"Largedate","direction":"IN","defaultValue":null},{"name":"@AddedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":68,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Updates the OBC (On-Board Curriculum) quiz completion date when a linked quiz is completed, using temp tables and WHILE loop to match OBC learning assignments to quiz completions.","businessPurpose":"Synchronizes quiz completion data back to the OBC learning assignment tracking system when a quiz linked to an OBC curriculum item is completed.","optimizationRecommendations":["WHILE loop for updating OBC completions should be replaced with a set-based UPDATE with JOIN.","Temp table staging for OBC assignment matching can be replaced with a direct correlated UPDATE."],"migrationRelevance":"medium"},{"name":"UpdatePublishStatusForQuiz","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdatePublishStatusForQuiz"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Toggles the published/draft status of a quiz template, enabling it to appear in assignment screens.","businessPurpose":"Controls whether a quiz template is visible for assignment, supporting a draft-to-published workflow in quiz administration.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateQuizAnswerID","schema":"dbo","parameters":[],"lineCount":197,"tablesReferenced":["QUIZ_Answers","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Repairs or updates stored answer IDs in quiz user response records, using WHILE loops over questions and users to remap answer IDs where they have become stale or invalid after question edits.","businessPurpose":"Data maintenance SP used to fix answer ID references in QUIZ_UserAnsweredQuestion when questions are edited and answer option IDs change.","optimizationRecommendations":["The nested WHILE loops (question × user) are O(n×m) row-by-row processing; replace with a set-based UPDATE JOIN.","This SP appears to be a data fix utility — ensure it is not called in real-time user flows."],"migrationRelevance":"medium"},{"name":"UpdateQuizAnswerOrder","schema":"dbo","parameters":[],"lineCount":95,"tablesReferenced":["QUIZ_Answers","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Updates the stored answer ordering strings in quiz response records to correct invalid or stale ordering data after questions are modified, using WHILE loop and temp table processing.","businessPurpose":"Data maintenance SP to correct answer order data in user response tables when the underlying question structure has changed.","optimizationRecommendations":["The answer order as a stored string is a design anti-pattern; migrate to a proper answer order table to eliminate the need for this maintenance SP.","WHILE loop should be replaced with set-based UPDATE."],"migrationRelevance":"medium"},{"name":"UpdateQuizAssignmentDetails","schema":"dbo","parameters":[{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentRotationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PassPercentage","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@NumberOfTimesRetakeAllowed","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@AnswersDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@AssignedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AccessDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@DueDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@MaxTimeLimitID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@QuestionDisplay","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncryptText","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequirementGroupAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@Timezone","dataType":"LargeText","direction":"IN","defaultValue":"'EST'"}],"lineCount":246,"tablesReferenced":["DH_DepartmentRotations","LA_LearningAssignments","OBC_RequirementGroupAssignment","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","SEC_Departments","SEC_TimeZones"],"sprocsCalledFromBody":["GetEmailInformation","SaveQuizAuditTrailInfo","UpdateOBCEditRecordByID"],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateQuizAssignmentDetails"],"complexity":"very-complex","aiEnrichment":null,"module":"QUIZ","summary":"Updates an existing quiz assignment's configuration (dates, pass percentage, users, answer display settings) and processes user additions/removals, using temp tables for new user staging and 5 JOINs for context.","businessPurpose":"Primary SP for modifying existing quiz assignments from the administrator UI, handling date changes, user list updates, and setting modifications.","optimizationRecommendations":["The user list update pattern (delete-then-reinsert) should be replaced with a MERGE statement identifying additions and removals.","Temp table staging for new users can be replaced with TVP parameter handling."],"migrationRelevance":"high"},{"name":"UpdateQuizRemainingTime","schema":"dbo","parameters":[{"name":"@UserAssignmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AttemptedTime","dataType":"ShortText","direction":"IN","defaultValue":"''"}],"lineCount":32,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["DesignQuizManager.cs.UpdateQuizRemainingTime"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Updates the remaining time for a timed quiz, either initializing it on first access or decrementing it as the user progresses.","businessPurpose":"Manages the countdown timer state for timed quizzes, persisting remaining time to support page refreshes and session continuity.","optimizationRecommendations":["The UPSERT pattern (check-then-insert-or-update) should use a MERGE statement for atomicity under concurrent access."],"migrationRelevance":"medium"},{"name":"UpdateQuizSpecialtyDetails","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["QUIZ_Specialty"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateQuizSpecialtyDetails"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Updates a quiz specialty's name and properties in QUIZ_Specialty.","businessPurpose":"Used in the specialty management UI to rename or update a specialty category.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateQuizTemplate","schema":"dbo","parameters":[{"name":"@QuizID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@QuizName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizTopDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@QuizBottomDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Updates a quiz template's basic metadata (name, descriptions, department) in QUIZ_Template.","businessPurpose":"Used when an administrator edits a quiz template's basic properties without changing its questions.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateQuizTopicDetails","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["QUIZ_Topic"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateQuizTopicDetails"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Updates a quiz topic's name in QUIZ_Topic.","businessPurpose":"Used in the topic management screen to rename an existing topic category.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateRestoreQuizQuestions","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TopicID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateRestoreQuizQuestions"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Restores soft-deleted quiz questions by clearing IsDeleted and IsDisabled flags.","businessPurpose":"Allows administrators to restore previously deleted questions in the quiz question bank.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateSharedQuizStatus","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@QuizID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":36,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateSharedQuizStatus"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Updates the shared/private status of a quiz template, controlling whether it can be copied by other departments.","businessPurpose":"Used in the quiz template management UI to toggle sharing of quiz templates across departments.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateTimeLimtQuizStatus","schema":"dbo","parameters":[],"lineCount":128,"tablesReferenced":["QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_AttemptedUserAnsweredQuestion","QUIZ_Template","QUIZ_UserAnsweredQuestion","Quiz_AssignmentUsersLog","Quiz_TimeLimit","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Auto-closes quiz assignments where the time limit has expired, marking assignments as completed or expired for users who did not submit in time. Uses temp tables with 12 JOINs to identify affected assignments.","businessPurpose":"Powers the timed quiz enforcement mechanism — a scheduled job calls this SP to automatically close timed-out quiz sessions and record the outcome.","optimizationRecommendations":["Ensure appropriate index on the AccessedDateTime column for efficient expired session detection.","The two-phase temp table approach (identify then update) can be replaced with a direct UPDATE with JOIN.","This SP is likely called by a SQL Agent job; document the schedule and ensure it is idempotent."],"migrationRelevance":"high"},{"name":"UpdateToDeleteQuizStatus","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateToDeleteQuizStatus"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Marks a quiz assignment user record as soft-deleted, setting IsDeleted=1.","businessPurpose":"Used to remove a specific user from a quiz assignment without hard-deleting the record.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateVoluntaryQuizTemplate","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["QUIZ_Template"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AssignmentInfoManager.cs.UpdateVoluntaryQuizTemplate"],"complexity":"simple","aiEnrichment":null,"module":"QUIZ","summary":"Updates a quiz template's IsVoluntary flag to mark it as a voluntary (self-service) quiz.","businessPurpose":"Used to convert a quiz template to voluntary mode, making it available for user self-selection.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"usp_RefreshPerformanceQuizDetails_API","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":69,"tablesReferenced":["MYEval_PerformanceQuizDetails","QUIZ_Answers","QUIZ_Assignment","QUIZ_AssignmentUsers","QUIZ_Template","QUIZ_TemplateQuestion","QUIZ_UserAnsweredQuestion"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"QUIZ","summary":"Retrieves current quiz assignment status data for performance monitoring refresh, joining QUIZ_Template, QUIZ_Assignment, QUIZ_AssignmentUsers, and QUIZ_TemplateQuestion to return completion/expiry status with correct answer IDs. Called by an API endpoint.","businessPurpose":"Powers a performance dashboard API that shows real-time quiz completion status for monitoring and analytics purposes.","optimizationRecommendations":["The correlated subquery using STUFF/FOR XML PATH to concatenate AnswerIDs runs once per row; replace with a pre-aggregated JOIN or use STRING_AGG (SQL Server 2017+).","The TOP 1 subquery for correct answer is also a per-row operation; join QUIZ_CorrectAnswer directly."],"migrationRelevance":"high"},{"name":"usp_UpdateQUIZ_QuestionsJob","schema":"dbo","parameters":[],"lineCount":57,"tablesReferenced":["QUIZ_Questions"],"sprocsCalledFromBody":["usp_QuizQuestionFormatedText"],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"QUIZ","summary":"Batch-processes up to 50,000 quiz questions to populate the Question_HTMLFormat column by calling usp_QuizQuestionFormatedText to strip unnecessary HTML from question text. Designed to run as a SQL Agent job.","businessPurpose":"Data migration/maintenance job that normalizes HTML formatting in quiz question text, separating the raw HTML format from a cleaned version for consistent rendering.","optimizationRecommendations":["The WHILE loop over 50,000 rows is inherently slow; consider processing in smaller batches with a batch size parameter and job scheduling.","The SP processes only questions with NULL Question_HTMLFormat; ensure an index exists on (Question_HTMLFormat) to make the WHERE clause efficient.","Add error handling (TRY/CATCH) around the UPDATE inside the loop to prevent a single bad question from stopping the entire batch."],"migrationRelevance":"medium"}]}