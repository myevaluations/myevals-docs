{"module":"SYS","displayName":"System","procedureCount":117,"procedures":[{"name":"AddDepartmentMessageNotification","schema":"dbo","parameters":[],"lineCount":48,"tablesReferenced":["SEC_MailMessage","SEC_UserMailMessage","SYS_MobileAppSettings","SYS_NotificationModuleSettings","SYS_NotificationModules"],"sprocsCalledFromBody":["AddSysNotification"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Checks whether a user has enabled the 'dept_message' notification module, then constructs a push notification with an MD5-hashed deep-link URL and dispatches it via AddSysNotification.","businessPurpose":"Delivers in-app and mobile push notifications when a new department message is sent to a user, supporting the internal messaging feature used by programs to communicate with trainees and faculty.","optimizationRecommendations":["The OUTER APPLY + IF NOT EXISTS pattern re-reads SYS_NotificationModules on every invocation; cache the enabled notification list or index Code and UserID together for faster early-exit.","MD5 hashing via [master].[dbo].[fn_varbintohexstr](HASHBYTES()) is non-deterministic per call; consider pre-computing or caching URL tokens where possible."],"migrationRelevance":"medium"},{"name":"AddEvaluationNotification","schema":"dbo","parameters":[],"lineCount":62,"tablesReferenced":["SYS_MobileAppSettings","SYS_NotificationModuleSettings","SYS_NotificationModules"],"sprocsCalledFromBody":["AddSysNotification"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Verifies whether the 'evaluation' notification module is enabled for a user, resolves the correct mobile app host based on the current database name (stage vs. production), and fires AddSysNotification with a deep-link to the evaluation completion screen.","businessPurpose":"Sends a push notification to a trainee or evaluator when a new evaluation assignment is created, ensuring timely completion of clinical assessments within the MyEvaluations platform.","optimizationRecommendations":["The DB_NAME() check to switch between stage and production hosts is a fragile hard-coded environment flag; replace with a setting row in SYS_MobileAppSettings or a system-level configuration table.","The TOP 1 SELECT for @NotificationModuleSettingsID is un-ordered; add ORDER BY to make the result deterministic.","OUTER APPLY + NOT EXISTS on SYS_NotificationModules/Settings lacks a covering index on (NotificationModuleID, UserID); add one to avoid table scans on large notification settings tables."],"migrationRelevance":"medium"},{"name":"AddHelpChapters","schema":"dbo","parameters":[{"name":"@ContentID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@SectionID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ParentID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@AccessLevel","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.AddHelpChapters"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts or updates a help chapter record in Help_Contents based on whether a ContentID is provided, then returns the SectionID.","businessPurpose":"Manages the hierarchical help chapter structure in the MyHelp documentation system, used by administrators to author and organise in-application help content accessible to users by role.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddHelpPageContents","schema":"dbo","parameters":[{"name":"@ContentID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@NodeName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@KeyValue","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@ParentIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@AccessLevel","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":253,"tablesReferenced":["HELP_Contents","HELP_PageRelations"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.AddHelpPageContents","SectionInfoBusiness.cs.GetHelpChapterInfoByContentID"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Manages the full lifecycle of a help page within the Help_Contents tree: splits a pipe-delimited parent ID list, deletes removed parent associations, inserts new parent node copies, and updates existing ones, all within a single transaction using cursor-based iteration.","businessPurpose":"Supports the MyHelp content authoring workflow, allowing administrators to assign or reassign help pages to multiple chapters/sections simultaneously within the in-app help system.","optimizationRecommendations":["Three CURSOR iterations (DIFF_ITEM_CUR, NEW_ITEM_CUR11, COMMON_ITEM_CUR) over small derived tables can be replaced with set-based MERGE or INSERT/DELETE statements, dramatically reducing round-trip overhead.","The GOTO PROBLEM pattern for error handling should be replaced with TRY/CATCH blocks, which are the SQL Server standard and provide cleaner, more reliable rollback semantics.","The NULL comparison 'IF @MIN_SEED!=NULL' is always false in T-SQL; should be 'IF @MIN_SEED IS NOT NULL' — this is a latent bug.","The string-splitting approach using CHARINDEX/LEFT/RIGHT loops should use the table-valued dbo.fnSplit or STRING_SPLIT (SQL Server 2016+) for clarity and performance.","Using @@IDENTITY instead of SCOPE_IDENTITY() in AddMyHelpSection is unsafe; this SP uses SCOPE_IDENTITY() which is correct, but the old @@IDENTITY usage in Help_Contents insert in AddMyHelpSection should be reviewed."],"migrationRelevance":"low"},{"name":"AddHelpSections","schema":"dbo","parameters":[{"name":"@SectionID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SecName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@IsActive","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":84,"tablesReferenced":["HELP_Sections"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.AddHelpSections"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Creates or updates a help section in HELP_Sections and its corresponding root folder in Help_Contents, preventing duplicate section names via a uniqueness check before committing.","businessPurpose":"Allows administrators to create and manage top-level sections within the MyHelp in-application documentation system, which is used to organize help content by subject area for end users.","optimizationRecommendations":["The GOTO PROBLEM error handling should be replaced with TRY/CATCH blocks.","A unique constraint on HELP_Sections.Name would enforce the duplicate check at the database level rather than requiring an application-level EXISTS check inside a transaction."],"migrationRelevance":"low"},{"name":"AddLearningAssgnmentNotification","schema":"dbo","parameters":[],"lineCount":68,"tablesReferenced":["LA_LearningAssignments","LA_Literature","SYS_MobileAppSettings","SYS_NotificationModuleSettings","SYS_NotificationModules"],"sprocsCalledFromBody":["AddSysNotification"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Checks whether the 'learning_assignment' notification module is enabled for a user, then builds a push notification with assignee and assigner details and calls AddSysNotification with a deep-link to the learning assignment.","businessPurpose":"Notifies trainees when they are assigned a learning resource (literature/article) in the Learning Assignment module, driving timely completion of educational activities.","optimizationRecommendations":["Same DB_NAME() stage/production environment flag issue as AddEvaluationNotification; centralise this in a settings table.","The SELECT TOP 1 for @NotificationModuleSettingsID where NotificationModuleID = 2 is hard-coded; the module ID should be resolved by Code name to avoid coupling to a primary key value."],"migrationRelevance":"medium"},{"name":"AddMailMergeCustomTemplate","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@MailMergeTemplateID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TemplateName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Message","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@OrderOfDepartment","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@IsIncludeDepartment","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@SortOrder","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":41,"tablesReferenced":["SEC_MailMergeCustomFieldTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.AddMailMergeCustomTemplate","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts a new custom mail-merge field template or updates an existing one in SEC_MailMergeCustomFieldTemplateInfo, returning the template ID.","businessPurpose":"Enables department administrators to create and manage custom mail-merge templates used for personalised communication to residents, faculty, or staff from within the platform.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddMailMergeTemplate","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@MailMergeTemplateID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TemplateName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Message","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":37,"tablesReferenced":["SEC_MailMergeTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.AddMailMergeTemplate","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts or updates a standard mail-merge template in SEC_MailMergeTemplateInfo based on the provided MailMergeTemplateID, returning the ID upon completion.","businessPurpose":"Provides CRUD support for department-level mail-merge message templates used to generate personalised bulk communications within the MyEvaluations platform.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddMyHelpSection","schema":"dbo","parameters":[{"name":"@Name","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@IsActive","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@AccessLevel","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":["HELP_Contents","HELP_Sections"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SectionsGroupManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts a new help section into HELP_Sections and creates its root Help_Contents folder entry within a transaction, returning the new ContentID.","businessPurpose":"Supports the legacy MyHelp section creation workflow; functionally superseded by AddHelpSections but may still be called from older ASP code paths.","optimizationRecommendations":["Uses @@IDENTITY instead of SCOPE_IDENTITY() for the HELP_Contents insert, which is unsafe if triggers are present on HELP_Sections.","GOTO PROBLEM error handling should be replaced with TRY/CATCH.","The procedure is missing a BEGIN keyword wrapper, relying on the outer SP boundary; this is fragile."],"migrationRelevance":"low"},{"name":"AddPdInboxNotification","schema":"dbo","parameters":[],"lineCount":64,"tablesReferenced":["SYS_MobileAppSettings","SYS_NotificationModuleSettings","SYS_NotificationModules"],"sprocsCalledFromBody":["AddSysNotification"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Verifies that the 'pd_inbox' notification module is active for a user, then constructs a notification linking to the evaluation details page and dispatches it through AddSysNotification.","businessPurpose":"Alerts program directors or reviewers when an evaluation is ready for their review in the PD Inbox, supporting the evaluation review workflow central to GME assessment.","optimizationRecommendations":["Same environment-detection via DB_NAME() issue as other notification SPs; should use a settings table.","Hard-coded NotificationModuleID = 2 duplicated across multiple notification SPs; should resolve by Code."],"migrationRelevance":"medium"},{"name":"AddSysBroadcastNotification","schema":"dbo","parameters":[{"name":"@UserIDs","dataType":"varchar(max)","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["SYS_Notifications","SYS_UserNotificationSettings"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts notification rows into SYS_Notifications for a list of comma-separated user IDs, filtering to only those users who have notifications enabled in SYS_UserNotificationSettings.","businessPurpose":"Supports system-wide or batch broadcast notifications sent to a specific set of users (e.g. announcements, alerts), used by administrative workflows to reach multiple users simultaneously.","optimizationRecommendations":["The dbo.fnSplit scalar function on @UserIDs with a CAST to BIGINT is executed row-by-row; replacing with STRING_SPLIT or a table-valued parameter would be more efficient for large user lists.","No deduplication guard — if the same UserID appears multiple times in @UserIDs, duplicate notifications will be inserted despite the DISTINCT on SPL.UserID."],"migrationRelevance":"medium"},{"name":"AddSysNotification","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["SYS_Notifications","SYS_UserNotificationSettings"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts a single notification record into SYS_Notifications for a given user, but only if that user has notifications enabled in SYS_UserNotificationSettings.","businessPurpose":"Core notification insertion primitive called by all domain-specific notification SPs (evaluation, learning assignment, messages, etc.) to queue notifications for mobile and desktop delivery.","optimizationRecommendations":["SELECT TOP 1 FROM SYS_UserNotificationSettings without ORDER BY is non-deterministic; add ORDER BY or use an EXISTS check instead of SELECT TOP 1.","The INSERT ... SELECT TOP 1 pattern will silently insert nothing if the user has no enabled notification settings, with no error returned to the caller; callers cannot distinguish 'inserted' from 'skipped'."],"migrationRelevance":"high"},{"name":"AddTrainingEvents","schema":"dbo","parameters":[{"name":"@EventTitle","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EventDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@MaxRegistrations","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventStartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EventEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@RegistrationStartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@RegistrationEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@IsClosed","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FileName","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":61,"tablesReferenced":["SEC_TrainingEvents","SEC_TrainingMeals"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.Save","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Inserts a new training event record into SEC_TrainingEvents and populates a fixed set of 12 meal menu options across three days in SEC_TrainingMeals, returning the new EventID.","businessPurpose":"Creates a new training seminar/conference event that users can register for within the platform, including pre-seeding standard meal menu options used during multi-day events.","optimizationRecommendations":["The 12 individual INSERT statements for meal options should be replaced with a single multi-row INSERT or an INSERT ... SELECT from a lookup table, reducing round trips.","Hard-coded meal names in the SP create a maintenance burden; these should be seeded from a configuration table rather than embedded in procedural code."],"migrationRelevance":"low"},{"name":"AddTrainingSeminar","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@InstName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@DepartmentName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@FirstName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@LastName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Address","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@City","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@State","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@Zip","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EMail","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Phone","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CreditCard","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CreditCardNumber","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ExpDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CVNCode","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@ChargeAmount","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FullName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@BillingAddress","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Status","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@Comments","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@LastUserUpdate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@LastSysUpdate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@MealDay1","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@MealDay2","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@MealDay3","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PaymentType","dataType":"ShortText","direction":"IN","defaultValue":"null"},{"name":"@CheckNumber","dataType":"ShortText","direction":"IN","defaultValue":"null"},{"name":"@CheckDate","dataType":"ShortText","direction":"IN","defaultValue":"null"}],"lineCount":85,"tablesReferenced":["SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.Save","MessageDistributionManager.cs.SavetrainingSeminar"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Inserts a new training seminar registration record for a user into SEC_TrainingSeminar, including payment details, meal selections, and attendance type, returning the new TrainingID.","businessPurpose":"Handles event registration submissions from users signing up for MyEvaluations training conferences, capturing attendee details, payment information, and meal preferences.","optimizationRecommendations":["Stores credit card number, CVN code, and expiry date in plain text in the database (CreditCardNumber, CVNCode, ExpDate columns); this is a PCI-DSS compliance risk and should be reviewed.","The empty-string check for @CheckDate using CASE WHEN @CheckDate='' THEN NULL is fragile; should use NULLIF(@CheckDate,'') for clarity."],"migrationRelevance":"low"},{"name":"CheckEmailStatus","schema":"dbo","parameters":[],"lineCount":27,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":1,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EmailValidation.cs.CheckEmailStatus"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Looks up whether an email address is verified, rejected, or unverified for platform users, with special-case logic for known internal MyEvaluations email addresses.","businessPurpose":"Used during user login or communication workflows to determine whether a user's email address has been verified, allowing the platform to gate certain features or send verification prompts.","optimizationRecommendations":["Hard-coded internal email addresses (sales@, support@, jivadev@) in the CASE statement are a maintenance liability; these should be stored in a configuration table.","Multiple EXISTS/CASE branches against vSEC_Users without index hints may result in repeated view scans; ensure MainEmail is indexed on the underlying tables.","The TOP 1 ... ORDER BY pattern in the DECLARE section uses un-ordered vSEC_Users scan; this was refactored to use ORDER BY ISNULL(MainEmailStatus,0) DESC, IsArchived DESC in the newer SP body, which is correct."],"migrationRelevance":"low"},{"name":"CheckEventEmailStatus","schema":"dbo","parameters":[],"lineCount":40,"tablesReferenced":["CME_UploadList"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":true,"nolockCount":4,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EmailValidation.cs.CheckEventEmailStatus"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Checks whether a given email address is verified, rejected, or unverified by querying vSEC_Users, with special-casing for known internal platform email addresses.","businessPurpose":"Validates registrant email addresses during training event registration to prevent unverified or bounced email addresses from completing the sign-up process.","optimizationRecommendations":["Same hard-coded internal email address maintenance issue as CheckEmailStatus.","Multiple sequential IF EXISTS / ELSE branches against the same view (vSEC_Users) could be collapsed into a single SELECT with CASE, reducing view evaluations from potentially 3 to 1."],"migrationRelevance":"low"},{"name":"CheckMailDistributionTemplateName","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["SEC_MailDistributionTemplateSection"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.CheckMailDistributionTemplateName","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all mail distribution template section records matching a given template name to allow duplicate name detection.","businessPurpose":"Provides a uniqueness check for mail distribution template names before allowing administrators to create or rename a template in the system.","optimizationRecommendations":["Returning SELECT * instead of a specific column or a scalar COUNT/EXISTS forces the caller to inspect the result set to determine uniqueness; a simple IF EXISTS / SELECT 1 approach would be cleaner.","A unique constraint on TemplateName in SEC_MailDistributionTemplateSection would enforce this at the database level."],"migrationRelevance":"low"},{"name":"CMEEVENTFORNONUSER","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@AdministratorID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@EvaluationScheduleID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@EventTypeID","dataType":"verySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"2016"}],"lineCount":573,"tablesReferenced":["CME_Events","CME_ScheduleTemplate","CME_ScheduleTemplateTopics","CME_Templates","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.CMEEVENTFORNONUSER","MessageDistributionManager.cs"],"complexity":"very-complex","aiEnrichment":null,"module":"SYS","summary":"Retrieves CME evaluation assignment lists for non-authenticated (outside) users based on schedule, event, department, and academic year filters, applying the same complex academic-year date range logic and topic counting as the authenticated equivalent.","businessPurpose":"Supports CME (Continuing Medical Education) event registration and evaluation access for external, non-user participants who need to view or complete evaluations without a full platform account.","optimizationRecommendations":["The procedure is extremely long and contains large conditional branches (academic year vs. non-academic year, multiple event type filters); splitting into targeted sub-procedures or table-valued functions would improve maintainability.","Uses dbo.RetrieveDepartments() scalar/TVF repeatedly; ensure this function is properly indexed and optimised.","PRINT @DateCheck is left in the body from debugging; should be removed from production code.","Multiple temp table creation/drop cycles within a single long procedure increase tempdb pressure; consolidate where possible."],"migrationRelevance":"medium"},{"name":"DeleteEmailFromBounceList","schema":"dbo","parameters":[],"lineCount":41,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.DeleteEmailFromBounceList","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Resets the email bounce and verification status flags for all user accounts associated with a given email address that has been marked as bounced, iterating user-by-user in a loop.","businessPurpose":"Allows administrators to re-enable email delivery to users whose email addresses were previously flagged as bounced (e.g. after a temporary delivery failure is resolved), restoring notification capability.","optimizationRecommendations":["The row-by-row loop using a temp table and identity counter is unnecessary; the updates to SEC_Users, SEC_MailMessage, and SCHE_ApplicationEmailSchedules can all be performed as set-based UPDATE statements joining on the email address directly.","Updating SCHE_ApplicationEmailSchedules.IsMailSent to 0 for historical sent emails may unintentionally cause emails to be re-sent; intent should be reviewed carefully before any migration."],"migrationRelevance":"medium"},{"name":"DeleteHelpChaptersByContentID","schema":"dbo","parameters":[{"name":"@ContentID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.DeleteHelpChaptersByContentID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Soft-deletes a help chapter by setting IsActive = 0 in Help_Contents for the given ContentID and SectionID, then returns the SectionID.","businessPurpose":"Allows administrators to remove help chapters from the MyHelp documentation tree without permanently destroying the record, supporting content management within the in-app help system.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteHelpPageByContentID","schema":"dbo","parameters":[{"name":"@ContentID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["HELP_Contents","HELP_PageRelations"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.DeleteHelpPageByContentID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Soft-deletes a help page (sets IsActive = 0) in HELP_Contents and removes its relationship records from HELP_PageRelations for the given ContentID.","businessPurpose":"Removes a help page from the active documentation tree while preserving the record, used by administrators managing in-application help content.","optimizationRecommendations":["Deletes from HELP_PageRelations only on PageID = @ContentID, but RelatePageID links may be orphaned; consider also cleaning up WHERE RelatePageID = @ContentID."],"migrationRelevance":"low"},{"name":"DeleteHelpSectionInfoBySecID","schema":"dbo","parameters":[],"lineCount":20,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.DeleteHelpSectionInfoBySecID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Soft-deletes a help section and all its associated contents by setting IsDeleted = 1 in both HELP_Sections and Help_Contents for the given SectionID.","businessPurpose":"Allows administrators to retire an entire help section along with its contents without permanently removing the data, preserving the historical content hierarchy.","optimizationRecommendations":["Commented-out hard DELETE statements are still present in the code and should be cleaned up to avoid confusion."],"migrationRelevance":"low"},{"name":"DeleteMailDistributionTemplate","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["SEC_MailDistributionTemplateSection"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.DeleteMailDistributionTemplate","MessageDistributionManager.cs"],"complexity":"trivial","aiEnrichment":null,"module":"SYS","summary":"Permanently deletes all section records for a given mail distribution template from SEC_MailDistributionTemplateSection.","businessPurpose":"Removes a mail distribution template from the system when an administrator deletes it through the Mail Distribution Template management interface.","optimizationRecommendations":["A hard DELETE with no soft-delete flag means there is no recovery path if a template is accidentally deleted; consider adding an IsDeleted flag consistent with other mail template tables."],"migrationRelevance":"low"},{"name":"DeleteMailMergeCustomTemplates","schema":"dbo","parameters":[{"name":"@MailMergeTemplateID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["SEC_MailMergeCustomFieldTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.DeleteMailMergeCustomTemplates","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Soft-deletes or restores a custom mail-merge field template by toggling its IsDelete flag in SEC_MailMergeCustomFieldTemplateInfo.","businessPurpose":"Allows administrators to archive or recover custom mail-merge templates from the Template management page without permanently removing the data.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteMailMergeTemplates","schema":"dbo","parameters":[{"name":"@MailMergeTemplateID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["SEC_MailMergeTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.DeleteMailMergeTemplates","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Soft-deletes or restores a standard mail-merge template by toggling its IsDeleted flag in SEC_MailMergeTemplateInfo.","businessPurpose":"Manages the lifecycle of standard mail-merge message templates, allowing administrators to remove or reinstate templates used for bulk department communications.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteMessages","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@MessageID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":10,"tablesReferenced":["SEC_Message"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MessageDistributionManager.cs.DeleteMessage"],"complexity":"trivial","aiEnrichment":null,"module":"SYS","summary":"Soft-deletes or restores a department message by setting the IsDeleted flag on the SEC_Message record matching the given MessageID and DepartmentID.","businessPurpose":"Supports message management in the department messaging feature, allowing department administrators or users to archive or recover internal messages.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteMyHelpSection","schema":"dbo","parameters":[],"lineCount":29,"tablesReferenced":["HELP_Contents","HELP_Sections"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SectionsGroupManager.cs.Delete"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Permanently deletes a help section and all its contents from HELP_Sections and HELP_Contents within a transaction, returning the SectionID on success or rolling back on error.","businessPurpose":"Provides a hard-delete capability for help sections in the legacy MyHelp system, used when a section needs to be completely removed rather than soft-deleted.","optimizationRecommendations":["GOTO PROBLEM error handling should be replaced with TRY/CATCH.","Deleting all Help_Contents for a SectionID cascades without checking for PageRelations orphans; HELP_PageRelations should also be cleaned up."],"migrationRelevance":"low"},{"name":"DeleteTrainingEvents","schema":"dbo","parameters":[],"lineCount":17,"tablesReferenced":["SEC_TrainingEvents","SEC_TrainingMeals"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.Delete","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Permanently deletes a training event and all its associated meal records from SEC_TrainingEvents and SEC_TrainingMeals for the given EventID.","businessPurpose":"Removes a cancelled or erroneous training event from the system, including all associated meal configuration data.","optimizationRecommendations":["Does not check for or delete associated SEC_TrainingSeminar registration records; orphaned registrations may remain if not handled by a foreign key constraint or separate cleanup."],"migrationRelevance":"low"},{"name":"DeleteTrainingSeminar","schema":"dbo","parameters":[],"lineCount":22,"tablesReferenced":["SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.Delete","MessageDistributionManager.cs.DeletePayeeList"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Permanently deletes a single training seminar registration record from SEC_TrainingSeminar by TrainingID.","businessPurpose":"Allows administrators to remove a specific event registration, for example when a registrant cancels or is removed from a training event.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"EventRegistrationMail","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":163,"tablesReferenced":["EVAL_EmailTemplate","SEC_TrainingEvents","SEC_TrainingMeals","SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.EventRegistrationMail","MessageDistributionManager.cs.CMEEventRegistrationMail"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Builds a personalised HTML email for a user who has registered for a training event by substituting template placeholders with event details, dates, meal selections, and registration status, then returns the rendered HTML, recipient address, and subject.","businessPurpose":"Generates the confirmation email sent to users upon successful registration for a MyEvaluations training conference, including event schedule, meal choices, and attendance type (live or virtual).","optimizationRecommendations":["The WHILE loop for building day-by-day event date details and meal lookups executes repeated SELECT statements inside a loop; replace with a single set-based query joining #EventDates with meal tables.","Multiple individual SELECT statements to fetch @EventName, @EventDays, @EventDates, etc. from SEC_TrainingEvents could be combined into a single SELECT.","The fn_GetReplacedHTML scalar function is called 10+ times in series, each potentially re-scanning the template string; a single pass replacement approach would be more efficient.","Uses a temp table (#EventDates) that must be explicitly dropped; consider using a table variable for simpler cleanup."],"migrationRelevance":"low"},{"name":"EventSalesMail","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":63,"tablesReferenced":["EVAL_EmailTemplate","SEC_TrainingEvents","SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":1,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.EventSalesMail","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Constructs an HTML notification email for the MyEvaluations sales team when a user registers for a training event, populating template placeholders with registrant and event details.","businessPurpose":"Automatically notifies the sales team about new training event registrations, enabling follow-up and logistical coordination for in-person or virtual training seminars.","optimizationRecommendations":["Multiple individual column SELECTs from SEC_TrainingEvents could be combined into a single SELECT statement.","fn_GetReplacedHTML is called multiple times sequentially; same optimisation concern as EventRegistrationMail."],"migrationRelevance":"low"},{"name":"GetActiveDepartmentList","schema":"dbo","parameters":[],"lineCount":25,"tablesReferenced":["SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["AnnualProgramEvaluationManager.cs.GetActiveDepartmentList","MailDistributionManager.cs.GetDepartmentListForSystemAdmin","MyEvaluations.Business.Security/MessageDistributionManager.cs","DepartmentManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns a sorted list of active, non-closed department IDs and names from SEC_Departments, filtering out disabled departments and those with names beginning with 'Closed:'.","businessPurpose":"Populates department selection dropdowns across various platform modules, ensuring only currently active programs are presented to users for assignment, evaluation, or reporting purposes.","optimizationRecommendations":["The LIKE 'Closed:%' filter combined with IsDisabled = 0 may miss departments marked closed with different naming conventions; data quality should be enforced with an explicit IsDisabled flag rather than name pattern matching."],"migrationRelevance":"medium"},{"name":"GetAdminListByDepartmentID","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"}],"lineCount":40,"tablesReferenced":["SEC_DepartmentInstitution","SEC_InstitutionUsers","SEC_Privileges","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetAdminListByDepartmentID","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Returns a list of administrator users for a given department by combining role-based administrators (those with view privilege on submodule 627) with institution-linked users, with access level filtering based on the calling user's role.","businessPurpose":"Populates administrator selection lists used when assigning or escalating tasks to department administrators or institution-linked users within the platform.","optimizationRecommendations":["The subquery 'SELECT DISTINCT RoleID FROM SEC_Privileges WHERE submoduleid=627 AND EnableView <> 0' is evaluated for every row in the UNION; materialise it into a temp table or CTE for better performance.","The UNION ALL does not deduplicate; if a user is both a role-based admin and an institution-linked user, they appear twice in results."],"migrationRelevance":"medium"},{"name":"GetAllMailMergeCustomTemplates","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["SEC_MailMergeCustomFieldTemplateInfo","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetAllMailMergeCustomTemplates","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Retrieves all custom mail-merge field templates for a given department and deletion status, joined with the creating user's name.","businessPurpose":"Populates the custom mail-merge template management grid for department administrators, showing available templates for personalised bulk communications.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetAllMailMergeTemplates","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["SEC_MailMergeTemplateInfo","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetAllMailMergeTemplates","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all standard mail-merge templates for a given department filtered by deletion status, joined with the creator's name.","businessPurpose":"Populates the standard mail-merge template list for department administrators to select and use when composing personalised bulk emails.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetAllTrainingEvents","schema":"dbo","parameters":[{"name":"@StartIndex","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@PageSize","dataType":"INT","direction":"IN","defaultValue":"0"}],"lineCount":82,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetAllTrainingEvents","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Retrieves all training events with registration counts and availability, supports server-side pagination via StartIndex/PageSize, and returns a page of results from a temp table ordered by registration start date.","businessPurpose":"Drives the training events administration grid, displaying all events with registration status, capacity, and open/closed indicators for system administrators managing the training calendar.","optimizationRecommendations":["Calls dbo.GetNoOfRegistrationByEventID() scalar function per row in the initial SELECT INTO #Results, causing N+1 function invocations; replace with a subquery or JOIN to COUNT(TrainingID) FROM SEC_TrainingSeminar.","The pagination logic is duplicated verbatim twice in the procedure body (IF @StartIndex=1 / ELSE blocks appear twice); one copy should be removed.","INSERT INTO #Results using ROW_NUMBER() then SELECT WHERE Rno BETWEEN is the correct pattern, but the row-number approach can be replaced with OFFSET/FETCH NEXT in SQL Server 2012+ for cleaner pagination."],"migrationRelevance":"low"},{"name":"GetAllTrainingEventsForTrainingSeminar","schema":"dbo","parameters":[{"name":"@IsOutsideRegistration","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetAllTrainingEventsForTrainingSeminar","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all open training events (IsClosed <> 1) from SEC_TrainingEvents, optionally filtered by outside registration flag, with registration counts for each event.","businessPurpose":"Populates the event list presented to users registering for training seminars, showing only currently open events that are available for public or internal registration.","optimizationRecommendations":["Uses dbo.GetNoOfRegistrationByEventID() scalar function per row, causing N+1 scalar invocations; replace with a subquery joining SEC_TrainingSeminar.","The CASE for IsOutsideRegistration filtering could be replaced with a cleaner WHERE clause: WHERE IsClosed <> 1 AND (IsOutsideRegistration = 1 OR @IsOutsideRegistration = 0)."],"migrationRelevance":"low"},{"name":"GetApplicationEmailSend","schema":"dbo","parameters":[],"lineCount":85,"tablesReferenced":["SCHE_ApplicationEmailSchedules","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["ApplicationEmailSchedule.cs.GetApplicationEmailSend"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Fetches up to 1000 unsent email queue records from SCHE_ApplicationEmailSchedules, excluding closed/disabled department emails and specific hard-coded department IDs, using a UNION to also include user-deletion emails, ordered by priority.","businessPurpose":"Drives the email sending scheduler that polls for queued outgoing emails across all departments and application modules, filtering out excluded departments and already-sent records to ensure reliable email dispatch.","optimizationRecommendations":["The hard-coded list of ~80+ excluded DepartmentIDs embedded in the WHERE clause is a critical maintenance liability; these should be stored in a dedicated exclusion table (e.g. SCHE_EmailExcludedDepartments) and joined.","The UNION of two identical TOP 1000 queries with only a minor WHERE difference (ApplicationSendMailMethodNumber=7000) creates significant query plan overhead; consider a single query with conditional filtering.","Scalar functions dbo.udfnGetDepartmentNameByDepartmentID and dbo.GetUserFullNameByCriteria were replaced with inline JOINs (noted in modification history), which is the correct optimisation.","The #ClosedDepartments temp table is recreated on every scheduler poll; if the department list is large, this adds overhead — consider caching or indexing SEC_Departments.IsDisabled.","TOP 1000 with no deterministic ORDER BY in the subquery means different emails may be selected on each run; add a consistent ORDER BY (e.g. ApplicationEmailScheduleID ASC) before applying the priority ORDER."],"migrationRelevance":"high"},{"name":"GetAvailableCompetenciesByTemplate","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubjectID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TargetID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@Shared","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"}],"lineCount":67,"tablesReferenced":["EVAL_Audiences","EVAL_QuestionsCategories","EVAL_TemplateQuestion","EVAL_Templates","Eval_BaseAudience","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EvaluationsReportManager.cs.GetAvailableCompetencies","MyEvaluations.Business.Evaluations/MailDistributionManager.cs","MyEvaluations.Business.Mail/MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Returns a list of question categories (competencies) available for a given audience, subject, and optionally filtered by a specific template and department, supporting shared template access across linked departments.","businessPurpose":"Populates the competency selection interface when building or editing evaluation templates, allowing coordinators to browse available question categories relevant to their audience and program.","optimizationRecommendations":["Uses dbo.RetrieveDepartments() TVF to build #LinkedDepartments; ensure this function is optimised and indexed.","The #audience temp table is built via a three-way UNION with a dynamic CASE expression in the WHERE clause; a CTE might be cleaner and allow better query plan caching.","The IsNull(TemplateID, NULL) = IsNull(@TemplateID, IsNull(TemplateID, NULL)) construct is overly convoluted and should be rewritten as (TemplateID = @TemplateID OR @TemplateID IS NULL)."],"migrationRelevance":"medium"},{"name":"GetAvailableSeminars","schema":"dbo","parameters":[],"lineCount":31,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetAvailableSeminars","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all open training events (IsClosed <> 1) with registration counts and available openings, sorted by event title.","businessPurpose":"Powers the available seminars listing page for users browsing and registering for training events, showing capacity and availability information.","optimizationRecommendations":["Uses dbo.GetNoOfRegistrationByEventID() and dbo.GetNoOfOpeningsbyEventID() scalar functions per row; replace with inline aggregates for better performance."],"migrationRelevance":"low"},{"name":"GetCategoryandOsDetails","schema":"dbo","parameters":[{"name":"@Type","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":33,"tablesReferenced":["SEC_OperatingSystemSupport","SEC_SystemCategory"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCategoryandOsDetails","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Retrieves support ticket category types and operating system/browser details from SEC_SystemCategory and SEC_OperatingSystemSupport based on the specified type parameter.","businessPurpose":"Populates the support request form with relevant category and system environment options so users can accurately describe their technical environment when submitting help requests.","optimizationRecommendations":["Returns three result sets from a single SP call, which can complicate ORM/data access layer handling; consider separating into targeted procedures or a lookup API."],"migrationRelevance":"low"},{"name":"GetChaptersTreeView","schema":"dbo","parameters":[],"lineCount":59,"tablesReferenced":["HELP_Contents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SectionsGroupManager.cs.GetChaptersTreeView"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Builds a hierarchical tree view of help chapters and pages for a given section by iteratively resolving parent-child relationships using table variables, returning the ordered tree and any remaining unresolved items.","businessPurpose":"Renders the hierarchical navigation tree in the MyHelp administration interface, allowing administrators to browse and manage chapters and pages in their proper hierarchical order.","optimizationRecommendations":["The WHILE loop that iteratively removes processed nodes from @Help_ContentTemp (O(n) iterations) is an anti-pattern for tree traversal; replace with a recursive CTE for cleaner and faster hierarchy traversal.","The self-join 'LEFT JOIN HELP_Contents t2 ON t1.ContentID=t2.ParentID' in the initial INSERT is used only for the DISTINCT; the join product may create unexpected row duplication.","Returns two result sets from one call (the resolved tree and @Help_ContentTemp remainder); the second is likely a debugging artifact and should be removed."],"migrationRelevance":"low"},{"name":"GetChaptersTreeViewOnView","schema":"dbo","parameters":[{"name":"@SectionID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":68,"tablesReferenced":["HELP_Contents","HELP_UserAccessLevel"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SectionsGroupManager.cs.GetChaptersTreeForView"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Retrieves the complete help content tree for a section (or all sections if @SectionID = -1) using the same iterative table-variable approach as GetChaptersTreeView, for use in the user-facing help view.","businessPurpose":"Provides the help chapter and page tree used in the end-user help viewer, rendering the hierarchical documentation navigation for all sections or a specific one.","optimizationRecommendations":["Same iterative WHILE loop tree traversal anti-pattern as GetChaptersTreeView; replace with a recursive CTE.","The all-sections (-1) path loads all Help_Contents records into a table variable before filtering, which could be expensive for large help systems."],"migrationRelevance":"low"},{"name":"GetCMEEvaluationAssignmentListByCriteriaForMainPage_test51","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@AdministratorID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@EvaluationScheduleID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@EventTypeID","dataType":"verySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"2016"},{"name":"@outsideResistration","dataType":"LargeNumber","direction":"IN","defaultValue":"1"}],"lineCount":744,"tablesReferenced":["CME_Evaluation","CME_Events","CME_ScheduleTemplate","CME_ScheduleTemplateTopics","CME_Templates","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCMEEvaluationAssignmentListByCriteriaForMainPage","MessageDistributionManager.cs"],"complexity":"very-complex","aiEnrichment":null,"module":"SYS","summary":"Retrieves a list of CME evaluation assignments matching multiple criteria (department, schedule, academic year, event type, date range) using linked department expansion, academic calendar date computation, and conditional sorting; this is a test/staging variant of the main CME listing procedure.","businessPurpose":"Powers the main CME (Continuing Medical Education) evaluation dashboard, listing evaluation assignments for non-standard users based on their CME event schedule, with academic year filtering for program compliance tracking.","optimizationRecommendations":["The '_test51' suffix in the name indicates this is a test/development variant left in production; the active version should be identified and the test variant removed.","PRINT @DateCheck is present as debugging output that should be removed from production code.","The procedure body is ~39KB and contains multiple large conditional branches; it should be refactored into smaller, focused procedures.","dbo.RetrieveDepartments() is called once but linked department expansion is repeated across multiple inner queries; materialise results into the temp table and use it consistently.","Date range computation using dbo.fnGetAcademicStartDate is called multiple times; pre-compute into variables."],"migrationRelevance":"medium"},{"name":"GetCMEEvaluationAssignmentListByCriteriaForMainPageDetailedView","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@AdministratorID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@EvaluationScheduleID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@EventTypeID","dataType":"verySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@AcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":"2016"},{"name":"@outsideResistration","dataType":"LargeNumber","direction":"IN","defaultValue":"1"}],"lineCount":766,"tablesReferenced":["CME_Evaluation","CME_Events","CME_ScheduleTemplate","CME_ScheduleTemplateTopics","CME_Templates","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCMEEvaluationAssignmentListByCriteriaForMainPageView","MessageDistributionManager.cs"],"complexity":"very-complex","aiEnrichment":null,"module":"SYS","summary":"A detailed-view variant of the CME evaluation assignment list procedure (~40KB), returning extended columns including topic counts, sign fields, and partial scheduling status for the CME evaluation dashboard.","businessPurpose":"Renders the expanded/detailed row view on the CME evaluation main page, providing coordinators with additional evaluation details such as topic completion status and scheduling flags for compliance monitoring.","optimizationRecommendations":["PRINT @DateCheck debugging output should be removed.","At ~40KB, this is one of the largest SPs in the module; it should be broken into smaller targeted procedures or use views/table-valued functions for the repeated sub-logic.","Same dbo.RetrieveDepartments() and academic date computation optimisation opportunities as the _test51 variant.","Contains commented-out DROP TABLE after the main END block (DROP TABLE #tblCustomDataScheduleID after END) which indicates incomplete cleanup logic."],"migrationRelevance":"medium"},{"name":"GetCMEEventsForRegistration","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["CME_Events","CME_ScheduleTemplate","CME_Templates"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCMEEventsForRegistration","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Returns CME schedule templates with EnableRegistration = 1 for a given department, joined with event names.","businessPurpose":"Populates the CME event registration selection list for authenticated department users who need to register for a CME session.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetCMEEventsForRegistrationOutUsers","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["CME_Events","CME_ScheduleTemplate","CME_Templates"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCMEEventsForRegistrationOutUsers","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Returns CME schedule templates with EnableOutRegistration = 1, for use by outside/non-platform users accessing public CME event registration.","businessPurpose":"Supports the public-facing CME event registration flow allowing external users (physicians, attendees without platform accounts) to register for continuing medical education events.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetCompetenciesForMergeDocument","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FromDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ToDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ResidentID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SubjectID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TargetID","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@CompetencyID","dataType":"LargeText","direction":"IN","defaultValue":"NULL"},{"name":"@EvaluationType","dataType":"SmallNumber","direction":"IN","defaultValue":"NULL"},{"name":"@ResultsDisplay","dataType":"SmallNumber","direction":"IN","defaultValue":"0  -- 0 = All or 1 = Actual Evaluation Results (excludes averages)"}],"lineCount":317,"tablesReferenced":["EVAL_AnswerScales","EVAL_Answers","EVAL_Audiences","EVAL_Evaluations","EVAL_Questions","EVAL_QuestionsCategories","EVAL_TemplateQuestion","EVAL_Templates","Eval_BaseAudience","SEC_DepartmentLinks","SEC_Specialty","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":["GetAvailableCompetenciesByTemplate"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":true,"nolockCount":32,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCompetenciesForMergeDocument","MessageDistributionManager.cs"],"complexity":"very-complex","aiEnrichment":null,"module":"SYS","summary":"Retrieves competency summary data for a user or set of users within date ranges and filters (competency ID, evaluation type, display format), used to populate competency sections in mail-merge portfolio documents.","businessPurpose":"Supplies competency performance data for the MyPortfolio summary report and mail-merge document generation, enabling residency programs to include ACGME milestone/competency results in formatted reports sent to trainees and faculty.","optimizationRecommendations":["The SP comment notes it is also used by the JIVA team with specific parameter conventions; this external coupling should be documented and the interface formally versioned.","Complex multi-join query across evaluation and competency tables; ensure covering indexes on EvaluationID, TemplateID, and date range columns."],"migrationRelevance":"high"},{"name":"GetCustomFieldsData","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":42,"tablesReferenced":["SEC_MailMergeCustomFieldTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCustomFieldsData","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Retrieves custom mail-merge field templates applicable to a given department and evaluation template, expanding to linked departments and filtering by audience ID to produce a context-relevant field list.","businessPurpose":"Populates the custom field selector in the mail-merge document builder, showing only the custom fields relevant to the current department and evaluation audience.","optimizationRecommendations":["Uses dbo.RetrieveDepartments() for department expansion; ensure proper indexing.","Builds two temp tables (#LinkedDepartments and #SEC_MailMergeCustomFieldTemplateInfo) for relatively simple filtering; could be simplified with CTEs."],"migrationRelevance":"medium"},{"name":"GetCustomMailMergeSections","schema":"dbo","parameters":[],"lineCount":25,"tablesReferenced":["SEC_MailMergeSections"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetCustomMailMergeSections","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns a hard-coded filtered list of mail-merge sections (IDs 1, 2, 6) with ValueType = 1 from SEC_MailMergeSections.","businessPurpose":"Provides the specific subset of mail-merge section types available when building custom field-based templates, limiting the interface to relevant sections for custom template construction.","optimizationRecommendations":["The hard-coded IN (1, 2, 6) list should be replaced with a flag or attribute on SEC_MailMergeSections (e.g. IsCustom = 1) to avoid hardcoded maintenance."],"migrationRelevance":"low"},{"name":"GetEvaluationCommentsForMergeDocument","schema":"dbo","parameters":[{"name":"@UserTypeID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":57,"tablesReferenced":["EVAL_BaseAnswerTypes","EVAL_EvaluationComments","EVAL_EvaluationGrade","EVAL_Evaluations","EVAL_Templates","Eval_TemplateOverallGrade","Eval_UserInbox","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetEvaluationCommentsForMergeDocument","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Retrieves evaluation comment data (narrative comments, grade text) for a set of users across completed evaluations, filtered by department, user type, audience, and date range, for inclusion in mail-merge documents.","businessPurpose":"Supplies evaluation narrative comments and overall grades for the mail-merge document generator, enabling programs to include qualitative feedback in resident portfolio reports and performance summaries.","optimizationRecommendations":["Uses fnSplit() for @DepartmentIDs and @UserIDs; replace with STRING_SPLIT or table-valued parameters for better performance with large user lists.","Two separate code paths (DepartmentID = 0 vs. specific user IDs) produce the same #UserInfo temp table; both branches should share the same downstream query logic."],"migrationRelevance":"high"},{"name":"GetEvaluationGradesForMergeDocument","schema":"dbo","parameters":[{"name":"@UserTypeID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":97,"tablesReferenced":["DH_DepartmentRotations","EVAL_Answers","EVAL_EvaluationTestGrades","EVAL_Evaluations","EVAL_Templates","Eval_TemplateOverallGrade","Eval_UserInbox","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":11,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetEvaluationGradesForMergeDocument","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Retrieves evaluation grade data for a set of users across completed evaluations, filtered by department, user type, audience, template, and date range, for mail-merge document generation.","businessPurpose":"Provides structured grade and performance data for the mail-merge document generator to include evaluation scores and metrics in resident portfolio reports.","optimizationRecommendations":["Same fnSplit() optimisation opportunity as GetEvaluationCommentsForMergeDocument.","Same dual code path for user ID resolution."],"migrationRelevance":"high"},{"name":"GetEventIDandOpeningsCount","schema":"dbo","parameters":[],"lineCount":34,"tablesReferenced":["SEC_TrainingEvents","Sec_SeminarDisplaySetting"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetEventIDandOpeningsCount","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns training event details including current registration count, maximum registrations, available openings, and the logged-in user's existing TrainingID for events that are not closed.","businessPurpose":"Displays event capacity information on the training event registration page so authenticated users can see how many spots remain and whether they have already registered.","optimizationRecommendations":["Uses dbo.GetNoOfRegistrationByEventID() and dbo.GetNoOfOpeningsbyEventID() scalar functions per row; replace with inline COUNT aggregates from SEC_TrainingSeminar.","dbo.GetTrainingIDofLoggedinUser() scalar function per row; replace with a LEFT JOIN to SEC_TrainingSeminar."],"migrationRelevance":"low"},{"name":"GetEventIDandOpeningsCountNonUser","schema":"dbo","parameters":[],"lineCount":28,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetEventIDandOpeningsCountNonUser","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns training event capacity details (registration count, max registrations, available openings) for events where IsOutsideRegistration = 1 and IsClosed = 0, for non-authenticated users.","businessPurpose":"Provides event capacity information on the public-facing training registration page for external users who do not have platform accounts.","optimizationRecommendations":["Same scalar function per-row issue as GetEventIDandOpeningsCount."],"migrationRelevance":"low"},{"name":"GetEventInfo","schema":"dbo","parameters":[{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetEventInfo","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns detailed event information (status, description, pricing, dates, menu details, logo) for a specific training event ID.","businessPurpose":"Populates the event detail/landing page shown to users considering registration for a MyEvaluations training conference.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetHelpChapterInfoByContentID","schema":"dbo","parameters":[{"name":"@ContentID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":53,"tablesReferenced":["HELP_Contents","HELP_UserAccessLevelMaster"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpChapterInfoByContentID"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Retrieves the details of a help chapter (name, parent, access level) by ContentID, with different query paths depending on whether a SectionID is provided.","businessPurpose":"Loads chapter details into the help chapter edit form, allowing administrators to view and modify an existing chapter's metadata in the MyHelp authoring interface.","optimizationRecommendations":["Uses SELECT INTO #TempContent then queries #TempContent; this can be simplified to direct variable assignment without a temp table for this simple single-row lookup.","Two code paths (SectionID = 0/-1 vs. specific SectionID) are structurally similar; could be unified."],"migrationRelevance":"low"},{"name":"GetHelpContentsByKeyIDs","schema":"dbo","parameters":[],"lineCount":56,"tablesReferenced":[],"sprocsCalledFromBody":["CheckHelpContentForKeyID"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpContentsByKeyIDs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Fetches help page content and name for a list of comma-separated KeyIDs by iterating through the IDs using a cursor-like temp table and identity-based loop.","businessPurpose":"Retrieves multiple specific help page contents by their key IDs, used for contextual help display where multiple related topics are shown together.","optimizationRecommendations":["The row-by-row loop through @KeyIDs using an identity table and index can be replaced with a single set-based JOIN query using fnSplit or STRING_SPLIT.","WHILE loop iterating from 1 to @count with identity-based row access is a cursor anti-pattern."],"migrationRelevance":"low"},{"name":"GetHelpIndexResult","schema":"dbo","parameters":[{"name":"@ContentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpIndexResult"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns the name and content of a specific active help content page matching the given ContentID and ParentID.","businessPurpose":"Retrieves the content of a specific help page for display in the help index viewer, used when a user navigates to a particular help topic.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetHelpInfoByKey","schema":"dbo","parameters":[{"name":"@Key","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpInfoByKey"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Retrieves help page content by section name and key value, with a fallback message if no matching content is found.","businessPurpose":"Provides context-sensitive help content lookup by key/section name, used to display relevant help text when a user requests help on a specific platform feature.","optimizationRecommendations":["The IN clause constructed via string replacement (replace(@Section,',',''',''')) to simulate an IN list is error-prone and a potential SQL injection vector if @Section is user-supplied; use a split function instead."],"migrationRelevance":"low"},{"name":"GetHelpInfoByKeyID","schema":"dbo","parameters":[],"lineCount":37,"tablesReferenced":["Help_KeyValues"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpInfoByKeyID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Looks up a help page's key value and section name by KeyID from Help_KeyValues, then resolves the SectionID, returning the key, section, and SectionID.","businessPurpose":"Supports context-sensitive help lookup by numeric KeyID, enabling the platform to display the appropriate help page when a user triggers a help request from a specific UI location.","optimizationRecommendations":["Same IN clause construction via string replacement issue as GetHelpInfoByKey."],"migrationRelevance":"low"},{"name":"GetHelpSearchResult","schema":"dbo","parameters":[{"name":"@SearchWord","dataType":"VARCHAR(255)","direction":"IN","defaultValue":null}],"lineCount":36,"tablesReferenced":["HELP_UserAccessLevel"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpSearchResult"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Performs a full-text-style search across help content (Name and Content fields) filtered by the user's access level, deduplicating results and returning matching pages sorted by relevance.","businessPurpose":"Powers the help search feature that allows users to find relevant help articles by keyword, returning results filtered to their access level.","optimizationRecommendations":["Uses LIKE-based search without full-text indexes; consider enabling SQL Server Full-Text Search on HELP_Contents.Content and Name columns for better performance and relevance ranking.","The access level filtering via 'AccessLevel <= any(SELECT UserAccessID FROM HELP_UserAccess...)' may perform poorly on large datasets; ensure proper indexing on AccessLevel."],"migrationRelevance":"low"},{"name":"GetHelpSectionDetails","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["HELP_Sections"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SectionsGroupManager.cs.FetchListOfSectionsOnID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns the metadata (SectionID, Name, Description, IsActive, AccessLevel) for a specific help section.","businessPurpose":"Loads a help section's detail record for display or editing in the MyHelp section management interface.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetHelpSectionInfoBySecID","schema":"dbo","parameters":[],"lineCount":18,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpSectionInfoBySecID"],"complexity":"trivial","aiEnrichment":null,"module":"SYS","summary":"Returns a single help section record including name, description, active status, and access level for the given SectionID.","businessPurpose":"Retrieves help section details for rendering in the section edit form or section display context within the help management module.","optimizationRecommendations":["Functionally duplicates GetHelpSectionDetails; both SPs query the same columns from HELP_Sections by SectionID — candidates for consolidation."],"migrationRelevance":"low"},{"name":"GetHelpSections","schema":"dbo","parameters":[],"lineCount":22,"tablesReferenced":["HELP_Sections"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpSections"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns a list of all active help sections (SectionID, Name) ordered by name.","businessPurpose":"Populates the help section navigation menu and selection dropdowns used throughout the in-application help system.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetHelpUserAccessList","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["HELP_UserAccessLevelMaster"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetHelpUserAccessList"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all help system user access levels (MasterAccessID, Description) from HELP_UserAccessLevelMaster ordered by ID.","businessPurpose":"Populates the access level selector in the help authoring interface, allowing administrators to restrict help content visibility by role level.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetKeyValueBySectionID","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["HELP_Contents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetKeyValueBySectionID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all active, non-folder help content items (ContentID, KeyValue) for a given section, used for key-value based help lookup.","businessPurpose":"Supports the key-value lookup mechanism in the context-sensitive help system, providing a mapping of content IDs to their key values for a given help section.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetListOfHelpChapters","schema":"dbo","parameters":[{"name":"@SectionID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["HELP_UserAccessLevelMaster"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetListOfHelpChapters"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns either all chapters for a section or the details of a specific chapter (by ContentID), joined with access level descriptions, for the help chapter management list view.","businessPurpose":"Populates the chapter list in the MyHelp admin management grid, showing all chapters within a section with their access levels for administrative review and editing.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetListOfHelpSections","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["HELP_Sections"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SectionsGroupManager.cs.FetchListOfSections"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all help sections with their ID, name, description, active status (as Yes/No), and access level from HELP_Sections.","businessPurpose":"Populates the help section management grid, giving administrators an overview of all help sections in the system.","optimizationRecommendations":["Uses CASE('IsActive') WHEN 1... with quoted column name — the quotes around IsActive are non-standard; should use CASE IsActive WHEN 1 THEN 'Yes' ELSE 'No' END."],"migrationRelevance":"low"},{"name":"GetListOfHelpSectionsDetails","schema":"dbo","parameters":[],"lineCount":37,"tablesReferenced":["HELP_Sections","HELP_UserAccessLevel","HELP_UserAccessLevelMaster"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.GetListOfHelpSectionsDetails"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Returns detailed help section information filtered by access level, supporting different views based on the user's role.","businessPurpose":"Provides a role-filtered view of available help sections to end users, showing only sections they are permitted to access based on their platform role.","optimizationRecommendations":["Contains a large block of commented-out role-to-access-level mapping code that should be cleaned up."],"migrationRelevance":"low"},{"name":"GetMailDistributionSchedulersInfo","schema":"dbo","parameters":[],"lineCount":33,"tablesReferenced":["SEC_MailDistributionInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailDistributionSchedulersInfo","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Retrieves pending scheduled mail distribution records from SEC_MailDistributionInfo where the schedule date matches today and the email has not yet been sent.","businessPurpose":"Drives the scheduled mail distribution feature that automatically sends pre-configured email distributions on their scheduled dates, used for recurring department communications.","optimizationRecommendations":["The date comparison using CONVERT(VARCHAR, ScheduleDate, 101) = CONVERT(VARCHAR, GETDATE(), 101) prevents index use on ScheduleDate; replace with CAST(ScheduleDate AS DATE) = CAST(GETDATE() AS DATE) to allow index seeks."],"migrationRelevance":"low"},{"name":"GetMailDistributionTemplateInfoByID","schema":"dbo","parameters":[{"name":"@TemplateID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":65,"tablesReferenced":["SEC_MailDistributionTemplateSection","SEC_Programs","SEC_Specialty","SEC_UserTypes"],"sprocsCalledFromBody":["GetRowValuesToString"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailDistributionTemplateInfoByID","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Returns the full configuration of a mail distribution template by TemplateID, including the selected values for program types, specialities, access IDs, and user types, parsed from a composite delimited string and looked up against reference tables.","businessPurpose":"Loads a saved mail distribution template for editing or preview in the Mail Distribution template management interface, reconstructing the structured filter selections from stored composite values.","optimizationRecommendations":["Uses dbo.fnSplitWithEmptyValue() to split a composite '@#@'-delimited string stored as a single column value; this is a schemaless data design anti-pattern — the constituent fields (ProgramTypes, Specialities, etc.) should be separate columns or a related detail table.","Multiple SELECT @value FROM ... WHERE id = N queries iterate over the same split result; a single PIVOT or conditional aggregation would be more efficient."],"migrationRelevance":"medium"},{"name":"GetMailDistributionTemplateSections","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["SEC_MailDistributionTemplateSection"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailDistributionTemplateSections","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all records from SEC_MailDistributionTemplateSection ordered by template name.","businessPurpose":"Populates the mail distribution template selection list, showing all configured distribution templates available for scheduling or use.","optimizationRecommendations":["Returns all records without any filtering; as the table grows, this unbounded SELECT could impact performance. Consider adding pagination or a status filter."],"migrationRelevance":"low"},{"name":"GetMailMergeCustomTemplateInfoByDepartmentID","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["SEC_MailMergeCustomFieldTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailMergeCustomTemplateInfoByDepartmentID","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns non-deleted custom mail-merge field templates for a given department, ordered by template name.","businessPurpose":"Populates the custom template selector in the mail-merge workflow for a specific department, showing only their own active templates.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMailMergeCustomTemplateInfoByID","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["SEC_MailMergeCustomFieldTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailMergeCustomTemplateInfoByID","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns the full details of a specific custom mail-merge field template by its TemplateID.","businessPurpose":"Loads a custom mail-merge template for editing or preview in the template management UI.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMailMergeFieldsBySectionID","schema":"dbo","parameters":[{"name":"@MailMergeSectionID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":59,"tablesReferenced":["SEC_Departments","SEC_MailMergeCustomFieldTemplateInfo","SEC_MailMergeFields","SEC_ManageFieldsDetails","SEC_ManageFieldsMaster"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailMergeFieldsBySectionID","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Returns available mail-merge field options for a given section ID, with special-case logic for custom field sections (section 5), institution-level NHB fields, and standard user demographic fields, dynamically filtered by department and section type.","businessPurpose":"Populates the field picker in the mail-merge template builder, presenting available merge fields relevant to the selected section and department context so users can compose personalised documents.","optimizationRecommendations":["The hard-coded MailMergeSectionID values (5, specific IDs) scattered through conditional logic make this SP brittle; a more data-driven approach with a field registry table would be maintainable.","Multiple conditional branches each executing different SELECT statements; query plan caching is ineffective across branches."],"migrationRelevance":"medium"},{"name":"GetMailMergeSections","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["SEC_MailMergeSections"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailMergeSections","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all mail-merge sections with ValueType = 1, ordered by name.","businessPurpose":"Populates the mail-merge section selector at the start of the mail-merge document building workflow.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMailMergeTemplateInfoByDepartmentID","schema":"dbo","parameters":[],"lineCount":27,"tablesReferenced":["SEC_MailMergeTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailMergeTemplateInfo","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all non-deleted standard mail-merge templates for a given department, sorted by name.","businessPurpose":"Populates the standard template selector for department-specific mail-merge communications.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMailMergeTemplateInfoByID","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["SEC_MailMergeTemplateInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetMailMergeTemplateInfoByID","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns the full content of a specific standard mail-merge template by its MailMergeTemplateID.","businessPurpose":"Loads a standard mail-merge template for editing or document generation.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMealNameID","schema":"dbo","parameters":[],"lineCount":22,"tablesReferenced":["SEC_TrainingMeals"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTrainingMealName","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns the name of a training event meal option by its MealID.","businessPurpose":"Retrieves a specific meal name for display on event registration confirmation or administration screens.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMessageDetailsbyID","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["SEC_Message","SEC_UserMessage"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MessageDistributionManager.cs.GetMessageDetailsbyID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Retrieves full details of a department message by MessageID, including the list of recipient user IDs aggregated via STRING_AGG, dates, and content.","businessPurpose":"Loads a specific department message for display or editing in the department messaging interface, including the full list of recipients.","optimizationRecommendations":["STRING_AGG requires SQL Server 2017+; if an older compatibility level is in use, this may fail — verify database compatibility.","The GROUP BY / STRING_AGG pattern needs to be confirmed against the table structure to ensure MessageID-to-UserID is a proper many-to-many join."],"migrationRelevance":"low"},{"name":"GetNoofRegistartions","schema":"dbo","parameters":[],"lineCount":24,"tablesReferenced":["SEC_TrainingEvents","SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetNoofRegistrations","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns the count of registrations for a given event, optionally filtered by attendance type, from SEC_TrainingSeminar.","businessPurpose":"Provides registration count data for training event capacity management, used in administration views to monitor event fill rates.","optimizationRecommendations":["The SP name has a typo ('Registartions'); this is a minor but persistent code quality issue."],"migrationRelevance":"low"},{"name":"GetProcedureDetailsForMailMerge","schema":"dbo","parameters":[{"name":"@UserTypeID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":108,"tablesReferenced":["PRC_Procedures","PRC_ProceduresCertificationStatus","PRC_ProceduresCertificationStatusTypes","PRC_ProceduresSubmitted","PRC_ProceduresSubmittedStatusTypes","SEC_UserCertifications","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetProcedureDetailsForMailMerge","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Retrieves user information and procedure/rotation data for a set of users (by department or explicit user ID list) for inclusion in mail-merge documents.","businessPurpose":"Supplies rotation and procedure completion data for mail-merge document generation, used in resident portfolio reports and performance summaries sent by program administrators.","optimizationRecommendations":["Uses fnSplit() for @DepartmentIDs and @UserIDs; same STRING_SPLIT optimisation opportunity as other merge document SPs.","Two code paths for user ID resolution that can be unified."],"migrationRelevance":"high"},{"name":"GetSendPushNotificationsDetails","schema":"dbo","parameters":[{"name":"@userid","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":14,"tablesReferenced":["SYS_Notifications","SYS_UserNotificationSettings"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns notification records from SYS_Notifications joined with the user's push notification device registration UID, filtered by user ID and device token.","businessPurpose":"Provides the notification payload and device token needed by the push notification service to deliver unread notifications to a specific user's mobile device.","optimizationRecommendations":["Returns all notifications for a user/device combination without filtering out already-delivered ones; callers must filter externally. Consider adding a SentDate IS NULL filter."],"migrationRelevance":"medium"},{"name":"GetSupportInfo","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SupportType","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@CategoryID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@OS_ID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@BrowserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Explanation","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@OperatingSystemName","dataType":"LargeText","direction":"IN","defaultValue":"null"},{"name":"@BrowserName","dataType":"LargeText","direction":"IN","defaultValue":"null"}],"lineCount":103,"tablesReferenced":["EVAL_EmailTemplate","SEC_Departments","SEC_Roles","SEC_SupportQuery","SEC_SystemCategory","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetSupportInfo","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Builds and returns support request email HTML content by populating an email template with the submitted support query details, saves the query to SEC_SupportQuery, and returns the rendered template with recipient addresses.","businessPurpose":"Handles the submission of technical support requests from platform users, recording the query in the database and generating the notification email to the support team.","optimizationRecommendations":["The SQL in the body contains a syntax error: '+ ++' ' (double-plus concatenation) in the date formatting line which suggests a typo or copy-paste error that should be corrected.","Creates two temp tables (#SupportInfo, #SupportResponse) for what appears to be a single-row operation; direct variable assignment would suffice."],"migrationRelevance":"low"},{"name":"GetSysNotificationsForSending","schema":"dbo","parameters":[],"lineCount":27,"tablesReferenced":["SYS_Notifications","SYS_NotificationsLog","SYS_UserNotificationSettings"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Retrieves pending system notifications (from SYS_Notifications) that have not yet been sent via any notification service, joining with user notification settings to get device tokens, with hard-coded UserID filtering visible in the WHERE clause.","businessPurpose":"Drives the push notification dispatcher that reads queued notifications and delivers them through registered notification services (Firebase, etc.) to user devices.","optimizationRecommendations":["Hard-coded 'AND T.UserID IN (2, 4275)' is a debugging artifact in the WHERE clause that must be removed before this SP is used in production — it would otherwise only send notifications to two specific users.","The LEFT JOIN to SYS_NotificationsLog with WHERE NL.NotificationsLogID IS NULL is the correct anti-join pattern for finding unsent notifications, but ensure NotificationID + UserNotificationSettingID is indexed in the log table."],"migrationRelevance":"high"},{"name":"GetTraineeinfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":56,"tablesReferenced":["SEC_Departments","SEC_InstitutionUsers","SEC_States","SEC_UserAddress","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTraineeinfo","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Returns detailed trainee profile information for a given user, including role, institution, rotation, and supervisor details, with role-specific conditional logic.","businessPurpose":"Loads the trainee profile view used during training event registration and profile management, providing contextual information about the user's program, institution, and rotations.","optimizationRecommendations":["Role-based conditional branching inside a single SP creates complex and hard-to-test logic; consider separate role-targeted procedures or a unified query with LEFT JOINs and role filtering."],"migrationRelevance":"low"},{"name":"GetTrainingEventsByEventID","schema":"dbo","parameters":[{"name":"@EventID","dataType":"bigint","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTrainingEventsByEventID","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all details of a specific training event (title, description, dates, registration window, costs, file name) by EventID.","businessPurpose":"Loads a specific training event's details for the event administration edit form and event detail display.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetTrainingEventsByID","schema":"dbo","parameters":[],"lineCount":34,"tablesReferenced":["SEC_TrainingEvents","SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTrainingEventsByID","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns a paginated list of seminar registrations for a given event, including registrant details, payment info, attendance type, and a row number for ordering.","businessPurpose":"Populates the registrant management grid for a specific training event, allowing administrators to view and manage attendees, their registration status, and meal preferences.","optimizationRecommendations":["The SP is named 'ByID' but actually retrieves registrations by EventID; the name is misleading.","Pagination is not implemented in this version; all registrations are returned with ROW_NUMBER() but no BETWEEN filter is applied."],"migrationRelevance":"low"},{"name":"GetTrainingEventsListExportToExcel","schema":"dbo","parameters":[],"lineCount":78,"tablesReferenced":["SEC_TrainingMeals","SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTrainingEventsListETE","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Generates an Excel-export-ready result set of event registrations with formatted columns (registration status, dates, contact info, payment, meal selections) for a given event ID, supporting both single-event and multi-event export modes.","businessPurpose":"Provides the data export for administrators downloading training event registration lists to Excel for off-platform reporting, logistics, or record keeping.","optimizationRecommendations":["The IF(@EventID > 10) condition as the branch selector for single vs. all-event export is a fragile, magic-number convention; use an explicit @ExportMode parameter instead."],"migrationRelevance":"low"},{"name":"GetTrainingID","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":30,"tablesReferenced":["SEC_TrainingEvents","SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTrainingID","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns full registration details for a specific user's seminar registration, including payment, attendance type, and meal selections, role-filtered by the calling user's role.","businessPurpose":"Loads an individual training registration record for review or editing by an administrator or the registrant themselves.","optimizationRecommendations":["Role-based query branching (System Admin vs. others) duplicates large SELECT statements; a UNION with role filtering or a unified query with WHERE role condition would reduce duplication."],"migrationRelevance":"low"},{"name":"GetTrainingMeals","schema":"dbo","parameters":[{"name":"@DayNum","dataType":"SmallNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["SEC_TrainingMeals"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTrainingMeals","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns all meal options for a specific event and day number from SEC_TrainingMeals, ordered by name.","businessPurpose":"Populates meal selection options on the training event registration form for a given event day.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetTrainingSeminar","schema":"dbo","parameters":[{"name":"@TrainingID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":104,"tablesReferenced":["SEC_TrainingEvents","SEC_TrainingSeminar","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetTrainingSeminar","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Returns training seminar registration records filtered by the calling user's role (System Admin sees all; Program Directors see department registrations; trainees see their own), with role-based data access control.","businessPurpose":"Powers the training seminar administration view with role-appropriate data access, ensuring program directors see only their department's registrations while administrators see all.","optimizationRecommendations":["Large IF/ELSE branches per role repeat nearly identical SELECT columns; a unified query with role-based WHERE conditions would reduce maintenance overhead.","All branches return the same columns; the role-based filtering should be a parameterised WHERE predicate rather than separate query blocks."],"migrationRelevance":"low"},{"name":"GetUserDetailsForMailMerge","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserTypeID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@FromDate","dataType":"LargeDate","direction":"IN","defaultValue":"NULL"},{"name":"@ToDate","dataType":"LargeDate","direction":"IN","defaultValue":"NULL"}],"lineCount":842,"tablesReferenced":["SEC_CitizenShipStatus","SEC_City","SEC_Countries","SEC_Degrees","SEC_Departments","SEC_EducationCategory","SEC_EducationCertification","SEC_Ethnicity","SEC_Gender","SEC_Language","SEC_MaritalStatus","SEC_MedSchools","SEC_Military","SEC_MilitaryRank","SEC_PostGraduatePosition","SEC_PostGraduation","SEC_Programs","SEC_ResidencyTypes","SEC_Roles","SEC_Specialty","SEC_States","SEC_UserAddress","SEC_UserCertifications","SEC_UserContract","SEC_UserExams","SEC_UserMoonLightingHistory","SEC_UserRoles","SEC_UserStatus","SEC_UserStipendHistory","SEC_UserTrainingGapHistory","SEC_Users","SEC_UsersExt","SEC_VisaTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetUserDetailsForMailMerge","MessageDistributionManager.cs"],"complexity":"very-complex","aiEnrichment":null,"module":"SYS","summary":"The most complex SP in the module (~60KB), assembling a comprehensive user data payload for mail-merge document generation by joining user demographics, certifications, post-graduation details, contracts, exams, stipend history, moonlighting, training gaps, states, countries, and city data into multiple temp tables and returning a merged result set.","businessPurpose":"Provides the complete user profile data package needed to render personalised mail-merge documents (portfolio reports, letters, compliance documents) for residents and fellows, pulling from across the entire user profile schema.","optimizationRecommendations":["The SP is ~60KB and builds 10+ temp tables with extensive JOINs across user profile sub-systems; it should be refactored into modular sub-procedures or views, each responsible for a specific data domain.","Modification history notes scalar functions were replaced with inline JOINs for performance (revision #2 in 2024); this pattern should be applied consistently to any remaining scalar function calls.","Multiple DROP TABLE statements at the end indicate many temp tables are created; consolidate or use table variables where cardinality is small and predictable.","PRINT statements left in the code body ('001' + CONVERT...) from debugging must be removed.","This is the highest-migration-risk SP in the module; any changes to the user data model will require updates here."],"migrationRelevance":"high"},{"name":"GetUserMessages","schema":"dbo","parameters":[{"name":"@UserID","dataType":"INT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"INT","direction":"IN","defaultValue":null},{"name":"@IsDeleted","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@DisplayFilter","dataType":"SmallNumber","direction":"IN","defaultValue":"0"},{"name":"@StartIndex","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PageSize","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":104,"tablesReferenced":["SEC_Message","SEC_UserRoles","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MessageDistributionManager.cs.GetMessages"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Retrieves department messages for a given user, populating a temp table with message details including sender information, dates, and read status, with pagination support.","businessPurpose":"Powers the user inbox/message center view, loading messages sent to or from a user within their department for display in the platform's messaging feature.","optimizationRecommendations":["The use of a temp table for a potentially simple paginated query adds overhead; consider a direct CTE with OFFSET/FETCH."],"migrationRelevance":"low"},{"name":"GetUserNotificationModuleSettings","schema":"dbo","parameters":[],"lineCount":50,"tablesReferenced":["SEC_UserRoles","SYS_NotificationModuleSettings","SYS_NotificationModules"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Returns all notification modules with their enabled/disabled status for a specific user, using OUTER APPLY to include user-specific overrides from SYS_NotificationModuleSettings, filtered by user role.","businessPurpose":"Populates the user notification preferences page, showing all available notification types and whether each is enabled or disabled for the current user.","optimizationRecommendations":["The role-based filtering logic built from @pRoleID into a #Result temp table adds complexity; the role restriction on notification modules (if needed) should be stored as metadata on SYS_NotificationModules rather than applied procedurally."],"migrationRelevance":"medium"},{"name":"GetUserRelatedInfo","schema":"dbo","parameters":[],"lineCount":41,"tablesReferenced":["SEC_Roles","SEC_UserRoles","SEC_UserTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetUserRelatedInfo","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Returns a formatted user info string and individual user attributes (name, type, role, email) by joining MDV_Users, SEC_UserTypes, SEC_UserRoles, and SEC_Roles for a given UserID.","businessPurpose":"Provides contextual user identification data used in reporting headers, audit displays, and session context within the platform.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetUserRoles","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":11,"tablesReferenced":["SEC_Roles"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MessageDistributionManager.cs.BindUserRoles"],"complexity":"trivial","aiEnrichment":null,"module":"SYS","summary":"Returns all roles from SEC_Roles ordered alphabetically by trimmed name, with a commented-out filter that previously restricted to specific role IDs.","businessPurpose":"Populates role selection dropdowns throughout the administration interface, providing the full list of available roles for user management.","optimizationRecommendations":["The large commented-out role ID list suggests there was previously a business rule restricting which roles appear; if that restriction is still needed, it should be encoded in a column on SEC_Roles (e.g. IsVisible) rather than hardcoded in the SP."],"migrationRelevance":"low"},{"name":"GetUsersEmailInfo","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"NVARCHAR(max)","direction":"IN","defaultValue":null},{"name":"@FromEmail","dataType":"largetext","direction":"IN","defaultValue":null},{"name":"@Subject","dataType":"NVARCHAR(max)","direction":"IN","defaultValue":null},{"name":"@Message","dataType":"NVARCHAR(max)","direction":"IN","defaultValue":null},{"name":"@IsSendMessage","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@IsPostOnHome","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":83,"tablesReferenced":["EVAL_EmailTemplate","SEC_Departments","SEC_MailMessage","SEC_UserMailMessage","SEC_Users"],"sprocsCalledFromBody":["AddDepartmentMessageNotification"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.SaveAndGetUsersEmailInfo","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Inserts email message records into SEC_MailMessage (parent) and SEC_UserMailMessage (per-recipient), iterating over a list of user IDs to create individual mail message rows and returns the resulting mail message details.","businessPurpose":"Handles the creation of internal mail message records when a user or administrator sends a message through the platform's internal email/messaging system.","optimizationRecommendations":["Row-by-row insertion loop for SEC_UserMailMessage should be replaced with a set-based INSERT from the split user ID list.","Creates mail records and returns the result in a single SP call, mixing write and read operations; consider separating concerns."],"migrationRelevance":"medium"},{"name":"GetUsersListByPreceptor","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["LA_Preceptors","LA_Trainee"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.GetPrecptorInfo","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns a preceptor's own record from LA_Preceptors and the trainee records they supervise from LA_Trainee for a given user ID.","businessPurpose":"Provides preceptor-trainee relationship data for the Learning Assignment module, used to display the trainees supervised by a given preceptor.","optimizationRecommendations":["Returns two result sets (preceptor record + trainee list); the caller must handle multiple result sets, which can complicate ORM usage."],"migrationRelevance":"low"},{"name":"GetUsersMessageInfo","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserIDs","dataType":"NVARCHAR(max)","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"largedate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"largedate","direction":"IN","defaultValue":null},{"name":"@Subject","dataType":"NVARCHAR(max)","direction":"IN","defaultValue":null},{"name":"@Message","dataType":"NVARCHAR(max)","direction":"IN","defaultValue":null},{"name":"@IsSendMessage","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@IsPostOnHome","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@UpdateMessageId","dataType":"LargeNumber","direction":"IN","defaultValue":"0"},{"name":"@UserRole","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":79,"tablesReferenced":["SEC_Message","SEC_UserMessage"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["MessageDistributionManager.cs.SaveAndGetUsersMessageInfo"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Similar to GetUsersEmailInfo, creates internal message records in SEC_Message and links them to recipients in SEC_UserMessage via a row-by-row loop, returning the MessageID.","businessPurpose":"Persists the creation of a new department broadcast message along with its per-recipient records, used when administrators send messages through the platform's internal messaging system.","optimizationRecommendations":["Same row-by-row insertion anti-pattern as GetUsersEmailInfo; replace with set-based INSERT.","The SP name (GetUsers...) is misleading as it writes data rather than retrieving users; should be renamed to something like CreateUserMessage."],"migrationRelevance":"medium"},{"name":"InsertApplicationEmailSchedules","schema":"dbo","parameters":[{"name":"@FromEmailAddress","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ToEmailAddress","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@Subject","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@IsSendDepartmentImage","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@FolderPath","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@FileName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ReplyToEmailAddress","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@IsReplyToRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsSendBCC","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@BccEmailAddress","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@IsAlternateSMTP","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@ApplicationSendMailMethodNumber","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":65,"tablesReferenced":["SCHE_ApplicationEmailSchedules"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["ApplicationEmailSchedule.cs.InsertApplicationEmailSchedules"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Inserts a new email into the SCHE_ApplicationEmailSchedules queue table with all required fields including recipients, template, department, BCC, and scheduling metadata.","businessPurpose":"Queues outgoing application emails (notifications, reminders, reports) for asynchronous sending by the email scheduler, serving as the primary email injection point for all automated platform communications.","optimizationRecommendations":["Also accepts UserID and IsSendCC parameters visible in other references; ensure all columns are populated correctly and the INSERT list matches the table schema exactly.","No deduplication logic; if called multiple times with the same parameters, duplicate emails will be queued."],"migrationRelevance":"high"},{"name":"InsertManualAssignments","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["SCHE_ManualAssignments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.InsertManualAssignments","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Creates a new manual assignment queue entry in SCHE_ManualAssignments for a given department and creator, returning the new ManualAssignmentID.","businessPurpose":"Records a manual assignment creation event in the scheduler queue, triggering the manual evaluation assignment workflow for a specific department.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"IsSeminarSubmittedForUser","schema":"dbo","parameters":[{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["SEC_TrainingSeminar"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.IsSeminarSubmittedForUser","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Returns the count of existing registrations for a user at a specific training event, used to determine if the user has already registered.","businessPurpose":"Prevents duplicate registrations by checking whether a user has already submitted a registration for a given training seminar before allowing another submission.","optimizationRecommendations":["Returning a COUNT is more expensive than needed for a boolean check; a simple IF EXISTS / SELECT CAST(1 AS BIT) would be more idiomatic and faster."],"migrationRelevance":"low"},{"name":"LogEvent","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventType","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@EntityID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@EventTime","dataType":"datetime","direction":"IN","defaultValue":null},{"name":"@ReportName","dataType":"LargeText","direction":"IN","defaultValue":"'' --Added by Amit 3/2/15"},{"name":"@BrowserDetail","dataType":"LargeText","direction":"IN","defaultValue":"'' --Added by Amit 2/8/16 for Storing BrowserDetail for LoginEvent"}],"lineCount":46,"tablesReferenced":["SEC_Events"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EventManager.cs.LogEventToDatabase"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts a security/audit event record into SEC_Events with event type, entity, user, department, timestamp, and optional browser/session details.","businessPurpose":"The primary audit logging mechanism for the platform, recording user actions (login, data changes, report generation, etc.) for compliance, security review, and audit trail requirements in a medical education context.","optimizationRecommendations":["As a high-frequency audit SP, ensure SEC_Events is properly indexed for the query patterns used in audit reporting (EventTypeID, LoggedInUserID, EventTime).","No error handling; a failed audit log insert could silently lose audit data — consider whether the caller should handle errors or if this should use TRY/CATCH."],"migrationRelevance":"high"},{"name":"LogEventDetail","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["SEC_EventDetail"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EventManager.cs.LogEventToDatabase"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Inserts a supplementary detail record into SEC_EventDetail associating an EventID with a specific entity primary key (Identifier).","businessPurpose":"Provides extended audit log detail entries linking an audit event to a specific database entity (e.g. a specific evaluation ID, user ID, or schedule ID) for fine-grained audit traceability.","optimizationRecommendations":[],"migrationRelevance":"high"},{"name":"LogSysNotification","schema":"dbo","parameters":[],"lineCount":14,"tablesReferenced":["SYS_NotificationsLog"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"SYS","summary":"Inserts a delivery log record into SYS_NotificationsLog tracking the delivery status of a push notification to a specific user notification setting.","businessPurpose":"Records the outcome (success/failure) of each push notification delivery attempt, enabling the notification system to avoid re-sending delivered notifications and to report on delivery failures.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"ManageEvaluationsCommentsCustomFields","schema":"dbo","parameters":[{"name":"@Departments","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SelectedUsers","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@IncludeDeptFlag","dataType":"VeryShortText","direction":"IN","defaultValue":null},{"name":"@SortOrder","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@NStartdate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@NEnddate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":187,"tablesReferenced":["DH_DepartmentRotations","EVAL_BaseAnswerTypes","EVAL_EvaluationComments","EVAL_EvaluationGrade","EVAL_Evaluations","EVAL_Templates","Eval_TemplateOverallGrade","Eval_UserInbox","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.ManageEvaluationsCommentsCustomFields","MessageDistributionManager.cs"],"complexity":"very-complex","aiEnrichment":null,"module":"SYS","summary":"Builds a comprehensive evaluation comment export dataset by joining evaluations, comments, acknowledgements, review feedback, and custom fields across multiple user IDs and date ranges, returning a structured result for report generation.","businessPurpose":"Powers the custom field and comments export report that program directors use to review all evaluation narrative feedback (PD comments, overall comments, acknowledgement comments, and review comments) for residents across a time period.","optimizationRecommendations":["Builds a large temp table #EvaluationTempCustomFields through row-by-row iteration (evident from the Loopcount/RowCount declare pattern); replace with a set-based JOIN across evaluation tables.","The 20+ column temp table structure suggests this SP is aggregating data that could be served by a properly indexed view or a dedicated reporting procedure."],"migrationRelevance":"high"},{"name":"MovingPagesOrChapters","schema":"dbo","parameters":[{"name":"@ContentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["HELP_Contents"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.MovingPagesOrChapters"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Updates the ParentID of a help content item to move it to a new parent in the Help_Contents hierarchy.","businessPurpose":"Supports drag-and-drop or administrative reorganisation of help pages and chapters within the MyHelp documentation tree.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"RegisterFirebaseToken","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@Token","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["SYS_NotificationServices","SYS_UserNotificationSettings"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Registers a Firebase web push notification token for a user if not already registered, inserting into SYS_UserNotificationSettings with the Firebase service ID.","businessPurpose":"Enables web push notifications by registering the browser's Firebase token for a user, allowing the platform to send push notifications to users through the Firebase Cloud Messaging service.","optimizationRecommendations":["The NOT EXISTS check followed by INSERT is subject to a race condition in concurrent environments; a MERGE or unique constraint with error handling would be safer."],"migrationRelevance":"medium"},{"name":"SaveMailDistributionTemplateInfo","schema":"dbo","parameters":[{"name":"@DBType","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@CreatedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TemplateName","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@ProgramTypes","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@DeptIDs","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@TemplateID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@AccessID","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@SpecialtyID","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":111,"tablesReferenced":["SEC_MailDistributionTemplateSection","SEC_Programs","SEC_Specialty","SEC_UserTypes"],"sprocsCalledFromBody":["GetRowValuesToString"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.SaveMailDistributionTemplateInfo","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Builds and saves a mail distribution template configuration by parsing program type, speciality, access ID, and user type ID lists into a composite '@#@'-delimited string, then inserts or updates a SEC_MailDistributionTemplateSection record.","businessPurpose":"Persists the configuration of a mail distribution template including the target audience filters (program types, specialities, user types) that determine which users receive the distribution.","optimizationRecommendations":["Storing multiple filter values as a single delimited string in one column (SelectedValues with '@#@' separator) is a poor data design choice that makes querying, validation, and migration extremely difficult; normalise into a related detail table.","Uses dbo.GetRowValuesToString with temp tables to concatenate code values from reference tables; a set-based STRING_AGG approach would be cleaner.","The SP name starts with 'Save' but also handles updates; this is acceptable, but the insert/update branching should be made explicit."],"migrationRelevance":"medium"},{"name":"SendManualEvaluationReminders","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":475,"tablesReferenced":["EVAL_EmailTemplate","EVAL_Evaluations","EVAL_Templates","SEC_Departments"],"sprocsCalledFromBody":["GetPendingEvaluationsForManualEvaluationReminders"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.SendManualEvaluationReminders","MessageDistributionManager.cs"],"complexity":"complex","aiEnrichment":null,"module":"SYS","summary":"Iterates over pending manual assignment records and eligible users to send personalised evaluation reminder emails by queuing them in SCHE_ApplicationEmailSchedules, with department-aware HTML template population and loop-based user and evaluation iteration.","businessPurpose":"Drives the manual evaluation reminder email workflow that allows program coordinators to trigger reminder emails to residents or faculty who have incomplete evaluations, supporting timely completion of required clinical assessments.","optimizationRecommendations":["Nested WHILE loops (users outer, evaluations inner) with individual InsertApplicationEmailSchedules calls per user-evaluation pair creates O(n*m) SP invocations; convert to set-based bulk insert.","Department-level email template population is done inside the loop on every iteration; move template loading outside the loop.","Large number of scalar variable declarations and sequential assignments; consider using a temp table to batch process user-evaluation pairs.","This is a scheduler-called SP and its performance directly impacts the responsiveness of the reminder system."],"migrationRelevance":"high"},{"name":"UpdateApplicationEmailSend","schema":"dbo","parameters":[{"name":"@ApplicationEmailScheduleID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":58,"tablesReferenced":["SCHE_ApplicationEmailSchedules","SEC_KeyTxtInfo"],"sprocsCalledFromBody":["GetEmailVerificationTemplate"],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["ApplicationEmailSchedule.cs.GetApplicationEmailSend"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Marks an email schedule entry as sent in SCHE_ApplicationEmailSchedules, records the error message if any, and performs additional password/token-related updates for user deletion emails.","businessPurpose":"Called by the email sender service after dispatching a scheduled email to mark it complete and update any post-send state (e.g. invalidating login tokens for deleted users).","optimizationRecommendations":["The additional post-send processing (reading encryption keys, updating passwords for deleted users) is mixed into what should be a simple status update; consider separating this logic.","Creates a temp table #Emails inside what appears to be a simple update procedure; the temp table's purpose needs review to ensure it is not a leftover."],"migrationRelevance":"high"},{"name":"UpdateKeySectionByKeyID","schema":"dbo","parameters":[{"name":"@KeyID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Section","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@KeyValue","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SecondaryKeyID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["Help_KeyValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["HelpGroupManager.cs.UpdateKeySectionByKeyID"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Updates the Section, KeyValue, ModifiedBy, and ModifiedDate fields for one or two help key records in Help_KeyValues by KeyID.","businessPurpose":"Allows administrators to update contextual help key mappings that link platform UI locations to their corresponding help content entries.","optimizationRecommendations":["The IN(@KeyID, @SecondaryKeyID) pattern updates both keys with identical Section and KeyValue, which may not always be the intended behaviour if the two keys represent different topics."],"migrationRelevance":"low"},{"name":"UpdateMyHelpSection","schema":"dbo","parameters":[{"name":"@SectionID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@IsActive","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@AccessLevel","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["HELP_Sections"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["SectionsGroupManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Updates a help section's name, description, active status, and access level in HELP_Sections within a transaction, rolling back on error.","businessPurpose":"Allows administrators to modify the properties of an existing help section in the MyHelp system.","optimizationRecommendations":["GOTO PROBLEM error handling should be replaced with TRY/CATCH.","Missing BEGIN wrapper at the procedure level (relies on implicit block); should be wrapped in BEGIN/END."],"migrationRelevance":"low"},{"name":"UpdateQuestionActiveFlag","schema":"dbo","parameters":[{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.UpdateQuestionActiveFlag","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Sets IsClosed = 1 on a training event and updates the ModifiedBy and ModifiedDate fields, effectively closing the event for further registration.","businessPurpose":"Allows administrators to close a training event from accepting new registrations, used when an event is full or the registration period has ended.","optimizationRecommendations":["The SP is named 'UpdateQuestionActiveFlag' but actually closes a training event; the name is highly misleading and should be renamed to something like CloseTrainingEvent."],"migrationRelevance":"low"},{"name":"UpdateTrainingEvents","schema":"dbo","parameters":[{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventTitle","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EventDescription","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@MaxRegistrations","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EventStartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EventEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@RegistrationStartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@RegistrationEndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@IsClosed","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FileName","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["SEC_TrainingEvents"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["MailDistributionManager.cs.Update","MessageDistributionManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"SYS","summary":"Updates all editable fields of a training event record in SEC_TrainingEvents for the given EventID.","businessPurpose":"Persists administrator edits to training event details including title, description, dates, registration window, and capacity.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateTrainingSeminar","schema":"dbo","parameters":[{"name":"@LoggedInUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@TrainingID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@InstName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@DepartmentName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@FirstName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@LastName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Address","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@City","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@State","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@Zip","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@EMail","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Phone","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CreditCard","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CreditCardNumber","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ExpDate","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CVNCode","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@ChargeAmount","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FullName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@BillingAddress","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Status","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@Comments","dataType":"LargeText","direction":"IN","defaultValue":null},{"name":"@LastUserUpdate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@LastSysUpdate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@MealDay1","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@MealDay2","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@MealDay3","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@EventID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PaymentType","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CheckNumber","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@CheckDate","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":90,"tablesReferenced":["SEC_TrainingSeminar","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["ScheduleTemplateManager.cs.UpdatetrainingSeminar","MailDistributionManager.cs.Update","MessageDistributionManager.cs"],"complexity":"moderate","aiEnrichment":null,"module":"SYS","summary":"Updates a training seminar registration record with role-based field access: System Administrators can update all fields including payment and status, while other users can only update personal details.","businessPurpose":"Allows administrators to modify registration records and allows users to update their own registration details, with role-based field-level access control enforced in the procedure.","optimizationRecommendations":["Two nearly identical UPDATE statements differentiated only by which columns are included; could be unified with a single statement using role-conditional column assignments, or separated into two explicitly named procedures."],"migrationRelevance":"low"}]}