{"module":"PTL","displayName":"Patient Logs","procedureCount":150,"procedures":[{"name":"AcceptListOfPtLogs","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":53,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.AcceptListOfPtLogs"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Accepts a list of patient logs for review by inserting review records and marking them as closed for the given user.","businessPurpose":"Used by supervisors or program directors to bulk-accept multiple patient log submissions in the PTL module, marking them as reviewed and closed in one operation.","optimizationRecommendations":["Replace dbo.SplitIDs(@PtLogIDs) with a table-valued parameter to avoid string splitting overhead on large ID lists.","The INSERT then UPDATE pattern can be collapsed into a single MERGE statement to reduce round-trips."],"migrationRelevance":"medium"},{"name":"AcceptPatientLogList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.AcceptPatientLogList"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Updates the supervisor review status of a list of patient log submissions to 'accepted' (status ID 2).","businessPurpose":"Allows supervisors to bulk-approve patient log submissions in the PTL module by updating the review status field.","optimizationRecommendations":["Replace fnSplit(@IDs,',') with a table-valued parameter for better performance on large ID lists."],"migrationRelevance":"low"},{"name":"AddDiagnosisForSubmittedPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":27,"tablesReferenced":["PTL_PatientLogSubmittedDiagnosisList"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Inserts one or more diagnoses for a submitted patient log entry, marking the first one as the primary diagnosis.","businessPurpose":"Supports the clinical data capture workflow by allowing diagnoses to be attached to a submitted patient encounter log, with automatic primary diagnosis designation.","optimizationRecommendations":["Replace SplitTextCSV with a table-valued parameter to avoid repeated string parsing.","The IDENTITY-based primary selection (MIN(id)) is fragile; consider passing the primary diagnosis ID explicitly."],"migrationRelevance":"high"},{"name":"AddDXClassificationSetting","schema":"dbo","parameters":[{"name":"@DiagnosisClassificationID","dataType":"BigInt","direction":"IN","defaultValue":null},{"name":"@PGYValue","dataType":"BigInt","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_DiagnosisClassificationsSettings"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.AddDXClassificationSetting"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a required-count setting for a diagnosis classification at a specific PGY level, skipping the operation if RequiredCount is -1.","businessPurpose":"Configures curriculum requirements for diagnosis classifications in the PTL module, allowing program directors to set how many encounters of a given type are required per training year.","optimizationRecommendations":["Use a MERGE statement instead of separate EXISTS check plus INSERT/UPDATE to avoid the read-then-write anti-pattern."],"migrationRelevance":"medium"},{"name":"AddEncounterTypeForImport","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Inserts a new encounter type (competence level) for a department during data import and returns the new ID.","businessPurpose":"Used during bulk patient log import to create encounter types that do not yet exist in the system for the target department.","optimizationRecommendations":["Use SCOPE_IDENTITY() instead of SCOPE_IDENTITY() (already used); no significant issues."],"migrationRelevance":"low"},{"name":"AddImportedPatientLogCustomFieldData","schema":"dbo","parameters":[],"lineCount":113,"tablesReferenced":["PTL_FreeTextFieldValues","PTL_LargeDateFieldValues","PTL_LargeNumberFieldValues","PTL_LongTextFieldValues","PTL_LookupFieldValues","PTL_NumberFieldValues","PTL_ShortTextValues"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.SaveImportedSubmittedPatientLogCustomFieldData"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Iterates over a table-valued variable of custom field data and inserts each row into the appropriate typed field value table based on the field type ID.","businessPurpose":"Handles the custom field portion of patient log bulk import, routing numeric, text, date, and lookup field values to their respective storage tables.","optimizationRecommendations":["Replace the row-by-row WHILE loop with set-based INSERT statements using CASE or separate filtered INSERT statements per field type — this is a major performance bottleneck.","Drop the temp table (#tblImportPatientLogCustomFieldData) creation and use the table variable directly to avoid tempdb overhead.","ISNUMERIC is unreliable for detecting valid integers; use TRY_CAST instead."],"migrationRelevance":"medium"},{"name":"AddLearnerReviewForPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_PatientLogSubmittedLearnerReview"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.SaveLearnerReview"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Inserts a learner review record for a submitted patient log with comments and a reviewed flag.","businessPurpose":"Supports the learner self-review workflow in the PTL module, allowing trainees to acknowledge or comment on their patient encounter after supervisor feedback.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"AddPatientLogDefaultFieldAndGroupOrderData","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_DepartmentFieldGroupOrder","PTL_DepartmentFieldOrder","PTL_FieldGroups","PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Populates the department field order and field group order tables with any missing default entries for a given department.","businessPurpose":"Ensures that when a new patient log form is set up for a department, all fields and field groups have display-order entries, which drives the form rendering order.","optimizationRecommendations":["The ROW_NUMBER() OVER (ORDER BY FieldGroupID) for group ordering is non-deterministic if FieldGroupIDs are not contiguous; consider making order explicit."],"migrationRelevance":"medium"},{"name":"AddPatientLogEducationDX","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EducationDX","dataType":"LongText","direction":"IN","defaultValue":null}],"lineCount":27,"tablesReferenced":["PTL_DiagnosisClassifications"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Inserts a new diagnosis classification (Education DX) for a department and returns the new ID.","businessPurpose":"Allows program administrators to add new diagnostic classification categories used to categorize patient encounters in the PTL module.","optimizationRecommendations":["Use SCOPE_IDENTITY() instead of @@IDENTITY for safer identity retrieval in trigger-possible environments."],"migrationRelevance":"medium"},{"name":"AddPatientLogEncounterType","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncounterType","dataType":"LongText","direction":"IN","defaultValue":null}],"lineCount":27,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Inserts a new encounter type (competence level) for a department and returns the new ID.","businessPurpose":"Allows program administrators to define new encounter types (e.g., observation, primary care) used when submitting patient logs.","optimizationRecommendations":["Use SCOPE_IDENTITY() instead of @@IDENTITY."],"migrationRelevance":"medium"},{"name":"AddPatientLogField","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@DisplayName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@VisibilityTypeID","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@FieldTypeID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsSystem","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsHidden","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@DefaultValue","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@UpperBound","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@LowerBound","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":158,"tablesReferenced":["MGMT_FieldTypes","PTL_DepartmentFieldOrder","PTL_FieldGroups","PTL_FieldGroupsBase","PTL_FieldTypeInfo","PTL_Fields","PTL_FieldsBase","PTL_FieldsGroupsInfo","PTL_LookupItems","PTL_Lookups","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.Save"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Creates a new custom field for the patient log form, handling field group bootstrapping, lookup replication, and cross-department propagation based on visibility type.","businessPurpose":"Core field management SP for the PTL module that enables administrators to add custom data collection fields to patient log forms with support for institution-wide or global sharing.","optimizationRecommendations":["The SP has extremely high cyclomatic complexity with deeply nested IF/ELSE blocks — refactor into smaller atomic SPs.","Multiple correlated subqueries in INSERT SELECT statements (e.g., MAX([Order])+1 per department) should be pre-computed with a window function.","Repeated use of @@IDENTITY is unsafe in the presence of triggers; use SCOPE_IDENTITY() or OUTPUT clause.","Cross-apply to RetrieveDepartments() for each visibility type case causes repeated TVF evaluation; cache results in a temp table."],"migrationRelevance":"high"},{"name":"AddPatientLogFieldLookup","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":19,"tablesReferenced":["PTL_Lookups"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Inserts a new lookup list for a patient log field and returns the new lookup ID.","businessPurpose":"Creates a named dropdown/lookup list that can be associated with custom patient log fields of lookup type.","optimizationRecommendations":["Use SCOPE_IDENTITY() instead of @@IDENTITY."],"migrationRelevance":"low"},{"name":"AddPatientLogFieldLookupItem","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["PTL_LookupItems"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Appends a new item to a lookup list, automatically assigning the next sort order, and returns the new item ID.","businessPurpose":"Adds selectable options to dropdown fields on patient log forms, supporting the dynamic configuration of lookup-type custom fields.","optimizationRecommendations":["Use SCOPE_IDENTITY() instead of @@IDENTITY.","The MAX(SortOrder) query with GROUP BY and a subsequent SET is two operations; a single scalar subquery is cleaner."],"migrationRelevance":"low"},{"name":"AddPatientLogForReview","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"CounterNumber","direction":"IN","defaultValue":null},{"name":"@ReviewedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsDifferenceInAnticipation","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":41,"tablesReferenced":["PTL_PatientLogSubmittedForReview"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.SaveCaseReview"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Inserts a review record for a submitted patient log with initial course summary, outcome, and follow-up fields.","businessPurpose":"Initiates the supervisor review workflow for a patient log, creating the review record that supervisors fill out when evaluating a trainee's case write-up.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"AddPatientLogLocation","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Inserts a new clinical location for a department and returns the new location ID.","businessPurpose":"Allows program administrators to define the clinical sites or wards that trainees can select when submitting patient logs.","optimizationRecommendations":["Use SCOPE_IDENTITY() instead of @@IDENTITY."],"migrationRelevance":"low"},{"name":"AddPatientLogLookup","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":19,"tablesReferenced":["PTL_Lookups"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.Save"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Inserts a new lookup list for a patient log and returns the new lookup ID.","businessPurpose":"Duplicate of AddPatientLogFieldLookup; creates a named lookup list for a department's patient log configuration.","optimizationRecommendations":["This SP appears to be a duplicate of AddPatientLogFieldLookup — consider consolidating.","Use SCOPE_IDENTITY() instead of @@IDENTITY."],"migrationRelevance":"low"},{"name":"AddPatientLogLookupItem","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["PTL_LookupItems"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Appends an item to a lookup list with auto-incremented sort order.","businessPurpose":"Adds options to dropdown lookup fields on patient log forms; a near-duplicate of AddPatientLogFieldLookupItem.","optimizationRecommendations":["Consolidate with AddPatientLogFieldLookupItem — these two SPs have nearly identical logic."],"migrationRelevance":"low"},{"name":"AddPatientLogSupervisor","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["PTL_PatientLogSupervisors"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Adds a supervisor to a department's patient log supervisor list, restoring a soft-deleted record if one exists rather than creating a duplicate.","businessPurpose":"Manages the list of supervisors who can receive and review patient log submissions for a given department.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"AddPtLogLocationForImport","schema":"dbo","parameters":[],"lineCount":19,"tablesReferenced":["PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Inserts a new location for a department during patient log import and returns the new location ID.","businessPurpose":"Used during bulk data import to create clinical locations that do not yet exist for the target department.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"AddSubmitedProcedureForPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProcedureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SupervisorID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CompletedDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ParticipationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ConsentTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ComplicationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ModifiedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":67,"tablesReferenced":["PRC_ProceduresSubmitted","PTL_PatientLogSubmittedProcedures"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Creates a procedure submission record in PRC_ProceduresSubmitted and links it to a patient log submission via PTL_PatientLogSubmittedProcedures.","businessPurpose":"Allows trainees to log clinical procedures performed during a patient encounter as part of the PTL submission workflow.","optimizationRecommendations":["The conditional CHECK (EXISTS ... WHERE ProceduresSubmittedID = @ProceduresSubmittedID) immediately after INSERT is redundant — the SCOPE_IDENTITY() guarantees the row was inserted.","Use SCOPE_IDENTITY() consistently instead of mixing @@IDENTITY."],"migrationRelevance":"high"},{"name":"AddSubmitedProcedureImport_Update","schema":"dbo","parameters":[{"name":"@NiImportID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProcedureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SupervisorID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@CompletedDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ConsentTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresStatusID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@IsGrandFathered","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@ParticipationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ComplicationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@IsDeleted","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@ModifiedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":141,"tablesReferenced":["PRC_ProceduresSubmitted","PTL_NiImportLog","PTL_PatientLogSubmittedProcedures"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"During NI import, inserts a new procedure submission if no matching record exists, links it to the patient log, and logs the result (success or duplicate) to PTL_NiImportLog.","businessPurpose":"Handles procedure records during third-party (NI) data imports, with duplicate detection and audit logging to track import outcomes per record.","optimizationRecommendations":["The duplicate detection query uses multiple LEFT JOINs with a complex WHERE clause — ensure composite indexes exist on PRC_ProceduresSubmitted (ProcedureID, DepartmentID, UserID, SubmittedDate, CompletedDate).","The commented-out ParticipationTypeID filter suggests evolving business logic; dead code should be removed."],"migrationRelevance":"medium"},{"name":"AddSubmitedProcedureImport_Update2","schema":"dbo","parameters":[{"name":"@NiImportID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProcedureID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SupervisorID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@CompletedDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@ConsentTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresStatusID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@IsGrandFathered","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@ParticipationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@ComplicationTypeID","dataType":"BigNumber","direction":"IN","defaultValue":null},{"name":"@IsDeleted","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@ModifiedBy","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedId","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":140,"tablesReferenced":["PRC_ProceduresSubmitted","PTL_NiImportLog","PTL_PatientLogSubmittedProcedures"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Version 2 of the NI import procedure SP, adding InternalID-based deduplication by also checking PTL_NiImportLog for prior successful imports of the same internal record.","businessPurpose":"Improved version of the NI import handler that prevents re-importing the same procedure record identified by an external system's internal ID.","optimizationRecommendations":["Nearly identical to AddSubmitedProcedureImport_Update; extract shared logic into a common SP or parameterize the deduplication strategy.","The JOIN to PTL_NiImportLog in the deduplication query adds significant overhead — ensure NiImportLog is indexed on (InternalID, ResultID)."],"migrationRelevance":"medium"},{"name":"AddSubmittedPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUser","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedSupervisorID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FirstLogDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@LastLogDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@LocationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CompetenceLevelID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsDischarged","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@Age","dataType":"SmallNumber","direction":"IN","defaultValue":"NULL"}],"lineCount":128,"tablesReferenced":["PTL_CompetenceLevels","PTL_PatientLogSubmitted","PTL_Patients","SEC_Users","SYS_MobileAppSettings","SYS_NotificationModuleSettings","SYS_NotificationModules"],"sprocsCalledFromBody":["AddSysNotification"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Inserts a new patient log submission record, handles default encounter type setup, and sends a push notification to the supervisor if notification settings allow.","businessPurpose":"The primary SP for submitting a new patient encounter log in the PTL module; coordinates data insertion, notification dispatch, and mobile app URL generation for the supervisor review link.","optimizationRecommendations":["The notification eligibility check uses an OUTER APPLY which may be expensive — consider caching notification settings per user.","Hard-coded MD5 hash using fn_varbintohexstr is a deprecated SQL Server pattern; should be replaced with application-layer URL signing.","Environment detection via DB_NAME() comparison is a code smell — use a configuration table instead.","The correlated subquery for NotificationModuleSettingsID could be a JOIN."],"migrationRelevance":"high"},{"name":"AddSubmittedProceduresForPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["PTL_PatientLogSubmittedProcedures"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Links a list of existing procedure submission IDs to a patient log submission via PTL_PatientLogSubmittedProcedures.","businessPurpose":"Associates previously submitted procedure records with a patient log entry, enabling the combined tracking of diagnoses and procedures in a single encounter.","optimizationRecommendations":["Replace SplitTextCSV with a table-valued parameter for better performance."],"migrationRelevance":"medium"},{"name":"CloseCase","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":27,"tablesReferenced":["PTL_PatientLogSubmittedForReview"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.CloseCase"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Closes a patient log review case by updating the ClosedDate and ClosedBy fields, or creating a new review record that is immediately closed if none exists.","businessPurpose":"Allows supervisors to close (finalize) a patient log review, marking the case as complete without requiring full review data entry.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DeletePatientLogEducationDX","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.Delete"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Soft-deletes a diagnosis classification if it is in use by any patient log, or hard-deletes it (along with settings) if it is unused.","businessPurpose":"Allows administrators to remove diagnosis classification categories, protecting data integrity by soft-deleting when the classification is still referenced by existing patient logs.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DeletePatientLogEncounterType","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["PTL_CompetenceLevels","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.Delete"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Soft-deletes an encounter type (competence level) if referenced by patient logs, or hard-deletes it if unused.","businessPurpose":"Allows administrators to remove encounter type options from patient log forms, with referential integrity protection via soft-delete when records exist.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DeletePatientLogField","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.Delete"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Soft-deletes a custom patient log field for a department by setting IsDeleted=1.","businessPurpose":"Removes a custom field from the patient log form for a department while preserving historical data captured in that field.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DeletePatientLogLocation","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["PTL_Locations","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.Delete"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Soft-deletes a clinical location if referenced by patient logs, or hard-deletes it if unused.","businessPurpose":"Allows administrators to retire clinical locations from the patient log form while protecting referential integrity.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeletePatientLogSupervisor","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSupervisors"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Soft-deletes a supervisor from a department's patient log supervisor list if they have associated submissions, or hard-deletes them if not.","businessPurpose":"Manages the removal of supervisors from the patient log review workflow for a department.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteSubmitedPatientLogDiagnosis","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PTL_PatientLogSubmittedDiagnosisList"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Deletes all diagnosis entries for a submitted patient log and returns the log ID.","businessPurpose":"Clears the diagnosis list for a patient log submission, typically called before re-inserting an updated set of diagnoses during an edit.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DeleteSubmitedProcedureForPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProceduresSubmittedID","dataType":"largeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PTL_PatientLogSubmittedProcedures"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.SavePatientLogProceduresList"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Removes a specific procedure link from a patient log submission.","businessPurpose":"Allows trainees to remove a procedure that was incorrectly associated with a patient log encounter.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DeleteSubmittedPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.UpdateSubmittedPatientLogDeletedFlag"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Soft-deletes a submitted patient log by setting IsDeleted=1.","businessPurpose":"Allows trainees or administrators to remove a patient log submission without permanently destroying the record.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"DoesPatientLogEducationDXExists","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EducationDX","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@EducationDXId","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["PTL_DiagnosisClassifications"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.DoesEducationDXExist"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Checks for duplicate diagnosis classification names within a department, with separate logic for add mode and edit mode.","businessPurpose":"Validates uniqueness of diagnosis classification names before allowing an administrator to create or rename one.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DoesPatientLogEncounterTypeExists","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncounterType","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@EncounterTypeId","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.DoesEncounterTypeExist"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Checks for duplicate encounter type names within a department for add or edit mode.","businessPurpose":"Validates uniqueness of encounter type names before allowing creation or renaming in the department's patient log configuration.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DoesPatientLogFieldNameExist","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.DoesFieldNameExist"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Checks whether a field name already exists in a department's patient log fields for add or edit mode.","businessPurpose":"Prevents duplicate custom field names on patient log forms during field creation or renaming.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DoesPatientLogLocationNameExists","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LocationName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@LocationId","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":39,"tablesReferenced":["PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.DoesLocationNameExist"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Checks for duplicate location names within a department's patient log locations for add or edit mode.","businessPurpose":"Validates uniqueness of clinical location names before creation or renaming.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DoesPatientLogLookUpNameExist","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupName","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"CounterNumber","direction":"IN","defaultValue":null}],"lineCount":37,"tablesReferenced":["PTL_Lookups"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.DoesLookUpNameExist"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Checks whether a lookup list name already exists for a department in add or edit mode.","businessPurpose":"Prevents duplicate lookup list names in a department's patient log configuration.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"DoesPatientLogSupervisorActive","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SupervisorID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.DoesPatientLogSupervisorActive"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns 1 if a supervisor has any patient log submissions in a department, 0 otherwise.","businessPurpose":"Used to determine if a supervisor is active in a department's patient log workflow before allowing deletion.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GeneratePatientDxDepartmentReport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":186,"tablesReferenced":["PRC_DiagnosisList","PTL_DiagnosisClassifications","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["PatientLogReportManager.cs.GeneratePatientDxDepartmentReport"],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Generates a dynamic pivot report of patient log encounters broken down by diagnosis classification and diagnosis, with columns for each PGY level, filtered by date, location, supervisor, encounter type, and patient demographics.","businessPurpose":"Provides program directors and coordinators with a cross-tabulated report showing trainee case exposure by diagnosis category and training year across linked departments.","optimizationRecommendations":["The dynamic SQL pivot via sp_executesql rebuilds every column list on each call — consider caching or pre-computing the column structure.","Multiple temporary tables with conditional inserts from SplitIDs create repeated TVF overhead; use table-valued parameters.","The WHILE loop to build the PGY number table (1..MaxPGY) should be replaced with a numbers table or recursive CTE.","The NOT EXISTS anti-join in the CTE for primary diagnosis can be rewritten as a LEFT JOIN / IS NULL pattern for better performance."],"migrationRelevance":"high"},{"name":"GeneratePatientLogCategoryReport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ReportByFilter","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":501,"tablesReferenced":["PRC_DiagnosisList","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_Locations","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["PatientLogReportManager.cs.GeneratePatientLogCategoryReport"],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Generates a multi-view category report of patient log encounters grouped by diagnosis classification, encounter type, or location with optional cross-grouping, supporting multiple ReportByFilter modes.","businessPurpose":"Powers the category-level analytics view in the PTL module, allowing program directors to see trainee encounter patterns by diagnosis, encounter type, or clinical location.","optimizationRecommendations":["The procedure uses a v_PTL_PatientLogSubmitted_per_days view inside a large aggregation — ensure this view is indexed or materialized.","Eight temporary tables are created per execution; high tempdb contention risk under concurrent load.","The five UNION ALL blocks for different ReportByFilter values could be refactored into a unified query with conditional aggregation.","PGY computation using GetPGYLevel() is called per-row in the WHERE clause — this is a scalar UDF being evaluated row-by-row, which prevents parallelism."],"migrationRelevance":"high"},{"name":"GeneratePatientLogDepartmentReport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":135,"tablesReferenced":["PRC_DiagnosisList","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["PatientLogReportManager.cs.GeneratePatientLogDepartmentReport"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Generates a dynamic pivot report of patient log encounters by diagnosis, with PGY-level columns, filtered by date range and multiple optional criteria.","businessPurpose":"Provides department-level patient encounter reporting for program directors, showing case counts by diagnosis name and training year.","optimizationRecommendations":["Dynamic SQL pivot pattern creates parameter injection risk if @PGYText values are not sanitized — verify all inputs are controlled.","GetPGYLevel() scalar UDF called in WHERE clause prevents parallelism; replace with an inline table-valued function or pre-computed values.","The PRINT @SQL_QUERY statement left in production code should be removed."],"migrationRelevance":"high"},{"name":"GeneratePatientLogDiagnosisReport__1","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":508,"tablesReferenced":["PRC_DiagnosisList","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Generates a patient log diagnosis report grouped by age (child/adult) with PGY-level breakdowns, supporting linked department hierarchies.","businessPurpose":"Provides diagnosis-level encounter counts for patients categorized by age group and training year, used by program directors for curriculum assessment.","optimizationRecommendations":["Multiple scalar UDF calls (GetPGYLevel, GetAge) per row prevent parallelism — replace with set-based calculations.","Complex WHILE loops and dynamic SQL should be refactored into a parameterized reporting approach.","This appears to be an older version (suffix __1) — verify it is still in active use before optimizing."],"migrationRelevance":"medium"},{"name":"GeneratePatientLogDiagnosisReport_181026","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":459,"tablesReferenced":["PRC_DiagnosisList","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"A dated version (October 2018) of the patient log diagnosis report with age group breakdown, likely a legacy snapshot.","businessPurpose":"Historical version of the diagnosis report SP; may have been kept as a rollback option or reference implementation.","optimizationRecommendations":["Evaluate whether this SP is still called in production; if not, it should be archived or removed to reduce maintenance burden."],"migrationRelevance":"low"},{"name":"GeneratePatientLogDiagnosisReport_20240522","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsOneSessionPerDay","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"}],"lineCount":495,"tablesReferenced":["PRC_DiagnosisList","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"A May 2024 version of the patient log diagnosis report, the current production version with PGY-level and age group breakdown.","businessPurpose":"Current production diagnosis report for the PTL module, generating per-trainee encounter counts by diagnosis and training year for accreditation reporting.","optimizationRecommendations":["Scalar UDF calls in WHERE clause (GetPGYLevel, GetAge) prevent parallelism; replace with computed columns or inline TVFs.","Dynamic SQL pivot is built anew each execution — consider caching the column list."],"migrationRelevance":"high"},{"name":"GeneratePatientLogDiagnosisReportForArchieved","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":488,"tablesReferenced":["PRC_DiagnosisList","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_DepartmentTrainingTypes","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Generates a diagnosis report similar to the main report but operating against archived patient log data.","businessPurpose":"Enables reporting on archived patient log encounters for historical analysis and accreditation documentation.","optimizationRecommendations":["Dynamic SQL with complex pivoting — same performance concerns as the active version.","Misspelling 'Archieved' in the SP name should be corrected to 'Archived' if the SP is still active."],"migrationRelevance":"medium"},{"name":"GeneratePatientLogDiagnosisReportTst","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@AgeGroup","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":249,"tablesReferenced":["PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_DepartmentTrainingTypes","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"A test/staging version of the patient log diagnosis report, likely used for QA validation.","businessPurpose":"Development or testing variant of the diagnosis report; should not be called in production.","optimizationRecommendations":["Remove or archive this SP if it is not part of the production code path."],"migrationRelevance":"none"},{"name":"GeneratePatientLogSummaryReport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":507,"tablesReferenced":["PRC_DiagnosisList","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["PatientLogReportManager.cs.GeneratePatientLogSummaryReport"],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Generates a comprehensive dynamic pivot summary report of patient log encounters per user with PGY-level columns, supporting multi-department hierarchies and multiple filter criteria.","businessPurpose":"Powers the PTL summary dashboard for program directors, showing total patient encounter counts per resident and per PGY level across departments.","optimizationRecommendations":["Dynamic SQL execution rebuilds the entire column list per call — high overhead for frequent report loads.","Scalar UDF GetPGYLevel called per row prevents query parallelism; refactor to set-based PGY computation.","WHILE loop for PGY number table generation should use a numbers CTE."],"migrationRelevance":"high"},{"name":"GeneratePatientLogSummaryReport_Test","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null}],"lineCount":474,"tablesReferenced":["PRC_DiagnosisList","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Test version of the summary report SP, likely for QA or staging.","businessPurpose":"Development/testing variant of the patient log summary report; should not be in active production use.","optimizationRecommendations":["Remove or archive if not part of the production code path."],"migrationRelevance":"none"},{"name":"GeneratePatientLogSummaryReport2","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@Gender","dataType":"VerySmallNumber","direction":"IN","defaultValue":null}],"lineCount":226,"tablesReferenced":["PRC_DiagnosisList","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_Patients","SEC_DepartmentLinks","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"An alternate version of the summary report that uses temporary tables for department data rather than a local table variable.","businessPurpose":"Alternate implementation of the patient encounter summary report; may serve a specific department type or reporting scenario.","optimizationRecommendations":["Consolidate with GeneratePatientLogSummaryReport if the logic overlap is high."],"migrationRelevance":"medium"},{"name":"GetAvailableDiagnosis","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":27,"tablesReferenced":["PRC_DiagnosisList","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetAvailableDiagnosis"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns a distinct list of diagnoses that have been used in patient logs, optionally filtered by department hierarchy or specific user IDs.","businessPurpose":"Populates diagnosis filter dropdowns in PTL reporting views, showing only diagnoses that have actual encounter data.","optimizationRecommendations":["The OR condition combining department filter and user ID filter prevents index use — consider splitting into two queries with UNION.","Temp table for linked departments should have an index on DepartmentID."],"migrationRelevance":"medium"},{"name":"GetCaseReviewForPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_PatientLogSubmittedForReview"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.FetchCaseReviewInfo"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Retrieves the review record details for a submitted patient log including reviewer, dates, comments, and outcome fields.","businessPurpose":"Loads the supervisor's review data when a trainee or administrator views the review status of a patient log submission.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetCustomFieldDetailsByName","schema":"dbo","parameters":[{"name":"@Name","dataType":"LargeText","direction":"IN","defaultValue":null}],"lineCount":43,"tablesReferenced":["MGMT_FieldTypes","MGMT_VisibilityTypes","PTL_DepartmentFieldOrder","PTL_FieldGroups","PTL_FieldTypeInfo","PTL_Fields","PTL_FieldsGroupsInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.GetCustomFieldDetails"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns custom field metadata for a department, optionally filtering by field name, joining field type, visibility, and group information.","businessPurpose":"Retrieves custom field definitions needed for patient log import field mapping, matching source data columns to target form fields.","optimizationRecommendations":["The hard-coded DepartmentID = 13 in two JOIN conditions appears to be a bug — should likely use @DepartmentID."],"migrationRelevance":"medium"},{"name":"GetDataForPatientLogExport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"SmallDate","direction":"IN","defaultValue":null}],"lineCount":239,"tablesReferenced":["PRC_ConsentTypes","PRC_CustomFieldsGroupProcedures","PRC_DiagnosisList","PRC_Fields","PRC_LookupFieldValues","PRC_LookupItems","PRC_Procedures","PRC_ProceduresSubmitted","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_Fields","PTL_FreeTextFieldValues","PTL_LargeDateFieldValues","PTL_LargeNumberFieldValues","PTL_Locations","PTL_LongTextFieldValues","PTL_LookupFieldValues","PTL_LookupItems","PTL_NumberFieldValues","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_PatientLogSubmittedForReview","PTL_PatientLogSubmittedProcedures","PTL_Patients","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["ExportPatientLogManager.cs.GetDataForpatientLogsExport"],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Generates a dynamic SQL export query that pivots patient log data including custom field values across all field types into a flat exportable result set.","businessPurpose":"Powers the data export functionality in the PTL module, allowing administrators to download patient log data including custom fields into spreadsheet format.","optimizationRecommendations":["Dynamic SQL with string concatenation in a WHILE loop is a performance and injection risk; use parameterized dynamic SQL with sp_executesql.","The WHILE loop for building column lists should be replaced with FOR XML PATH or STRING_AGG.","Multiple temp tables and table variables create high tempdb pressure for large exports.","The export SP family has 4 versions (GetDataForPatientLogExport, _1, _20220325, 4) — consolidate or document which version is current."],"migrationRelevance":"high"},{"name":"GetDataForPatientLogExport_1","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"SmallDate","direction":"IN","defaultValue":null}],"lineCount":312,"tablesReferenced":["PRC_ConsentTypes","PRC_CustomFieldsGroupProcedures","PRC_DiagnosisList","PRC_Fields","PRC_LookupFieldValues","PRC_LookupItems","PRC_Procedures","PRC_ProceduresSubmitted","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_Fields","PTL_FreeTextFieldValues","PTL_LargeDateFieldValues","PTL_LargeNumberFieldValues","PTL_Locations","PTL_LongTextFieldValues","PTL_LookupFieldValues","PTL_LookupItems","PTL_NumberFieldValues","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_PatientLogSubmittedForReview","PTL_PatientLogSubmittedProcedures","PTL_Patients","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Version 1 variant of the patient log export SP with dynamic column generation.","businessPurpose":"Alternate or earlier version of the patient log export query — likely kept for rollback or specific department use.","optimizationRecommendations":["Consolidate with the primary export SP or document the distinction."],"migrationRelevance":"low"},{"name":"GetDataForPatientLogExport_20220325","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"SmallDate","direction":"IN","defaultValue":null}],"lineCount":237,"tablesReferenced":["PRC_ConsentTypes","PRC_CustomFieldsGroupProcedures","PRC_DiagnosisList","PRC_Fields","PRC_LookupFieldValues","PRC_LookupItems","PRC_Procedures","PRC_ProceduresSubmitted","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_Fields","PTL_FreeTextFieldValues","PTL_LargeDateFieldValues","PTL_LargeNumberFieldValues","PTL_Locations","PTL_LongTextFieldValues","PTL_LookupFieldValues","PTL_LookupItems","PTL_NumberFieldValues","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_PatientLogSubmittedForReview","PTL_PatientLogSubmittedProcedures","PTL_Patients","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"A March 2022 dated version of the patient log export SP.","businessPurpose":"Historical snapshot of the export SP from March 2022; likely superseded by the current version.","optimizationRecommendations":["Archive or remove if superseded by the current GetDataForPatientLogExport."],"migrationRelevance":"none"},{"name":"GetDataForPatientLogExport4","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@RequestedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@StartDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@EndDate","dataType":"SmallDate","direction":"IN","defaultValue":null}],"lineCount":310,"tablesReferenced":["PRC_ConsentTypes","PRC_CustomFieldsGroupProcedures","PRC_DiagnosisList","PRC_Fields","PRC_LookupFieldValues","PRC_LookupItems","PRC_Procedures","PRC_ProceduresSubmitted","PTL_CompetenceLevels","PTL_DiagnosisClassifications","PTL_Fields","PTL_FreeTextFieldValues","PTL_LargeDateFieldValues","PTL_LargeNumberFieldValues","PTL_Locations","PTL_LongTextFieldValues","PTL_LookupFieldValues","PTL_LookupItems","PTL_NumberFieldValues","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedDiagnosisList","PTL_PatientLogSubmittedForReview","PTL_PatientLogSubmittedProcedures","PTL_Patients","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Version 4 variant of the patient log export SP.","businessPurpose":"Likely the most recent iteration of the dynamic patient log data export, incorporating newer field types or filter options.","optimizationRecommendations":["Document which version is the current production export SP and retire the others.","Same dynamic SQL and loop concerns as the primary version."],"migrationRelevance":"high"},{"name":"GetDeletedSubmittedPatientLogs","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedAcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":85,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetDeletedSubmittedPatientLogByCriteria"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Retrieves soft-deleted patient log submissions for a department or user, with role-based filtering that restricts certain user types to their own records.","businessPurpose":"Powers the 'deleted logs' view in the PTL admin interface, allowing authorized users to view and potentially restore deleted patient encounter records.","optimizationRecommendations":["The RetrieveDepartments() TVF used for linked department lookup should be ensured to have appropriate indexes.","Role-based filtering via @UserRoleID in conditional branches could be expressed more cleanly as a single parameterized query."],"migrationRelevance":"medium"},{"name":"GetDepartmentCriteriaTypeID","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@ProcedureCriteriaTypeID","dataType":"SMALLNUMBER","direction":"IN","defaultValue":"0"}],"lineCount":26,"tablesReferenced":["SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.GetDepartmentCriteriaTypeID","MyEvaluations.Business.Procedures/SupervisorsManager.cs"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the procedure and/or patient log criteria type IDs for a department based on non-zero input values.","businessPurpose":"Configures whether a department uses procedure-based or patient-log-based completion tracking, a key program setup step in MyEvaluations.","optimizationRecommendations":["The SP name (GetDepartmentCriteriaTypeID) is misleading — it actually performs UPDATE operations, not a GET; rename for clarity."],"migrationRelevance":"medium"},{"name":"GetDXClassificationSetting","schema":"dbo","parameters":[{"name":"@DiagnosisClassificationID","dataType":"BigInt","direction":"IN","defaultValue":null},{"name":"@PGYValue","dataType":"BigInt","direction":"IN","defaultValue":null}],"lineCount":72,"tablesReferenced":["PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings"],"sprocsCalledFromBody":["AddDXClassificationSetting"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.GetDXClassificationSetting"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Retrieves the required count setting for a diagnosis classification at a specific PGY level, falling back to a common setting if the PGY-specific one does not exist.","businessPurpose":"Provides the minimum required encounter count for a diagnosis category at a given training level, used to display completion progress on trainee dashboards.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetEducationDXIdByName","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_DiagnosisClassifications","PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.GetEducationDXIdByName"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns the diagnosis classification ID for a given name and department.","businessPurpose":"Used during import or lookup operations to resolve a diagnosis classification name to its database ID.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetEncounterTypeIdByName","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.GetEncounterTypeIdByName"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns the encounter type (competence level) ID for a given name and department.","businessPurpose":"Used during import or lookup operations to resolve an encounter type name to its database ID.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetLearnerReviewsForPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["PTL_PatientLogSubmittedLearnerReview","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.GetLearnerReviewsForPatientLog"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns all learner reviews for a patient log submission, including reviewer name with title prefix and review timestamp.","businessPurpose":"Displays the learner's self-review history for a patient log case, showing who reviewed it, when, and their comments.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetLocationIdByName","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":27,"tablesReferenced":["PTL_Fields","PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.GetLocationIdByName"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns the location ID for a given location name and department.","businessPurpose":"Used during import to resolve a location name string to its database ID for the target department.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetMyEvalsFieldsForPatientLogImporting","schema":"dbo","parameters":[],"lineCount":26,"tablesReferenced":["PTL_Fields","PTL_PatientLogImportingMyEvalsFields"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetMyEvalsFieldsForPatientLogImporting"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns all importable field names for patient log data, combining system-defined fields with active custom fields for the department.","businessPurpose":"Drives the field mapping step during patient log data import, presenting all available target fields for the user to map to source columns.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientCasesToReviewCount","schema":"dbo","parameters":[{"name":"@LoggedIUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":151,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","PTL_PatientLogSubmittedLearnerReview","SEC_Departments"],"sprocsCalledFromBody":["GetCountNotation"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.GetPatientCasesToReviewCount"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Retrieves the count and details of patient log cases pending supervisor review, with notification state tracking per case.","businessPurpose":"Powers the supervisor dashboard widget showing how many patient logs are awaiting their review, with new-message indicators.","optimizationRecommendations":["Uses a WHILE loop with cursor-like row-by-row processing via identity-indexed temp tables — replace with set-based aggregation.","The notification state computation per case inside a loop is O(n) in the number of cases; batch it."],"migrationRelevance":"medium"},{"name":"GetpatientidLoG","schema":"dbo","parameters":[],"lineCount":21,"tablesReferenced":["PTL_Patients"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns a list of patients with non-empty names and MRNs, excluding specific known bad patient IDs.","businessPurpose":"Provides a patient list for the patient log encryption or data cleanup process; the hard-coded exclusion IDs suggest targeted data remediation.","optimizationRecommendations":["Hard-coded patient ID exclusions (6378989, 6379031) should be stored in a configuration table, not embedded in the SP body."],"migrationRelevance":"low"},{"name":"GetPatientLogCustomFieldInfoByID","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":43,"tablesReferenced":["MGMT_FieldTypes","PTL_FieldTypeInfo","PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.FetchFieldInfo"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns all metadata for a specific custom patient log field by its ID, including field type, visibility, bounds, and lookup reference.","businessPurpose":"Loads a custom field's full configuration for the field edit form in the patient log administration interface.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientLogCustomLookupItems","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PTL_LookupItems"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.GetLookUpValues"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Returns all lookup items for a given lookup list in sort order.","businessPurpose":"Populates the list of selectable values for a lookup-type custom field on a patient log form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPatientLogDetails","schema":"dbo","parameters":[{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["PTL_PatientLogSubmitted","SEC_EventDetail","SEC_Events"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetPatientLogDetails"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Retrieves the audit trail details for a patient log submission including submitting user, supervisor, and the original submission date from the events log.","businessPurpose":"Provides the submission history detail view for a patient log case, showing who submitted it, who the supervisor was, and when it was submitted.","optimizationRecommendations":["Uses NOLOCK hints on multiple tables which can return dirty reads; evaluate whether eventual consistency is acceptable for audit data.","SEC_Events JOIN to PTL_PatientLogSubmitted may be slow without an index on SED.Identifier filtered to PatientLog event type."],"migrationRelevance":"medium"},{"name":"GetPatientLogEducationDX","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedPatientLog","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@PageMode","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"}],"lineCount":53,"tablesReferenced":["PTL_DiagnosisClassifications","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.FetchEducationDX"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns the list of diagnosis classifications for a department, with awareness of linked departments and the currently selected classification for a given patient log.","businessPurpose":"Populates the diagnosis classification dropdown when a trainee submits or edits a patient log, pre-selecting the current value if editing.","optimizationRecommendations":["Temp table for linked departments created on every call — use RetrieveDepartments() directly in the JOIN to avoid this overhead if the result set is small."],"migrationRelevance":"high"},{"name":"GetPatientLogEducationDXById","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PTL_DiagnosisClassifications"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.FetchEducationDXInfo"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Returns the name and sort order of a specific diagnosis classification by its ID.","businessPurpose":"Loads the details of a single diagnosis classification for the edit form in the patient log admin interface.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPatientLogEmailReminderSend","schema":"dbo","parameters":[{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":485,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","SEC_Departments","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Iterates over departments and users to send email reminders to supervisors for unreviewed patient log submissions using HTML templates.","businessPurpose":"Drives the automated email reminder system that prompts supervisors to review pending patient log submissions, supporting timely feedback in residency programs.","optimizationRecommendations":["Row-by-row cursor-like iteration over departments and users via WHILE loops is a major performance bottleneck — batch email dispatch at the application layer instead.","Email template processing in SQL is an anti-pattern; move to an application service.","The SP has high complexity and length — should be broken into discrete steps: identify pending logs, prepare notification data, dispatch via application layer."],"migrationRelevance":"medium"},{"name":"GetPatientLogEncounterType","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedPatientLog","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"},{"name":"@PageMode","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"}],"lineCount":57,"tablesReferenced":["PTL_CompetenceLevels","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.FetchEncounterTypes"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns encounter types (competence levels) for a department with mode-based filtering for submission vs. administration views, using linked department awareness.","businessPurpose":"Populates the encounter type dropdown on the patient log submission form and the admin management view with appropriate filtering per mode.","optimizationRecommendations":["Temp table for linked departments is created on every call — evaluate caching or using a direct JOIN to RetrieveDepartments()."],"migrationRelevance":"high"},{"name":"GetPatientLogEncounterType_prod","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedPatientLog","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@PageMode","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"}],"lineCount":48,"tablesReferenced":["PTL_CompetenceLevels","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Production variant of GetPatientLogEncounterType with linked department support for retrieving encounter types.","businessPurpose":"Production-flagged version of the encounter type retrieval SP; likely has different filtering or performance characteristics than the base version.","optimizationRecommendations":["Determine if this and GetPatientLogEncounterType can be consolidated into a single SP."],"migrationRelevance":"high"},{"name":"GetPatientLogEncounterTypeDetailsById","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.FetchEncounterTypeInfo"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Returns the name and description of a specific encounter type by its ID.","businessPurpose":"Loads the details of a single encounter type for the admin edit form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPatientLogFieldsList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["MGMT_FieldTypes","MGMT_VisibilityTypes","PTL_FieldTypeInfo","PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.FetchFields"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns all custom fields for a department with their type and visibility information.","businessPurpose":"Populates the custom field management grid in the patient log administration interface.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientLogFieldsToDraw","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":148,"tablesReferenced":["EVAL_EvaluateEvaluation","MGMT_FieldTypes","MGMT_VisibilityTypes","PTL_DepartmentFieldGroupOrder","PTL_DepartmentFieldOrder","PTL_FieldGroups","PTL_FieldGroupsBase","PTL_FieldTypeInfo","PTL_Fields","PTL_FieldsBase","PTL_FieldsGroupsInfo"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.FetchPatientLogsFieldsToDraw","PatientLogManager.cs.GetPatientLogsFieldsList","SubmittedProcedureManager.cs.IsPatientInfoIsRequiredForPtLog"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns the ordered list of fields and field groups for rendering a patient log form, bootstrapping default field/group data if not yet configured for the department, with performance logging.","businessPurpose":"Core form-rendering SP that drives the dynamic patient log form display, determining which fields appear, in what order, and in which groups.","optimizationRecommendations":["The performance logging via EVAL_EvaluateEvaluation table on every form render adds write overhead — ensure this table is indexed by procedure name and consider sampling.","The bootstrap INSERT (copying from base tables) runs on every call with an EXISTS guard — this guard check adds a read per request; consider a department-level flag."],"migrationRelevance":"high"},{"name":"GetPatientLogLocationDetailsById","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.FetchLocationNameInfo"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Returns the name and ID of a specific clinical location by its ID.","businessPurpose":"Loads location details for the edit form in the patient log administration interface.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPatientLogLocationNames","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedPatientLog","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"},{"name":"@PageMode","dataType":"VerySmallNumber","direction":"IN","defaultValue":"1"}],"lineCount":46,"tablesReferenced":["PTL_Locations","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.FetchLocationNames"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns clinical locations for a department with mode-based filtering for submission vs. administration views, with linked department awareness.","businessPurpose":"Populates the clinical location dropdown on the patient log submission form and the admin location management view.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientLogLookUpItemInfoByID","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PTL_Lookups"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.FetchLookUpInfo"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns lookup list metadata (ID, department, name) for a given lookup ID.","businessPurpose":"Loads lookup list details for display or edit in the patient log admin interface.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPatientLogLookUpValuesByLookUpID","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":19,"tablesReferenced":["PTL_LookupItems"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.FetchLookUpValues"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Returns all items in a lookup list ordered by sort order.","businessPurpose":"Populates the lookup item management grid in the admin interface when editing a lookup list.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPatientLogPatient__1","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@IsIncludeDischarged","dataType":"TINYINT","direction":"IN","defaultValue":"0"}],"lineCount":31,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_Patients"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Version 1 of the patient lookup SP for patient log forms, returning matching patient records.","businessPurpose":"Earlier version of the patient search functionality used when selecting a patient on the log submission form.","optimizationRecommendations":["Verify if this version is still in use; if superseded by GetPatientLogPatientInfo or similar, retire it."],"migrationRelevance":"low"},{"name":"GetPatientLogPatientInfo","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":16,"tablesReferenced":["PTL_Patients"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Returns the date of birth, MR number, and gender ID for a specific patient.","businessPurpose":"Loads patient demographics when a trainee selects a patient on the patient log submission form to auto-fill age and gender fields.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientLogPatientListForUser","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":22,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_Patients"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns distinct patients associated with a user's patient log submissions for a department, with non-empty name and MR number filters.","businessPurpose":"Populates the patient selection dropdown for a trainee when submitting a new patient log, showing their previously logged patients.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientLogReviewEmailReminder","schema":"dbo","parameters":[{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":198,"tablesReferenced":["PF_EmailTemplate","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.SendPatientLogReviewEmailReminder"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Generates and sends review reminder emails to supervisors for patient log submissions that have not been reviewed within the configured reminder period.","businessPurpose":"Automates supervisor review reminders in the PTL workflow, ensuring timely feedback on trainee patient encounter write-ups.","optimizationRecommendations":["Email generation and dispatch in SQL via HTML template assembly is an anti-pattern; move to application layer.","Large DECLARE block with many variables suggests this SP is doing too much — decompose into data-retrieval and dispatch steps."],"migrationRelevance":"medium"},{"name":"GetPatientLogsDeletedFields","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["MGMT_FieldTypes","MGMT_VisibilityTypes","PTL_FieldTypeInfo","PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.FetchDeletedFields"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns deleted custom fields for a department that can potentially be restored.","businessPurpose":"Powers the 'restore deleted fields' feature in the patient log admin interface, showing which custom fields have been soft-deleted.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPatientLogsSubmittedByUser","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":38,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","PTL_PatientLogSubmittedLearnerReview","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.GetCasesSubmittedByUser"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns patient log submissions associated with a given patient log and reviewer, including the last learner review date and professional title prefix.","businessPurpose":"Provides the list of patient logs submitted by a user for display in the supervisor review queue, with learner review status indicators.","optimizationRecommendations":["The MAX(CreatedDateTime) subquery per row for last learner review could be pre-computed as a JOIN for better performance."],"migrationRelevance":"high"},{"name":"GetPatientLogsTobeReviewedByUser","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUser","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SortBy","dataType":"VARCHAR(100)","direction":"IN","defaultValue":"''"}],"lineCount":125,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","PTL_PatientLogSubmittedLearnerReview","PTL_Patients","SEC_MyEvalMainPageLinks","SEC_ToDoAdmRevPatientCases","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":["usp_TraceMyEvalMainPageCounts"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["CaseReviewManager.cs.GetCasesReviewedByUser"],"complexity":"very-complex","aiEnrichment":null,"module":"PTL","summary":"Returns patient log submissions pending supervisor review for a given user, including due-date information and 'things to do' main-page link metadata.","businessPurpose":"Drives the supervisor's pending review queue in the MyEvaluations dashboard, showing case submissions that need attention with their due dates.","optimizationRecommendations":["Multiple correlated subqueries for main page link and category lookups could be pre-joined.","The 10-day due difference (@pDueDifference) is hard-coded — consider making it configurable per department."],"migrationRelevance":"high"},{"name":"GetPatientLogSubmittedInfo","schema":"dbo","parameters":[{"name":"@UserId","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetPatientLogSubmittedInfo"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Executes a pre-built dynamic SQL query replacing the DateOfBirth reference with a patient-specific value from the submitted log, supporting custom field queries.","businessPurpose":"Retrieves full patient log submission details for display, handling the DOB override logic for cases where the submitted log contains a corrected date of birth.","optimizationRecommendations":["Executing arbitrary SQL passed as @QRYSQL is a major SQL injection risk — validate that only known query templates are accepted.","The string replacement approach (REPLACE on SQL text) is fragile; consider parameterized templates."],"migrationRelevance":"high"},{"name":"GetPatientLogSupervisorList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedPatientLog","dataType":"LargeNumber","direction":"IN","defaultValue":"- 1"},{"name":"@UserType","dataType":"ShortCounterNumber","direction":"IN","defaultValue":"- 1"}],"lineCount":22,"tablesReferenced":["PTL_PatientLogSupervisors"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.FetchSupervisorsForEdit"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns a distinct list of supervisors configured for a department with optional filtering by user type.","businessPurpose":"Populates the supervisor management list in the patient log admin interface and the supervisor filter dropdowns in reports.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientLogSupervisors","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SubmittedPatientLog","dataType":"LargeNumber","direction":"IN","defaultValue":"-1"}],"lineCount":85,"tablesReferenced":["EVAL_EvaluateEvaluation","LA_Preceptors","PTL_PatientLogSubmitted","PTL_PatientLogSupervisors","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.GetSuperVisorsForViewMode"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns supervisors for a department with mode-based filtering — for log submission, lists active supervisors; for admin, shows current assigned supervisors with preceptor flag.","businessPurpose":"Populates the supervisor selection dropdown when a trainee submits a patient log, and the supervisor list in the admin configuration view.","optimizationRecommendations":["Performance logging to EVAL_EvaluateEvaluation on every call adds write overhead for a high-frequency read SP."],"migrationRelevance":"high"},{"name":"GetPatientLogUsersPatientList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_Patients"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns distinct patients logged by a specific user in a department, plus a specific patient from a given patient log submission.","businessPurpose":"Powers the patient autocomplete or selection list on the patient log edit form, showing the user's known patients.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetPatientLogVerificationEmailReminder","schema":"dbo","parameters":[{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginDepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LoginUserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":198,"tablesReferenced":["PF_EmailTemplate","PTL_PatientLogSubmitted","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":true,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.SendPatientLogVerificationEmailReminder"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Generates and sends verification reminder emails to trainees for patient log submissions that require learner verification.","businessPurpose":"Automates learner verification reminders in the PTL workflow, prompting trainees to confirm or review their submitted patient encounters.","optimizationRecommendations":["Same anti-pattern as GetPatientLogReviewEmailReminder: email dispatch belongs at the application layer, not in SQL."],"migrationRelevance":"medium"},{"name":"GetPGYTextforUser","schema":"dbo","parameters":[],"lineCount":23,"tablesReferenced":["SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogReportManager.cs.GetPGYTextforUser"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns the PGY designation text label (e.g., 'PGY', 'FPGY', 'MSY') for a given user based on their user type.","businessPurpose":"Determines the appropriate training year label to display for a user in the PTL reporting context, since different training programs use different PGY nomenclature.","optimizationRecommendations":["A CASE statement on UserTypeID could be moved to a lookup table for easier maintenance."],"migrationRelevance":"low"},{"name":"GetPhysicians","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_PatientLogSubmitted","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns a list of physician names who have supervised patient logs in a given department or all linked departments.","businessPurpose":"Provides the attending physician list for patient log filters and reporting dropdowns.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetPtlGenderList","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["PTL_Gender"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetGenderList"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns the gender list for the patient log form, with special filtering for a specific department (2207) that shows fewer options.","businessPurpose":"Populates the patient gender dropdown on the patient log submission form, with department-specific customization for at least one department.","optimizationRecommendations":["Hard-coded DepartmentID 2207 in business logic is fragile — replace with a configuration table or a department-level gender restriction flag."],"migrationRelevance":"low"},{"name":"GetSubmitPatientLogCustomizations","schema":"dbo","parameters":[],"lineCount":38,"tablesReferenced":["EVAL_EvaluateEvaluation","SEC_Departments"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetSubmitPatientLogCustomizations"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns department-level customization settings for patient log submission, specifically the maximum allowed days to submit a log.","businessPurpose":"Loads submission deadline configuration so the patient log form can enforce or display the maximum number of days after an encounter that a log can be submitted.","optimizationRecommendations":["Performance logging to EVAL_EvaluateEvaluation on every call adds write overhead for a frequently called SP."],"migrationRelevance":"medium"},{"name":"GetSubmittedPatientLogs","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedAcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PageNumber","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@RowsPerPage","dataType":"INT","direction":"IN","defaultValue":"65534534"},{"name":"@SortExpression","dataType":"VARCHAR(255)","direction":"IN","defaultValue":"NULL"},{"name":"@SubmittedStartDate","dataType":"SmallDate","direction":"IN","defaultValue":"NULL"},{"name":"@SubmittedEndDate","dataType":"SmallDate","direction":"IN","defaultValue":"NULL"},{"name":"@SearchText","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":"NULL"},{"name":"@SupervisorReviewStatusID","dataType":"SmallNumber","direction":"IN","defaultValue":"1"}],"lineCount":167,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","PTL_Patients","SEC_UserRoles","SEC_UserTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.GetSubmittedPatientLogByCriteria"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns a paginated, filterable, searchable list of patient log submissions for a user or department with sorting and academic year filtering, built with dynamic SQL.","businessPurpose":"Powers the main patient log list view for trainees and supervisors, supporting sorting, searching, pagination, and multi-department scoping.","optimizationRecommendations":["Dynamic SQL with string-concatenated ORDER BY and WHERE clauses is hard to maintain and may be vulnerable to injection — parameterize where possible.","Academic year date computation on every call could be cached at the session or application layer.","The rowsPerPage maximum of 65534534 effectively disables pagination for some callers — verify this is intentional."],"migrationRelevance":"high"},{"name":"GetSubmittedPatientLogs_Test","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedAcademicYear","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PageNumber","dataType":"INT","direction":"IN","defaultValue":"0"},{"name":"@RowsPerPage","dataType":"INT","direction":"IN","defaultValue":"65534534"},{"name":"@SortExpression","dataType":"VARCHAR(255)","direction":"IN","defaultValue":"NULL"},{"name":"@SubmittedStartDate","dataType":"SmallDate","direction":"IN","defaultValue":"NULL"},{"name":"@SubmittedEndDate","dataType":"SmallDate","direction":"IN","defaultValue":"NULL"}],"lineCount":164,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","PTL_Patients","SEC_UserRoles","SEC_UserTypes"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Test version of the patient log list SP.","businessPurpose":"Development/testing variant of the patient log list query.","optimizationRecommendations":["Remove or retire if not in active production use."],"migrationRelevance":"none"},{"name":"GetSubmittedProceduresForPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":44,"tablesReferenced":["PRC_ParticipationTypes","PRC_Procedures","PRC_ProceduresSubmitted","PRC_ProceduresSubmittedStatusTypes","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedProcedures","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.FetchSubmittedProcedureForPatientLog"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns procedures submitted and linked to a specific patient log submission.","businessPurpose":"Displays the procedures section of a patient log case detail view, showing what clinical procedures were performed and recorded.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"GetSupervisorsByDepartment","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FlagArchived","dataType":"SmallNumber","direction":"IN","defaultValue":"0"},{"name":"@SelectedUserID","dataType":"LargeNumber","direction":"IN","defaultValue":"0"}],"lineCount":142,"tablesReferenced":["ACT_Sessions","BSN_CourseFaculty","BSN_CourseSession","BSN_Faculty","BSN_StudentReturnDemonstrationLogs","BSN_StudentReturnDemonstrationLogsExt","EVAL_EvaluateEvaluation","LA_Preceptors","PRC_ProceduresSubmitted","PRC_ProceduresSupervisors","SEC_UserRoles","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogSupervisorsManager.cs.FetchSupervisors","SupervisorsManager.cs.FetchSupervisorsByDepartment"],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns a list of active supervisors for a given department.","businessPurpose":"Provides supervisor data for patient log reporting filters and administrative views.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"GetUserIdByNPIForImport","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FirstName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@LastName","dataType":"ShortText","direction":"IN","defaultValue":null}],"lineCount":47,"tablesReferenced":["SEC_UsersExt"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["ImportPatientLogManager.cs.GetUserId"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Returns the user ID for a given NPI number, used during patient log import to resolve external clinician identifiers to internal user IDs.","businessPurpose":"Enables third-party import processes to map NPI-identified physicians to MyEvaluations user accounts during patient log bulk import.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"ImportPatientLogData","schema":"dbo","parameters":[],"lineCount":151,"tablesReferenced":["PTL_CompetenceLevels","PTL_Locations","PTL_Patients","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Performs bulk import of patient log data from a staging temp table, inserting patient records, log submissions, diagnoses, and linking all components across multiple tables.","businessPurpose":"Core import engine for the PTL module that ingests patient encounter data from external sources (e.g., hospital EHR exports), creating all necessary records in a single transaction.","optimizationRecommendations":["The SP processes rows individually using a WHILE loop over a temp table — this is O(n) row-by-row processing and should be refactored to set-based bulk insert.","Transaction scope is not explicit — wrap the entire import in an explicit transaction with rollback on error.","Consider implementing error handling via TRY/CATCH with detailed logging to the existing PTL_NiImportLog table."],"migrationRelevance":"high"},{"name":"ProcessNiImport_update","schema":"dbo","parameters":[],"lineCount":263,"tablesReferenced":["PRC_NiImport","PTL_CompetenceLevels","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":["AddPatientLogPatient","AddSubmitedProcedureImport_Update"],"crudType":"update","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Processes a single NI (New Innovations) patient log import record by resolving resident, patient, location, and diagnosis data, then calling multiple SPs to insert the full log entry.","businessPurpose":"Handles individual record processing during New Innovations data integration, the primary third-party import source for patient log data in medical residency programs.","optimizationRecommendations":["This SP orchestrates many other SP calls sequentially — consider consolidating into a single set-based insert pipeline.","Large DECLARE block with 30+ variables indicates complex row-at-a-time processing that should be converted to set-based operations.","Error handling is absent — TRY/CATCH with rollback should be added."],"migrationRelevance":"high"},{"name":"ProcessNiImport_update2","schema":"dbo","parameters":[],"lineCount":303,"tablesReferenced":["PRC_NiImport","PTL_CompetenceLevels","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":["AddPatientLogPatient","AddSubmitedProcedureImport_Update2"],"crudType":"update","antiPatterns":{"hasCursor":true,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":true,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Version 2 of the NI import record processor with InternalID-based deduplication to prevent re-importing previously imported records.","businessPurpose":"Improved NI import processor that tracks an internal ID from the source system to detect and skip already-imported records during re-imports.","optimizationRecommendations":["Same concerns as ProcessNiImport_update; consolidate the two versions with a parameter flag for deduplication strategy.","The InternalID-based deduplication check should use an index on PTL_NiImportLog(InternalID, ResultID)."],"migrationRelevance":"high"},{"name":"RestoreDeletedPatientLogFields","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.RestoreDeletedFields"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Restores one or more soft-deleted custom patient log fields, optionally all deleted fields for a department or a specific list.","businessPurpose":"Allows administrators to undo field deletions in the patient log form configuration.","optimizationRecommendations":["Replace SplitTextCSV with a table-valued parameter."],"migrationRelevance":"low"},{"name":"RestoreDxClassification","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PTL_DiagnosisClassifications"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.RestoreDxClassification"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Restores soft-deleted diagnosis classifications from a comma-separated ID list.","businessPurpose":"Allows administrators to undo deletion of diagnosis classification categories in the PTL module.","optimizationRecommendations":["Replace fnSplit with a table-valued parameter."],"migrationRelevance":"low"},{"name":"RestoreEncounterTypes","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":17,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.RestoreEncounterTypes"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Restores soft-deleted encounter types (competence levels) from a comma-separated ID list.","businessPurpose":"Allows administrators to undo deletion of encounter type options in the PTL module.","optimizationRecommendations":["Replace fnSplit with a table-valued parameter."],"migrationRelevance":"low"},{"name":"RestoreLocations","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":18,"tablesReferenced":["PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.RestoreLocations"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Restores soft-deleted clinical locations from a comma-separated ID list.","businessPurpose":"Allows administrators to undo deletion of clinical location options in the PTL module.","optimizationRecommendations":["Replace fnSplit with a table-valued parameter."],"migrationRelevance":"low"},{"name":"SavePatientLogFieldAndFieldGroupOrder","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldOrder","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":32,"tablesReferenced":["PTL_DepartmentFieldGroupOrder","PTL_DepartmentFieldOrder"],"sprocsCalledFromBody":["AddPatientLogDefaultFieldAndGroupOrderData"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.SaveFieldAndGroupOrder"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Saves the display order for a specific field or field group in a department's patient log form, calling the default data seeder if needed.","businessPurpose":"Persists the drag-and-drop field ordering configured by administrators in the patient log form builder.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"SavePatientLogFreeTextFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":23,"tablesReferenced":["PTL_FreeTextFieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a free-text field value for a patient log submission.","businessPurpose":"Saves the content of a free-text custom field on a patient log entry, using an update-or-insert pattern.","optimizationRecommendations":["Use a MERGE statement instead of the EXISTS-based upsert pattern for clarity and atomicity."],"migrationRelevance":"medium"},{"name":"SavePatientLogLargeDateFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["PTL_LargeDateFieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a large date field value for a patient log submission.","businessPurpose":"Saves date-type custom field values on patient log entries.","optimizationRecommendations":["Use MERGE for cleaner upsert logic."],"migrationRelevance":"medium"},{"name":"SavePatientLogLargeNumberFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["PTL_LargeNumberFieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a large number field value for a patient log submission.","businessPurpose":"Saves large-integer custom field values on patient log entries.","optimizationRecommendations":["Use MERGE for cleaner upsert logic."],"migrationRelevance":"medium"},{"name":"SavePatientLogLongTextFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["PTL_LongTextFieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a long text field value for a patient log submission.","businessPurpose":"Saves long-text custom field values on patient log entries.","optimizationRecommendations":["Use MERGE for cleaner upsert logic."],"migrationRelevance":"medium"},{"name":"SavePatientLogLookupFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["PTL_LookupFieldValues"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a lookup field value for a patient log submission.","businessPurpose":"Saves the selected dropdown option for a lookup-type custom field on a patient log entry.","optimizationRecommendations":["Use MERGE for cleaner upsert logic."],"migrationRelevance":"medium"},{"name":"SavePatientLogNumberFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":["PTL_NumberFieldValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a numeric field value for a patient log submission.","businessPurpose":"Saves numeric custom field values on patient log entries.","optimizationRecommendations":["Use MERGE for cleaner upsert logic."],"migrationRelevance":"medium"},{"name":"SavePatientLogShortTextValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":24,"tablesReferenced":["PTL_ShortTextValues"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Save"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Upserts a short text field value for a patient log submission.","businessPurpose":"Saves short-text custom field values on patient log entries.","optimizationRecommendations":["Use MERGE for cleaner upsert logic."],"migrationRelevance":"medium"},{"name":"SetDischargeStatusForSubmittedPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":19,"tablesReferenced":["PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.UpdateSubmittedPatientLogDischargeFlag"],"complexity":"trivial","aiEnrichment":null,"module":"PTL","summary":"Updates the discharge flag on a submitted patient log.","businessPurpose":"Records whether a patient has been discharged as part of the clinical encounter tracking in the PTL module.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SetPatientLogFieldGroupHiddenFlag","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PTL_FieldGroups"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsGroupManager.cs.SetFieldGroupHiddenFlag"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Sets the IsHidden flag on a patient log field group.","businessPurpose":"Allows administrators to hide entire field groups on the patient log form for a department without deleting them.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SetPatientLogFieldGroupRequiredFlag","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldGroupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["PTL_FieldGroups"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsGroupManager.cs.SetFieldGroupRequiredFlag"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Sets the IsRequired flag on a patient log field group, and automatically un-hides it if required.","businessPurpose":"Allows administrators to make a field group mandatory on the patient log form, automatically making it visible in the process.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SetPatientLogFieldHiddenFlag","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.SetFieldHiddenFlag"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Sets the IsHidden flag on a specific patient log field.","businessPurpose":"Allows administrators to hide individual fields on the patient log form without deleting them.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SetPatientLogFieldRequiredFlag","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.SetFieldRequiredFlag"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Sets the IsRequired flag on a specific patient log field, automatically un-hiding it if required.","businessPurpose":"Allows administrators to make individual custom fields mandatory on the patient log form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"SwapPatientLogFieldAndGroupOrder","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":66,"tablesReferenced":["PTL_DepartmentFieldGroupOrder","PTL_DepartmentFieldOrder"],"sprocsCalledFromBody":["AddPatientLogDefaultFieldAndGroupOrderData"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.SwapFieldAndFieldGroupOrder"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Swaps the display order of two fields or two field groups in a department's patient log form configuration.","businessPurpose":"Supports the drag-and-drop reordering UI in the patient log form builder, allowing administrators to change field and group display sequence.","optimizationRecommendations":["Calls AddPatientLogDefaultFieldAndGroupOrderData on every swap — this default-seeding call should be skipped if data is already initialized.","Order swapping with separate UPDATE statements could be done in a single UPDATE with CASE."],"migrationRelevance":"medium"},{"name":"SwappatientLogFieldGroupOrder","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldGroupId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":69,"tablesReferenced":["PTL_DepartmentFieldGroupOrder"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsGroupManager.cs.SwapFieldGroupOrder"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Swaps the display order of two field groups in the patient log form for a department.","businessPurpose":"Handles field group reordering in the patient log form builder.","optimizationRecommendations":["Merge with SwapPatientLogFieldAndGroupOrder to reduce duplication."],"migrationRelevance":"low"},{"name":"SwapPatientLogFieldOrder","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":48,"tablesReferenced":["PTL_DepartmentFieldOrder"],"sprocsCalledFromBody":["AddPatientLogDefaultFieldAndGroupOrderData"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.SwapFieldOrder"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Swaps the display order of two individual fields in the patient log form for a department.","businessPurpose":"Handles individual field reordering in the patient log form builder.","optimizationRecommendations":["Merge with SwapPatientLogFieldAndGroupOrder to reduce duplication."],"migrationRelevance":"low"},{"name":"UpdateDiagnosisForSubmittedPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":29,"tablesReferenced":["PTL_PatientLogSubmittedDiagnosisList"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Replaces the diagnosis list for a submitted patient log by deleting existing entries and inserting the new set with primary designation.","businessPurpose":"Supports editing the diagnosis fields on a patient log submission, replacing the entire diagnosis set in one operation.","optimizationRecommendations":["DELETE-then-INSERT pattern does not use a transaction; wrap in TRY/CATCH with explicit transaction to ensure atomicity.","Replace SplitTextCSV with a table-valued parameter."],"migrationRelevance":"high"},{"name":"UpdatePatientLog","schema":"dbo","parameters":[],"lineCount":45,"tablesReferenced":["PTL_Patients"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":true,"hasTempTable":false,"hasWhileLoop":true,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates patient records with encrypted patient name data from a table-valued variable as part of a patient data encryption batch process.","businessPurpose":"Supports the patient data encryption initiative, updating patient name fields to encrypted values in a loop-driven batch.","optimizationRecommendations":["The commented-out MRNumber and DOB encryption lines suggest incomplete implementation — review and complete or remove.","PRINT statements left in production code should be removed.","Row-by-row processing via @LoopCount should be replaced with a single UPDATE...FROM join on the table variable."],"migrationRelevance":"medium"},{"name":"UpdatePatientLogEducationDX","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EducationDX","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Order","dataType":"LongText","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["PTL_DiagnosisClassifications"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EducationDXManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the name and sort order of a diagnosis classification.","businessPurpose":"Allows administrators to rename or reorder diagnosis classification categories in the PTL module.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientLogEncounterType","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@EncounterType","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@Description","dataType":"LongText","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["PTL_CompetenceLevels"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["EncounterTypeManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the name and description of an encounter type (competence level).","businessPurpose":"Allows administrators to rename or edit the description of encounter type options in the patient log form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientLogField","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldId","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Name","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@DisplayName","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@VisibilityTypeID","dataType":"SmallNumber","direction":"IN","defaultValue":null},{"name":"@FieldTypeID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsSystem","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsRequired","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsHidden","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@DefaultValue","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@UpperBound","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@LowerBound","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":42,"tablesReferenced":["MGMT_FieldTypes","PTL_FieldTypeInfo","PTL_Fields"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogFieldsManager.cs.Update"],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Updates the metadata of a custom patient log field including name, display name, visibility, field type, and constraints.","businessPurpose":"Allows administrators to edit existing custom fields on the patient log form, including renaming, changing field type, and adjusting validation bounds.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatePatientLogFieldLookup","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PTL_Lookups"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the name of a lookup list for a patient log field.","businessPurpose":"Allows administrators to rename a lookup list used by a custom dropdown field on the patient log form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientLogFieldLookupItem","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookUpItemID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@SortOrder","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":41,"tablesReferenced":["PTL_LookupItems"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the value and sort order of a lookup list item.","businessPurpose":"Allows administrators to edit the text and position of items in a dropdown lookup list on the patient log form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientLogFreeTextFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PrimaryKey","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["PTL_FreeTextFieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates an existing free-text custom field value for a patient log submission.","businessPurpose":"Saves changes to a free-text custom field value when a trainee edits an existing patient log.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatePatientLogLargeDateFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PrimaryKey","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LargeDate","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["PTL_LargeDateFieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates an existing large-date custom field value for a patient log submission.","businessPurpose":"Saves changes to a date-type custom field value when editing a patient log.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatePatientLogLargeNumberFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PrimaryKey","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["PTL_LargeNumberFieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates an existing large-number custom field value for a patient log submission.","businessPurpose":"Saves changes to a large-integer custom field value when editing a patient log.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatePatientLogLocation","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LocationName","dataType":"LongText","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PTL_Locations"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["LocationNameManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the name of a clinical location.","businessPurpose":"Allows administrators to rename a clinical location option in the patient log form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientLogLongTextFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PrimaryKey","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["PTL_LongTextFieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates an existing long-text custom field value for a patient log submission.","businessPurpose":"Saves changes to a long-text custom field when editing a patient log.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatepatientLogLookup","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":21,"tablesReferenced":["PTL_Lookups"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the name of a lookup list for a patient log.","businessPurpose":"Allows administrators to rename lookup lists used by custom dropdown fields in the patient log form.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientLogLookupFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PrimaryKey","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupItemID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["PTL_LookupFieldValues"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates an existing lookup field value for a patient log submission.","businessPurpose":"Saves changes to a dropdown selection custom field when editing a patient log.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatePatientLogLookupItem","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookUpItemID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@LookupID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"LongText","direction":"IN","defaultValue":null},{"name":"@SortOrder","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":47,"tablesReferenced":["PTL_LookupItems"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":true,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogLookupItemManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the value and sort order of a lookup list item.","businessPurpose":"Allows administrators to edit dropdown option text and ordering in patient log lookup lists.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdatePatientLogNumberFieldValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PrimaryKey","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"ScoreNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":38,"tablesReferenced":["PTL_NumberFieldValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates an existing numeric custom field value for a patient log submission.","businessPurpose":"Saves changes to a numeric custom field when editing a patient log.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatePatientLogReminderSentDate","schema":"dbo","parameters":[],"lineCount":24,"tablesReferenced":["PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the ReminderSentDate to today for a list of patient log submissions.","businessPurpose":"Marks patient log submissions as having had a reminder email sent, preventing duplicate reminders on the same day.","optimizationRecommendations":["Replace fnSplit with a table-valued parameter."],"migrationRelevance":"low"},{"name":"UpdatePatientLogShortTextValues","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PrimaryKey","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@Value","dataType":"ShortText","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":34,"tablesReferenced":["PTL_ShortTextValues"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates an existing short-text custom field value for a patient log submission.","businessPurpose":"Saves changes to a short-text custom field when editing a patient log.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"UpdatePtLogFiledLockState","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FieldId","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":[],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.UpdatePtLogFiledLockState"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the locked/unlocked state of a patient log custom field.","businessPurpose":"Allows administrators to lock or unlock specific custom fields on the patient log form to prevent or allow editing by trainees.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateSubmittedPatientLog","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedPatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedDepartment","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedUser","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@SelectedSupervisorID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@FirstLogDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@LastLogDate","dataType":"SmallDate","direction":"IN","defaultValue":null},{"name":"@LocationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@CompetenceLevelID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DiagnosisClassificationID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@IsDischarged","dataType":"VerySmallNumber","direction":"IN","defaultValue":null},{"name":"@IsFinishSubmitReview","dataType":"VerySmallNumber","direction":"IN","defaultValue":"0"},{"name":"@PatientId","dataType":"LargeNumber","direction":"IN","defaultValue":"NULL"},{"name":"@Age","dataType":"SmallNumber","direction":"IN","defaultValue":"NULL"},{"name":"@IsMobileOrWeb","dataType":"VARCHAR(5)","direction":"IN","defaultValue":"NULL"},{"name":"@SupervisorReviewStatusID","dataType":"SmallNumber","direction":"IN","defaultValue":"1"}],"lineCount":43,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_Patients"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.Update"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates all editable fields of a submitted patient log including supervisor, dates, location, encounter type, comments, and discharge status, with notification dispatch to the new supervisor if changed.","businessPurpose":"Supports editing a submitted patient log, handling supervisor reassignment with notification logic similar to the initial submission flow.","optimizationRecommendations":["Same notification dispatch concerns as AddSubmittedPatientLog — MD5 URL signing and mobile host detection should move to the application layer.","The SP is long and mixes data update with notification logic; separate concerns for maintainability."],"migrationRelevance":"high"},{"name":"UpdateSubmittedPatientLogDeletedFlag","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":20,"tablesReferenced":["PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.RestoreDeletedSubmittedPatientLog"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Restores a soft-deleted patient log by setting IsDeleted=0.","businessPurpose":"Allows administrators to undelete a previously deleted patient log submission.","optimizationRecommendations":[],"migrationRelevance":"low"},{"name":"UpdateSubmittedPatientLogStatus","schema":"dbo","parameters":[{"name":"@UserID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"LargeNumber","direction":"IN","defaultValue":null},{"name":"@PatientLogSubmittedID","dataType":"LargeNumber","direction":"IN","defaultValue":null}],"lineCount":25,"tablesReferenced":["PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":["PatientLogManager.cs.UpdateSubmittedPatientLogSupervisorReviewStatus"],"complexity":"simple","aiEnrichment":null,"module":"PTL","summary":"Updates the supervisor review status of a patient log submission and, if reset to status 1 (pending), deletes the review record and clears the completed date.","businessPurpose":"Allows supervisors to change the review status of a patient log, including the ability to reset it back to pending review which removes the existing review record.","optimizationRecommendations":[],"migrationRelevance":"medium"},{"name":"usp_GetPTLDigClassSubmittedDetails","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"INT","direction":"IN","defaultValue":null},{"name":"@FromDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@ToDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@AcademicYear","dataType":"INT","direction":"IN","defaultValue":null},{"name":"@PGYStartDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@PGYEndDate","dataType":"DATETIME","direction":"IN","defaultValue":null}],"lineCount":91,"tablesReferenced":["MYEVAL_PerformanceUserPatientTypeDetails","PTL_DiagnosisClassifications","PTL_DiagnosisClassificationsSettings","PTL_PatientLogSubmitted"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"PTL","summary":"Returns detailed diagnosis classification completion statistics for a user including submitted counts vs. required counts by PGY level and overall, using temp tables for intermediate calculations.","businessPurpose":"Powers the diagnosis classification completion progress view in the PTL module, showing trainees and program directors how many encounters have been completed vs. required for each diagnosis category.","optimizationRecommendations":["Multiple temp table creates and inserts with identity-based looping are used for data assembly — refactor to set-based CTEs.","PGY level computation per user on every call should be cached or pre-computed at login time.","Ensure indexes exist on PTL_DiagnosisClassificationsSettings(DiagnosisClassificationID, PGYValue)."],"migrationRelevance":"high"},{"name":"usp_UserSubmittedPatientLogs","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@PGYStartDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@PGYEndDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@UserPGYLevel","dataType":"INT","direction":"IN","defaultValue":null},{"name":"@PeriodStartDate","dataType":"DATETIME","direction":"IN","defaultValue":null},{"name":"@periodEndDate","dataType":"DATETIME","direction":"IN","defaultValue":null}],"lineCount":68,"tablesReferenced":["MYEval_PerformanceTaskCompletion","PTL_PatientLogSubmitted","PTL_PatientLogSubmittedForReview","PTL_Patients","SEC_UserTypes","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"PTL","summary":"Returns patient log submissions for a user with status labels derived from discharge, review, and completion state, along with completion percentage metrics.","businessPurpose":"Powers the trainee's patient log dashboard, displaying their submitted cases with status indicators and overall completion percentage toward curriculum requirements.","optimizationRecommendations":["Multiple EXISTS subqueries per row for status computation (discharged, reviewed, closed) are evaluated row-by-row; consider pre-joining to review and close status tables.","Completion percentage computation should be documented — clarify how @pTotalSubmitted and @pCompleted are populated."],"migrationRelevance":"high"}]}