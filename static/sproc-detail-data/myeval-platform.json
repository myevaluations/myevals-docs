{"module":"MYEVAL","displayName":"MyEval Platform","procedureCount":43,"procedures":[{"name":"usp_CaptureCPUSpikeDiagnostics","schema":"dbo","parameters":[],"lineCount":49,"tablesReferenced":["MyEvals_CPUSpikeLog"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Captures a snapshot of SQL Server CPU usage from sys.dm_os_ring_buffers and sys.dm_exec_query_stats, then inserts a record into MyEvals_CPUSpikeLog only when CPU utilization meets or exceeds a configurable threshold. Logs the top CPU-consuming query along with session, host, and program context.","businessPurpose":"Provides proactive database health monitoring for the MyEvaluations platform by recording CPU spikes, enabling DBAs to identify queries causing performance degradation and correlate them with specific evaluation or reporting workloads.","optimizationRecommendations":["The TOP 1 in the INSERT...SELECT from sys.dm_exec_query_stats aggregates with a GROUP BY then discards most rows — consider querying the stats DMV separately and only joining session data once the top query_hash is identified.","@CPUThreshold appears to be referenced without being declared in the visible body; confirm this is a parameter and not an undeclared variable to avoid silent non-logging.","Use READ UNCOMMITTED isolation (already set) but add explicit WITH(NOLOCK) hints to the DMV cross-applies for consistency.","Add an index on MyEvals_CPUSpikeLog (CaptureTime) to support range-based log queries in the GetLongRunningQueries companion SP."],"migrationRelevance":"low"},{"name":"usp_CleanUpCompletedWeekProcess_Job","schema":"dbo","parameters":[],"lineCount":53,"tablesReferenced":["EVAL_ThingsToDoTrace","MYEval_ThingsToDoEnabledUserSections","MYEval_ThingsToDoEnabledUsers","MYEval_ThingsToDoRefreshUserCount","SEC_Departments","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":7,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Deletes stale records from the Things-To-Do refresh and enabled-user tracking tables: removes entries older than 15 days from MYEval_ThingsToDoRefreshUserCount, orphaned user entries no longer in SEC_Users, entries for users in closed or disabled departments, and users with IsToDoEnabled=0.","businessPurpose":"Scheduled maintenance job that keeps the Things-To-Do feature's denormalised user-section tables clean, preventing unbounded table growth and ensuring disabled or departed resident/faculty records are removed from nightly refresh queues.","optimizationRecommendations":["The DELETE on MYEval_ThingsToDoEnabledUserSections for orphaned users is duplicated verbatim — the second block is redundant and should be removed.","NOT EXISTS subqueries on SEC_Users will cause table scans if UserID is not indexed in the source tables; verify foreign key indexes or rewrite as a MERGE/DELETE with explicit JOIN.","CONVERT(DATE, RefreshedDate) in the WHERE clause prevents index use on RefreshedDate; store pre-converted dates or use a range-based filter (RefreshedDate < DATEADD(DD,-15,GETDATE())).","Wrap the multi-table DELETE sequence in a transaction to prevent partial cleanup on failure."],"migrationRelevance":"medium"},{"name":"usp_CleanupScheduleAssignmentHistory","schema":"dbo","parameters":[],"lineCount":23,"tablesReferenced":["MyEvals_ScheduleAssignmentHistory"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Deletes records from MyEvals_ScheduleAssignmentHistory where the DeletetedDate is older than 3 months from the current date, enforcing a rolling data-retention window for schedule-change audit history.","businessPurpose":"Implements data-retention policy for the schedule-assignment history table used to audit rotations and duty-period changes in the MyEvals scheduling subsystem, preventing unbounded log growth.","optimizationRecommendations":["A spurious SELECT of @pCurrentDate and @pTillDate is left in the body — this should be removed (or changed to a PRINT) before production use.","Add a covering index on MyEvals_ScheduleAssignmentHistory (DeletetedDate) if one does not exist; a full-table scan on a high-volume history table will be slow.","Note the typo in the column name 'DeletetedDate' — document or plan a rename migration to avoid confusion."],"migrationRelevance":"low"},{"name":"usp_CMEDataExport","schema":"dbo","parameters":[],"lineCount":209,"tablesReferenced":["MyEval_CMELedgerData","SEC_Departments"],"sprocsCalledFromBody":["GetCMEEExportDetailedLedgerReport","GetUserListByCriteriaForCMEReports"],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Iterates over departments matching a client-specific name pattern (MetroHealth), retrieves CME-eligible users and their CME ledger data for a fixed historical date range, and populates the MyEval_CMELedgerData staging table for downstream export. Uses cursor-style WHILE loops over temp tables and calls GetUserListByCriteriaForCMEReports and GetCMEEExportDetailedLedgerReport.","businessPurpose":"Produces a complete Continuing Medical Education (CME) export for the MetroHealth client, aggregating evaluation schedules, CME credits, and attendance data into a flat staging table for periodic compliance reporting.","optimizationRecommendations":["Date range is hard-coded ('2013-07-01' to '2024-06-30') — parameterise or store in a config table to avoid code changes for each reporting cycle.","The WHILE loop over departments calls two EXEC SPs and performs TRUNCATE TABLE inside the loop, causing repeated lock/unlock cycles; consider processing all departments in set-based batches if the called SPs support it.","FOR XML PATH string concatenation to build @pUserIDs is O(n^2) for large user lists; replace with STRING_AGG (SQL Server 2017+) or a pre-built TVF.","The entire #CMELedgerCreditData section is commented out but still allocates the temp table — remove the dead code to reduce confusion.","Add error handling (TRY/CATCH) around the WHILE loop since a failure mid-export leaves the staging table in a partial state."],"migrationRelevance":"high"},{"name":"usp_DataBaseGrowthCalculationReport","schema":"dbo","parameters":[{"name":"@FromDate","dataType":"DATE","direction":"IN","defaultValue":null}],"lineCount":73,"tablesReferenced":["MyEvals_DatabaseDetails"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Computes day-over-day database size growth percentages from the MyEvals_DatabaseDetails tracking table for a given date range, using a WHILE loop to compute delta MB and growth percentage row-by-row, then returns the result set.","businessPurpose":"Provides a time-series growth analysis tool for DBAs and platform administrators to monitor database storage consumption trends and plan capacity for the MyEvaluations platform.","optimizationRecommendations":["The WHILE loop iterates row-by-row to compute deltas — replace with a window function approach using LAG(SizeInMB) OVER (ORDER BY ID) to compute all rows in a single set-based pass.","UPDATE is called twice per loop iteration (once to set IncreasedInMB, once to recalculate GrowthPercent); collapse into a single UPDATE after computing the lag value.","CONVERT(DATE, ...) applied to @FromDate/@ToDate in WHERE prevents index use; convert once at the beginning and store as DATE variables.","The stored result in #DatabaseDetails is a temp table — for a reporting SP, consider returning a TVF or using RETURN SELECT directly to avoid temp table overhead."],"migrationRelevance":"low"},{"name":"usp_DatabaseSizeGrowthReport","schema":"dbo","parameters":[],"lineCount":210,"tablesReferenced":["MyEvals_DatabaseDetails"],"sprocsCalledFromBody":[],"crudType":"insert","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Generates aggregated database size growth charts for configurable time windows (current week through last 5 years) by reading MyEvals_DatabaseDetails and grouping data by day, week, month, or year, returning results in GB for chart rendering.","businessPurpose":"Powers the database growth dashboard for MyEvaluations platform administrators, enabling visual monitoring of storage trends across multiple time horizons to support capacity planning and cost forecasting.","optimizationRecommendations":["Ten near-identical IF/ELSE IF branches with duplicate INSERT INTO #DatabaseDetails blocks; refactor using a date-range lookup table or a single parametric WHERE clause with computed start/end dates.","DATEPART(WEEK, ...) and DATEPART(MONTH, ...) in WHERE clauses are non-sargable; convert to explicit date range comparisons (>= start AND < end) to allow index seeks.","DATENAME functions return locale-dependent strings for month/weekday names — use a deterministic ordering column (e.g., month number) to ensure correct chart ordering across locales.","The 'Last 5 Years' label in the ELSE IF comment incorrectly reads 'Last 2 Years' — fix the comment."],"migrationRelevance":"low"},{"name":"usp_DeletePerformanceDataForDepartment","schema":"dbo","parameters":[],"lineCount":33,"tablesReferenced":["MYEVAL_PerformanceQIPProjects","MYEVAL_PerformanceUserPatientLog","MYEVAL_PerformanceUserPatientTypeDetails","MYEVAL_PerformanceUserProcedureSubmitted","MYEVAL_PerformanceUserQuizzScore","MYEVAL_UserClinicalHourDetails","MYEVAL_UserClinicalHourViolationDetails","MYEVAL_UserEvaluationDetails","MYEVAL_UserQuizAssignmentDetails"],"sprocsCalledFromBody":[],"crudType":"delete","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Deletes all performance API cache data for a given DepartmentID across 9 MYEVAL performance tables covering clinical hours, evaluations, quizzes, QI projects, patient logs, and procedures.","businessPurpose":"Used as a prerequisite step when a department's academic year configuration changes — purges stale performance dashboard cache so the nightly job can repopulate it with recalculated data based on the updated date configuration.","optimizationRecommendations":["Nine sequential DELETE statements without a transaction — wrap in BEGIN TRANSACTION/COMMIT so a partial delete (e.g., mid-way failure) does not leave the department in an inconsistent cache state.","All DELETE statements filter by DepartmentID; verify that covering indexes exist on DepartmentID in each of the 9 target tables to avoid full-table scans.","Consider using TRUNCATE TABLE with a filtered staging approach if the table is partitioned by DepartmentID, to avoid row-by-row delete overhead on large cache tables."],"migrationRelevance":"medium"},{"name":"usp_GenerateDependencyCountScript","schema":"dbo","parameters":[{"name":"@RootSchema","dataType":"SYSNAME","direction":"IN","defaultValue":null},{"name":"@RootTable","dataType":"SYSNAME","direction":"IN","defaultValue":null},{"name":"@RootPK","dataType":"SYSNAME","direction":"IN","defaultValue":null}],"lineCount":86,"tablesReferenced":["MYEVAL_TableDependency"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":1,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Reads the pre-built MYEVAL_TableDependency hierarchy table and generates dynamic COUNT SQL statements for a root table and all its child/nested tables, building IN-subquery chains for nested levels. Returns the generated SQL strings rather than executing them.","businessPurpose":"A developer and DBA tool used during data archiving or department deletion workflows — generates ready-to-run scripts that count dependent records at each level of the data hierarchy before performing cascading deletes.","optimizationRecommendations":["The CTE-based approach to build AllTables does not use MAXRECURSION 0 — for schemas with deep nesting this may hit the default 100-level recursion limit; add OPTION (MAXRECURSION 0).","Generated IN subqueries nest deeper with each hierarchy level, producing exponentially expensive query plans for deep tables; consider generating EXISTS subqueries or JOIN-based COUNT scripts instead.","The INTO #GeneratedSQL pattern without an explicit schema/collation may cause issues in tempdb with mixed-collation environments; use explicit column definitions."],"migrationRelevance":"low"},{"name":"usp_GetLongRunningQueries","schema":"dbo","parameters":[],"lineCount":40,"tablesReferenced":["MyEvals_CPUSpikeLog"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":true,"hasDynamicSql":false,"hasNolock":true,"nolockCount":2,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Queries sys.dm_exec_sessions and sys.dm_exec_requests to capture the top 10 currently running queries by CPU time, supplements with a 1-hour CPU spike view and yesterday/today CPU spike log entries, and also returns MyGME demographics mismatch data.","businessPurpose":"A real-time diagnostic tool for DBAs to identify blocking and high-CPU queries during performance incidents on the MyEvaluations platform, cross-referencing live sessions with the historical CPU spike log.","optimizationRecommendations":["Mixing unrelated concerns (running queries, CPU spike log, and MyGME demographics comparison) in a single SP makes it hard to use programmatically — split into focused SPs or at minimum document each result set's column contract.","CONVERT(DATE, CaptureTime) in WHERE clause prevents index use — rewrite as a range filter: CaptureTime >= DATEADD(DD,-1, CONVERT(DATE, GETDATE())).","The #LongRunningQueries temp table is populated with SELECT INTO but the outer query filters by @Status — filtering after full population is wasteful; push the filter into the initial SELECT."],"migrationRelevance":"low"},{"name":"usp_GetSystemImplDashboardAPI_Job","schema":"dbo","parameters":[],"lineCount":72,"tablesReferenced":["MyEval_RefreshSystemImplDashboard"],"sprocsCalledFromBody":["GetSystemImplementationDashBoardDetails"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Dequeues up to 20 pending System Implementation Dashboard refresh requests from MyEval_RefreshSystemImplDashboard (split across two priority queues — unmodified and modified), calls GetSystemImplementationDashBoardDetails for each user/department/year combination, then marks processed records as refreshed.","businessPurpose":"Powers the scheduled background job that refreshes system implementation dashboard metrics (adoption, completion rates, usage statistics) for residency program directors and administrators across all departments.","optimizationRecommendations":["The two-priority queue logic (Set1 = NULL ModifiedBy, Set2 = NOT NULL ModifiedBy) uses separate temp tables and two INSERT steps; a UNION ALL with ROW_NUMBER() ordering would simplify this into a single query.","The exclusion of sysadmin users (IDs 1 and 46) is hardcoded — parameterise or store in a config table.","There is no error handling around the EXEC GetSystemImplementationDashBoardDetails loop — a single failure will abort the entire batch; add TRY/CATCH with per-record error logging.","The UPDATE to mark records as refreshed uses a JOIN from the in-memory temp table but does not include the AcademicYear in the join condition — validate that this cannot produce incorrect updates for duplicate user/department pairs."],"migrationRelevance":"medium"},{"name":"usp_GetTableDependencyCountScript","schema":"dbo","parameters":[{"name":"@RootSchema","dataType":"SYSNAME","direction":"IN","defaultValue":null},{"name":"@RootTable","dataType":"SYSNAME","direction":"IN","defaultValue":null},{"name":"@RootPK","dataType":"SYSNAME","direction":"IN","defaultValue":null}],"lineCount":128,"tablesReferenced":["MYEVAL_TableDependency"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":2,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Traverses the MYEVAL_TableDependency hierarchy using a recursive CTE with MAXRECURSION 0, building a dynamic COUNT SQL statement for the root table and each dependent child table with appropriately nested IN subquery filters, returning the generated scripts ordered by dependency level.","businessPurpose":"Generates a dependency-aware set of record-count queries used by DBAs to audit data volumes at each level of the schema hierarchy before performing cascading department data deletions or archiving operations.","optimizationRecommendations":["The EdgeFilter column builds nested IN subqueries that grow in length with each recursion level; for schemas with more than 3-4 levels of nesting, the generated SQL may exceed NVARCHAR(MAX) limits or produce extremely slow query plans.","CAST to NVARCHAR(MAX) inside the recursive CTE anchor and recursive member can cause truncation warnings — verify no filter expressions are silently truncated.","The OPTION (MAXRECURSION 0) is present but no cycle-detection logic exists; if MYEVAL_TableDependency has circular references (e.g., self-referencing FKs), this will infinite-loop.","NULL guards on ParentColumn, ChildColumn, ChildTableFullName in the recursive member are correct but should also exclude rows where ParentColumn = ChildColumn (self-joins)."],"migrationRelevance":"low"},{"name":"usp_LoadAllClosedDepartmentSript","schema":"dbo","parameters":[],"lineCount":42,"tablesReferenced":["MYEVAL_TableDependencyCountSript","SEC_Departments"],"sprocsCalledFromBody":["usp_LoadTableDependencyCountScriptForEachRootPK"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Identifies up to 50 closed or disabled departments not yet present in MYEVAL_TableDependencyCountSript, then iterates over them calling usp_LoadTableDependencyCountScriptForEachRootPK to generate and store record-count scripts for each department.","businessPurpose":"Pre-generates dependency count scripts for all closed departments so DBAs can efficiently audit residual data volumes before performing department-level data archiving or purging operations.","optimizationRecommendations":["The TOP 50 limit is hardcoded — parameterise or increase; 50 departments at a time with WHILE loop overhead may be slow for environments with hundreds of closed departments.","NOT EXISTS check against MYEVAL_TableDependencyCountSript inside a UNION'd subquery causes repeated correlation — materialise the existing DepartmentID list into a temp table first.","ORDER BY X.DateModified ASC without a TOP guarantee from the UNION may produce indeterminate results depending on the UNION's internal deduplication; validate ordering is stable."],"migrationRelevance":"low"},{"name":"usp_LoadTableDependencies","schema":"dbo","parameters":[{"name":"@RootSchema","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@RootTable","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":37,"tablesReferenced":["MYEVAL_TableDependency"],"sprocsCalledFromBody":["usp_GetTableDependencyHierarchy"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Truncates MYEVAL_TableDependency and repopulates it by calling usp_GetTableDependencyHierarchy, effectively rebuilding the entire foreign-key dependency hierarchy cache for a given root table.","businessPurpose":"Maintains the MYEVAL_TableDependency cache table that records the complete FK-based dependency tree for a root schema object, used as the foundation for the data-archiving and count-script generation tools.","optimizationRecommendations":["TRUNCATE TABLE without a transaction means if the subsequent INSERT fails, the dependency table is left empty — wrap in BEGIN TRANSACTION/COMMIT with a ROLLBACK on failure.","The temp table #MYEVAL_TableDependency mirrors the permanent table exactly — the intermediary step adds no value; insert directly from EXEC usp_GetTableDependencyHierarchy into the permanent table using INSERT...EXEC.","No index rebuild or statistics update is performed after re-populating the table — add an UPDATE STATISTICS call after the bulk insert."],"migrationRelevance":"low"},{"name":"usp_LoadTableDependencyCountScriptForEachRootPK","schema":"dbo","parameters":[{"name":"@RootSchema","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@RootTable","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null},{"name":"@RootPK","dataType":"VARCHAR(MAX)","direction":"IN","defaultValue":null}],"lineCount":28,"tablesReferenced":["MYEVAL_TableDependencyCountSript"],"sprocsCalledFromBody":["usp_GetTableDependencyCountScript"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Generates COUNT scripts for a specific root table primary key value by calling usp_GetTableDependencyCountScript, then inserts the resulting script rows into MYEVAL_TableDependencyCountSript if they do not already exist for that DepartmentID.","businessPurpose":"Provides the per-department script-loading step in the dependency count audit pipeline, enabling DBA tooling to build a complete set of data-volume queries for each department's data hierarchy before purging.","optimizationRecommendations":["The NOT EXISTS check uses @RootPKValue cast to DepartmentID — the column name conflation (treating a generic PK value as a DepartmentID) is fragile; document the expected call conventions clearly.","Inserting into MYEVAL_TableDependencyCountSript without a transaction means partial inserts are possible if the SP is interrupted mid-way.","Multiple typos in column and table names ('DynamiSQL', 'NumberOfReords', 'DependencySript') — plan rename migrations for readability and consistency."],"migrationRelevance":"low"},{"name":"usp_LoadThingsToDoEnabledSectionsForEachUsers_Job","schema":"dbo","parameters":[],"lineCount":43,"tablesReferenced":["MYEval_ThingsToDoEnabledUserSections","MYEval_ThingsToDoEnabledUsers"],"sprocsCalledFromBody":["usp_GetUserToDosListForAPI"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Processes up to 100 users who have Things-To-Do enabled but no section records yet in MYEval_ThingsToDoEnabledUserSections, calling usp_GetUserToDosListForAPI for each to pre-populate their section lists.","businessPurpose":"Background job that bootstraps the Things-To-Do section configuration for newly onboarded or newly enabled residents and faculty, ensuring their dashboard pending-item counts are immediately available.","optimizationRecommendations":["The NOT EXISTS check before each EXEC inside the WHILE loop is redundant — the outer INSERT into #Users already filters on NOT EXISTS, so the inner check will always be true; remove the inner guard.","TOP 100 is hardcoded — for large cohorts this may leave many users unprocessed per run; consider making this configurable or using a batched execution strategy.","No error handling inside the loop — a single failing EXEC will abort the batch; add TRY/CATCH per iteration."],"migrationRelevance":"medium"},{"name":"usp_LogDepartmentAcademicYearScheduleDetails","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@AcademicYear","dataType":"INT","direction":"IN","defaultValue":null}],"lineCount":70,"tablesReferenced":["MyEvals_ScheduleAssignmentValidation","MyEvals_ScheduleDetails"],"sprocsCalledFromBody":["usp_RefreshScheduleAssignments"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Upserts a schedule metadata record in MyEvals_ScheduleDetails for a department/academic-year combination, then triggers a full schedule-assignment refresh and validation trace if the schedule's last-updated timestamp has changed.","businessPurpose":"Serves as the entry point for detecting schedule changes in the MyGME-integrated scheduling subsystem — orchestrates the refresh-then-validate pipeline that keeps the MyEvals_ScheduleAssignments denormalised table in sync with the source scheduling view.","optimizationRecommendations":["The condition @LastUpdatedDateTime <> @ActualLastUpdateDateTime will fail to detect changes if either value is NULL (datetime comparison with NULL returns UNKNOWN) — use ISNULL() or IS DISTINCT FROM.","The @pRefreshScheduleAssignments flag is set and then checked in a nested IF rather than a single conditional block — simplify the flow to reduce branching complexity.","The INSERT into MyEvals_ScheduleAssignmentValidation is followed immediately by an UPDATE to reset IsRequiredToValidate=0 — this pair should be reviewed for correctness (the flag is set to 1 on INSERT then immediately reset to 0 on the UPDATE branch)."],"migrationRelevance":"high"},{"name":"usp_RefreshCHReviewalRateData_Job","schema":"dbo","parameters":[],"lineCount":81,"tablesReferenced":["MYEVAL_CHReviewalRateDataTrace","SEC_Departments"],"sprocsCalledFromBody":["usp_GetCompletionReportData_API"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Processes pending clinical-hours reviewal rate refresh requests from MYEVAL_CHReviewalRateDataTrace, computes academic year date ranges from department configuration, then calls usp_GetCompletionReportData_API for each user/department/year and marks records as refreshed.","businessPurpose":"Background job that refreshes clinical hours completion and reviewal rate data for the performance dashboard, ensuring attendings and programme directors see up-to-date completion statistics for each academic period.","optimizationRecommendations":["Academic year start/end dates are computed via a multi-step UPDATE cascade on temp tables — a single JOIN with computed DATEADD expressions would be cleaner and faster.","No error handling in the WHILE loop — a single API call failure will abort the entire batch; add TRY/CATCH per iteration with error logging.","Consider batching the EXEC calls with a configurable TOP N limit similar to other refresh SPs in this module rather than processing all pending records in one run."],"migrationRelevance":"medium"},{"name":"usp_RefreshDashboardPRPPPDetails_Job","schema":"dbo","parameters":[],"lineCount":74,"tablesReferenced":["MYEval_DepartmentUserPRPAndPPDetailsTrace","SEC_Users"],"sprocsCalledFromBody":["GetDashboardForPortfolio"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Refreshes Procedural Review Profile (PRP) and Portfolio Profile (PP) data for all active users in departments queued for refresh in MYEval_DepartmentUserPRPAndPPDetailsTrace, calling GetDashboardForPortfolio twice per user (once for PRPDOC, once for PP).","businessPurpose":"Scheduled job that keeps portfolio-based dashboard metrics current for residents' procedural and portfolio review data, supporting program director review workflows in the MyEvaluations platform.","optimizationRecommendations":["The SP loops through all users twice (once for PRPDOC, once for PP) with identical WHILE logic — refactor so each user is processed once with both EXEC calls in a single iteration.","No error handling around either WHILE loop — add TRY/CATCH to prevent a single user's failure from aborting the entire batch.","The IsArchived=0 filter on SEC_Users is correct but there is no filter for department IsDisabled — include disabled department filtering to avoid processing departments that should be excluded."],"migrationRelevance":"medium"},{"name":"usp_RefreshDataforTheUserInPerformanceDashboard","schema":"dbo","parameters":[],"lineCount":65,"tablesReferenced":["MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI","Numbers","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Enqueues all performance API refresh requests for a given department's users into MYEVAL_RefreshPerformanceDashboarAPI, covering all enabled dashboard APIs across up to 12 past academic years (for procedure-based APIs) and non-year-specific APIs, using MERGE-style INSERT/UPDATE logic.","businessPurpose":"Entry point for triggering a full performance dashboard cache refresh for an entire department, typically invoked when a department's academic year dates change, ensuring all user-specific API caches are flagged for background regeneration.","optimizationRecommendations":["The UPDATE step uses ISNULL(R.AcademicYear,0) = ISNULL(M.AcademicYear,0) which prevents index use on AcademicYear; store 0 instead of NULL in the database column to enable direct comparison.","The CROSS APPLY between #DepartmentUsers and #MYEVAL_DashboardPerformanceAPI generates a Cartesian product — for large departments with many APIs, this can produce millions of rows; add a TOP limit or batch by department.","The code appears truncated (DROP TABLE #MYEVAL_DashboardPerformanceAPI followed by 'DR') — verify the full body contains complete cleanup and additional DROP TABLE calls.","Consider using a single MERGE statement instead of separate UPDATE + INSERT for the MYEVAL_RefreshPerformanceDashboarAPI upsert."],"migrationRelevance":"medium"},{"name":"usp_RefreshDepartmentClinicalHoursData_Job","schema":"dbo","parameters":[],"lineCount":47,"tablesReferenced":["MYEVAL_RefreshClinicalHours"],"sprocsCalledFromBody":["usp_UserScoreClinicalHours_API"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Dequeues pending clinical hours refresh requests from MYEVAL_RefreshClinicalHours and calls usp_UserScoreClinicalHours_API for each user/department, then marks the processed records as refreshed.","businessPurpose":"Scheduled job that re-calculates and caches clinical hours scores for residents and fellows in the performance dashboard, ensuring hours-based compliance metrics reflect the latest submitted log entries.","optimizationRecommendations":["No TOP limit on the initial SELECT — this can load an unbounded number of records into the temp table; add a configurable batch size to prevent runaway execution.","No error handling in the WHILE loop — add TRY/CATCH per iteration to log failures without aborting the entire batch.","The UPDATE to mark records refreshed could miss records if the batch is interrupted; consider using OUTPUT clause or a transaction to ensure atomicity."],"migrationRelevance":"medium"},{"name":"usp_RefreshPerforamnceProcedures_Job","schema":"dbo","parameters":[],"lineCount":48,"tablesReferenced":["MYEval_PerformanceProcedureRefreshTrace"],"sprocsCalledFromBody":["usp_RefreshPerformanceProcedure_API"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Dequeues the oldest 50 pending procedure performance refresh requests from MYEval_PerformanceProcedureRefreshTrace and calls usp_RefreshPerformanceProcedure_API for each user/department pair, then marks records as refreshed.","businessPurpose":"Background job that refreshes the procedure-based performance metrics (logged procedures per trainee) for the performance dashboard, consuming from a trace queue to process updates in FIFO order.","optimizationRecommendations":["No error handling in the WHILE loop — add TRY/CATCH per iteration.","Note the SP name contains a typo ('Perforamn-ce') — consistent with the parent trace table name but should be documented.","The ORDER BY ISNULL(T.ModifiedDate, T.CreatedDate) is correct for FIFO processing but will benefit from a composite index on (IsRefreshed, ModifiedDate, CreatedDate)."],"migrationRelevance":"medium"},{"name":"usp_RefreshPerforamnceQIPAPI_Job","schema":"dbo","parameters":[],"lineCount":45,"tablesReferenced":["MYEval_PerformanceQIProjectsTrace"],"sprocsCalledFromBody":["usp_PerformanceQIP_API"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Dequeues up to 50 pending Quality Improvement Project performance refresh requests from MYEval_PerformanceQIProjectsTrace and calls usp_PerformanceQIP_API for each, then marks records as refreshed.","businessPurpose":"Scheduled job that populates and refreshes QI Project completion counts for the performance dashboard, supporting ACGME milestone tracking for residents participating in quality improvement initiatives.","optimizationRecommendations":["No error handling in the WHILE loop — add TRY/CATCH per iteration.","Missing ORDER BY on the initial TOP 50 SELECT — without ordering, which 50 records are dequeued is non-deterministic; add ORDER BY CreatedDate ASC for consistent FIFO processing.","The #MYEvalPerformanceQIProjectsTrace temp table is created but never dropped — add DROP TABLE before END."],"migrationRelevance":"medium"},{"name":"usp_RefreshPerforamnceQuizzes_Job","schema":"dbo","parameters":[],"lineCount":48,"tablesReferenced":["MYEval_PerformanceQuizRefreshTrace"],"sprocsCalledFromBody":["usp_RefreshPerformanceQuizDetails_API"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Dequeues the oldest 50 pending quiz performance refresh requests from MYEval_PerformanceQuizRefreshTrace and calls usp_RefreshPerformanceQuizDetails_API for each user/department, then marks records as refreshed.","businessPurpose":"Background job that refreshes quiz performance scores (pass rates, attempt counts) for the performance dashboard, consuming from a trace queue to process updates in order of submission.","optimizationRecommendations":["No error handling in the WHILE loop — add TRY/CATCH per iteration.","The ORDER BY ISNULL(T.ModifiedDate, T.CreatedDate) ASC is correct for FIFO but requires a composite index; verify index coverage.","SP name contains a typo ('Perforamn-ce') — consistent with peer SPs but should be noted."],"migrationRelevance":"medium"},{"name":"usp_RefreshPerformanceClinicalHours_Job","schema":"dbo","parameters":[],"lineCount":268,"tablesReferenced":["DH_DepartmentComplianceSettings","MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI"],"sprocsCalledFromBody":["GetCompletionReportData","GetSummaryComplainceReportResult","usp_GetDepartmentUserPGYLevelPeriodDetails"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Processes clinical hours API refresh requests from MYEVAL_RefreshPerformanceDashboarAPI for the 'Performance - Clinical Hours' API, resolving each user's PGY level and period dates before calling the clinical hours API SP for each period, with error capture per record.","businessPurpose":"Core scheduled job for the performance clinical hours dashboard cache, ensuring every resident's and fellow's work-hour data is recalculated per academic period and PGY level, supporting ACGME duty-hour compliance dashboards.","optimizationRecommendations":["Multi-level WHILE loop nesting (outer: users, inner: PGY periods) with no batch size cap on the inner loop can lead to very long runtimes for large cohorts — add progress logging or split into sub-batches.","Period validity check via usf_CheckIsDateValid is called once per row in the inner loop; if this is a UDF, it prevents parallelism — consider inlining the date check logic.","Error records are captured into #ErrorRecords but there is no subsequent logic to process or log them — add a final INSERT into a persistent error table.","The top-level batch size is driven by usf_GetTopRecordNo(@pAPIName) — document this UDF's logic and ensure it is calibrated for this SP's execution time profile."],"migrationRelevance":"high"},{"name":"usp_RefreshPerformanceDashboarAPI","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@APIName","dataType":"VARCHAR(1000)","direction":"IN","defaultValue":null}],"lineCount":79,"tablesReferenced":["MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI","MYEVAL_RefreshPerformanceTaskCompletionAPI","SEC_UserRoles"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Upserts a refresh request into MYEVAL_RefreshPerformanceDashboarAPI for a specific user/department/API/academic-year combination, and additionally inserts into MYEVAL_RefreshPerformanceTaskCompletionAPI for task-completion-capable APIs, excluding sysadmin-level roles.","businessPurpose":"Called when a user or system event triggers a performance dashboard cache invalidation for a specific API — queues the refresh for background processing by the corresponding _Job SP.","optimizationRecommendations":["The role lookup (SELECT RoleID FROM SEC_UserRoles WHERE UserID = @UserID) has no TOP 1 — if a user has multiple roles, this will error or return non-deterministic results; add TOP 1.","The ISNULL(@AcademicYear, 0) pattern in WHERE clauses and INSERT VALUES will prevent NULL-safe index seeks; standardise by storing 0 instead of NULL for 'no academic year' semantics.","The body appears truncated mid-ISNULL call — verify the complete SP body is captured."],"migrationRelevance":"medium"},{"name":"usp_RefreshPerformanceEvaluations_Job","schema":"dbo","parameters":[],"lineCount":288,"tablesReferenced":["MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI"],"sprocsCalledFromBody":["GenerateCompletionStatusResults_ByUser","GetAvailableTemplates","GetIncompleteEvaluations","usp_GetDepartmentUserPGYLevelPeriodDetails"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Processes evaluation performance refresh requests from the dashboard API queue, resolving each user's PGY level periods and evaluation templates, then calling the evaluations API SP per period, with multi-template support for both standard and conference templates.","businessPurpose":"Scheduled job that refreshes evaluation completion metrics and milestone achievement data for the performance dashboard, covering all active evaluation templates and conference evaluations per academic period.","optimizationRecommendations":["The SP creates 6 temp tables (#ErrorRecords, #MYEVAL_RefreshPerformanceDashboarAPI, #UserPGYLevelDetails, #Templates, #Department, #DepartmentTemplates, #DepartmentConfTemplates) — this is complex state management; consider breaking this into smaller, focused SPs.","Template loading via EXEC GetAvailableTemplates inside a department WHILE loop causes N+1 API SP calls for N departments — cache department templates once at the top if the template list is stable during a job run.","Error records are captured into #ErrorRecords but not persisted — add INSERT into a permanent error log table.","Batch size is driven by usf_GetTopRecordNo() — ensure this is calibrated for the evaluation SP's typical execution time."],"migrationRelevance":"high"},{"name":"usp_RefreshPerformancePatientLog_Job","schema":"dbo","parameters":[],"lineCount":194,"tablesReferenced":["DH_DepartmentActivities","MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI"],"sprocsCalledFromBody":["GetSelectedUsersDutyHoursData","usp_GetDepartmentUserPGYLevelPeriodDetails","usp_GetPTLDigClassSubmittedDetails"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Processes patient log performance refresh requests from the dashboard API queue, resolving PGY level and period details for each user before calling the patient log API SP, with TRY/CATCH transaction handling per batch.","businessPurpose":"Scheduled job that refreshes patient encounter log metrics (procedure types, case counts) for the performance dashboard, supporting ACGME case-log compliance tracking for surgical and clinical trainees.","optimizationRecommendations":["Uses BEGIN TRY/BEGIN TRANSACTION wrapping — verify that the CATCH block properly handles ROLLBACK and that open transactions are not left hanging on error.","Similar to peer SPs, the inner WHILE loop over PGY periods creates unbounded nesting — add logging of progress metrics (records processed, elapsed time) for job monitoring.","Error records should be persisted to a permanent log table, not just a temp table that disappears at session end."],"migrationRelevance":"high"},{"name":"usp_RefreshPerformanceProcedure_Job","schema":"dbo","parameters":[],"lineCount":103,"tablesReferenced":["MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI","SEC_Departments"],"sprocsCalledFromBody":["usp_GetProcedureSubmittedDetails"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Processes procedure performance refresh requests for academic-year-specific records from the dashboard API queue, resolving PGY periods and then calling the procedure API SP with date range parameters.","businessPurpose":"Scheduled job that refreshes procedure-based performance metrics (logged surgical/clinical procedures per trainee per year) for the performance dashboard, distinguished from the non-year-specific procedure job by filtering on non-zero AcademicYear.","optimizationRecommendations":["The filter ISNULL(M.AcademicYear, 0) <> 0 excludes year-agnostic records — document explicitly why this SP handles only year-specific records while the other procedure job handles year-agnostic records.","No error handling in the WHILE loop — add TRY/CATCH per iteration.","The PGY level resolution loop and the main processing loop both iterate over the same #MYEVAL_RefreshPerformanceDashboarAPI set separately — combine into a single loop to halve the iteration count."],"migrationRelevance":"high"},{"name":"usp_RefreshPerformanceQIProjects_Job","schema":"dbo","parameters":[],"lineCount":159,"tablesReferenced":["MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI"],"sprocsCalledFromBody":["GetQualityImprovementProjects","usp_GetDepartmentUserPGYLevelPeriodDetails"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Processes QI Projects performance refresh requests from the dashboard API queue, resolving PGY periods for each user and then calling the QI Projects API SP with date range and PGY parameters.","businessPurpose":"Scheduled job that refreshes Quality Improvement Project participation counts and outcomes for the performance dashboard, supporting milestone tracking for ACGME practice-based learning and improvement competencies.","optimizationRecommendations":["Error records are captured into #ErrorRecords temp table but not persisted — add INSERT into a permanent error log.","PGY level resolution in a WHILE loop adds an extra pass over the dataset; consider resolving in the initial SELECT using a JOIN to the PGY level table.","The #UserPGYLevelDetails temp table is populated inside the outer loop by an EXEC — verify this SP inserts into #UserPGYLevelDetails via INSERT...EXEC, which cannot be used inside a transaction."],"migrationRelevance":"high"},{"name":"usp_RefreshPerformanceQuizzPerformance_Job","schema":"dbo","parameters":[],"lineCount":162,"tablesReferenced":["MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceDashboarAPI"],"sprocsCalledFromBody":["GetDetailedQuizAssignmentsResults","usp_GetDepartmentUserPGYLevelPeriodDetails"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Processes quiz performance refresh requests from the dashboard API queue, resolving PGY period details and then calling the quiz performance API SP with date range parameters for each user/period combination.","businessPurpose":"Scheduled job that refreshes quiz score and pass-rate metrics for the performance dashboard, supporting knowledge assessment tracking for residents across all assigned quiz modules.","optimizationRecommendations":["Follows the same WHILE-loop-within-WHILE-loop pattern as peer performance SPs — consider extracting the PGY resolution into a shared helper SP or TVF.","Error records are captured but not persisted — add persistent error logging.","Add a TOP limit or configurable batch size parameter to prevent unbounded processing per job execution."],"migrationRelevance":"high"},{"name":"usp_RefreshPerformanceTaskCompletion_Job","schema":"dbo","parameters":[],"lineCount":387,"tablesReferenced":["MYEVAL_DashboardPerformanceAPI","MYEVAL_RefreshPerformanceTaskCompletionAPI"],"sprocsCalledFromBody":["GenerateCompletionStatusResults_ByUser","GetAvailableTemplates","GetCompletionReportData","usp_GetDepartmentUserPGYLevelPeriodDetails","usp_UserSubmittedPatientLogs","usp_UserSubmittedProcedures"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Processes task-completion performance refresh requests for the four core i95Dev-built API types (Clinical Hours, Evaluations, Patient Log, Procedures), resolving PGY periods and then calling task-completion API SPs for each user/period/type combination.","businessPurpose":"Scheduled job that refreshes the task-completion layer of the performance dashboard, computing overall completion scores across the four primary performance API types and caching results for real-time dashboard display.","optimizationRecommendations":["The largest SP in the module at 16KB — its multi-level WHILE loop (users, then PGY periods, then API types) creates O(n^3) complexity; refactor using a pre-joined result set to reduce iteration.","WAITFOR DELAY '00:00:01' calls (seen in usp_UpdateTableDependencyCount for sp_executesql) should not be present in API refresh loops — verify this SP does not contain hidden delays.","Add a configurable top-N batch size and implement idempotent error retry semantics so failed records are retried without re-processing successful ones.","Temp table creation of #MYEVAL_RefreshPerformanceTaskCompletionAPI and #UserPGYLevelDetails follows the same schema as peer SPs — extract into a shared temp-table setup SP or table-valued function to reduce code duplication."],"migrationRelevance":"high"},{"name":"usp_RefreshScheduleAssignments","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@AcademicYear","dataType":"INT","direction":"IN","defaultValue":null}],"lineCount":182,"tablesReferenced":["MyEvals_ScheduleAssignmentHistory","MyEvals_ScheduleAssignments","MyEvals_ScheduleDetails"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":2,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Refreshes the MyEvals_ScheduleAssignments denormalised table for a given department/academic year by reading from the vscheduleassignments6 view, archiving the existing rows to MyEvals_ScheduleAssignmentHistory, then performing a full delete-and-insert within a transaction.","businessPurpose":"Core schedule synchronisation job that keeps the MyEvals scheduling cache in sync with the MyGME source scheduling system, ensuring accurate rotation assignment data for clinical hours tracking, evaluation scheduling, and compliance reporting.","optimizationRecommendations":["Full delete-and-reinsert within a transaction on a potentially large table causes lock contention during the transaction window; consider a MERGE approach with change detection to update only modified rows.","The SP includes explicit SET ANSI_NULLS/PADDING/WARNINGS/QUOTED_IDENTIFIER at execution time — these are session-level and redundant when the SP is compiled with the correct options; remove to reduce noise.","The comment references sp_recompile after alterations — codify this as an automated post-deployment step.","The history INSERT before the DELETE adds referential history correctly, but the history table may grow unbounded without regular cleanup beyond the 3-month trim in usp_CleanupScheduleAssignmentHistory — verify retention is sufficient.","The view vscheduleassignments6 is read with NOLOCK — ensure this is intentional and that dirty-read risk is acceptable for schedule data."],"migrationRelevance":"high"},{"name":"usp_RefreshThingsToDoCounts_Job","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":"0"}],"lineCount":895,"tablesReferenced":["MYEval_ThingsToDoEnabledUserSections","MYEval_ThingsToDoEnabledUsers","MYEval_ThingsToDoRefreshUserCount","SEC_MyEvalMainPageLinks","SEC_UserRoles"],"sprocsCalledFromBody":["GetBSNDutyHourVerificationUsersWithDateRange","GetDepartmentsforDemographics","GetDutyHourVerificationUsersWithDateRange","GetEvaluationsForUserInbox","GetEvaluationsToReview","GetEvaluationsToSign","GetIncompleteCMEEvaluationsForMultiTopics","GetIncompleteEvaluations","GetIncompleteEvaluationsByCriteria","GetLearningAssignmentToReview","GetMilestonePIPAssignmentsForReview","GetOBCUserAssignments","GetPatientLogsTobeReviewedByUser","GetPendingProcedures","GetPendingQuizInfo","GetPendingSchedulePreferences","GetProcedureReviewList","GetSubmittedLearningAssignments","GetUserMessagesInfo","GetViolationList","usp_GetUserReviewMilestonePerformanceCount"],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"very-complex","aiEnrichment":null,"module":"MYEVAL","summary":"The largest SP in the module (43KB) — orchestrates the complete Things-To-Do count refresh pipeline: dequeues users needing refresh (split into new and modified priority queues), inserts per-section refresh tracking records, then iterates through each user/section calling the individual count-refresh API SP, with error capture and process-level coordination via a ProcessID GUID.","businessPurpose":"Core scheduled job that keeps the Things-To-Do pending-item counts current for all enabled residents and faculty, powering the dashboard notification badges showing pending evaluations, quiz assignments, and other required activities.","optimizationRecommendations":["At 43KB, this SP is too large for a single stored procedure — refactor into sub-SPs: one for queue management, one for section record creation, one for count refresh execution.","The OUTPUT clause to capture inserted IDs into #RefreshUserCountSections is a good pattern but the subsequent WHILE loop over #RefreshUserCountSections adds another nested loop — flatten using a single JOIN-based update.","The two-queue strategy (TableA: new users, TableB: modified users with modified date ordering) is correct but uses two separate INSERT INTO #UsersToDoCountSections statements — combine with a UNION ALL and ROW_NUMBER() deduplication.","Consider implementing SET-based bulk processing for section refresh rather than row-by-row API calls to significantly improve throughput.","Add timing metrics (start/end datetime per batch) to the process tracking table to enable runtime monitoring and SLA alerting."],"migrationRelevance":"high"},{"name":"usp_RefreshUserDataForPerformanceAPI_Job","schema":"dbo","parameters":[],"lineCount":47,"tablesReferenced":["MYEval_DepartmentDateChangeTracker"],"sprocsCalledFromBody":["usp_DeletePerformanceDataForDepartment","usp_RefreshDataforTheUserInPerformanceDashboard"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Identifies departments with date configuration changes (MYEval_DepartmentDateChangeTracker.IsDateChanged=1), deletes their performance cache data, enqueues all department users for performance API refresh, then resets the change flag.","businessPurpose":"Handles the cascade effect of department academic year date changes — clears stale performance cache data and triggers a full performance dashboard refresh for all affected department members.","optimizationRecommendations":["Calls usp_DeletePerformanceDataForDepartment and usp_RefreshDataforTheUserInPerformanceDashboard inside a WHILE loop without error handling — a failure mid-loop leaves subsequent departments unprocessed and the change flag un-reset.","The UPDATE to reset IsDateChanged=0 uses a JOIN with the temp table — verify this covers all processed departments even if the loop is interrupted.","Add explicit TOP N batch limiting to prevent processing an unbounded number of date-changed departments in one execution."],"migrationRelevance":"medium"},{"name":"usp_TraceDepartmentToRefreshSystemIMPLDashboardData","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":26,"tablesReferenced":["MyEval_RefreshSystemImplDashboard"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Upserts a record into MyEval_RefreshSystemImplDashboard for a specific user/department/academic-year combination, setting IsDataRefreshed=0 to flag the record for background refresh by the system implementation dashboard job.","businessPurpose":"Queue-writer SP called when a user views or requests a refresh of the System Implementation Dashboard, ensuring the background job picks up the refresh request in its next execution cycle.","optimizationRecommendations":["The UPDATE only resets records where IsDataRefreshed=1 — if the record is already at IsDataRefreshed=0 (pending), no update occurs, which is correct; add a comment to make this intent explicit.","Consider using MERGE instead of the INSERT/UPDATE conditional pattern for cleaner upsert semantics."],"migrationRelevance":"low"},{"name":"usp_TraceTheDatabaseSize","schema":"dbo","parameters":[],"lineCount":41,"tablesReferenced":["MyEvals_DatabaseDetails"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Records the current total database file size in MB into MyEvals_DatabaseDetails, using an upsert pattern to update the record if one already exists for today's date, or insert a new one.","businessPurpose":"Scheduled daily job that tracks database storage growth over time for the MyEvaluations platform, populating the data used by the database growth reporting SPs.","optimizationRecommendations":["The size calculation uses sys.master_files joined to sys.databases — this reads all files for all databases and then filters; running this in the context of the target database and filtering by DB_NAME() is correct but ensure the login has VIEW SERVER STATE permission.","Use MERGE for the upsert instead of IF NOT EXISTS / INSERT / ELSE / UPDATE to atomically handle concurrent executions.","The 'SQL-Job' string as CreatedBy is fine for auditing but consider recording the job name (@@SERVERNAME or JOB_NAME()) for more precise tracking."],"migrationRelevance":"low"},{"name":"usp_TraceToRefreshDashboardDeteails","schema":"dbo","parameters":[{"name":"@UserID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":47,"tablesReferenced":["MYEval_DepartmentUserPRPAndPPDetailsTrace","SEC_DashBoard_Refresh"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":false,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Upserts records into both MYEval_DepartmentUserPRPAndPPDetailsTrace and SEC_DashBoard_Refresh for a user/department/academic-year, flagging dashboard data as needing refresh for portfolio and standard dashboards.","businessPurpose":"Queue-writer SP called when portfolio-level dashboard data is invalidated, queuing both the PRP/PP portfolio refresh and the standard dashboard refresh for background job processing.","optimizationRecommendations":["Two separate upsert blocks (one per target table) without a transaction — if the second INSERT/UPDATE fails, only one of the two refresh flags is set, causing partial refresh state.","Consider using MERGE for both upserts and wrapping both in a single transaction.","Note the typo in the SP name ('Deteails') — document for future cleanup."],"migrationRelevance":"low"},{"name":"usp_TracPerformanceProcedures","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":44,"tablesReferenced":["MYEval_PerformanceProcedureRefreshTrace","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Enqueues refresh requests for procedure performance data for a given department/user: inserts all department users into MYEval_PerformanceProcedureRefreshTrace if none exist yet, or updates the specific user's record to reset IsRefreshed=0.","businessPurpose":"Queue-writer SP that flags procedure performance records as needing refresh when a user's procedure log is updated, queuing the record for processing by the procedure performance background job.","optimizationRecommendations":["The #DepartmentUsers temp table is populated but only used in the ELSE (bulk insert) branch — if the IF branch is taken, the temp table population is wasted overhead; move the INSERT into #DepartmentUsers inside the ELSE block.","The EXISTS check at the department level followed by per-user EXISTS check creates a two-level conditional — simplify with a single MERGE statement.","Note the SP name typo ('TracPerformanceProcedures' vs 'TracePerformanceProcedures') — consistent with peer SP but should be documented."],"migrationRelevance":"medium"},{"name":"usp_TracPerformanceQuizzes","schema":"dbo","parameters":[{"name":"@DepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null}],"lineCount":44,"tablesReferenced":["MYEval_PerformanceQuizRefreshTrace","SEC_Users"],"sprocsCalledFromBody":[],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"simple","aiEnrichment":null,"module":"MYEVAL","summary":"Enqueues refresh requests for quiz performance data for a given department/user: inserts all department users into MYEval_PerformanceQuizRefreshTrace if none exist yet, or updates the specific user's record to reset IsRefreshed=0.","businessPurpose":"Queue-writer SP that flags quiz performance records for refresh when a user's quiz results change, queuing the record for processing by the quiz performance background job.","optimizationRecommendations":["Identical structural issue as usp_TracPerformanceProcedures — the #DepartmentUsers temp table is populated unconditionally but only used in the ELSE branch.","Refactor using MERGE for the upsert logic.","The SP is structurally identical to usp_TracPerformanceProcedures — consider a generic parameterised trace SP or at minimum extract the common pattern into a documented template."],"migrationRelevance":"medium"},{"name":"usp_UpdateTableDependencyCount","schema":"dbo","parameters":[],"lineCount":75,"tablesReferenced":["MYEVAL_TableDependencyCountSript"],"sprocsCalledFromBody":[],"crudType":"get","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":true,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":false},"calledFromCode":[],"complexity":"complex","aiEnrichment":null,"module":"MYEVAL","summary":"Processes up to 500 unexecuted COUNT scripts from MYEVAL_TableDependencyCountSript by dynamically executing each script via sp_executesql with a 1-second WAITFOR DELAY between executions, capturing record counts and errors, then updating the source table with results.","businessPurpose":"Executes the pre-generated dependency count scripts to populate actual record counts in the data-archiving audit table, enabling DBAs to quantify dependent data volumes for each closed department before performing data purges.","optimizationRecommendations":["WAITFOR DELAY '00:00:01' between each sp_executesql execution artificially throttles to ~500 executions per ~8 minutes — this is extreme for a maintenance SP; reduce or remove the delay unless intentional rate-limiting is required.","Dynamic SQL execution via sp_executesql inside a loop with no query plan caching causes plan cache pollution — consider using a temp table and batch-executing scripts where possible.","The BEGIN TRANSACTION/ROLLBACK per iteration is correct for isolation but generates significant log activity for 500 iterations; consider using READ UNCOMMITTED isolation for COUNT queries which don't modify data.","Top 500 is hardcoded — make configurable via a parameter."],"migrationRelevance":"low"},{"name":"usp_UserCompletedAndPendingEvaluations_Job","schema":"dbo","parameters":[],"lineCount":64,"tablesReferenced":["MyEval_UserPendingEvaluationsTrace"],"sprocsCalledFromBody":["usp_GenerateCompletedEvaluationsResult_API","usp_GetIncompleteEvaluations_API"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Processes pending evaluation refresh requests from MyEval_UserPendingEvaluationsTrace, calling usp_GetIncompleteEvaluations_API for pending/overdue evaluations and usp_GenerateCompletedEvaluationsResult_API for completed evaluations for each user, then marks records as processed.","businessPurpose":"Scheduled job that refreshes the pending and completed evaluation cache for each user's dashboard, ensuring residents and faculty see accurate counts of overdue, pending, and completed evaluations.","optimizationRecommendations":["The SP loops through all pending users twice (once for incomplete, once for completed) — combine both EXEC calls into a single loop iteration to halve the database round-trips.","usp_GetIncompleteEvaluations_API is called with @PageSize=100000 — for users with many evaluations this can return extremely large result sets; verify this is necessary for the cache refresh context.","No error handling in either WHILE loop — add TRY/CATCH per iteration."],"migrationRelevance":"high"},{"name":"usp_ValidateScheduleAssignments","schema":"dbo","parameters":[],"lineCount":56,"tablesReferenced":["MyEvals_ScheduleAssignmentValidation","MyEvals_ScheduleDetails"],"sprocsCalledFromBody":["usp_ValidateScheduleData"],"crudType":"mixed","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":false,"nolockCount":0,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Dequeues up to 5 pending schedule validation requests from MyEvals_ScheduleAssignmentValidation, calls usp_ValidateScheduleData for each department/academic-year, and if data mismatches are detected, resets the schedule details timestamp to trigger a full data reload.","businessPurpose":"Post-refresh validation job that verifies the MyEvals_ScheduleAssignments denormalised table matches the source vScheduleAssignments6 view, automatically triggering re-synchronisation when discrepancies are detected.","optimizationRecommendations":["@LoginUserID is referenced in the UPDATE but is not declared as a local variable and not visible as a parameter — verify this is a parameter of the SP and not an undeclared variable that would cause a runtime error.","The TOP 5 batch size is conservative — consider making it configurable or increasing it since each iteration involves a full view/table comparison query.","Consider logging validation results (match/mismatch counts) to an audit table for trend monitoring."],"migrationRelevance":"high"},{"name":"usp_ValidateScheduleData","schema":"dbo","parameters":[{"name":"@pDepartmentID","dataType":"BIGINT","direction":"IN","defaultValue":null},{"name":"@pAcademicYear","dataType":"INT","direction":"IN","defaultValue":null}],"lineCount":82,"tablesReferenced":["MyEvals_ScheduleAssignmentValidation","MyEvals_ScheduleAssignments"],"sprocsCalledFromBody":[],"crudType":"update","antiPatterns":{"hasCursor":false,"hasSelectStar":false,"hasDynamicSql":false,"hasNolock":true,"nolockCount":2,"missingSetNocountOn":false,"hasTableVariable":false,"hasTempTable":true,"hasWhileLoop":false,"hasNoTryCatch":true},"calledFromCode":[],"complexity":"moderate","aiEnrichment":null,"module":"MYEVAL","summary":"Compares the vScheduleAssignments6 view against the MyEvals_ScheduleAssignments table for a given department/academic year using a two-stage check: count comparison followed by EXCEPT-based data diff in both directions, returning a match/mismatch flag via an OUTPUT parameter.","businessPurpose":"Validation SP used by the schedule synchronisation pipeline to detect data drift between the source scheduling view and the cached assignment table, enabling the system to self-heal by triggering re-synchronisation when mismatches are found.","optimizationRecommendations":["SELECT * INTO temp tables from both the view and the permanent table before comparison will fully materialise both datasets in tempdb — for large schedules this is memory-intensive; filter at the SELECT level and avoid SELECT *.","The EXCEPT-based comparison (Case-2.1 and Case-2.2) runs two full table scans after the count check — if counts already differ (Case-1 fails), the EXCEPT blocks are correctly skipped, but the temp table creation still materialises all data unnecessarily; consider deferring temp table creation until after the count check.","The second EXCEPT (Case-2.2, reverse direction) is correct for a complete symmetric diff check but at 4.9KB the body appears truncated — verify both EXCEPT directions are complete.","Output parameter @pIsDataMatchedOut should be explicitly initialised to 0 at the top of the SP before any conditional logic to prevent uninitialised-value bugs."],"migrationRelevance":"high"}]}