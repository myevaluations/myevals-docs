---
title: "SAMLServiceProvider Files"
sidebar_label: "SAMLServiceProvider"
description: "Per-file reference for SAMLServiceProvider (18 files)"
---

import FileReference from '@site/src/components/FileReference';

# SAMLServiceProvider File Reference

**18 files** · **8,340 lines** · Generated 2/20/2026

SAML 2.0 Service Provider and Identity Provider library supporting SSO integration for MyEvaluations. Acts as both an IdP (generating signed/encrypted SAML responses for third-party service providers) and an SP (consuming SAML responses from external identity providers like Salesforce). Also includes JWT token generation for the React frontend authentication. Key integration point for institutional SSO where hospitals and medical schools authenticate users through their own identity providers.

**Key Workflows**

- IdP Flow: SamlIntegrationSteps.BuildEncodedSamlResponse -> SamlAssertionAlgorithms.Create -> Sign -> Encrypt -> SamlResponseAlgorithms.Create -> Sign -> Base64 encode
- SP Flow: ConsumeResponse.LoadXmlFromBase64 -> isAuthenticated (signature verification) -> extract user attributes (username, email, name)
- JWT Flow: JwtToken.GenerateToken -> GetIdentity (build claims) -> GenerateTokenFromIdentity (sign with HMAC-SHA256)
- External Supervisor JWT: JwtToken.GenerateExternalToken -> GetExtrenalSupervisorIdentity -> GenerateTokenFromIdentity (with separate key)

<FileReference
  files={[
  {
    "filePath": "SAMLServiceProvider/Data/IIntegrationConfiguration.cs",
    "fileName": "IIntegrationConfiguration.cs",
    "fileType": "infrastructure",
    "className": "IIntegrationConfiguration",
    "inheritsFrom": null,
    "module": "SAML SSO Configuration",
    "summary": "Interface defining the configuration properties required for SAML integration with third-party service providers. Includes URIs for service provider, logout, return, start, issuer, and certificate thumbprints for signing and encryption.",
    "businessPurpose": "Provides a contract for SAML SSO configuration settings used to integrate with external identity providers or service providers",
    "keyMethods": [
      "ServiceProviderUri - Service provider endpoint URL",
      "LogoutUri - Logout redirect URL",
      "ReturnUri - Return URL after authentication",
      "StartUri - Start URL for SSO flow",
      "IssuerUri - SAML issuer identifier",
      "SigningCertificateThumbprint - Certificate thumbprint for response signing",
      "AssertionEncryptionCertificateThumbprint - Certificate thumbprint for assertion encryption"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "SAML SSO is a critical integration point. The Node.js backend likely needs equivalent SAML support via passport-saml or similar library. Configuration structure should be replicated.",
    "complexity": "trivial",
    "lineCount": 14
  },
  {
    "filePath": "SAMLServiceProvider/Data/IUserDataRepository.cs",
    "fileName": "IUserDataRepository.cs",
    "fileType": "infrastructure",
    "className": "IUserDataRepository",
    "inheritsFrom": null,
    "module": "SAML SSO User Data",
    "summary": "Interface for retrieving user data needed for SAML assertions. Provides methods to get user email and a globally unique identifier used in SAML integration with third-party vendors.",
    "businessPurpose": "Abstracts user data retrieval for SAML assertion generation, decoupling the SAML logic from specific data access",
    "keyMethods": [
      "GetUserEmail - Returns the email of the user within the current context",
      "GetUserGuid - Returns a globally unique identifier for the user for third-party SAML integration"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "User identity resolution for SAML assertions must be migrated. The Node.js backend needs equivalent user lookup for SSO flows.",
    "complexity": "trivial",
    "lineCount": 19
  },
  {
    "filePath": "SAMLServiceProvider/Helpers/ISamlAssertionAlgorithms.cs",
    "fileName": "ISamlAssertionAlgorithms.cs",
    "fileType": "infrastructure",
    "className": "ISamlAssertionAlgorithms",
    "inheritsFrom": null,
    "module": "SAML Assertion",
    "summary": "Interface for SAML assertion operations including creation, signing, and encryption of SAML 2.0 assertions.",
    "businessPurpose": "Defines the contract for building SAML assertions that authenticate users with external systems",
    "keyMethods": [
      "Create - Creates a SAML AssertionType object from settings and user data",
      "Sign - Signs the XML assertion element using X509 certificate",
      "Encrypt - Encrypts the assertion within the SAML response XML document"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "SAML assertion building is critical for SSO. Node.js equivalent would use saml2-js or passport-saml libraries.",
    "complexity": "trivial",
    "lineCount": 12
  },
  {
    "filePath": "SAMLServiceProvider/Helpers/ISamlResponseAlgorithms.cs",
    "fileName": "ISamlResponseAlgorithms.cs",
    "fileType": "infrastructure",
    "className": "ISamlResponseAlgorithms",
    "inheritsFrom": null,
    "module": "SAML Response",
    "summary": "Interface for SAML response operations including creation, signing, and XML serialization of SAML 2.0 response objects.",
    "businessPurpose": "Defines the contract for building complete SAML responses that wrap signed assertions",
    "keyMethods": [
      "Create - Creates a SAML ResponseType wrapping an assertion",
      "Sign - Signs the SAML response XML document",
      "SerializeToXml - Serializes the ResponseType to an XmlDocument"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "SAML response generation is paired with assertion generation for SSO. Must be migrated together.",
    "complexity": "trivial",
    "lineCount": 12
  },
  {
    "filePath": "SAMLServiceProvider/Helpers/SamlAssertionAlgorithms.cs",
    "fileName": "SamlAssertionAlgorithms.cs",
    "fileType": "service",
    "className": "SamlAssertionAlgorithms",
    "inheritsFrom": "ISamlAssertionAlgorithms",
    "module": "SAML Assertion",
    "summary": "Implements SAML 2.0 assertion creation, signing, and encryption. Builds assertions with user attributes, conditions (audience restriction, one-time use), subject confirmation, and authentication statements. Uses X509 certificates from the local machine store for signing and encryption.",
    "businessPurpose": "Core SAML SSO functionality that creates cryptographically signed and optionally encrypted assertions for authenticating MyEvaluations users with external service providers",
    "keyMethods": [
      "Create - Builds a complete SAML AssertionType with attributes, conditions, subject, and auth statements",
      "Sign - Signs the assertion XML element using X509 certificate from local machine store",
      "Encrypt - Encrypts the assertion within the SAML response using XML encryption with X509 certificate"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "Core SAML IdP functionality. The signing and encryption logic uses .NET-specific X509 and XML crypto APIs that need equivalent Node.js implementations (e.g., xml-crypto, node-forge).",
    "complexity": "moderate",
    "lineCount": 218
  },
  {
    "filePath": "SAMLServiceProvider/Helpers/SamlResponseAlgorithms.cs",
    "fileName": "SamlResponseAlgorithms.cs",
    "fileType": "service",
    "className": "SamlResponseAlgorithms",
    "inheritsFrom": "ISamlResponseAlgorithms",
    "module": "SAML Response",
    "summary": "Implements SAML 2.0 response creation, signing, and XML serialization. Creates response objects wrapping assertions with proper SAML namespaces, signs the response using X509 certificates, and serializes to XML with correct namespace prefixes.",
    "businessPurpose": "Generates the complete SAML response envelope that wraps signed assertions for SSO POST binding",
    "keyMethods": [
      "Create - Creates a SAML ResponseType with issuer, status, destination, and embedded assertion",
      "Sign - Signs the response XML document using X509 certificate and inserts signature after issuer element",
      "SerializeToXml - Serializes ResponseType to XmlDocument with proper SAML namespace prefixes"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "SAML response serialization with proper namespace handling is critical. Node.js XML serialization libraries handle this differently.",
    "complexity": "simple",
    "lineCount": 128
  },
  {
    "filePath": "SAMLServiceProvider/Helpers/SamlSignedXml.cs",
    "fileName": "SamlSignedXml.cs",
    "fileType": "infrastructure",
    "className": "SamlSignedXml",
    "inheritsFrom": "SignedXml",
    "module": "SAML XML Signing",
    "summary": "Custom SignedXml subclass that overrides GetIdElement to correctly resolve SAML ID references during XML signature verification. Without this override, the standard SignedXml would not find elements by their SAML-specific ID attribute.",
    "businessPurpose": "Enables correct XML digital signature creation and verification for SAML documents that use custom ID attribute names",
    "keyMethods": [
      "GetIdElement - Overrides default ID element resolution to find elements by configurable attribute name and value"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "medium",
    "migrationNote": "This is a .NET-specific workaround. Node.js XML signing libraries (xml-crypto) handle ID resolution differently.",
    "complexity": "trivial",
    "lineCount": 30
  },
  {
    "filePath": "SAMLServiceProvider/Helpers/SigningHelper.cs",
    "fileName": "SigningHelper.cs",
    "fileType": "infrastructure",
    "className": "SigningHelper",
    "inheritsFrom": null,
    "module": "SAML XML Signing",
    "summary": "Static helper class for signing XML documents and elements for SAML responses. Handles enveloped signature transforms, exclusive C14N canonicalization, and X509 key info attachment. Provides overloaded methods for signing both XmlDocument and XmlElement targets.",
    "businessPurpose": "Central XML digital signature utility used by both assertion and response signing flows",
    "keyMethods": [
      "SignXml(XmlDocument) - Signs an entire XML document with X509 certificate and enveloped signature",
      "SignXml(XmlElement) - Signs an XML element with X509 certificate and enveloped signature",
      "SignXml(SamlSignedXml, certificate, referenceValue) - Core signing logic with transform chain and KeyInfo"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "XML signing is fundamental to SAML. In Node.js, xml-crypto library provides equivalent functionality with different API.",
    "complexity": "simple",
    "lineCount": 70
  },
  {
    "filePath": "SAMLServiceProvider/Helpers/X509CertificateHelper.cs",
    "fileName": "X509CertificateHelper.cs",
    "fileType": "infrastructure",
    "className": "X509CertificateHelper",
    "inheritsFrom": null,
    "module": "Certificate Management",
    "summary": "Static helper for retrieving X509 certificates from the Windows certificate store by thumbprint. Opens the specified store, searches by thumbprint, and returns the first matching certificate.",
    "businessPurpose": "Provides certificate lookup from the Windows certificate store for SAML signing and encryption operations",
    "keyMethods": [
      "GetCertificateByThumbprint - Retrieves an X509Certificate2 from a specified store by its thumbprint"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "Windows certificate store access is IIS/Windows-specific. In Node.js/Azure, certificates are typically loaded from files, environment variables, or Azure Key Vault.",
    "complexity": "trivial",
    "lineCount": 42
  },
  {
    "filePath": "SAMLServiceProvider/ISamlIntegrationSteps.cs",
    "fileName": "ISamlIntegrationSteps.cs",
    "fileType": "infrastructure",
    "className": "ISamlIntegrationSteps",
    "inheritsFrom": null,
    "module": "SAML SSO Integration",
    "summary": "Interface defining the high-level SAML integration orchestration. Single method that builds a complete signed, encrypted, and base64-encoded SAML response ready for HTTP POST binding.",
    "businessPurpose": "Defines the public contract for SAML SSO response generation used by the web application layer",
    "keyMethods": [
      "BuildEncodedSamlResponse - Builds a complete base64-encoded SAML response ready for POST"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "This is the main entry point for SAML SSO from the web application. The Node.js backend needs an equivalent service.",
    "complexity": "trivial",
    "lineCount": 13
  },
  {
    "filePath": "SAMLServiceProvider/JwtToken.cs",
    "fileName": "JwtToken.cs",
    "fileType": "service",
    "className": "JwtToken",
    "inheritsFrom": null,
    "module": "Authentication / JWT",
    "summary": "JWT token generation and validation for internal authentication. Generates tokens with claims for UserID, DepartmentID, RoleID, UserTypeID, QRCodeID, and IsReview. Also handles external supervisor tokens with separate signing keys. Contains hardcoded secrets and the AuthOptions configuration class.",
    "businessPurpose": "Provides JWT-based authentication for the new React procedure pages, enabling stateless auth between the .NET backend and React frontend. Also supports external supervisor access via separate tokens.",
    "keyMethods": [
      "ValidateToken - Validates a JWT from an HttpCookie using the standard signing key",
      "ValidateExternal - Validates an external supervisor JWT using a separate signing key",
      "GenerateToken - Creates a JWT with department, user, role, and type claims",
      "GenerateExternalToken - Creates a JWT for external supervisors with procedure context",
      "GenerateTokenFromIdentity - Core token generation from ClaimsIdentity with configurable key",
      "GetIdentity - Builds a ClaimsIdentity with standard user claims",
      "GetExtrenalSupervisorIdentity - Builds a ClaimsIdentity for external supervisor access"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "JWT generation/validation is already partially migrated to the Node.js backend. The hardcoded secrets must match between .NET and Node.js during the migration period. The AuthOptions class contains shared secret keys.",
    "complexity": "moderate",
    "lineCount": 152
  },
  {
    "filePath": "SAMLServiceProvider/LoadProperties.cs",
    "fileName": "LoadProperties.cs",
    "fileType": "infrastructure",
    "className": "LoadProperties",
    "inheritsFrom": null,
    "module": "SAML Configuration",
    "summary": "Loads SAML integration properties from config.properties files stored per issuer under the Documents/Certificates directory. Reads IDP issuer URL, certificate filename, issuer name, and assertion consumer service URL from key=value format files.",
    "businessPurpose": "Loads per-institution SAML configuration from file system, enabling multi-tenant SAML SSO with different identity providers per institution",
    "keyMethods": [
      "initProperties - Reads config.properties file for the current issuer and populates static fields"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "medium",
    "migrationNote": "File-based configuration should be migrated to database or environment-based configuration in the Node.js backend.",
    "complexity": "trivial",
    "lineCount": 47
  },
  {
    "filePath": "SAMLServiceProvider/Properties/AssemblyInfo.cs",
    "fileName": "AssemblyInfo.cs",
    "fileType": "infrastructure",
    "className": null,
    "inheritsFrom": null,
    "module": "Assembly Metadata",
    "summary": "Standard .NET assembly info file with version and metadata attributes for the SAMLServiceProvider project.",
    "businessPurpose": "Assembly metadata configuration",
    "keyMethods": [],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "none",
    "migrationNote": null,
    "complexity": "trivial",
    "lineCount": 37
  },
  {
    "filePath": "SAMLServiceProvider/SAMLServiceProviderRequest.cs",
    "fileName": "SAMLServiceProviderRequest.cs",
    "fileType": "service",
    "className": "SAMLServiceProviderRequest",
    "inheritsFrom": null,
    "module": "SAML SP / Consumer",
    "summary": "Contains three classes: an empty SAMLServiceProviderRequest, a ConsumeResponse class that validates and parses incoming SAML responses from identity providers (extracting subject, username, firstName, lastName, email, portalUser), and an AuthnRequest class that generates SAML authentication requests. Also includes a Certificate class for loading X509 certificates from files.",
    "businessPurpose": "Handles the Service Provider side of SAML SSO: generating authentication requests to send to identity providers and consuming/validating SAML responses received back. Supports multiple identity providers via per-issuer certificate loading.",
    "keyMethods": [
      "ConsumeResponse.LoadXml - Loads SAML response XML for processing",
      "ConsumeResponse.LoadXmlFromBase64 - Decodes and loads base64-encoded SAML response",
      "ConsumeResponse.isAuthenticated - Validates SAML response signature using X509 certificate",
      "ConsumeResponse.getSubject - Extracts NameID subject from SAML assertion",
      "ConsumeResponse.getUsername - Extracts UserName attribute from SAML assertion",
      "ConsumeResponse.getFirstName - Extracts FirstName attribute from SAML assertion",
      "ConsumeResponse.getLastName - Extracts LastName attribute from SAML assertion",
      "ConsumeResponse.getEmail - Extracts Email attribute from SAML assertion",
      "ConsumeResponse.getPortalUser - Extracts is_portal_user attribute from SAML assertion",
      "AuthnRequest.GetRequest - Generates a deflate-compressed, base64-encoded SAML AuthnRequest",
      "Certificate.loadCert - Loads X509 certificate from file system"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "This is the SP side of SAML, consuming SSO responses from external IdPs. Institutions use this for SSO login. passport-saml in Node.js handles this pattern. The attribute extraction logic must match institution-specific SAML attribute names.",
    "complexity": "moderate",
    "lineCount": 238
  },
  {
    "filePath": "SAMLServiceProvider/SamlIntegrationSettings.cs",
    "fileName": "SamlIntegrationSettings.cs",
    "fileType": "class",
    "className": "SamlIntegrationSettings",
    "inheritsFrom": null,
    "module": "SAML Configuration",
    "summary": "Data class holding SAML integration settings including recipient, issuer, audience, certificate thumbprint, assertion signing flag, ID prefix, encryption certificate thumbprint, and a dictionary of custom attributes to include in the assertion.",
    "businessPurpose": "Encapsulates all parameters needed to generate a SAML response for a specific integration, supporting flexible attribute configuration per third-party vendor",
    "keyMethods": [],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "medium",
    "migrationNote": "Settings class maps to configuration DTOs in Node.js. Structure should be preserved.",
    "complexity": "trivial",
    "lineCount": 42
  },
  {
    "filePath": "SAMLServiceProvider/SamlIntegrationSteps.cs",
    "fileName": "SamlIntegrationSteps.cs",
    "fileType": "service",
    "className": "SamlIntegrationSteps",
    "inheritsFrom": "ISamlIntegrationSteps",
    "module": "SAML SSO Orchestration",
    "summary": "Orchestrates the complete SAML SSO response generation flow. Builds settings from configuration, creates assertions with user attributes (UserId, LogoutUri, ReturnUri, StartUri), signs assertions, optionally encrypts them, signs the response, and returns base64-encoded result ready for HTTP POST binding.",
    "businessPurpose": "Main orchestrator for SAML IdP functionality - coordinates assertion creation, signing, encryption, and response signing into a single encoded response for SSO",
    "keyMethods": [
      "BuildEncodedSamlResponse - Orchestrates full SAML response generation: settings, assertion, sign, encrypt, encode",
      "BuildAndSignSamlResponse - Internal method that performs assertion creation, signing, optional encryption, and response signing"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "high",
    "migrationNote": "This is the IdP-side SAML flow orchestrator. The Node.js backend needs to replicate this workflow for any third-party integrations that rely on MyEvaluations as an IdP.",
    "complexity": "simple",
    "lineCount": 119
  },
  {
    "filePath": "SAMLServiceProvider/SamlResponse.cs",
    "fileName": "SamlResponse.cs",
    "fileType": "service",
    "className": "SamlResponse",
    "inheritsFrom": null,
    "module": "SAML Cryptography",
    "summary": "Provides alternative SAML response signing using BouncyCastle library for PEM key handling. Imports RSA public/private keys from PEM format, signs XML documents with enveloped signature transforms, and extracts PEM private keys from X509 certificates.",
    "businessPurpose": "Supports SAML signing scenarios where PEM-format keys are needed instead of Windows certificate store, enabling compatibility with non-Windows certificate formats",
    "keyMethods": [
      "ImportPublicKey - Imports RSA key from PEM format using BouncyCastle PemReader",
      "Sign - Signs an XML document using PEM private key with C14N and enveloped transforms",
      "GetPemKey - Extracts PEM-format private key string from an X509Certificate2"
    ],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "medium",
    "migrationNote": "PEM key handling is more natural in Node.js. The crypto module natively supports PEM format.",
    "complexity": "simple",
    "lineCount": 92
  },
  {
    "filePath": "SAMLServiceProvider/Schemas/SamlSchemas.cs",
    "fileName": "SamlSchemas.cs",
    "fileType": "infrastructure",
    "className": "SignatureType",
    "inheritsFrom": null,
    "module": "SAML Schema Types",
    "summary": "Auto-generated XML serialization classes from SAML 2.0 XSD schemas. Contains all SAML protocol and assertion types including ResponseType, AssertionType, NameIDType, SubjectType, ConditionsType, AttributeType, StatusType, AuthnStatementType, and XML digital signature types. Generated by xsd.exe tool.",
    "businessPurpose": "Provides strongly-typed C# classes for SAML 2.0 XML serialization and deserialization, enabling the creation and parsing of SAML protocol messages",
    "keyMethods": [],
    "storedProcedures": [],
    "businessManagersUsed": [],
    "migrationRelevance": "low",
    "migrationNote": "Auto-generated schema types. Node.js SAML libraries handle XML schema mapping internally.",
    "complexity": "very-complex",
    "lineCount": 7055
  }
]}
/>
